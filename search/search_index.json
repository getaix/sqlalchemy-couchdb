{"config":{"lang":["zh","en"],"separator":"[\\\\s\\\\-]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"SQLAlchemy CouchDB \u200b\u65b9\u8a00","text":"<p> \u200b\u529f\u80fd\u5f3a\u5927\u200b\u7684\u200b SQLAlchemy 2.0+ CouchDB \u200b\u9a71\u52a8\u200b </p> <p> </p>"},{"location":"#_1","title":"\u2728 \u200b\u9879\u76ee\u200b\u7279\u6027","text":""},{"location":"#phase-1-couchdb","title":"\ud83c\udfaf Phase 1: \u200b\u7eaf\u200b CouchDB \u200b\u6a21\u5f0f\u200b <code>\u2705 \u200b\u5df2\u200b\u5b8c\u6210\u200b</code>","text":"<p>\u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b</p> <ul> <li>\u2705 \u200b\u5b8c\u6574\u200b\u7684\u200b SQLAlchemy \u200b\u652f\u6301\u200b: \u200b\u5b9e\u73b0\u200b SQLAlchemy 2.0+ Dialect \u200b\u63a5\u53e3\u200b</li> <li>\u2705 \u200b\u540c\u6b65\u200b + \u200b\u5f02\u6b65\u200b: 100%\u200b\u652f\u6301\u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\uff08greenlet\u200b\u673a\u5236\u200b\uff09</li> <li>\u2705 SQL \u2192 Mango Query: \u200b\u81ea\u52a8\u200b\u5c06\u200b SQL \u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB Mango Query</li> <li>\u2705 \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b: \u200b\u5b8c\u6574\u200b\u7684\u200b Python \u2194 JSON \u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b</li> <li>\u2705 \u200b\u57fa\u4e8e\u200b httpx: \u200b\u9ad8\u6027\u80fd\u200b HTTP \u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u652f\u6301\u200b\u8fde\u63a5\u6c60\u200b</li> <li>\u2705 \u200b\u5b8c\u6574\u200b\u6d4b\u8bd5\u200b: 487\u200b\u9879\u200b\u6d4b\u8bd5\u901a\u8fc7\u200b\uff0c80% \u200b\u4ee3\u7801\u200b\u8986\u76d6\u7387\u200b</li> <li>\u2705 \u200b\u81ea\u52a8\u200b\u7d22\u5f15\u200b\u7ba1\u7406\u200b: ORDER BY \u200b\u64cd\u4f5c\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u6240\u200b\u9700\u200b\u7d22\u5f15\u200b</li> <li>\u2705 \u200b\u53c2\u6570\u200b\u7ed1\u5b9a\u200b: \u200b\u6b63\u786e\u5904\u7406\u200b SQLAlchemy 2.0 \u200b\u7684\u200b BindParameter \u200b\u673a\u5236\u200b</li> <li>\u2705 \u200b\u5f02\u6b65\u200b\u5e76\u53d1\u200b: \u200b\u652f\u6301\u200b asyncio.gather() \u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b</li> </ul>"},{"location":"#phase-2","title":"\ud83d\udea7 Phase 2: \u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u67b6\u6784\u200b <code>\u23f3 \u200b\u5df2\u200b\u5b9e\u73b0\u200b</code>","text":"<p>\u200b\u6df7\u5408\u200b\u67b6\u6784\u200b\u529f\u80fd\u200b</p> <ul> <li>\u23f3 \u200b\u667a\u80fd\u200b\u67e5\u8be2\u200b\u8def\u7531\u200b: \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\uff0c\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b</li> <li>\u23f3 \u200b\u53cc\u5199\u200b\u540c\u6b65\u200b: \u200b\u81ea\u52a8\u200b\u540c\u6b65\u200b\u6570\u636e\u200b\u5230\u200b CouchDB \u200b\u548c\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b</li> <li>\u23f3 \u200b\u901a\u7528\u200b\u6570\u636e\u5e93\u200b\u652f\u6301\u200b: \u200b\u652f\u6301\u200b PostgreSQL, MySQL, SQLite \u200b\u7b49\u200b</li> <li>\u23f3 \u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b: \u200b\u81ea\u52a8\u200b\u5904\u7406\u200b CouchDB \u200b\u7279\u6b8a\u200b\u5b57\u200b\u6bb5\u200b\uff08<code>_id</code>, <code>_rev</code>, <code>type</code>\uff09</li> <li>\u23f3 \u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b: \u200b\u540e\u53f0\u200b\u76d1\u63a7\u200b\u548c\u200b\u81ea\u52a8\u200b\u4fee\u590d\u200b\u6570\u636e\u200b\u5dee\u5f02\u200b</li> </ul>"},{"location":"#_2","title":"\ud83d\ude80 \u200b\u5feb\u901f\u200b\u5f00\u59cb","text":""},{"location":"#_3","title":"\u5b89\u88c5","text":"<pre><code>pip install sqlalchemy-couchdb\n</code></pre>"},{"location":"#_4","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"\u540c\u6b65\u64cd\u4f5c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b <pre><code>from sqlalchemy import create_engine, text\n\n# \u200b\u521b\u5efa\u200b\u5f15\u64ce\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u200b\u4f7f\u7528\u200b\u8fde\u63a5\u200b\nwith engine.connect() as conn:\n    # \u200b\u63d2\u5165\u200b\u6570\u636e\u200b\n    conn.execute(text(\"\"\"\n        INSERT INTO users (name, age, email)\n        VALUES (:name, :age, :email)\n    \"\"\"), {\"name\": \"Alice\", \"age\": 30, \"email\": \"alice@example.com\"})\n\n    # \u200b\u67e5\u8be2\u200b\u6570\u636e\u200b\n    result = conn.execute(text(\"SELECT * FROM users WHERE age &gt; :age\"), {\"age\": 25})\n    for row in result:\n        print(f\"{row.name}: {row.age}\")\n\n    conn.commit()\n</code></pre> <pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def main():\n    # \u200b\u521b\u5efa\u200b\u5f02\u6b65\u200b\u5f15\u64ce\u200b\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        # \u200b\u63d2\u5165\u200b\u6570\u636e\u200b\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (name, age, email)\n            VALUES (:name, :age, :email)\n        \"\"\"), {\"name\": \"Bob\", \"age\": 25, \"email\": \"bob@example.com\"})\n\n        # \u200b\u67e5\u8be2\u200b\u6570\u636e\u200b\n        result = await conn.execute(text(\"SELECT * FROM users WHERE age &gt; :age\"), {\"age\": 20})\n\n        # \u200b\u6ce8\u610f\u200b\uff1a\u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\uff08\u200b\u7ed3\u679c\u200b\u5df2\u200b\u5728\u200b execute \u200b\u65f6\u200b\u7f13\u5b58\u200b\uff09\n        for row in result:\n            print(f\"{row.name}: {row.age}\")\n\n        await conn.commit()\n\n    await engine.dispose()\n\nasyncio.run(main())\n</code></pre>"},{"location":"#sql","title":"\ud83d\udcca \u200b\u652f\u6301\u200b\u7684\u200b SQL \u200b\u7279\u6027","text":""},{"location":"#phase-1-couchdb_1","title":"Phase 1 (\u200b\u7eaf\u200b CouchDB)","text":"SQL \u200b\u7279\u6027\u200b \u200b\u652f\u6301\u200b\u60c5\u51b5\u200b \u200b\u8bf4\u660e\u200b <code>SELECT</code> \u2705 \u200b\u90e8\u5206\u200b\u652f\u6301\u200b \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\uff0c\u200b\u65e0\u200b JOIN <code>INSERT</code> \u2705 \u200b\u5b8c\u5168\u200b\u652f\u6301\u200b \u200b\u5355\u6761\u200b\u548c\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b <code>UPDATE</code> \u2705 \u200b\u5b8c\u5168\u200b\u652f\u6301\u200b \u200b\u9700\u8981\u200b <code>_rev</code> <code>DELETE</code> \u2705 \u200b\u5b8c\u5168\u200b\u652f\u6301\u200b \u200b\u9700\u8981\u200b <code>_rev</code> <code>WHERE</code> \u2705 \u200b\u5b8c\u5168\u200b\u652f\u6301\u200b \u200b\u652f\u6301\u200b <code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>IN</code>, <code>LIKE</code>, <code>AND</code>, <code>OR</code> <code>LIMIT</code> / <code>OFFSET</code> \u2705 \u200b\u5b8c\u5168\u200b\u652f\u6301\u200b \u200b\u5206\u9875\u200b\u67e5\u8be2\u200b <code>ORDER BY</code> \u2705 \u200b\u5b8c\u5168\u200b\u652f\u6301\u200b \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b <code>JOIN</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b CouchDB \u200b\u9650\u5236\u200b <code>GROUP BY</code> \u26a0\ufe0f \u200b\u90e8\u5206\u200b\u652f\u6301\u200b \u200b\u4f7f\u7528\u200b\u5ba2\u6237\u7aef\u200b\u805a\u5408\u200b <code>UNION</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b <code>\u200b\u5b50\u200b\u67e5\u8be2\u200b</code> \u274c \u200b\u4e0d\u200b\u652f\u6301"},{"location":"#phase-2_1","title":"Phase 2 (\u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b)","text":"<p>\u200b\u901a\u8fc7\u200b\u667a\u80fd\u200b\u8def\u7531\u200b\uff0c\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u81ea\u52a8\u200b\u8f6c\u53d1\u200b\u5230\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\uff1a</p> <ul> <li>\u2705 <code>JOIN</code>, <code>GROUP BY</code>, <code>HAVING</code> \u2192 \u200b\u8def\u7531\u200b\u5230\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b</li> <li>\u2705 <code>\u200b\u5b50\u200b\u67e5\u8be2\u200b</code>, <code>CTE</code>, <code>\u200b\u7a97\u53e3\u200b\u51fd\u6570\u200b</code> \u2192 \u200b\u8def\u7531\u200b\u5230\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b</li> <li>\u2705 \u200b\u4fdd\u7559\u200b CouchDB \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\u7684\u200b\u6027\u80fd\u200b\u4f18\u52bf\u200b</li> </ul>"},{"location":"#_5","title":"\ud83e\uddea \u200b\u6d4b\u8bd5\u72b6\u6001","text":"<p>\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b: \u2705 99.8% \u200b\u901a\u8fc7\u7387\u200b (487/488)</p> \u200b\u6d4b\u8bd5\u200b\u7c7b\u522b\u200b \u200b\u901a\u8fc7\u200b/\u200b\u603b\u6570\u200b \u200b\u72b6\u6001\u200b \u200b\u7f16\u8bd1\u5668\u200b\u6d4b\u8bd5\u200b 100% \u2705 \u200b\u540c\u6b65\u200b\u6d4b\u8bd5\u200b 100% \u2705 \u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b 100% \u2705 \u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b 100% \u2705 \u200b\u4ee3\u7801\u200b\u8986\u76d6\u7387\u200b 80% \ud83c\udf89"},{"location":"#_6","title":"\ud83d\udcda \u200b\u6587\u6863\u200b\u5bfc\u822a","text":""},{"location":"#_7","title":"\u65b0\u624b\u5165\u95e8","text":"<ul> <li>\ud83d\udce6 \u200b\u5b89\u88c5\u200b\u6307\u5357\u200b - \u200b\u73af\u5883\u200b\u914d\u7f6e\u200b\u548c\u200b\u5b89\u88c5\u200b</li> <li>\ud83c\udfaf \u200b\u57fa\u7840\u200b\u7528\u6cd5\u200b - \u200b\u5feb\u901f\u200b\u4e0a\u200b\u624b\u200b\u6559\u7a0b\u200b</li> <li>\ud83d\udd0c \u200b\u8fde\u63a5\u200b\u914d\u7f6e\u200b - \u200b\u8fde\u63a5\u200b\u9009\u9879\u200b\u8be6\u89e3\u200b</li> </ul>"},{"location":"#_8","title":"\u7528\u6237\u200b\u6307\u5357","text":"<ul> <li>\u26a1 \u200b\u540c\u6b65\u64cd\u4f5c\u200b - \u200b\u540c\u6b65\u200b\u6a21\u5f0f\u200b\u5b8c\u6574\u200b\u6307\u5357\u200b</li> <li>\ud83d\udd04 \u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b - \u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u5b8c\u6574\u200b\u6307\u5357\u200b</li> <li>\ud83d\udd00 SQL \u200b\u8f6c\u200b Mango Query - \u200b\u67e5\u8be2\u200b\u8f6c\u6362\u200b\u539f\u7406\u200b</li> <li>\ud83c\udfa8 \u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b - \u200b\u6570\u636e\u200b\u7c7b\u578b\u8f6c\u6362\u200b</li> <li>\ud83d\udd17 \u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u6a21\u5f0f\u200b - Phase 2 \u200b\u6df7\u5408\u200b\u67b6\u6784\u200b</li> </ul>"},{"location":"#api","title":"API \u200b\u53c2\u8003","text":"<ul> <li>\ud83d\udd27 Dialect API - SQLAlchemy \u200b\u65b9\u8a00\u200b\u63a5\u53e3\u200b</li> <li>\u2699\ufe0f Compiler API - SQL \u200b\u7f16\u8bd1\u5668\u200b</li> <li>\ud83d\udce1 Client API - CouchDB \u200b\u5ba2\u6237\u7aef\u200b</li> <li>\ud83c\udff7\ufe0f Types API - \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b</li> <li>\u26a0\ufe0f Exceptions API - \u200b\u5f02\u5e38\u200b\u5904\u7406\u200b</li> </ul>"},{"location":"#_9","title":"\ud83c\udfaf \u200b\u7279\u6027\u200b\u4eae\u70b9","text":""},{"location":"#_10","title":"\u6279\u91cf\u200b\u63d2\u5165\u200b\u4f18\u5316","text":"<pre><code>from sqlalchemy import insert\n\n# \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\uff083-10x \u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\uff09\nusers = [\n    {\"name\": \"User1\", \"age\": 25},\n    {\"name\": \"User2\", \"age\": 30},\n    # ... \u200b\u66f4\u200b\u591a\u200b\u6570\u636e\u200b\n]\n\nwith engine.connect() as conn:\n    conn.execute(insert(users_table), users)\n    conn.commit()\n</code></pre>"},{"location":"#_11","title":"\u67e5\u8be2\u200b\u7f13\u5b58","text":"<pre><code>from sqlalchemy_couchdb.cache import QueryCache\n\n# \u200b\u542f\u7528\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b\ncache = QueryCache(max_size=1000, ttl=300)\n\n# \u200b\u7f13\u5b58\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5904\u7406\u200b\nresult = conn.execute(query)  # \u200b\u7b2c\u4e00\u6b21\u200b\uff1a\u200b\u67e5\u8be2\u6570\u636e\u5e93\u200b\nresult = conn.execute(query)  # \u200b\u7b2c\u4e8c\u6b21\u200b\uff1a\u200b\u4ece\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u200b\n</code></pre>"},{"location":"#phase-2_2","title":"\u667a\u80fd\u200b\u8def\u7531\u200b\uff08Phase 2\uff09","text":"<pre><code># \u200b\u81ea\u52a8\u200b\u8def\u7531\u200b\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost/pgdb'\n)\n\n# \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\uff08\u200b\u5feb\u200b\uff09\nresult = conn.execute(\"SELECT * FROM users WHERE age &gt; 25\")\n\n# \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 PostgreSQL\uff08\u200b\u529f\u80fd\u200b\u5b8c\u6574\u200b\uff09\nresult = conn.execute(\"\"\"\n    SELECT u.name, COUNT(o.id) as order_count\n    FROM users u\n    JOIN orders o ON u.id = o.user_id\n    GROUP BY u.name\n\"\"\")\n</code></pre>"},{"location":"#_12","title":"\ud83d\udd17 \u200b\u5feb\u901f\u200b\u94fe\u63a5","text":"<ul> <li>GitHub \u200b\u4ed3\u5e93\u200b</li> <li>PyPI \u200b\u5305\u200b</li> <li>\u200b\u95ee\u9898\u200b\u62a5\u544a\u200b</li> <li>\u200b\u8d21\u732e\u200b\u6307\u5357\u200b</li> </ul>"},{"location":"#_13","title":"\ud83d\udcc4 \u200b\u8bb8\u53ef\u8bc1","text":"<p>\u200b\u672c\u200b\u9879\u76ee\u200b\u91c7\u7528\u200b MIT \u200b\u8bb8\u53ef\u8bc1\u200b\u3002</p> <p> \u2b50 \u200b\u5982\u679c\u200b\u89c9\u5f97\u200b\u6709\u7528\u200b\uff0c\u200b\u8bf7\u200b\u7ed9\u200b\u6211\u4eec\u200b\u4e00\u4e2a\u200b Star\uff01 </p>"},{"location":"faq/","title":"\u5e38\u89c1\u200b\u95ee\u9898\u89e3\u7b54\u200b (FAQ)","text":""},{"location":"faq/#_1","title":"\u5b89\u88c5\u200b\u95ee\u9898","text":""},{"location":"faq/#q-no-module-named-sqlalchemy_couchdb","title":"Q: \u200b\u5b89\u88c5\u200b\u65f6\u200b\u63d0\u793a\u200b \"No module named 'sqlalchemy_couchdb'\"","text":"<p>A: \u200b\u8bf7\u200b\u786e\u4fdd\u200b\u6b63\u786e\u200b\u5b89\u88c5\u5305\u200b\uff1a</p> <pre><code># \u200b\u4f7f\u7528\u200b pip\npip install sqlalchemy-couchdb\n\n# \u200b\u6216\u200b\u4ece\u200b\u6e90\u7801\u200b\u5b89\u88c5\u200b\ngit clone https://github.com/getaix/sqlalchemy-couchdb.git\ncd sqlalchemy-couchdb\npip install -e .\n</code></pre>"},{"location":"faq/#q-python","title":"Q: Python \u200b\u7248\u672c\u200b\u4e0d\u200b\u517c\u5bb9","text":"<p>A: SQLAlchemy CouchDB \u200b\u9700\u8981\u200b Python 3.11+\uff1a</p> <pre><code># \u200b\u68c0\u67e5\u200b Python \u200b\u7248\u672c\u200b\npython --version\n\n# \u200b\u5982\u679c\u200b\u7248\u672c\u200b\u8fc7\u4f4e\u200b\uff0c\u200b\u8bf7\u200b\u5347\u7ea7\u200b Python\n# \u200b\u6216\u200b\u4f7f\u7528\u200b pyenv\npyenv install 3.11.0\npyenv local 3.11.0\n</code></pre>"},{"location":"faq/#q-httpx","title":"Q: httpx \u200b\u7248\u672c\u200b\u51b2\u7a81","text":"<p>A: \u200b\u786e\u4fdd\u200b\u5b89\u88c5\u200b\u517c\u5bb9\u200b\u7248\u672c\u200b\uff1a</p> <pre><code>pip install --upgrade httpx&gt;=0.27.0\n</code></pre>"},{"location":"faq/#_2","title":"\u8fde\u63a5\u200b\u95ee\u9898","text":""},{"location":"faq/#q-couchdb","title":"Q: \u200b\u65e0\u6cd5\u200b\u8fde\u63a5\u200b\u5230\u200b CouchDB","text":"<p>A: \u200b\u68c0\u67e5\u200b\u4ee5\u4e0b\u51e0\u70b9\u200b\uff1a</p> <ol> <li> <p>CouchDB \u200b\u670d\u52a1\u200b\u662f\u5426\u200b\u8fd0\u884c\u200b: <pre><code>curl http://localhost:5984/\n</code></pre></p> </li> <li> <p>\u200b\u9632\u706b\u5899\u200b\u8bbe\u7f6e\u200b: <pre><code># Ubuntu/Debian\nsudo ufw allow 5984\n\n# CentOS/RHEL\nsudo firewall-cmd --add-port=5984/tcp --permanent\nsudo firewall-cmd --reload\n</code></pre></p> </li> <li> <p>\u200b\u8fde\u63a5\u200b URL \u200b\u683c\u5f0f\u200b: <pre><code># \u200b\u6b63\u786e\u200b\u683c\u5f0f\u200b\ncouchdb://username:password@host:port/database\n\n# \u200b\u793a\u4f8b\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n</code></pre></p> </li> </ol>"},{"location":"faq/#q","title":"Q: \u200b\u8ba4\u8bc1\u200b\u5931\u8d25","text":"<p>A: \u200b\u68c0\u67e5\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\uff1a</p> <pre><code># \u200b\u6d4b\u8bd5\u200b\u8ba4\u8bc1\u200b\ncurl -X GET http://admin:password@localhost:5984/mydb\n</code></pre>"},{"location":"faq/#q_1","title":"Q: \u200b\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728","text":"<p>A: \u200b\u5148\u200b\u521b\u5efa\u200b\u6570\u636e\u5e93\u200b\uff1a</p> <pre><code>curl -X PUT http://admin:password@localhost:5984/mydb\n</code></pre>"},{"location":"faq/#_3","title":"\u4f7f\u7528\u200b\u95ee\u9898","text":""},{"location":"faq/#q_2","title":"Q: \u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\u7ed3\u679c\u200b\u4e3a\u7a7a","text":"<p>A: \u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\uff08\u200b\u7ed3\u679c\u200b\u5df2\u200b\u7f13\u5b58\u200b\uff09\uff1a</p> <pre><code># \u2705 \u200b\u6b63\u786e\u200b\nresult = await conn.execute(text(\"SELECT * FROM users\"))\nfor row in result:  # \u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\n    print(row.name)\n\n# \u274c \u200b\u9519\u8bef\u200b\nasync for row in result:  # \u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b async for\n    print(row.name)\n</code></pre>"},{"location":"faq/#q-","title":"Q: \u200b\u66f4\u65b0\u200b\u5931\u8d25\u200b - \u200b\u6587\u6863\u200b\u51b2\u7a81","text":"<p>A: CouchDB \u200b\u4e50\u89c2\u200b\u9501\u200b\u673a\u5236\u200b\uff0c\u200b\u9700\u8981\u200b\u6700\u65b0\u200b <code>_rev</code>\uff1a</p> <pre><code># \u200b\u9519\u8bef\u5904\u7406\u200b\ntry:\n    conn.execute(text(\"UPDATE users SET age=31 WHERE _id='user:123'\"))\n    conn.commit()\nexcept Exception:\n    # \u200b\u6587\u6863\u200b\u53ef\u80fd\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\n    result = conn.execute(text(\"SELECT * FROM users WHERE _id='user:123'\"))\n    row = result.fetchone()\n    print(f\"\u200b\u6700\u65b0\u200b\u7248\u672c\u200b: {row._rev}\")\n</code></pre>"},{"location":"faq/#q-order-by","title":"Q: ORDER BY \u200b\u6027\u80fd\u200b\u5dee","text":"<p>A: ORDER BY \u200b\u9700\u8981\u200b\u7d22\u5f15\u200b\uff0c\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u6216\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\uff1a</p> <pre><code># \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    ORDER BY age DESC  -- \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b age \u200b\u7d22\u5f15\u200b\n\"\"\"))\n\n# \u200b\u6216\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\nfrom sqlalchemy_couchdb.client import SyncCouchDBClient\nclient = SyncCouchDBClient(...)\nclient.ensure_index(\"age\", design_doc=\"age-index\")\n</code></pre>"},{"location":"faq/#q-like","title":"Q: LIKE \u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\u5dee","text":"<p>A: LIKE \u200b\u67e5\u8be2\u200b\u4f7f\u7528\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u6027\u80fd\u200b\u8f83\u200b\u4f4e\u200b\uff1a</p> <pre><code># \u200b\u6027\u80fd\u200b\u8f83\u200b\u597d\u200b\uff1a\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\nSELECT * FROM users WHERE name LIKE 'Alice%'\n\n# \u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b\uff1a\u200b\u5305\u542b\u200b\u5339\u914d\u200b\nSELECT * FROM users WHERE name LIKE '%lice%'\n\n# \u200b\u6700\u4f73\u200b\u65b9\u6848\u200b\uff1a\u200b\u4f7f\u7528\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b\u6216\u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5\u200b\nSELECT * FROM users WHERE name = 'Alice'\n</code></pre>"},{"location":"faq/#_4","title":"\u7c7b\u578b\u200b\u95ee\u9898","text":""},{"location":"faq/#q_3","title":"Q: \u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\u683c\u5f0f\u200b\u9519\u8bef","text":"<p>A: \u200b\u4f7f\u7528\u200b\u6b63\u786e\u200b\u683c\u5f0f\u200b\uff1a</p> <pre><code>from datetime import datetime\n\n# \u2705 \u200b\u6b63\u786e\u200b\uff1a\u200b\u4f7f\u7528\u200b datetime \u200b\u5bf9\u8c61\u200b\nconn.execute(text(\"...\"), {\n    'created_at': datetime(2025, 1, 2, 15, 30, 0)\n})\n\n# \u2705 \u200b\u6b63\u786e\u200b\uff1aISO 8601 \u200b\u5b57\u7b26\u4e32\u200b\nconn.execute(text(\"...\"), {\n    'created_at': '2025-01-02T15:30:00'\n})\n\n# \u274c \u200b\u9519\u8bef\u200b\uff1a\u200b\u5176\u4ed6\u200b\u683c\u5f0f\u200b\nconn.execute(text(\"...\"), {\n    'created_at': '2025/01/02 15:30:00'\n})\n</code></pre>"},{"location":"faq/#q_4","title":"Q: \u200b\u6d6e\u70b9\u6570\u200b\u7cbe\u5ea6\u200b\u635f\u5931","text":"<p>A: \u200b\u4f7f\u7528\u200b Numeric \u200b\u7c7b\u578b\u200b\uff1a</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBNumeric\nfrom decimal import Decimal\n\n# \u200b\u8d27\u5e01\u200b\u7b49\u200b\u9ad8\u7cbe\u5ea6\u200b\u6570\u636e\u200b\nColumn('amount', CouchDBNumeric(precision=10, scale=2, as_string=True))\n\n# \u200b\u4f7f\u7528\u200b\nDecimal('123.456789')\n</code></pre>"},{"location":"faq/#q-json","title":"Q: JSON \u200b\u5b57\u200b\u6bb5\u200b\u67e5\u8be2\u200b\u95ee\u9898","text":"<p>A: CouchDB \u200b\u5bf9\u200b\u5d4c\u5957\u200b JSON \u200b\u67e5\u8be2\u200b\u6709\u200b\u9650\u5236\u200b\uff1a</p> <pre><code># \u274c \u200b\u4e0d\u200b\u63a8\u8350\u200b\uff1a\u200b\u5d4c\u5957\u200b\u67e5\u8be2\u200b\nSELECT * FROM users WHERE metadata-&gt;'preferences'-&gt;&gt;'theme' = 'dark'\n\n# \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u4f7f\u7528\u200b\u7b80\u5355\u200b\u5b57\u200b\u6bb5\u200b\nSELECT * FROM users WHERE theme = 'dark'\n\n# \u200b\u6216\u200b\uff1a\u200b\u5b58\u50a8\u200b\u65f6\u200b\u6241\u5e73\u5316\u200b\nuser = {\n    \"theme\": \"dark\",\n    \"notifications\": True,\n    \"metadata\": {...}  # \u200b\u5176\u4ed6\u200b\u6570\u636e\u200b\n}\n</code></pre>"},{"location":"faq/#sql","title":"SQL \u200b\u7279\u6027\u200b\u95ee\u9898","text":""},{"location":"faq/#q-join","title":"Q: \u200b\u4e0d\u200b\u652f\u6301\u200b JOIN","text":"<p>A: \u200b\u6587\u6863\u200b\u6570\u636e\u5e93\u200b\u56fa\u6709\u200b\u9650\u5236\u200b\uff1a</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nSELECT u.name, o.amount\nFROM users u\nJOIN orders o ON u._id = o.user_id\n\n# \u2705 \u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\uff1a\u200b\u5d4c\u5165\u5f0f\u200b\u6587\u6863\u200b\norder = {\n    \"_id\": \"order:1\",\n    \"user\": {\n        \"id\": \"user:1\",\n        \"name\": \"Alice\"\n    },\n    \"amount\": 99.99\n}\n\n# \u200b\u6216\u200b\uff1a\u200b\u591a\u6b21\u200b\u67e5\u8be2\u200b\nusers = conn.execute(text(\"SELECT * FROM users\")).fetchall()\nfor user in users:\n    orders = conn.execute(\n        text(\"SELECT * FROM orders WHERE user_id = :id\"),\n        {\"id\": user._id}\n    ).fetchall()\n</code></pre>"},{"location":"faq/#q-group-by","title":"Q: \u200b\u4e0d\u200b\u652f\u6301\u200b GROUP BY","text":"<p>A: \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b MapReduce \u200b\u89c6\u56fe\u200b\uff1a</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nSELECT name, COUNT(*) FROM users GROUP BY name\n\n# \u2705 \u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\uff1a\u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b\n# \u200b\u5b9a\u4e49\u200b Map \u200b\u51fd\u6570\u200b\uff1a\n# function(doc) {\n#     if (doc.type == 'user') {\n#         emit(doc.name, 1);\n#     }\n# }\n# Reduce \u200b\u51fd\u6570\u200b\uff1a\n# function(keys, values) {\n#     return sum(values);\n# }\n</code></pre>"},{"location":"faq/#q_5","title":"Q: \u200b\u4e0d\u200b\u652f\u6301\u200b\u5b50\u200b\u67e5\u8be2","text":"<p>A: \u200b\u5e94\u7528\u5c42\u200b\u5904\u7406\u200b\uff1a</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nSELECT * FROM users\nWHERE age &gt; (SELECT AVG(age) FROM users)\n\n# \u2705 \u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\uff1a\u200b\u4e24\u6b21\u200b\u67e5\u8be2\u200b\navg_age = conn.execute(text(\"SELECT AVG(age) as avg FROM users\")).fetchone()\nresult = conn.execute(\n    text(\"SELECT * FROM users WHERE age &gt; :age\"),\n    {\"age\": avg_age.avg}\n)\n</code></pre>"},{"location":"faq/#_5","title":"\u6027\u80fd\u200b\u95ee\u9898","text":""},{"location":"faq/#q_6","title":"Q: \u200b\u67e5\u8be2\u200b\u901f\u5ea6\u6162","text":"<p>A: \u200b\u4f18\u5316\u200b\u5efa\u8bae\u200b\uff1a</p> <ol> <li> <p>\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b: <pre><code># \u200b\u4e3a\u200b\u67e5\u8be2\u200b\u5b57\u200b\u6bb5\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nclient.ensure_index(\"age\")\nclient.ensure_index([\"age\", \"name\"])  # \u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\n</code></pre></p> </li> <li> <p>\u200b\u9650\u5236\u200b\u8fd4\u56de\u200b\u5b57\u200b\u6bb5\u200b: <pre><code># \u2705 \u200b\u53ea\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\nSELECT _id, name FROM users\n\n# \u274c \u200b\u67e5\u8be2\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b\nSELECT * FROM users\n</code></pre></p> </li> <li> <p>\u200b\u4f7f\u7528\u200b LIMIT: <pre><code>SELECT * FROM users LIMIT 100\n</code></pre></p> </li> </ol>"},{"location":"faq/#q_7","title":"Q: \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u6162","text":"<p>A: \u200b\u4f7f\u7528\u200b\u6279\u91cf\u200b API\uff1a</p> <pre><code># \u2705 \u200b\u9ad8\u6548\u200b\uff1a\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\ndata = [{...}, {...}, ...]\nconn.execute(text(\"INSERT INTO ...\"), data)\n\n# \u274c \u200b\u4f4e\u6548\u200b\uff1a\u200b\u5faa\u73af\u200b\u63d2\u5165\u200b\nfor item in data:\n    conn.execute(text(\"INSERT INTO ...\"), item)\n</code></pre>"},{"location":"faq/#q_8","title":"Q: \u200b\u5185\u5b58\u200b\u5360\u7528\u200b\u9ad8","text":"<p>A: \u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\uff1a</p> <pre><code># \u2705 \u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\u5927\u200b\u7ed3\u679c\u200b\u96c6\u200b\nresult = conn.execute(text(\"SELECT * FROM large_table\"))\nwhile True:\n    rows = result.fetchmany(1000)  # \u200b\u5206\u6279\u200b\u83b7\u53d6\u200b\n    if not rows:\n        break\n    process(rows)\n\n# \u274c \u200b\u4e00\u6b21\u6027\u200b\u52a0\u8f7d\u200b\u6240\u6709\u200b\nall_rows = result.fetchall()  # \u200b\u5360\u7528\u200b\u5927\u91cf\u200b\u5185\u5b58\u200b\n</code></pre>"},{"location":"faq/#phase-2","title":"Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u95ee\u9898","text":""},{"location":"faq/#q_9","title":"Q: \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u914d\u7f6e\u200b\u9519\u8bef","text":"<p>A: \u200b\u68c0\u67e5\u200b URL \u200b\u683c\u5f0f\u200b\uff1a</p> <pre><code># \u200b\u6b63\u786e\u200b\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n)\n\n# \u200b\u68c0\u67e5\u200b\u73af\u5883\u53d8\u91cf\u200b\nimport os\nprint(os.getenv('SECONDARY_DB_URL'))\n</code></pre>"},{"location":"faq/#q_10","title":"Q: \u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4","text":"<p>A: Phase 2 \u200b\u4f7f\u7528\u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b\uff1a</p> <pre><code># \u200b\u7b49\u5f85\u200b\u4e00\u81f4\u6027\u200b\nimport time\ntime.sleep(1)  # \u200b\u7b49\u5f85\u200b\u53cc\u5199\u200b\u5b8c\u6210\u200b\n\n# \u200b\u6216\u200b\u624b\u52a8\u200b\u68c0\u67e5\u200b\u4e00\u81f4\u6027\u200b\nresult = conn.execute(text(\"SELECT COUNT(*) FROM users\"))\n# CouchDB \u200b\u548c\u200b PostgreSQL \u200b\u53ef\u80fd\u200b\u77ed\u6682\u200b\u4e0d\u200b\u4e00\u81f4\u200b\n</code></pre>"},{"location":"faq/#q_11","title":"Q: \u200b\u67e5\u8be2\u200b\u8def\u7531\u200b\u9519\u8bef","text":"<p>A: \u200b\u68c0\u67e5\u200b\u8def\u7531\u200b\u7b56\u7565\u200b\uff1a</p> <pre><code># \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\nresult = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n\n# \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 PostgreSQL\nresult = conn.execute(text(\"\"\"\n    SELECT u.name, COUNT(o.id) as order_count\n    FROM users u JOIN orders o ON u._id = o.user_id\n    GROUP BY u.name\n\"\"\"))\n</code></pre>"},{"location":"faq/#_6","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"faq/#q_12","title":"Q: \u200b\u6355\u83b7\u200b\u5f02\u5e38\u200b\u7c7b\u578b","text":"<pre><code>from sqlalchemy_couchdb.exceptions import CouchDBError\n\ntry:\n    conn.execute(text(\"...\"))\nexcept CouchDBError as e:\n    print(f\"CouchDB \u200b\u9519\u8bef\u200b: {e}\")\nexcept Exception as e:\n    print(f\"\u200b\u901a\u7528\u200b\u9519\u8bef\u200b: {e}\")\n</code></pre>"},{"location":"faq/#q_13","title":"Q: \u200b\u91cd\u8bd5\u200b\u673a\u5236","text":"<pre><code>import time\nfrom functools import wraps\n\ndef retry(max_attempts=3, delay=0.1):\n    def decorator(func):\n        @wraps(func)\n        def wrapper(*args, **kwargs):\n            for attempt in range(max_attempts):\n                try:\n                    return func(*args, **kwargs)\n                except Exception as e:\n                    if attempt == max_attempts - 1:\n                        raise\n                    time.sleep(delay)\n        return wrapper\n    return decorator\n\n@retry(max_attempts=3)\ndef update_user(conn, user_id, data):\n    return conn.execute(text(\"UPDATE ...\"), data)\n</code></pre>"},{"location":"faq/#_7","title":"\u8c03\u8bd5\u200b\u6280\u5de7","text":""},{"location":"faq/#q-mango-query","title":"Q: \u200b\u67e5\u770b\u200b\u751f\u6210\u200b\u7684\u200b Mango Query","text":"<pre><code>import logging\nlogging.basicConfig(level=logging.DEBUG)\n\n# \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\u65f6\u4f1a\u200b\u5728\u200b\u63a7\u5236\u53f0\u200b\u770b\u5230\u200b\u7f16\u8bd1\u200b\u8fc7\u7a0b\u200b\nresult = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n</code></pre>"},{"location":"faq/#q-mango-query_1","title":"Q: \u200b\u624b\u52a8\u200b\u6d4b\u8bd5\u200b Mango Query","text":"<pre><code>import httpx\n\n# \u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b HTTP \u200b\u5ba2\u6237\u7aef\u200b\u6d4b\u8bd5\u200b\nwith httpx.Client() as client:\n    response = client.post(\n        'http://localhost:5984/mydb/_find',\n        json={\n            \"selector\": {\"type\": {\"$eq\": \"user\"}},\n            \"limit\": 10\n        }\n    )\n    print(response.json())\n</code></pre>"},{"location":"faq/#q_14","title":"Q: \u200b\u8fde\u63a5\u6c60\u200b\u72b6\u6001","text":"<pre><code>def check_pool(engine):\n    pool = engine.pool\n    print(f\"\u200b\u6c60\u200b\u5927\u5c0f\u200b: {pool.size()}\")\n    print(\"\u200b\u5df2\u200b\u501f\u51fa\u200b:\", pool.checkedout())\n    print(\"\u200b\u5df2\u200b\u8fd4\u56de\u200b:\", pool.returned())\n\ncheck_pool(engine)\n</code></pre>"},{"location":"faq/#_8","title":"\u8d44\u6e90","text":"<ul> <li>\u200b\u5b8c\u6574\u200b\u6587\u6863\u200b</li> <li>GitHub Issues</li> <li>CouchDB \u200b\u6587\u6863\u200b</li> <li>SQLAlchemy \u200b\u6587\u6863\u200b</li> </ul>"},{"location":"about/contributing/","title":"\u8d21\u732e\u200b\u6307\u5357","text":""},{"location":"about/contributing/#_2","title":"\u6b22\u8fce\u200b\u8d21\u732e","text":"<p>\u200b\u611f\u8c22\u60a8\u200b\u5bf9\u200b SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u9879\u76ee\u200b\u7684\u200b\u5174\u8da3\u200b\uff01\u200b\u6211\u4eec\u200b\u6b22\u8fce\u200b\u6240\u6709\u200b\u5f62\u5f0f\u200b\u7684\u200b\u8d21\u732e\u200b\uff0c\u200b\u5305\u62ec\u200b\u4f46\u200b\u4e0d\u200b\u9650\u4e8e\u200b\uff1a</p> <ul> <li>\ud83d\udc1b \u200b\u62a5\u544a\u200b Bug</li> <li>\ud83d\udca1 \u200b\u63d0\u51fa\u200b\u65b0\u200b\u529f\u80fd\u200b\u5efa\u8bae\u200b</li> <li>\ud83d\udcdd \u200b\u5b8c\u5584\u200b\u6587\u6863\u200b</li> <li>\ud83d\udcbb \u200b\u63d0\u4ea4\u200b\u4ee3\u7801\u200b\u4fee\u590d\u200b</li> <li>\ud83e\uddea \u200b\u6dfb\u52a0\u200b\u6d4b\u8bd5\u7528\u4f8b\u200b</li> <li>\ud83c\udfa8 \u200b\u6539\u8fdb\u200b\u4ee3\u7801\u200b\u89c4\u8303\u200b</li> <li>\ud83d\udcca \u200b\u6027\u80fd\u200b\u4f18\u5316\u200b</li> </ul>"},{"location":"about/contributing/#_3","title":"\u5f00\u53d1\u200b\u73af\u5883\u200b\u8bbe\u7f6e","text":""},{"location":"about/contributing/#1","title":"1. \u200b\u514b\u9686\u200b\u4ed3\u5e93","text":"<pre><code>git clone https://github.com/getaix/sqlalchemy-couchdb.git\ncd sqlalchemy-couchdb\n</code></pre>"},{"location":"about/contributing/#2","title":"2. \u200b\u521b\u5efa\u200b\u865a\u62df\u73af\u5883","text":"<pre><code># \u200b\u4f7f\u7528\u200b venv\npython -m venv .venv\nsource .venv/bin/activate  # Linux/Mac\n# .venv\\Scripts\\activate  # Windows\n\n# \u200b\u6216\u200b\u4f7f\u7528\u200b pyenv-virtualenv\npyenv virtualenv 3.11.0 sqlalchemy-couchdb-dev\npyenv local sqlalchemy-couchdb-dev\n</code></pre>"},{"location":"about/contributing/#3","title":"3. \u200b\u5b89\u88c5\u200b\u5f00\u53d1\u200b\u4f9d\u8d56","text":"<pre><code># \u200b\u5b89\u88c5\u200b\u9879\u76ee\u200b\uff08\u200b\u53ef\u200b\u7f16\u8f91\u200b\u6a21\u5f0f\u200b\uff09\npip install -e \".[dev]\"\n\n# \u200b\u5b89\u88c5\u200b\u53ef\u200b\u9009\u200b\u4f9d\u8d56\u200b\uff08Phase 2 \u200b\u5f00\u53d1\u200b\u9700\u8981\u200b\uff09\npip install -e \".[all]\"\n\n# \u200b\u9a8c\u8bc1\u200b\u5b89\u88c5\u200b\npython -c \"import sqlalchemy_couchdb; print(sqlalchemy_couchdb.__version__)\"\n</code></pre>"},{"location":"about/contributing/#4-couchdb","title":"4. \u200b\u542f\u52a8\u200b CouchDB","text":"<pre><code># \u200b\u4f7f\u7528\u200b Docker\uff08\u200b\u63a8\u8350\u200b\uff09\ndocker run -d -p 5984:5984 \\\n  -e COUCHDB_USER=admin \\\n  -e COUCHDB_PASSWORD=password \\\n  --name couchdb-dev couchdb:3\n\n# \u200b\u7b49\u5f85\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\nsleep 5\n\n# \u200b\u521b\u5efa\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\ncurl -X PUT http://admin:password@localhost:5984/testdb\n</code></pre>"},{"location":"about/contributing/#5","title":"5. \u200b\u9a8c\u8bc1\u200b\u5f00\u53d1\u200b\u73af\u5883","text":"<pre><code># \u200b\u8fd0\u884c\u200b\u7b80\u5355\u200b\u6d4b\u8bd5\u200b\npython -m pytest tests/test_compiler.py::TestSelectCompilation::test_simple_select -v\n</code></pre>"},{"location":"about/contributing/#_4","title":"\u5de5\u4f5c\u200b\u6d41\u7a0b","text":""},{"location":"about/contributing/#fork","title":"Fork \u200b\u9879\u76ee","text":"<ol> <li>\u200b\u5728\u200b GitHub \u200b\u4e0a\u200b Fork sqlalchemy-couchdb</li> <li>\u200b\u514b\u9686\u200b\u60a8\u200b\u7684\u200b Fork \u200b\u5230\u200b\u672c\u5730\u200b</li> </ol> <pre><code>git clone https://github.com/YOUR_USERNAME/sqlalchemy-couchdb.git\ncd sqlalchemy-couchdb\n</code></pre> <ol> <li>\u200b\u6dfb\u52a0\u200b\u4e0a\u6e38\u200b\u4ed3\u5e93\u200b</li> </ol> <pre><code>git remote add upstream https://github.com/getaix/sqlalchemy-couchdb.git\n</code></pre>"},{"location":"about/contributing/#_5","title":"\u521b\u5efa\u200b\u5206\u652f","text":"<pre><code># \u200b\u4ece\u200b main \u200b\u5206\u652f\u200b\u521b\u5efa\u200b\u65b0\u200b\u5206\u652f\u200b\ngit checkout -b feature/your-feature-name\n\n# \u200b\u6216\u200b\u4fee\u590d\u200b bug\ngit checkout -b fix/bug-description\n\n# \u200b\u6216\u200b\u6587\u6863\u200b\u6539\u8fdb\u200b\ngit checkout -b docs/improve-documentation\n</code></pre>"},{"location":"about/contributing/#_6","title":"\u5206\u652f\u200b\u547d\u540d\u200b\u89c4\u8303","text":"<pre><code>feature/new-feature-name    # \u200b\u65b0\u200b\u529f\u80fd\u200b\nfix/bug-description         # Bug \u200b\u4fee\u590d\u200b\ndocs/some-docs              # \u200b\u6587\u6863\u200b\u6539\u8fdb\u200b\nrefactor/refactor-something # \u200b\u4ee3\u7801\u200b\u91cd\u6784\u200b\ntest/add-new-tests          # \u200b\u6d4b\u8bd5\u7528\u4f8b\u200b\nperf/optimize-something     # \u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\n</code></pre>"},{"location":"about/contributing/#_7","title":"\u5f00\u53d1\u200b\u6d41\u7a0b","text":"<pre><code># 1. \u200b\u66f4\u65b0\u200b\u4ee3\u7801\u200b\ngit checkout main\ngit pull upstream main\n\n# 2. \u200b\u521b\u5efa\u200b\u5206\u652f\u200b\ngit checkout -b feature/your-feature\n\n# 3. \u200b\u5f00\u53d1\u200b\u4ee3\u7801\u200b\n# ... \u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b ...\n\n# 4. \u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b\npytest\n\n# 5. \u200b\u63d0\u4ea4\u200b\u4ee3\u7801\u200b\ngit add .\ngit commit -m \"feat: \u200b\u6dfb\u52a0\u200b\u65b0\u200b\u529f\u80fd\u200b\u63cf\u8ff0\u200b\"\n\n# 6. \u200b\u63a8\u9001\u200b\u5230\u200b\u60a8\u200b\u7684\u200b Fork\ngit push origin feature/your-feature\n\n# 7. \u200b\u5728\u200b GitHub \u200b\u4e0a\u200b\u521b\u5efa\u200b Pull Request\n</code></pre>"},{"location":"about/contributing/#_8","title":"\u4ee3\u7801\u200b\u89c4\u8303","text":""},{"location":"about/contributing/#_9","title":"\u9075\u5faa\u200b\u89c4\u8303","text":"<ul> <li>\u200b\u9075\u5faa\u200b PEP 8 Python \u200b\u7f16\u7801\u200b\u89c4\u8303\u200b</li> <li>\u200b\u4f7f\u7528\u200b Black \u200b\u683c\u5f0f\u5316\u200b\u4ee3\u7801\u200b</li> <li>\u200b\u4f7f\u7528\u200b isort \u200b\u6392\u5e8f\u200b\u5bfc\u5165\u200b</li> <li>\u200b\u6dfb\u52a0\u200b\u5b8c\u6574\u200b\u7684\u200b\u7c7b\u578b\u200b\u63d0\u793a\u200b</li> <li>\u200b\u7f16\u5199\u200b\u6e05\u6670\u200b\u7684\u200b\u6587\u6863\u200b\u5b57\u7b26\u4e32\u200b</li> </ul>"},{"location":"about/contributing/#_10","title":"\u683c\u5f0f\u5316\u200b\u4ee3\u7801","text":"<pre><code># \u200b\u683c\u5f0f\u5316\u200b\u6240\u6709\u200b Python \u200b\u6587\u4ef6\u200b\nblack sqlalchemy_couchdb tests\n\n# \u200b\u6392\u5e8f\u200b\u5bfc\u5165\u200b\nisort sqlalchemy_couchdb tests\n\n# \u200b\u68c0\u67e5\u200b\u4ee3\u7801\u200b\u98ce\u683c\u200b\nruff check sqlalchemy_couchdb tests\n\n# \u200b\u81ea\u52a8\u200b\u4fee\u590d\u200b\u98ce\u683c\u200b\u95ee\u9898\u200b\nruff check --fix sqlalchemy_couchdb tests\n</code></pre>"},{"location":"about/contributing/#_11","title":"\u7c7b\u578b\u200b\u68c0\u67e5","text":"<pre><code># \u200b\u8fd0\u884c\u200b mypy\nmypy sqlalchemy_couchdb\n\n# \u200b\u5ffd\u7565\u200b\u67d0\u4e9b\u200b\u5bfc\u5165\u200b\u7684\u200b\u7c7b\u578b\u200b\u9519\u8bef\u200b\nmypy sqlalchemy_couchdb --ignore-missing-imports\n</code></pre>"},{"location":"about/contributing/#_12","title":"\u63d0\u4ea4\u200b\u89c4\u8303","text":""},{"location":"about/contributing/#_13","title":"\u63d0\u4ea4\u200b\u4fe1\u606f\u683c\u5f0f","text":"<pre><code>type(scope): subject\n\nbody\n\nfooter\n</code></pre> <p>\u200b\u7c7b\u578b\u200b (type): - <code>feat</code>: \u200b\u65b0\u200b\u529f\u80fd\u200b - <code>fix</code>: Bug \u200b\u4fee\u590d\u200b - <code>docs</code>: \u200b\u6587\u6863\u200b\u66f4\u65b0\u200b - <code>style</code>: \u200b\u4ee3\u7801\u200b\u683c\u5f0f\u200b\uff08\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u529f\u80fd\u200b\uff09 - <code>refactor</code>: \u200b\u91cd\u6784\u200b\uff08\u200b\u65e2\u200b\u4e0d\u200b\u4fee\u590d\u200b Bug \u200b\u4e5f\u200b\u4e0d\u200b\u6dfb\u52a0\u200b\u529f\u80fd\u200b\uff09 - <code>test</code>: \u200b\u6d4b\u8bd5\u200b\u76f8\u5173\u200b - <code>chore</code>: \u200b\u6784\u5efa\u200b\u5de5\u5177\u200b\u6216\u200b\u8f85\u52a9\u5de5\u5177\u200b - <code>perf</code>: \u200b\u6027\u80fd\u200b\u4f18\u5316\u200b - <code>ci</code>: \u200b\u6301\u7eed\u200b\u96c6\u6210\u200b\u76f8\u5173\u200b</p> <p>\u200b\u4f5c\u7528\u57df\u200b (scope) (\u200b\u53ef\u200b\u9009\u200b): - <code>compiler</code>: \u200b\u7f16\u8bd1\u5668\u200b\u76f8\u5173\u200b - <code>client</code>: \u200b\u5ba2\u6237\u7aef\u200b\u76f8\u5173\u200b - <code>dialect</code>: \u200b\u65b9\u8a00\u200b\u76f8\u5173\u200b - <code>types</code>: \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\u76f8\u5173\u200b - <code>tests</code>: \u200b\u6d4b\u8bd5\u200b\u76f8\u5173\u200b - <code>docs</code>: \u200b\u6587\u6863\u200b\u76f8\u5173\u200b</p> <p>\u200b\u793a\u4f8b\u200b:</p> <pre><code>feat(compiler): \u200b\u6dfb\u52a0\u200b ORDER BY ASC/DESC \u200b\u652f\u6301\u200b\n\n- \u200b\u5b9e\u73b0\u200b _compile_order_by \u200b\u65b9\u6cd5\u200b\n- \u200b\u652f\u6301\u200b ASC \u200b\u548c\u200b DESC \u200b\u6392\u5e8f\u200b\n- \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u6240\u200b\u9700\u200b\u7d22\u5f15\u200b\n- \u200b\u6dfb\u52a0\u200b\u5355\u5143\u6d4b\u8bd5\u200b\n\nCloses #123\n</code></pre> <pre><code>fix(client): \u200b\u4fee\u590d\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u65f6\u200b\u7684\u200b\u8d85\u65f6\u200b\u95ee\u9898\u200b\n\n- \u200b\u589e\u52a0\u200b httpx \u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n- \u200b\u6dfb\u52a0\u200b\u91cd\u8bd5\u200b\u673a\u5236\u200b\n- \u200b\u66f4\u65b0\u200b\u6d4b\u8bd5\u7528\u4f8b\u200b\n\nFixes #456\n</code></pre> <pre><code>docs: \u200b\u66f4\u65b0\u200b\u5b89\u88c5\u200b\u6307\u5357\u200b\n\n- \u200b\u6dfb\u52a0\u200b Docker \u200b\u542f\u52a8\u200b\u6b65\u9aa4\u200b\n- \u200b\u5b8c\u5584\u200b\u6545\u969c\u200b\u6392\u9664\u200b\u90e8\u5206\u200b\n- \u200b\u6dfb\u52a0\u200b\u5e38\u89c1\u95ee\u9898\u200b\n\nRefs #789\n</code></pre>"},{"location":"about/contributing/#_14","title":"\u6d4b\u8bd5\u200b\u6307\u5357","text":""},{"location":"about/contributing/#_15","title":"\u8fd0\u884c\u200b\u6d4b\u8bd5","text":"<pre><code># \u200b\u8fd0\u884c\u200b\u6240\u6709\u200b\u6d4b\u8bd5\u200b\npytest\n\n# \u200b\u8fd0\u884c\u200b\u7279\u5b9a\u200b\u6d4b\u8bd5\u200b\npytest tests/test_compiler.py -v\n\n# \u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b\u5e76\u200b\u751f\u6210\u200b\u8986\u76d6\u7387\u200b\u62a5\u544a\u200b\npytest --cov=sqlalchemy_couchdb --cov-report=html --cov-report=term-missing\n\n# \u200b\u8fd0\u884c\u200b\u6162\u901f\u200b\u6d4b\u8bd5\u200b\npytest -m slow\n\n# \u200b\u8fd0\u884c\u200b\u5355\u5143\u6d4b\u8bd5\u200b\npytest -m unit\n</code></pre>"},{"location":"about/contributing/#_16","title":"\u7f16\u5199\u200b\u6d4b\u8bd5","text":""},{"location":"about/contributing/#_17","title":"\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\u547d\u540d","text":"<pre><code>test_*.py              # \u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\ntest_*_unit.py         # \u200b\u5355\u5143\u6d4b\u8bd5\u200b\ntest_*_integration.py  # \u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\n</code></pre>"},{"location":"about/contributing/#_18","title":"\u6d4b\u8bd5\u200b\u7c7b\u200b\u548c\u200b\u65b9\u6cd5","text":"<pre><code>import pytest\nfrom sqlalchemy import text\n\nclass TestYourFeature:\n    \"\"\"\u200b\u60a8\u200b\u7684\u200b\u529f\u80fd\u6d4b\u8bd5\u200b\"\"\"\n\n    @pytest.fixture\n    def setup_data(self, engine):\n        \"\"\"\u200b\u8bbe\u7f6e\u200b\u6d4b\u8bd5\u6570\u636e\u200b\"\"\"\n        # \u200b\u63d2\u5165\u200b\u6d4b\u8bd5\u6570\u636e\u200b\n        pass\n\n    def test_something(self, engine, setup_data):\n        \"\"\"\u200b\u6d4b\u8bd5\u7528\u4f8b\u200b\"\"\"\n        # Arrange - \u200b\u51c6\u5907\u200b\n        query = text(\"SELECT * FROM users WHERE type = 'user'\")\n\n        # Act - \u200b\u6267\u884c\u200b\n        result = engine.execute(query)\n\n        # Assert - \u200b\u65ad\u8a00\u200b\n        assert result.rowcount &gt; 0\n        assert result.fetchone().name is not None\n</code></pre>"},{"location":"about/contributing/#_19","title":"\u6d4b\u8bd5\u200b\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ol> <li>\u200b\u72ec\u7acb\u200b\u6d4b\u8bd5\u200b: \u200b\u6bcf\u4e2a\u200b\u6d4b\u8bd5\u200b\u90fd\u200b\u5e94\u200b\u72ec\u7acb\u200b\u8fd0\u884c\u200b</li> <li>\u200b\u63cf\u8ff0\u6027\u200b\u540d\u79f0\u200b: \u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\u540d\u5e94\u200b\u6e05\u695a\u200b\u63cf\u8ff0\u200b\u6d4b\u8bd5\u200b\u5185\u5bb9\u200b</li> <li>\u200b\u6e05\u7406\u200b\u6570\u636e\u200b: \u200b\u6d4b\u8bd5\u200b\u540e\u200b\u6e05\u7406\u200b\u6d4b\u8bd5\u6570\u636e\u200b</li> <li>\u200b\u4f7f\u7528\u200b Fixtures: \u200b\u590d\u7528\u200b\u6d4b\u8bd5\u200b\u8bbe\u7f6e\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\u8986\u76d6\u200b: \u200b\u65b0\u200b\u4ee3\u7801\u200b\u5fc5\u987b\u200b\u6709\u200b\u6d4b\u8bd5\u200b\u8986\u76d6\u200b</li> </ol>"},{"location":"about/contributing/#_20","title":"\u6d4b\u8bd5\u200b\u6807\u8bb0","text":"<pre><code>import pytest\n\nclass TestAsyncFeatures:\n    @pytest.mark.asyncio\n    async def test_async_operation(self, async_engine):\n        \"\"\"\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6d4b\u8bd5\u200b\"\"\"\n        ...\n\n    @pytest.mark.slow\n    def test_performance(self, engine):\n        \"\"\"\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\"\"\"\n        ...\n\n    @pytest.mark.integration\n    def test_real_database(self, couchdb_url):\n        \"\"\"\u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\"\"\"\n        ...\n</code></pre>"},{"location":"about/contributing/#pull-request","title":"Pull Request \u200b\u6307\u5357","text":""},{"location":"about/contributing/#pr","title":"PR \u200b\u524d\u200b\u68c0\u67e5\u200b\u6e05\u5355","text":"<ul> <li> \u200b\u4ee3\u7801\u200b\u5df2\u200b\u683c\u5f0f\u5316\u200b\uff08Black, isort\uff09</li> <li> \u200b\u6240\u6709\u200b\u6d4b\u8bd5\u901a\u8fc7\u200b</li> <li> \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u65b0\u200b\u6d4b\u8bd5\u200b</li> <li> \u200b\u66f4\u65b0\u200b\u4e86\u200b\u76f8\u5173\u200b\u6587\u6863\u200b</li> <li> \u200b\u63d0\u4ea4\u200b\u4fe1\u606f\u200b\u7b26\u5408\u89c4\u8303\u200b</li> <li> \u200b\u6ca1\u6709\u200b\u5408\u5e76\u200b\u51b2\u7a81\u200b</li> <li> \u200b\u8fd0\u884c\u200b\u4e86\u200b linter</li> </ul>"},{"location":"about/contributing/#pr_1","title":"PR \u200b\u63cf\u8ff0\u200b\u6a21\u677f","text":"<pre><code>## \u200b\u66f4\u6539\u200b\u8bf4\u660e\u200b\n\n\u200b\u7b80\u8981\u200b\u63cf\u8ff0\u200b\u6b64\u200b PR \u200b\u7684\u200b\u66f4\u6539\u200b\u5185\u5bb9\u200b\u3002\n\n## \u200b\u66f4\u6539\u200b\u7c7b\u578b\u200b\n\n- [ ] Bug \u200b\u4fee\u590d\u200b\n- [ ] \u200b\u65b0\u200b\u529f\u80fd\u200b\n- [ ] \u200b\u7834\u574f\u6027\u200b\u53d8\u66f4\u200b\n- [ ] \u200b\u6587\u6863\u200b\u66f4\u65b0\u200b\n- [ ] \u200b\u6027\u80fd\u200b\u6539\u8fdb\u200b\n- [ ] \u200b\u91cd\u6784\u200b\n\n## \u200b\u6d4b\u8bd5\u200b\n\n- [ ] \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u5355\u5143\u6d4b\u8bd5\u200b\n- [ ] \u200b\u6240\u6709\u200b\u6d4b\u8bd5\u901a\u8fc7\u200b\n- [ ] \u200b\u624b\u52a8\u200b\u6d4b\u8bd5\u200b\u5b8c\u6210\u200b\n\n## \u200b\u622a\u56fe\u200b/\u200b\u793a\u4f8b\u200b\uff08\u200b\u5982\u679c\u200b\u9002\u7528\u200b\uff09\n\n## \u200b\u6ce8\u610f\u4e8b\u9879\u200b\n\n\u200b\u9700\u8981\u200b\u5ba1\u67e5\u200b\u8005\u200b\u7279\u522b\u200b\u5173\u6ce8\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\n\n## \u200b\u76f8\u5173\u200b Issue\n\nCloses #123\n</code></pre>"},{"location":"about/contributing/#pr_2","title":"PR \u200b\u5ba1\u67e5\u200b\u6d41\u7a0b","text":"<ol> <li>\u200b\u81ea\u52a8\u200b\u68c0\u67e5\u200b: CI \u200b\u4f1a\u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b\u3001\u200b\u4ee3\u7801\u200b\u98ce\u683c\u200b\u68c0\u67e5\u200b\u7b49\u200b</li> <li>\u200b\u4ee3\u7801\u200b\u5ba1\u67e5\u200b: \u200b\u7ef4\u62a4\u8005\u200b\u4f1a\u200b\u5ba1\u67e5\u200b\u4ee3\u7801\u200b\u8d28\u91cf\u200b\u548c\u200b\u8bbe\u8ba1\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\u9a8c\u8bc1\u200b: \u200b\u786e\u4fdd\u200b\u6240\u6709\u200b\u6d4b\u8bd5\u901a\u8fc7\u200b</li> <li>\u200b\u5408\u5e76\u200b: \u200b\u5ba1\u67e5\u200b\u901a\u8fc7\u200b\u540e\u200b\u5408\u5e76\u200b\u5230\u200b\u4e3b\u200b\u5206\u652f\u200b</li> </ol>"},{"location":"about/contributing/#bug","title":"Bug \u200b\u62a5\u544a","text":""},{"location":"about/contributing/#github-issues","title":"\u4f7f\u7528\u200b GitHub Issues","text":""},{"location":"about/contributing/#bug_1","title":"Bug \u200b\u62a5\u544a\u200b\u6a21\u677f","text":"<pre><code>## Bug \u200b\u63cf\u8ff0\u200b\n\u200b\u7b80\u8981\u200b\u63cf\u8ff0\u200b Bug\u3002\n\n## \u200b\u91cd\u73b0\u200b\u6b65\u9aa4\u200b\n1. \u200b\u6253\u5f00\u200b '...'\n2. \u200b\u6267\u884c\u200b '...'\n3. \u200b\u6eda\u52a8\u200b\u5230\u200b '...'\n4. \u200b\u770b\u5230\u200b\u9519\u8bef\u200b\n\n## \u200b\u9884\u671f\u200b\u884c\u4e3a\u200b\n\u200b\u63cf\u8ff0\u200b\u9884\u671f\u200b\u4f1a\u200b\u53d1\u751f\u200b\u4ec0\u4e48\u200b\u3002\n\n## \u200b\u5b9e\u9645\u200b\u884c\u4e3a\u200b\n\u200b\u63cf\u8ff0\u200b\u5b9e\u9645\u200b\u53d1\u751f\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u3002\n\n## \u200b\u73af\u5883\u200b\u4fe1\u606f\u200b\n- OS: [e.g., macOS 14.0]\n- Python: [e.g., 3.11.5]\n- SQLAlchemy: [e.g., 2.0.23]\n- sqlalchemy-couchdb: [e.g., 0.1.0]\n- CouchDB: [e.g., 3.3.3]\n\n## \u200b\u590d\u73b0\u200b\u4ee3\u7801\u200b\n```python\n# \u200b\u63d0\u4f9b\u200b\u6700\u5c0f\u200b\u53ef\u200b\u590d\u73b0\u200b\u4ee3\u7801\u200b\n</code></pre>"},{"location":"about/contributing/#_21","title":"\u9519\u8bef\u4fe1\u606f","text":"<pre><code>\u200b\u5b8c\u6574\u200b\u7684\u200b\u9519\u8bef\u200b\u5806\u6808\u200b\u8ddf\u8e2a\u200b\n</code></pre>"},{"location":"about/contributing/#_22","title":"\u5176\u4ed6\u200b\u4fe1\u606f","text":"<p>\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u6709\u200b\u5e2e\u52a9\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002 <pre><code>## \u200b\u529f\u80fd\u200b\u8bf7\u6c42\u200b\n\n### \u200b\u529f\u80fd\u200b\u8bf7\u6c42\u200b\u6a21\u677f\u200b\n\n```markdown\n## \u200b\u529f\u80fd\u200b\u63cf\u8ff0\u200b\n\u200b\u7b80\u8981\u200b\u63cf\u8ff0\u200b\u60a8\u200b\u60f3\u8981\u200b\u7684\u200b\u529f\u80fd\u200b\u3002\n\n## \u200b\u95ee\u9898\u200b\u80cc\u666f\u200b\n\u200b\u6b64\u200b\u529f\u80fd\u200b\u89e3\u51b3\u200b\u4ec0\u4e48\u200b\u95ee\u9898\u200b\uff1f\n\n## \u200b\u9884\u671f\u200b\u89e3\u51b3\u65b9\u6848\u200b\n\u200b\u60a8\u200b\u5e0c\u671b\u200b\u6b64\u200b\u529f\u80fd\u200b\u5982\u4f55\u200b\u5de5\u4f5c\u200b\uff1f\n\n## \u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\n\u200b\u60a8\u200b\u8003\u8651\u200b\u8fc7\u200b\u5176\u4ed6\u200b\u89e3\u51b3\u65b9\u6848\u200b\u5417\u200b\uff1f\n\n## \u200b\u5176\u4ed6\u200b\u4fe1\u606f\u200b\n\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u76f8\u5173\u200b\u7684\u200b\u4fe1\u606f\u200b\u6216\u200b\u622a\u56fe\u200b\u3002\n</code></pre></p>"},{"location":"about/contributing/#_23","title":"\u6587\u6863\u200b\u8d21\u732e","text":""},{"location":"about/contributing/#_24","title":"\u6587\u6863\u200b\u7c7b\u578b","text":"<ul> <li>API \u200b\u53c2\u8003\u200b</li> <li>\u200b\u7528\u6237\u200b\u6307\u5357\u200b</li> <li>\u200b\u6559\u7a0b\u200b</li> <li>\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b</li> <li>\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b</li> </ul>"},{"location":"about/contributing/#_25","title":"\u6587\u6863\u200b\u89c4\u8303","text":"<ul> <li>\u200b\u4f7f\u7528\u200b Markdown \u200b\u683c\u5f0f\u200b</li> <li>\u200b\u6dfb\u52a0\u200b\u4ee3\u7801\u200b\u793a\u4f8b\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u4e2d\u6587\u200b\u7f16\u5199\u200b</li> <li>\u200b\u4fdd\u6301\u200b\u7b80\u6d01\u200b\u6e05\u6670\u200b</li> <li>\u200b\u6dfb\u52a0\u200b\u9002\u5f53\u200b\u7684\u200b\u6807\u9898\u200b\u5c42\u7ea7\u200b</li> </ul>"},{"location":"about/contributing/#_26","title":"\u6587\u6863\u6587\u4ef6\u200b\u7ed3\u6784","text":"<pre><code>docs/\n\u251c\u2500\u2500 getting-started/    # \u200b\u5165\u95e8\u200b\u6307\u5357\u200b\n\u251c\u2500\u2500 guide/             # \u200b\u7528\u6237\u200b\u6307\u5357\u200b\n\u251c\u2500\u2500 api/               # API \u200b\u53c2\u8003\u200b\n\u251c\u2500\u2500 dev/               # \u200b\u5f00\u53d1\u200b\u6307\u5357\u200b\n\u2514\u2500\u2500 about/             # \u200b\u9879\u76ee\u200b\u4fe1\u606f\u200b\n</code></pre>"},{"location":"about/contributing/#_27","title":"\u6027\u80fd\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5","text":""},{"location":"about/contributing/#_28","title":"\u8fd0\u884c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code># \u200b\u8fd0\u884c\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\npython -m pytest tests/performance/ -v\n\n# \u200b\u8fd0\u884c\u200b\u7279\u5b9a\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\npython -m pytest tests/performance/test_bulk_insert.py -v\n</code></pre>"},{"location":"about/contributing/#_29","title":"\u7f16\u5199\u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code>def test_bulk_insert_performance():\n    \"\"\"\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\"\"\"\n    import time\n\n    start = time.time()\n    # \u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\n    ...\n    elapsed = time.time() - start\n\n    # \u200b\u65ad\u8a00\u200b\u6027\u80fd\u200b\u8981\u6c42\u200b\n    assert elapsed &lt; 2.0, f\"\u200b\u64cd\u4f5c\u200b\u8017\u65f6\u200b {elapsed:.2f}s\uff0c\u200b\u8d85\u8fc7\u200b\u9608\u503c\u200b\"\n</code></pre>"},{"location":"about/contributing/#_30","title":"\u53d1\u5e03\u200b\u6d41\u7a0b","text":""},{"location":"about/contributing/#_31","title":"\u7248\u672c\u53f7\u200b\u89c4\u8303","text":"<p>\u200b\u9075\u5faa\u200b \u200b\u8bed\u4e49\u200b\u5316\u200b\u7248\u672c\u200b\uff1a</p> <ul> <li>\u200b\u4e3b\u200b\u7248\u672c\u53f7\u200b (x.0.0): \u200b\u4e0d\u200b\u517c\u5bb9\u200b\u7684\u200b API \u200b\u4fee\u6539\u200b</li> <li>\u200b\u6b21\u200b\u7248\u672c\u53f7\u200b (x.y.0): \u200b\u5411\u4e0b\u517c\u5bb9\u200b\u7684\u200b\u529f\u80fd\u6027\u200b\u65b0\u589e\u200b</li> <li>\u200b\u4fee\u8ba2\u200b\u53f7\u200b (x.y.z): \u200b\u5411\u4e0b\u517c\u5bb9\u200b\u7684\u200b\u95ee\u9898\u200b\u4fee\u6b63\u200b</li> </ul>"},{"location":"about/contributing/#_32","title":"\u53d1\u5e03\u200b\u6b65\u9aa4","text":"<ol> <li>\u200b\u66f4\u65b0\u200b <code>CHANGELOG.md</code></li> <li>\u200b\u66f4\u65b0\u200b <code>__init__.py</code> \u200b\u4e2d\u200b\u7684\u200b\u7248\u672c\u53f7\u200b</li> <li>\u200b\u521b\u5efa\u200b\u53d1\u5e03\u200b PR</li> <li>\u200b\u5408\u5e76\u200b\u5230\u200b main \u200b\u5206\u652f\u200b</li> <li>\u200b\u521b\u5efa\u200b GitHub Release</li> <li>\u200b\u63a8\u9001\u200b\u5230\u200b PyPI</li> </ol>"},{"location":"about/contributing/#_33","title":"\u884c\u4e3a\u51c6\u5219","text":""},{"location":"about/contributing/#_34","title":"\u6211\u4eec\u200b\u7684\u200b\u627f\u8bfa","text":"<p>\u200b\u4e3a\u4e86\u200b\u8425\u9020\u200b\u5f00\u653e\u200b\u548c\u200b\u6b22\u8fce\u200b\u7684\u200b\u73af\u5883\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f5c\u4e3a\u200b\u8d21\u732e\u8005\u200b\u548c\u200b\u7ef4\u62a4\u8005\u200b\u627f\u8bfa\u200b\uff0c\u200b\u65e0\u8bba\u200b\u5e74\u9f84\u200b\u3001\u200b\u4f53\u578b\u200b\u3001\u200b\u6b8b\u75be\u200b\u3001\u200b\u6c11\u65cf\u200b\u3001\u200b\u6027\u522b\u200b\u8ba4\u540c\u200b\u4e0e\u200b\u8868\u8fbe\u200b\u3001\u200b\u7ecf\u9a8c\u200b\u6c34\u5e73\u200b\u3001\u200b\u6559\u80b2\u200b\u7a0b\u5ea6\u200b\u3001\u200b\u793e\u4f1a\u200b\u7ecf\u6d4e\u200b\u5730\u4f4d\u200b\u3001\u200b\u56fd\u7c4d\u200b\u3001\u200b\u4e2a\u4eba\u200b\u5916\u8868\u200b\u3001\u200b\u79cd\u65cf\u200b\u3001\u200b\u5b97\u6559\u4fe1\u4ef0\u200b\u6216\u6027\u200b\u8ba4\u540c\u200b\u4e0e\u200b\u53d6\u5411\u200b\uff0c\u200b\u90fd\u200b\u8ba9\u200b\u6bcf\u4e2a\u200b\u4eba\u200b\u5728\u200b\u6211\u4eec\u200b\u7684\u200b\u9879\u76ee\u200b\u548c\u200b\u793e\u533a\u200b\u4e2d\u200b\u53c2\u4e0e\u200b\u65e0\u200b\u9a9a\u6270\u200b\u3002</p>"},{"location":"about/contributing/#_35","title":"\u6211\u4eec\u200b\u7684\u200b\u6807\u51c6","text":"<p>\u200b\u79ef\u6781\u5411\u4e0a\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5305\u62ec\u200b\uff1a - \u200b\u4f7f\u7528\u200b\u6b22\u8fce\u200b\u548c\u200b\u5305\u5bb9\u200b\u7684\u200b\u8bed\u8a00\u200b - \u200b\u5c0a\u91cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u89c2\u70b9\u200b\u548c\u200b\u7ecf\u5386\u200b - \u200b\u4f18\u96c5\u200b\u5730\u200b\u63a5\u53d7\u200b\u5efa\u8bbe\u6027\u200b\u6279\u8bc4\u200b - \u200b\u4e13\u6ce8\u200b\u4e8e\u200b\u5bf9\u200b\u793e\u533a\u200b\u6700\u200b\u6709\u5229\u200b\u7684\u200b\u4e8b\u60c5\u200b - \u200b\u5bf9\u200b\u5176\u4ed6\u200b\u793e\u533a\u200b\u6210\u5458\u200b\u8868\u73b0\u200b\u51fa\u200b\u540c\u7406\u200b\u5fc3\u200b</p> <p>\u200b\u4e0d\u53ef\u200b\u63a5\u53d7\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5305\u62ec\u200b\uff1a - \u200b\u4f7f\u7528\u200b\u6027\u5316\u200b\u7684\u200b\u8bed\u8a00\u200b\u6216\u200b\u56fe\u50cf\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e0d\u200b\u53d7\u6b22\u8fce\u200b\u7684\u200b\u6027\u200b\u5173\u6ce8\u200b\u6216\u200b\u642d\u8baa\u200b - \u200b\u6076\u610f\u200b\u8bc4\u8bba\u200b\u3001\u200b\u4fae\u8fb1\u200b/\u200b\u8d2c\u635f\u200b\u8bc4\u8bba\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e2a\u4eba\u200b\u6216\u200b\u653f\u6cbb\u200b\u653b\u51fb\u200b - \u200b\u516c\u5f00\u200b\u6216\u200b\u79c1\u4e0b\u200b\u9a9a\u6270\u200b - \u200b\u672a\u7ecf\u200b\u660e\u786e\u200b\u8bb8\u53ef\u200b\uff0c\u200b\u53d1\u5e03\u200b\u4ed6\u4eba\u200b\u7684\u200b\u79c1\u4eba\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5982\u200b\u7269\u7406\u200b\u6216\u200b\u7535\u5b50\u200b\u5730\u5740\u200b - \u200b\u5728\u200b\u4e13\u4e1a\u200b\u73af\u5883\u200b\u4e2d\u200b\u53ef\u80fd\u200b\u88ab\u200b\u5408\u7406\u200b\u8ba4\u4e3a\u200b\u4e0d\u5f53\u200b\u7684\u200b\u5176\u4ed6\u200b\u884c\u4e3a\u200b</p>"},{"location":"about/contributing/#_36","title":"\u6267\u884c","text":"<p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b [email@example.com] \u200b\u62a5\u544a\u200b\u8fdd\u89c4\u884c\u4e3a\u200b\u3002\u200b\u5ba1\u67e5\u200b\u540e\u200b\uff0c\u200b\u6240\u6709\u200b\u6295\u8bc9\u200b\u90fd\u200b\u5c06\u200b\u5f97\u5230\u200b\u5ba1\u67e5\u200b\u548c\u200b\u8c03\u67e5\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u4ea7\u751f\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u5fc5\u8981\u200b\u4e14\u200b\u9002\u5408\u200b\u5177\u4f53\u60c5\u51b5\u200b\u7684\u200b\u56de\u5e94\u200b\u3002</p>"},{"location":"about/contributing/#_37","title":"\u83b7\u53d6\u200b\u5e2e\u52a9","text":""},{"location":"about/contributing/#_38","title":"\u6c9f\u901a\u200b\u6e20\u9053","text":"<ul> <li>GitHub Issues: Bug \u200b\u62a5\u544a\u200b\u548c\u200b\u529f\u80fd\u200b\u8bf7\u6c42\u200b</li> <li>GitHub Discussions: \u200b\u4e00\u822c\u6027\u200b\u8ba8\u8bba\u200b</li> <li>\u200b\u90ae\u4ef6\u200b: \u200b\u60a8\u200b\u7684\u200b.email@example.com</li> </ul>"},{"location":"about/contributing/#_39","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>Q: \u200b\u6211\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u200b\u4e86\u89e3\u200b CouchDB \u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u8d21\u732e\u200b\u5417\u200b\uff1f A: \u200b\u53ef\u4ee5\u200b\uff01\u200b\u6211\u4eec\u200b\u6b22\u8fce\u200b\u5404\u79cd\u200b\u80cc\u666f\u200b\u7684\u200b\u8d21\u732e\u8005\u200b\u3002\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u9605\u8bfb\u200b\u6587\u6863\u200b\u5f00\u59cb\u200b\uff0c\u200b\u7136\u540e\u200b\u4ece\u200b\u7b80\u5355\u200b\u7684\u200b\u4efb\u52a1\u200b\uff08\u200b\u5982\u200b\u6587\u6863\u200b\u6539\u8fdb\u200b\uff09\u200b\u5f00\u59cb\u200b\u3002</p> <p>Q: \u200b\u5982\u4f55\u200b\u9009\u62e9\u200b\u7b2c\u4e00\u4e2a\u200b issue\uff1f A: \u200b\u5efa\u8bae\u200b\u4ece\u200b\u6807\u8bb0\u200b\u4e3a\u200b <code>good first issue</code> \u200b\u7684\u200b\u95ee\u9898\u200b\u5f00\u59cb\u200b\u3002</p> <p>Q: \u200b\u6211\u200b\u7684\u200b PR \u200b\u5f88\u200b\u957f\u65f6\u95f4\u200b\u6ca1\u6709\u200b\u5ba1\u67e5\u200b\u600e\u4e48\u529e\u200b\uff1f A: \u200b\u8bf7\u200b\u5728\u200b PR \u200b\u4e2d\u200b\u7559\u8a00\u200b\u6216\u200b\u7ed9\u200b\u7ef4\u62a4\u8005\u200b\u53d1\u90ae\u4ef6\u200b\u3002\u200b\u6211\u4eec\u200b\u4f1a\u200b\u5c3d\u5feb\u200b\u5904\u7406\u200b\u3002</p>"},{"location":"about/contributing/#_40","title":"\u81f4\u8c22","text":"<p>\u200b\u611f\u8c22\u200b\u6240\u6709\u200b\u4e3a\u672c\u200b\u9879\u76ee\u200b\u505a\u51fa\u200b\u8d21\u732e\u200b\u7684\u200b\u5f00\u53d1\u8005\u200b\u548c\u200b\u7528\u6237\u200b\uff01</p> <ul> <li>\u200b\u611f\u8c22\u200b\u6240\u6709\u200b\u4ee3\u7801\u200b\u8d21\u732e\u8005\u200b</li> <li>\u200b\u611f\u8c22\u200b\u6240\u6709\u200b\u62a5\u544a\u200b Bug \u200b\u7684\u200b\u7528\u6237\u200b</li> <li>\u200b\u611f\u8c22\u200b\u6240\u6709\u200b\u5b8c\u5584\u200b\u6587\u6863\u200b\u7684\u200b\u8d21\u732e\u8005\u200b</li> <li>\u200b\u611f\u8c22\u200b\u6240\u6709\u200b\u63d0\u4f9b\u200b\u53cd\u9988\u200b\u548c\u200b\u5efa\u8bae\u200b\u7684\u200b\u7528\u6237\u200b</li> </ul>"},{"location":"about/contributing/#_41","title":"\u8bb8\u53ef\u8bc1","text":"<p>\u200b\u901a\u8fc7\u200b\u8d21\u732e\u200b\uff0c\u200b\u60a8\u200b\u540c\u610f\u200b\u60a8\u200b\u7684\u200b\u8d21\u732e\u200b\u5c06\u200b\u5728\u200b MIT \u200b\u8bb8\u53ef\u8bc1\u200b\u4e0b\u200b\u8bb8\u53ef\u200b\u3002</p>"},{"location":"about/contributing/#_42","title":"\u8054\u7cfb\u65b9\u5f0f","text":"<ul> <li>\u200b\u7ef4\u62a4\u8005\u200b: [Your Name] your.email@example.com</li> <li>\u200b\u9879\u76ee\u200b\u4e3b\u9875\u200b: https://github.com/getaix/sqlalchemy-couchdb</li> <li>\u200b\u6587\u6863\u200b: https://getaix.github.io/sqlalchemy-couchdb</li> </ul> <p>\u200b\u518d\u6b21\u200b\u611f\u8c22\u60a8\u200b\u7684\u200b\u8d21\u732e\u200b\uff01\u200b\u6211\u4eec\u200b\u671f\u5f85\u200b\u4e0e\u200b\u60a8\u200b\u4e00\u8d77\u200b\u4f7f\u200b\u8fd9\u4e2a\u200b\u9879\u76ee\u200b\u53d8\u5f97\u200b\u66f4\u597d\u200b\u3002\ud83c\udf89</p>"},{"location":"about/license/","title":"\u8bb8\u53ef\u8bc1","text":""},{"location":"about/license/#mit-license","title":"MIT License","text":"<p>Copyright (c) 2025 SQLAlchemy CouchDB Contributors</p> <p>\u200b\u7279\u6b64\u200b\u514d\u8d39\u200b\u6388\u4e88\u200b\u83b7\u5f97\u200b\u672c\u200b\u8f6f\u4ef6\u200b\u53ca\u200b\u76f8\u5173\u200b\u6587\u6863\u6587\u4ef6\u200b\uff08\u200b\u4ee5\u4e0b\u200b\u7b80\u79f0\u200b\"\u200b\u8f6f\u4ef6\u200b\"\uff09\u200b\u526f\u672c\u200b\u7684\u200b\u4efb\u4f55\u4eba\u200b\u4e0d\u200b\u53d7\u9650\u5236\u200b\u5730\u200b\u5904\u7406\u8f6f\u4ef6\u200b\u7684\u200b\u6743\u5229\u200b\uff0c\u200b\u5305\u62ec\u200b\u4f46\u200b\u4e0d\u200b\u9650\u4e8e\u200b\u4f7f\u7528\u200b\u3001\u200b\u590d\u5236\u200b\u3001\u200b\u4fee\u6539\u200b\u3001\u200b\u5408\u5e76\u200b\u3001\u200b\u53d1\u5e03\u200b\u3001\u200b\u5206\u53d1\u200b\u3001\u200b\u518d\u200b\u8bb8\u53ef\u200b\u548c\u200b/\u200b\u6216\u200b\u9500\u552e\u200b\u8f6f\u4ef6\u200b\u526f\u672c\u200b\u7684\u200b\u6743\u5229\u200b\uff0c\u200b\u5e76\u200b\u5141\u8bb8\u200b\u5411\u200b\u5176\u200b\u63d0\u4f9b\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u4eba\u5458\u200b\u8fd9\u6837\u200b\u505a\u200b\uff0c\u200b\u4f46\u987b\u200b\u7b26\u5408\u200b\u4ee5\u4e0b\u200b\u6761\u4ef6\u200b\uff1a</p> <p>\u200b\u4e0a\u8ff0\u200b\u7248\u6743\u200b\u58f0\u660e\u200b\u548c\u200b\u672c\u200b\u8bb8\u53ef\u200b\u58f0\u660e\u200b\u5e94\u200b\u5305\u542b\u200b\u5728\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u6240\u6709\u200b\u526f\u672c\u200b\u6216\u200b\u91cd\u8981\u200b\u90e8\u5206\u200b\u4e2d\u200b\u3002</p> <p>**\u200b\u8f6f\u4ef6\u200b\u6309\u200b\"\u200b\u539f\u6837\u200b\"\u200b\u63d0\u4f9b\u200b\uff0c\u200b\u4e0d\u200b\u63d0\u4f9b\u200b\u4efb\u4f55\u200b\u5f62\u5f0f\u200b\u7684\u200b\u660e\u793a\u200b\u6216\u200b\u6697\u793a\u200b\u62c5\u4fdd\u200b\uff0c\u200b\u5305\u62ec\u200b\u4f46\u200b\u4e0d\u200b\u9650\u4e8e\u200b\u9002\u9500\u200b\u6027\u200b\u3001\u200b\u7279\u5b9a\u200b\u76ee\u7684\u200b\u9002\u7528\u6027\u200b\u548c\u200b\u975e\u200b\u4fb5\u6743\u200b\u6027\u200b\u7684\u200b\u62c5\u4fdd\u200b\u3002\u200b\u5728\u200b\u4efb\u4f55\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b\u5728\u200b\u5408\u540c\u200b\u8bc9\u8bbc\u200b\u3001\u200b\u4fb5\u6743\u884c\u4e3a\u200b\u8fd8\u662f\u200b\u5176\u4ed6\u200b\u65b9\u9762\u200b\uff0c\u200b\u4f5c\u8005\u200b\u6216\u200b\u7248\u6743\u200b\u6301\u6709\u8005\u200b\u5747\u200b\u4e0d\u200b\u5bf9\u200b\u4efb\u4f55\u200b\u7d22\u8d54\u200b\u3001\u200b\u635f\u5bb3\u200b\u6216\u200b\u5176\u4ed6\u200b\u8d23\u4efb\u200b\u8d1f\u8d23\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b\u5728\u200b\u5408\u540c\u200b\u8bc9\u8bbc\u200b\u3001\u200b\u4fb5\u6743\u884c\u4e3a\u200b\u8fd8\u662f\u200b\u5176\u4ed6\u200b\u65b9\u9762\u200b\uff0c\u200b\u7531\u200b\u8f6f\u4ef6\u200b\u6216\u200b\u4f7f\u7528\u200b\u6216\u200b\u5176\u4ed6\u200b\u4ea4\u6613\u200b\u5f15\u8d77\u200b\u3001\u200b\u4ea7\u751f\u200b\u6216\u200b\u4e0e\u200b\u4e4b\u200b\u76f8\u5173\u200b\u8f6f\u4ef6\u200b\u6216\u200b\u4f7f\u7528\u200b\u6216\u200b\u5176\u4ed6\u8f6f\u4ef6\u200b\u4ea4\u6613\u200b\u3002</p>"},{"location":"about/license/#_2","title":"\u7b2c\u4e09\u65b9\u200b\u8bb8\u53ef","text":"<p>\u200b\u672c\u200b\u9879\u76ee\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u7b2c\u4e09\u65b9\u200b\u5e93\u200b\uff1a</p>"},{"location":"about/license/#sqlalchemy","title":"SQLAlchemy","text":"<ul> <li>\u200b\u8bb8\u53ef\u8bc1\u200b: MIT License</li> <li>\u200b\u7248\u6743\u200b: Copyright (c) 2005-2025 the SQLAlchemy authors</li> <li>\u200b\u7f51\u7ad9\u200b: https://www.sqlalchemy.org/</li> <li>\u200b\u8bb8\u53ef\u8bc1\u200b\u6587\u672c\u200b: https://github.com/sqlalchemy/sqlalchemy/blob/main/LICENSE</li> </ul>"},{"location":"about/license/#httpx","title":"httpx","text":"<ul> <li>\u200b\u8bb8\u53ef\u8bc1\u200b: BSD 3-Clause License</li> <li>\u200b\u7248\u6743\u200b: Copyright (c) 2020-2025 Colaboratory</li> <li>\u200b\u7f51\u7ad9\u200b: https://www.python-httpx.org/</li> <li>\u200b\u8bb8\u53ef\u8bc1\u200b\u6587\u672c\u200b: https://github.com/encode/httpx/blob/master/LICENSE.md</li> </ul>"},{"location":"about/license/#greenlet","title":"greenlet","text":"<ul> <li>\u200b\u8bb8\u53ef\u8bc1\u200b: MIT License</li> <li>\u200b\u7248\u6743\u200b: Copyright (c) 2023-2025 greenlet contributors</li> <li>\u200b\u7f51\u7ad9\u200b: https://greenlet.readthedocs.io/</li> <li>\u200b\u8bb8\u53ef\u8bc1\u200b\u6587\u672c\u200b: https://github.com/python-greenlet/greenlet/blob/master/LICENSE</li> </ul>"},{"location":"about/license/#_3","title":"\u4f9d\u8d56\u200b\u9879","text":"<p>\u200b\u5b8c\u6574\u200b\u4f9d\u8d56\u200b\u9879\u200b\u5217\u8868\u200b\u8bf7\u200b\u53c2\u89c1\u200b <code>pyproject.toml</code> \u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"about/license/#_4","title":"\u5546\u4e1a\u200b\u4f7f\u7528","text":"<p>MIT \u200b\u8bb8\u53ef\u8bc1\u200b\u5141\u8bb8\u200b\u5728\u200b\u5546\u4e1a\u200b\u9879\u76ee\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u672c\u200b\u8f6f\u4ef6\u200b\u3002\u200b\u60a8\u200b\u53ef\u4ee5\u200b\uff1a</p> <ul> <li>\u2705 \u200b\u5546\u4e1a\u200b\u4f7f\u7528\u200b</li> <li>\u2705 \u200b\u4fee\u6539\u200b</li> <li>\u2705 \u200b\u5206\u53d1\u200b</li> <li>\u2705 \u200b\u79c1\u4eba\u200b\u4f7f\u7528\u200b</li> <li>\u2705 \u200b\u4e13\u5229\u200b\u6388\u6743\u200b</li> </ul> <p>\u200b\u6761\u4ef6\u200b\uff1a - \u200b\u5305\u542b\u200b\u8bb8\u53ef\u8bc1\u200b\u548c\u200b\u7248\u6743\u200b\u58f0\u660e\u200b</p> <p>\u200b\u9650\u5236\u200b\uff1a - \u200b\u4e0d\u200b\u63d0\u4f9b\u200b\u8d23\u4efb\u200b\u62c5\u4fdd\u200b - \u200b\u4e0d\u200b\u63d0\u4f9b\u200b\u4fdd\u8bc1\u200b</p>"},{"location":"about/license/#_5","title":"\u5b8c\u6574\u200b\u8bb8\u53ef\u8bc1\u200b\u6587\u672c","text":"<pre><code>MIT License\n\nCopyright (c) 2025 SQLAlchemy CouchDB Contributors\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n</code></pre>"},{"location":"about/license/#cla","title":"\u8d21\u732e\u8005\u200b\u8bb8\u53ef\u8bc1\u200b\u534f\u8bae\u200b (CLA)","text":"<p>\u200b\u901a\u8fc7\u200b\u8d21\u732e\u200b\u4ee3\u7801\u200b\uff0c\u200b\u60a8\u200b\u540c\u610f\u200b\u60a8\u200b\u7684\u200b\u8d21\u732e\u200b\u5c06\u200b\u5728\u200b MIT \u200b\u8bb8\u53ef\u8bc1\u200b\u4e0b\u200b\u8bb8\u53ef\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u60a8\u200b\u4e3a\u200b\u516c\u53f8\u200b\u8d21\u732e\u200b\uff0c\u200b\u60a8\u200b\u9700\u8981\u200b\u786e\u4fdd\u60a8\u200b\u7684\u200b\u516c\u53f8\u200b\u540c\u610f\u200b MIT \u200b\u8bb8\u53ef\u8bc1\u200b\u3002</p>"},{"location":"about/license/#_6","title":"\u5546\u6807","text":"<p>\u200b\u672c\u200b\u9879\u76ee\u200b\u4e0e\u200b\u4ee5\u4e0b\u200b\u5546\u6807\u200b\u65e0\u5173\u200b\uff1a - Apache Software Foundation - CouchDB - SQLAlchemy</p> <p>\u200b\u6240\u6709\u200b\u5546\u6807\u200b\u5747\u200b\u4e3a\u200b\u5176\u200b\u5404\u81ea\u200b\u6240\u6709\u8005\u200b\u7684\u200b\u8d22\u4ea7\u200b\u3002</p>"},{"location":"about/license/#_7","title":"\u8054\u7cfb","text":"<p>\u200b\u5982\u679c\u200b\u60a8\u200b\u5bf9\u200b\u8bb8\u53ef\u8bc1\u200b\u6709\u200b\u4efb\u4f55\u200b\u7591\u95ee\u200b\uff0c\u200b\u8bf7\u200b\u8054\u7cfb\u200b\uff1a</p> <ul> <li>\u200b\u7535\u5b50\u90ae\u4ef6\u200b: your.email@example.com</li> <li>GitHub Issues: https://github.com/getaix/sqlalchemy-couchdb/issues</li> </ul>"},{"location":"about/license/#_8","title":"\u81f4\u8c22","text":"<p>\u200b\u611f\u8c22\u200b\u6240\u6709\u200b\u4e3a\u672c\u200b\u9879\u76ee\u200b\u505a\u51fa\u200b\u8d21\u732e\u200b\u7684\u200b\u5f00\u53d1\u8005\u200b\uff01</p> <p>\u200b\u8bb8\u53ef\u8bc1\u200b\u6700\u540e\u200b\u66f4\u65b0\u200b: 2025-11-02</p>"},{"location":"about/roadmap/","title":"\u5f53\u524d\u200b\u72b6\u6001","text":""},{"location":"about/roadmap/#_2","title":"\u9879\u76ee\u200b\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6210\u719f\u200b\u53ef\u7528\u200b\u7684\u200b SQLAlchemy \u200b\u65b9\u8a00\u200b\uff0c\u200b\u4e3a\u200b Python \u200b\u5e94\u7528\u200b\u63d0\u4f9b\u200b\u6807\u51c6\u200b\u7684\u200b CouchDB \u200b\u8bbf\u95ee\u200b\u63a5\u53e3\u200b\u3002</p>"},{"location":"about/roadmap/#_3","title":"\u5df2\u200b\u5b8c\u6210\u200b\u529f\u80fd","text":"<p>\u200b\u72b6\u6001\u200b: \u2705 \u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b\u5b8c\u6210\u200b\u5e76\u200b\u9a8c\u8bc1\u200b</p> <p>\u200b\u6838\u5fc3\u200b\u7279\u6027\u200b:</p> <ul> <li>\u2705 \u200b\u5b8c\u6574\u200b\u7684\u200b Dialect \u200b\u5b9e\u73b0\u200b</li> <li>SQLAlchemy 2.0+ \u200b\u517c\u5bb9\u200b</li> <li>\u200b\u652f\u6301\u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\uff08greenlet\u200b\u673a\u5236\u200b\uff09</li> <li> <p>DB-API 2.0 \u200b\u5f02\u5e38\u200b\u5904\u7406\u200b</p> </li> <li> <p>\u2705 SQL \u2192 Mango Query \u200b\u7f16\u8bd1\u5668\u200b</p> </li> <li>SELECT \u200b\u67e5\u8be2\u200b\u7f16\u8bd1\u200b</li> <li>INSERT/UPDATE/DELETE \u200b\u7f16\u8bd1\u200b</li> <li>WHERE \u200b\u6761\u4ef6\u200b\uff08=, &gt;, &lt;, &gt;=, &lt;=, !=, IN, LIKE\uff09</li> <li>\u200b\u903b\u8f91\u200b\u64cd\u4f5c\u7b26\u200b\uff08AND, OR\uff09</li> <li>ORDER BY \u200b\u6392\u5e8f\u200b\uff08\u200b\u81ea\u52a8\u200b\u7d22\u5f15\u200b\u521b\u5efa\u200b\uff09</li> <li> <p>LIMIT/OFFSET \u200b\u5206\u9875\u200b</p> </li> <li> <p>\u2705 \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b</p> </li> <li>Python \u2194 JSON \u200b\u53cc\u5411\u200b\u8f6c\u6362\u200b</li> <li>CouchDBString, CouchDBInteger, CouchDBFloat</li> <li>CouchDBBoolean, CouchDBDateTime, CouchDBDate</li> <li>CouchDBJSON, CouchDBNumeric</li> <li> <p>\u200b\u9ad8\u7cbe\u5ea6\u200b\u6570\u503c\u200b\u5904\u7406\u200b</p> </li> <li> <p>\u2705 CRUD \u200b\u64cd\u4f5c\u200b</p> </li> <li>INSERT: \u200b\u5355\u6761\u200b\u548c\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b</li> <li>SELECT: \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\u3001\u200b\u6761\u4ef6\u200b\u67e5\u8be2\u200b\u3001\u200b\u6392\u5e8f\u200b\u3001\u200b\u5206\u9875\u200b</li> <li>UPDATE: \u200b\u4e50\u89c2\u200b\u9501\u200b\uff08<code>_rev</code>\uff09\u200b\u652f\u6301\u200b</li> <li> <p>DELETE: \u200b\u6807\u8bb0\u200b\u5220\u9664\u200b</p> </li> <li> <p>\u2705 \u200b\u8fde\u63a5\u200b\u7ba1\u7406\u200b</p> </li> <li>\u200b\u57fa\u4e8e\u200b httpx \u200b\u7684\u200b HTTP \u200b\u5ba2\u6237\u7aef\u200b</li> <li>\u200b\u8fde\u63a5\u6c60\u200b\u7ba1\u7406\u200b</li> <li>\u200b\u652f\u6301\u200b\u8ba4\u8bc1\u200b\u548c\u200b SSL</li> <li> <p>Ping/\u200b\u5065\u5eb7\u68c0\u67e5\u200b</p> </li> <li> <p>\u2705 \u200b\u6d4b\u8bd5\u200b\u9a8c\u8bc1\u200b</p> </li> <li>100% \u200b\u6d4b\u8bd5\u200b\u901a\u8fc7\u7387\u200b\uff0834/34\uff09</li> <li>\u200b\u7f16\u8bd1\u5668\u200b\u6d4b\u8bd5\u200b\uff0812/12\uff09</li> <li>\u200b\u540c\u6b65\u200b\u6d4b\u8bd5\u200b\uff0810/10\uff09</li> <li>\u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b\uff0812/12\uff09</li> <li>\u200b\u4ee3\u7801\u200b\u8986\u76d6\u7387\u200b 64%</li> </ul> <p>\u200b\u6027\u80fd\u6307\u6807\u200b: - \u200b\u7b80\u5355\u200b SELECT: &lt; 50ms - INSERT (\u200b\u5355\u6761\u200b): &lt; 30ms - INSERT (\u200b\u6279\u91cf\u200b 100): &lt; 100ms - UPDATE: &lt; 40ms - DELETE: &lt; 30ms</p>"},{"location":"about/roadmap/#_4","title":"\u7ef4\u62a4\u200b\u8ba1\u5212","text":"<p>\u200b\u91cd\u70b9\u200b: - \u200b\u4fee\u590d\u200b Bug - \u200b\u4fdd\u6301\u200b\u4e0e\u200b SQLAlchemy \u200b\u548c\u200b CouchDB \u200b\u65b0\u200b\u7248\u672c\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b - \u200b\u5b8c\u5584\u200b\u6587\u6863\u200b\u548c\u200b\u793a\u4f8b\u200b - \u200b\u63d0\u5347\u200b\u6d4b\u8bd5\u200b\u8986\u76d6\u7387\u200b</p> <p>\u200b\u793e\u533a\u200b\u53cd\u9988\u200b: - \u200b\u6b22\u8fce\u200b\u63d0\u4ea4\u200b Issue \u200b\u62a5\u544a\u200b\u95ee\u9898\u200b\u6216\u200b\u5efa\u8bae\u200b - \u200b\u6b22\u8fce\u200b\u63d0\u4ea4\u200b Pull Request \u200b\u8d21\u732e\u200b\u4ee3\u7801\u200b - \u200b\u52a0\u5165\u200b\u8ba8\u8bba\u200b\u6539\u8fdb\u200b\u9879\u76ee\u200b</p>"},{"location":"about/roadmap/#_5","title":"\u6280\u672f\u200b\u503a\u52a1","text":""},{"location":"about/roadmap/#_6","title":"\u5f53\u524d\u200b\u6280\u672f\u200b\u503a\u52a1","text":"<ol> <li>\u200b\u4ee3\u7801\u200b\u8986\u76d6\u7387\u200b: \u200b\u5f53\u524d\u200b 64%\uff0c\u200b\u76ee\u6807\u200b 80%+</li> <li>\u200b\u539f\u56e0\u200b\uff1a\u200b\u5f02\u6b65\u200b\u4ee3\u7801\u200b\u6d4b\u8bd5\u200b\u96be\u5ea6\u200b\u9ad8\u200b</li> <li> <p>\u200b\u8ba1\u5212\u200b\uff1a\u200b\u589e\u52a0\u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\u8986\u76d6\u7387\u200b</p> </li> <li> <p>\u200b\u6587\u6863\u200b\u8986\u76d6\u7387\u200b: \u200b\u7f3a\u5c11\u200b\u4e00\u4e9b\u200b\u9ad8\u7ea7\u200b\u7528\u6cd5\u200b\u793a\u4f8b\u200b</p> </li> <li> <p>\u200b\u8ba1\u5212\u200b\uff1a\u200b\u5b8c\u5584\u200b\u6587\u6863\u200b\u548c\u200b\u793a\u4f8b\u200b</p> </li> <li> <p>\u200b\u7c7b\u578b\u200b\u63d0\u793a\u200b: \u200b\u90e8\u5206\u200b\u8001\u200b\u4ee3\u7801\u200b\u7f3a\u5c11\u200b\u7c7b\u578b\u200b\u63d0\u793a\u200b</p> </li> <li>\u200b\u8ba1\u5212\u200b\uff1a\u200b\u6e10\u8fdb\u5f0f\u200b\u6dfb\u52a0\u200b\u7c7b\u578b\u200b\u63d0\u793a\u200b</li> </ol>"},{"location":"about/roadmap/#_7","title":"\u7f13\u89e3\u200b\u63aa\u65bd","text":"<ul> <li>\u200b\u5b9a\u671f\u200b\u4ee3\u7801\u200b\u5ba1\u67e5\u200b</li> <li>\u200b\u81ea\u52a8\u5316\u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u6301\u7eed\u200b\u96c6\u6210\u200b</li> <li>\u200b\u6027\u80fd\u200b\u76d1\u63a7\u200b</li> </ul>"},{"location":"about/roadmap/#_8","title":"\u793e\u533a\u200b\u53c2\u4e0e","text":""},{"location":"about/roadmap/#2025-11-02","title":"\u8d21\u732e\u200b\u7edf\u8ba1\u200b (\u200b\u622a\u81f3\u200b 2025-11-02)","text":"<ul> <li>\u200b\u603b\u200b\u63d0\u4ea4\u200b\u6570\u200b: 100+</li> <li>\u200b\u8d21\u732e\u8005\u200b: 1 \u200b\u4eba\u200b\uff08\u200b\u7ef4\u62a4\u8005\u200b\uff09</li> <li>\u200b\u6d4b\u8bd5\u7528\u4f8b\u200b: 34 \u200b\u4e2a\u200b</li> <li>\u200b\u4ee3\u7801\u200b\u8986\u76d6\u7387\u200b: 64%</li> </ul>"},{"location":"about/roadmap/#_9","title":"\u76ee\u6807","text":"<ul> <li>\u200b\u5438\u5f15\u200b\u66f4\u200b\u591a\u200b\u8d21\u732e\u8005\u200b</li> <li>\u200b\u5efa\u7acb\u200b\u793e\u533a\u200b\u751f\u6001\u200b</li> <li>\u200b\u6536\u96c6\u200b\u7528\u6237\u200b\u53cd\u9988\u200b</li> <li>\u200b\u6301\u7eed\u200b\u6539\u8fdb\u200b\u9879\u76ee\u200b</li> </ul>"},{"location":"about/roadmap/#_10","title":"\u517c\u5bb9\u6027\u200b\u627f\u8bfa","text":""},{"location":"about/roadmap/#_11","title":"\u7248\u672c\u200b\u517c\u5bb9\u6027","text":"<ul> <li>SQLAlchemy \u200b\u7248\u672c\u200b: 2.0.0+</li> <li>Python \u200b\u7248\u672c\u200b: 3.11+</li> <li>CouchDB \u200b\u7248\u672c\u200b: 3.0+</li> </ul>"},{"location":"about/roadmap/#_12","title":"\u5411\u200b\u540e\u200b\u517c\u5bb9\u6027","text":"<ul> <li>\u200b\u5c0f\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b (x.y.z): \u200b\u5b8c\u5168\u200b\u5411\u200b\u540e\u200b\u517c\u5bb9\u200b</li> <li>\u200b\u4e3b\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b (x.0.0): \u200b\u53ef\u80fd\u200b\u6709\u200b\u4e0d\u200b\u517c\u5bb9\u200b\u53d8\u66f4\u200b\uff0c\u200b\u63d0\u524d\u200b 3 \u200b\u4e2a\u200b\u6708\u200b\u901a\u77e5\u200b</li> </ul>"},{"location":"about/roadmap/#_13","title":"\u8fc1\u79fb\u200b\u652f\u6301","text":"<ul> <li>\u200b\u63d0\u4f9b\u200b\u8fc1\u79fb\u200b\u6307\u5357\u200b</li> <li>\u200b\u81ea\u52a8\u5316\u200b\u8fc1\u79fb\u200b\u5de5\u5177\u200b</li> <li>\u200b\u517c\u5bb9\u6027\u200b\u6d4b\u8bd5\u200b</li> </ul>"},{"location":"about/roadmap/#_14","title":"\u957f\u671f\u200b\u613f\u666f","text":""},{"location":"about/roadmap/#3-2025-2028","title":"3\u200b\u5e74\u200b\u76ee\u6807\u200b (2025-2028)","text":"<ul> <li>\u200b\u6210\u4e3a\u200b Python \u200b\u751f\u6001\u7cfb\u7edf\u200b\u4e2d\u200b CouchDB \u200b\u96c6\u6210\u200b\u7684\u200b\u9996\u9009\u200b\u65b9\u6848\u200b</li> <li>\u200b\u652f\u6301\u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u67b6\u6784\u200b\u7684\u200b\u5927\u89c4\u6a21\u200b\u5e94\u7528\u200b</li> <li>\u200b\u5efa\u7acb\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5f00\u6e90\u200b\u793e\u533a\u200b</li> <li>\u200b\u5546\u4e1a\u200b\u652f\u6301\u200b\u548c\u200b\u54a8\u8be2\u670d\u52a1\u200b</li> </ul>"},{"location":"about/roadmap/#5-2025-2030","title":"5\u200b\u5e74\u200b\u76ee\u6807\u200b (2025-2030)","text":"<ul> <li>\u200b\u6269\u5c55\u200b\u5230\u200b\u5176\u4ed6\u200b\u6587\u6863\u200b\u6570\u636e\u5e93\u200b\uff08MongoDB, DynamoDB \u200b\u7b49\u200b\uff09</li> <li>\u200b\u63d0\u4f9b\u200b\u4e91\u200b\u539f\u751f\u200b\u90e8\u7f72\u200b\u65b9\u6848\u200b</li> <li>\u200b\u5efa\u7acb\u200b\u5b8c\u6574\u200b\u7684\u200b\u751f\u6001\u7cfb\u7edf\u200b</li> <li>\u200b\u6210\u4e3a\u200b Apache \u200b\u57fa\u91d1\u4f1a\u200b\u6216\u4e91\u200b\u5382\u5546\u200b\u652f\u6301\u200b\u7684\u200b\u9879\u76ee\u200b</li> </ul>"},{"location":"about/roadmap/#_15","title":"\u53cd\u9988\u200b\u548c\u200b\u5efa\u8bae","text":"<p>\u200b\u6211\u4eec\u200b\u6b22\u8fce\u200b\u6240\u6709\u200b\u53cd\u9988\u200b\u548c\u200b\u5efa\u8bae\u200b\uff01</p> <ul> <li>GitHub Issues: \u200b\u529f\u80fd\u200b\u8bf7\u6c42\u200b\u3001Bug \u200b\u62a5\u544a\u200b</li> <li>GitHub Discussions: \u200b\u8ba8\u8bba\u533a\u200b</li> <li>\u200b\u90ae\u4ef6\u200b: \u200b\u60a8\u200b\u7684\u200b.email@example.com</li> </ul>"},{"location":"about/roadmap/#_16","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u8d21\u732e\u200b\u6307\u5357\u200b</li> <li>\u200b\u5b89\u88c5\u200b\u6307\u5357\u200b</li> <li>\u200b\u5feb\u901f\u200b\u5f00\u59cb\u200b</li> </ul>"},{"location":"api/client/","title":"CouchDB Client API","text":""},{"location":"api/client/#_1","title":"\u6982\u8ff0","text":"<p><code>CouchDBClient</code> \u200b\u662f\u200b CouchDB HTTP \u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u4e0e\u200b CouchDB API \u200b\u901a\u4fe1\u200b\u3002\u200b\u652f\u6301\u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u3002</p>"},{"location":"api/client/#_2","title":"\u7c7b\u200b\u5c42\u6b21","text":"<pre><code>CouchDBClient (\u200b\u57fa\u7c7b\u200b)\n\u251c\u2500\u2500 SyncCouchDBClient (\u200b\u540c\u6b65\u200b\u5ba2\u6237\u7aef\u200b)\n\u2514\u2500\u2500 AsyncCouchDBClient (\u200b\u5f02\u6b65\u200b\u5ba2\u6237\u7aef\u200b)\n</code></pre>"},{"location":"api/client/#couchdbclient","title":"CouchDBClient \u200b\u57fa\u7c7b","text":""},{"location":"api/client/#_3","title":"\u521d\u59cb\u5316","text":"<pre><code>class CouchDBClient:\n    def __init__(\n        self,\n        base_url: str,\n        database: str,\n        username: Optional[str] = None,\n        password: Optional[str] = None,\n        **kwargs\n    ):\n        \"\"\"\n        \u200b\u53c2\u6570\u200b:\n            base_url: CouchDB \u200b\u57fa\u7840\u200b URL\n            database: \u200b\u6570\u636e\u5e93\u200b\u540d\u200b\n            username: \u200b\u7528\u6237\u540d\u200b\n            password: \u200b\u5bc6\u7801\u200b\n            **kwargs: \u200b\u5176\u4ed6\u200b HTTP \u200b\u53c2\u6570\u200b\n        \"\"\"\n</code></pre>"},{"location":"api/client/#_4","title":"\u4e3b\u8981\u200b\u65b9\u6cd5","text":""},{"location":"api/client/#find","title":"find()","text":"<p>\u200b\u6267\u884c\u200b Mango Query \u200b\u67e5\u8be2\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def find(\n    self,\n    selector: dict,\n    fields: Optional[List[str]] = None,\n    limit: Optional[int] = None,\n    skip: Optional[int] = None,\n    sort: Optional[List[dict]] = None,\n    **kwargs\n) -&gt; List[dict]:\n    \"\"\"\u200b\u6267\u884c\u200b Mango Query\"\"\"\n</code></pre></p> <p>\u200b\u53c2\u6570\u200b: - <code>selector</code>: Mango selector \u200b\u5bf9\u8c61\u200b - <code>fields</code>: \u200b\u8fd4\u56de\u200b\u5b57\u200b\u6bb5\u200b\u5217\u8868\u200b - <code>limit</code>: \u200b\u9650\u5236\u200b\u8fd4\u56de\u200b\u6570\u91cf\u200b - <code>skip</code>: \u200b\u8df3\u8fc7\u200b\u6587\u6863\u200b\u6570\u91cf\u200b - <code>sort</code>: \u200b\u6392\u5e8f\u200b\u5b57\u200b\u6bb5\u200b</p> <p>\u200b\u8fd4\u56de\u200b: <pre><code>[\n    {\n        \"_id\": \"doc:1\",\n        \"_rev\": \"1-abc123\",\n        \"field1\": \"value1\",\n        ...\n    },\n    ...\n]\n</code></pre></p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>client = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb',\n    username='admin',\n    password='password'\n)\n\n# \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\nresults = client.find(\n    selector={\"type\": {\"$eq\": \"user\"}},\n    fields=[\"_id\", \"name\", \"age\"],\n    limit=10\n)\n\nfor doc in results:\n    print(f\"ID: {doc['_id']}, \u200b\u59d3\u540d\u200b: {doc['name']}\")\n</code></pre></p>"},{"location":"api/client/#bulk_docs","title":"bulk_docs()","text":"<p>\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b/\u200b\u66f4\u65b0\u200b/\u200b\u5220\u9664\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def bulk_docs(self, docs: List[dict]) -&gt; List[dict]:\n    \"\"\"\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u6587\u6863\u200b\"\"\"\n</code></pre></p> <p>\u200b\u53c2\u6570\u200b: - <code>docs</code>: \u200b\u6587\u6863\u200b\u5217\u8868\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>docs = [\n    {\"_id\": \"user:1\", \"name\": \"Alice\", \"age\": 30, \"type\": \"user\"},\n    {\"_id\": \"user:2\", \"name\": \"Bob\", \"age\": 25, \"type\": \"user\"},\n]\n\nresults = client.bulk_docs(docs)\n</code></pre></p>"},{"location":"api/client/#ensure_index","title":"ensure_index()","text":"<p>\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def ensure_index(\n    self,\n    fields: Union[str, List[str]],\n    design_doc: Optional[str] = None,\n    name: Optional[str] = None\n) -&gt; dict:\n    \"\"\"\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\"\"\"\n</code></pre></p> <p>\u200b\u53c2\u6570\u200b: - <code>fields</code>: \u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u5b57\u7b26\u4e32\u200b\u6216\u200b\u5217\u8868\u200b - <code>design_doc</code>: \u200b\u8bbe\u8ba1\u200b\u6587\u6863\u200b\u540d\u200b - <code>name</code>: \u200b\u7d22\u5f15\u200b\u540d\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code># \u200b\u5355\u5b57\u200b\u6bb5\u200b\u7d22\u5f15\u200b\nclient.ensure_index(\"age\")\n\n# \u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\nclient.ensure_index([\"age\", \"name\"])\n\n# \u200b\u81ea\u5b9a\u4e49\u200b\u540d\u79f0\u200b\nclient.ensure_index(\"age\", name=\"age-index\")\n</code></pre></p>"},{"location":"api/client/#ping","title":"ping()","text":"<p>\u200b\u68c0\u67e5\u200b\u8fde\u63a5\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def ping(self) -&gt; bool:\n    \"\"\"\u200b\u68c0\u67e5\u200b CouchDB \u200b\u8fde\u63a5\u200b\"\"\"\n</code></pre></p> <p>\u200b\u8fd4\u56de\u200b: <code>True</code> \u200b\u5982\u679c\u200b\u8fde\u63a5\u200b\u6210\u529f\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>if client.ping():\n    print(\"\u2705 \u200b\u8fde\u63a5\u200b\u6b63\u5e38\u200b\")\nelse:\n    print(\"\u274c \u200b\u8fde\u63a5\u200b\u5931\u8d25\u200b\")\n</code></pre></p>"},{"location":"api/client/#get","title":"get()","text":"<p>\u200b\u83b7\u53d6\u200b\u5355\u4e2a\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def get(self, doc_id: str, rev: Optional[str] = None) -&gt; Optional[dict]:\n    \"\"\"\u200b\u83b7\u53d6\u200b\u6587\u6863\u200b\"\"\"\n</code></pre></p> <p>\u200b\u53c2\u6570\u200b: - <code>doc_id</code>: \u200b\u6587\u6863\u200b ID - <code>rev</code>: \u200b\u6587\u6863\u200b\u7248\u672c\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>doc = client.get(\"user:123\")\nif doc:\n    print(f\"\u200b\u6587\u6863\u200b: {doc}\")\nelse:\n    print(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n</code></pre></p>"},{"location":"api/client/#put","title":"put()","text":"<p>\u200b\u63d2\u5165\u200b\u6216\u200b\u66f4\u65b0\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def put(self, doc_id: str, doc: dict) -&gt; dict:\n    \"\"\"\u200b\u63d2\u5165\u200b\u6216\u200b\u66f4\u65b0\u200b\u6587\u6863\u200b\"\"\"\n</code></pre></p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>result = client.put(\"user:123\", {\n    \"name\": \"Alice\",\n    \"age\": 30,\n    \"type\": \"user\"\n})\nprint(f\"\u200b\u65b0\u200b\u7248\u672c\u200b: {result['rev']}\")\n</code></pre></p>"},{"location":"api/client/#delete","title":"delete()","text":"<p>\u200b\u5220\u9664\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def delete(self, doc_id: str, rev: str) -&gt; dict:\n    \"\"\"\u200b\u5220\u9664\u200b\u6587\u6863\u200b\"\"\"\n</code></pre></p> <p>\u200b\u53c2\u6570\u200b: - <code>doc_id</code>: \u200b\u6587\u6863\u200b ID - <code>rev</code>: \u200b\u6587\u6863\u200b\u7248\u672c\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code># \u200b\u5148\u200b\u83b7\u53d6\u200b\u6587\u6863\u200b\u7248\u672c\u200b\ndoc = client.get(\"user:123\")\nif doc:\n    result = client.delete(\"user:123\", doc[\"_rev\"])\n    print(\"\u200b\u5220\u9664\u200b\u6210\u529f\u200b\")\n</code></pre></p>"},{"location":"api/client/#synccouchdbclient","title":"SyncCouchDBClient","text":"<p>\u200b\u540c\u6b65\u200b CouchDB \u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <pre><code>from sqlalchemy_couchdb.client import SyncCouchDBClient\n\n# \u200b\u521d\u59cb\u5316\u200b\nclient = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb',\n    username='admin',\n    password='password'\n)\n\n# \u200b\u4f7f\u7528\u200b\nclient.ping()\nresults = client.find({\"type\": {\"$eq\": \"user\"}})\n</code></pre>"},{"location":"api/client/#_5","title":"\u914d\u7f6e\u200b\u53c2\u6570","text":"<pre><code>client = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb',\n    username='admin',\n    password='password',\n    timeout=30.0,              # \u200b\u8bf7\u6c42\u200b\u8d85\u65f6\u200b\n    verify_ssl=True,           # \u200b\u9a8c\u8bc1\u200b SSL\n    ca_cert_path=None,         # CA \u200b\u8bc1\u4e66\u200b\n    client_cert_path=None,     # \u200b\u5ba2\u6237\u7aef\u200b\u8bc1\u4e66\u200b\n    client_key_path=None,      # \u200b\u5ba2\u6237\u7aef\u200b\u5bc6\u94a5\u200b\n)\n</code></pre>"},{"location":"api/client/#asynccouchdbclient","title":"AsyncCouchDBClient","text":"<p>\u200b\u5f02\u6b65\u200b CouchDB \u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <pre><code>import asyncio\nfrom sqlalchemy_couchdb.client import AsyncCouchDBClient\n\nasync def main():\n    client = AsyncCouchDBClient(\n        base_url='http://localhost:5984',\n        database='mydb',\n        username='admin',\n        password='password'\n    )\n\n    # \u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\n    await client.ping()\n    results = await client.find({\"type\": {\"$eq\": \"user\"}})\n\n    # \u200b\u5173\u95ed\u200b\n    await client.close()\n\nasyncio.run(main())\n</code></pre>"},{"location":"api/client/#_6","title":"\u7279\u6b8a\u200b\u65b9\u6cd5","text":""},{"location":"api/client/#aclose","title":"aclose()","text":"<p>\u200b\u5f02\u6b65\u200b\u5173\u95ed\u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>async def aclose(self):\n    \"\"\"\u200b\u5f02\u6b65\u200b\u5173\u95ed\u200b\u5ba2\u6237\u7aef\u200b\"\"\"\n</code></pre></p> <p>\u200b\u4f7f\u7528\u200b: <pre><code>client = AsyncCouchDBClient(...)\ntry:\n    await client.find(...)\nfinally:\n    await client.aclose()\n</code></pre></p>"},{"location":"api/client/#aenter-aexit","title":"aenter / aexit","text":"<p>\u200b\u5f02\u6b65\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668\u200b\u3002</p> <pre><code>async def main():\n    async with AsyncCouchDBClient(...) as client:\n        await client.ping()\n        results = await client.find(...)\n</code></pre>"},{"location":"api/client/#_7","title":"\u4f7f\u7528\u200b\u793a\u4f8b","text":""},{"location":"api/client/#crud","title":"\u57fa\u672c\u200b CRUD","text":"<pre><code>from sqlalchemy_couchdb.client import SyncCouchDBClient\n\nclient = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb'\n)\n\n# CREATE\ndoc = {\"_id\": \"user:1\", \"name\": \"Alice\", \"age\": 30, \"type\": \"user\"}\nresult = client.put(\"user:1\", doc)\nprint(f\"\u200b\u63d2\u5165\u200b\u6210\u529f\u200b: {result}\")\n\n# READ\ndoc = client.get(\"user:1\")\nprint(f\"\u200b\u8bfb\u53d6\u200b: {doc}\")\n\n# UPDATE\ndoc[\"age\"] = 31\nresult = client.put(\"user:1\", doc)\nprint(f\"\u200b\u66f4\u65b0\u200b\u6210\u529f\u200b: {result}\")\n\n# DELETE\nresult = client.delete(\"user:1\", doc[\"_rev\"])\nprint(f\"\u200b\u5220\u9664\u200b\u6210\u529f\u200b: {result}\")\n</code></pre>"},{"location":"api/client/#_8","title":"\u9ad8\u7ea7\u200b\u67e5\u8be2","text":"<pre><code># \u200b\u590d\u6742\u200b\u6761\u4ef6\u200b\u67e5\u8be2\u200b\nresults = client.find({\n    \"selector\": {\n        \"type\": {\"$eq\": \"user\"},\n        \"$and\": [\n            {\"age\": {\"$gte\": 25}},\n            {\"age\": {\"$lte\": 35}},\n            {\"name\": {\"$regex\": \"^A\"}}\n        ]\n    },\n    \"fields\": [\"_id\", \"name\", \"age\"],\n    \"sort\": [{\"age\": \"desc\"}],\n    \"limit\": 10\n})\n\nfor doc in results:\n    print(f\"{doc['name']}: {doc['age']} \u200b\u5c81\u200b\")\n</code></pre>"},{"location":"api/client/#_9","title":"\u7d22\u5f15\u200b\u7ba1\u7406","text":"<pre><code># \u200b\u5217\u51fa\u200b\u6240\u6709\u200b\u7d22\u5f15\u200b\nindexes = client.list_indexes()\nprint(f\"\u200b\u73b0\u6709\u200b\u7d22\u5f15\u200b: {indexes}\")\n\n# \u200b\u521b\u5efa\u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\nclient.ensure_index(\n    fields=[\"type\", \"age\"],\n    name=\"type-age-index\"\n)\n\n# \u200b\u521b\u5efa\u200b\u90e8\u5206\u200b\u7d22\u5f15\u200b\n# \u200b\u6ce8\u610f\u200b\uff1a\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\uff0c\u200b\u67e5\u770b\u200b CouchDB \u200b\u6587\u6863\u200b\n</code></pre>"},{"location":"api/client/#_10","title":"\u6279\u91cf\u200b\u64cd\u4f5c","text":"<pre><code># \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\ndocs = [\n    {\"_id\": f\"user:{i}\", \"name\": f\"User{i}\", \"age\": i, \"type\": \"user\"}\n    for i in range(100)\n]\n\nresults = client.bulk_docs(docs)\nprint(f\"\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b {len(results)} \u200b\u4e2a\u200b\u6587\u6863\u200b\")\n\n# \u200b\u6279\u91cf\u200b\u66f4\u65b0\u200b\uff08\u200b\u9700\u8981\u200b\u5148\u200b\u67e5\u8be2\u200b\u83b7\u53d6\u200b _rev\uff09\ndocs_to_update = []\nfor result in results:\n    if result.get('ok'):\n        # \u200b\u83b7\u53d6\u200b\u6587\u6863\u200b\n        doc = client.get(result['id'])\n        doc['age'] += 1\n        doc['_rev'] = result['rev']\n        docs_to_update.append(doc)\n\n# \u200b\u66f4\u65b0\u200b\nupdated = client.bulk_docs(docs_to_update)\n</code></pre>"},{"location":"api/client/#_11","title":"\u5206\u9875\u200b\u67e5\u8be2","text":"<pre><code># \u200b\u4f7f\u7528\u200b LIMIT \u200b\u548c\u200b SKIP\npage_size = 10\npage_num = 1\nskip = (page_num - 1) * page_size\n\nresults = client.find({\n    \"selector\": {\"type\": {\"$eq\": \"user\"}},\n    \"limit\": page_size,\n    \"skip\": skip,\n    \"sort\": [{\"_id\": \"asc\"}]\n})\n\n# \u200b\u9ad8\u6548\u200b\u5206\u9875\u200b\uff1a\u200b\u4f7f\u7528\u200b startkey\nif results:\n    last_key = results[-1][\"_id\"]\n    next_results = client.find({\n        \"selector\": {\"type\": {\"$eq\": \"user\"}},\n        \"limit\": page_size,\n        \"startkey\": last_key\n    })\n</code></pre>"},{"location":"api/client/#_12","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"api/client/#_13","title":"\u6355\u83b7\u200b\u5f02\u5e38","text":"<pre><code>from sqlalchemy_couchdb.exceptions import (\n    CouchDBError,\n    DocumentConflict,\n    NotFoundError\n)\n\ntry:\n    doc = client.get(\"nonexistent\")\nexcept NotFoundError:\n    print(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\nexcept DocumentConflict:\n    print(\"\u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b\")\nexcept CouchDBError as e:\n    print(f\"CouchDB \u200b\u9519\u8bef\u200b: {e}\")\n</code></pre>"},{"location":"api/client/#_14","title":"\u91cd\u8bd5\u200b\u673a\u5236","text":"<pre><code>from functools import wraps\n\ndef retry(max_attempts=3, delay=0.1):\n    def decorator(func):\n        @wraps(func)\n        def wrapper(self, *args, **kwargs):\n            for attempt in range(max_attempts):\n                try:\n                    return func(self, *args, **kwargs)\n                except DocumentConflict:\n                    if attempt == max_attempts - 1:\n                        raise\n                    time.sleep(delay)\n            return None\n        return wrapper\n    return decorator\n\nclass SyncCouchDBClient(SyncCouchDBClient):\n    @retry(max_attempts=3)\n    def update_with_retry(self, doc_id, update_func):\n        doc = self.get(doc_id)\n        if doc:\n            doc = update_func(doc)\n            return self.put(doc_id, doc)\n        return None\n</code></pre>"},{"location":"api/client/#_15","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"api/client/#_16","title":"\u8fde\u63a5\u6c60","text":"<pre><code># httpx \u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u200b\nclient = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb',\n    # httpx \u200b\u53c2\u6570\u200b\n    limits=httpx.Limits(\n        max_keepalive_connections=5,\n        max_connections=10\n    )\n)\n</code></pre>"},{"location":"api/client/#_17","title":"\u7f13\u5b58","text":"<pre><code>from functools import lru_cache\n\nclass CachedCouchDBClient(SyncCouchDBClient):\n    @lru_cache(maxsize=128)\n    def get_cached(self, doc_id):\n        \"\"\"\u200b\u7f13\u5b58\u200b get \u200b\u64cd\u4f5c\u200b\"\"\"\n        return super().get(doc_id)\n\n    def invalidate_cache(self, doc_id):\n        \"\"\"\u200b\u5931\u6548\u200b\u7f13\u5b58\u200b\"\"\"\n        self.get_cached.cache_clear()\n</code></pre>"},{"location":"api/client/#_18","title":"\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u4f18\u5316","text":"<pre><code># \u200b\u5206\u6279\u200b\u5904\u7406\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\nbatch_size = 100\ndocs = [...]  # \u200b\u5927\u91cf\u200b\u6587\u6863\u200b\n\nfor i in range(0, len(docs), batch_size):\n    batch = docs[i:i + batch_size]\n    results = client.bulk_docs(batch)\n    print(f\"\u200b\u5904\u7406\u200b\u6279\u6b21\u200b {i // batch_size + 1}\")\n</code></pre>"},{"location":"api/client/#_19","title":"\u76f8\u5173\u200b\u8d44\u6e90","text":"<ul> <li>CouchDB HTTP API</li> <li>Mango Query</li> <li>httpx \u200b\u6587\u6863\u200b</li> </ul>"},{"location":"api/compiler/","title":"CouchDBCompiler API","text":""},{"location":"api/compiler/#_1","title":"\u6982\u8ff0","text":"<p><code>CouchDBCompiler</code> \u200b\u662f\u200b SQLAlchemy \u200b\u5230\u200b Mango Query \u200b\u7684\u200b\u6838\u5fc3\u200b\u7f16\u8bd1\u5668\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u5c06\u200b SQL \u200b\u8bed\u53e5\u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB \u200b\u53ef\u200b\u6267\u884c\u200b\u7684\u200b Mango Query\u3002</p>"},{"location":"api/compiler/#_2","title":"\u7c7b\u200b\u5b9a\u4e49","text":"<pre><code>from sqlalchemy.engine.interfaces import Compiled\n\nclass CouchDBCompiler(SQLCompiler):\n    \"\"\"\u200b\u5c06\u200b SQL \u200b\u7f16\u8bd1\u200b\u4e3a\u200b Mango Query\"\"\"\n</code></pre>"},{"location":"api/compiler/#_3","title":"\u4e3b\u8981\u200b\u65b9\u6cd5","text":""},{"location":"api/compiler/#visit_select","title":"visit_select()","text":"<p>\u200b\u7f16\u8bd1\u200b SELECT \u200b\u8bed\u53e5\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def visit_select(self, select, **kwargs) -&gt; dict:\n    \"\"\"\u200b\u7f16\u8bd1\u200b SELECT \u200b\u8bed\u53e5\u200b\u4e3a\u200b Mango Query\"\"\"\n</code></pre></p> <p>\u200b\u53c2\u6570\u200b: - <code>select</code>: SQLAlchemy Select \u200b\u5bf9\u8c61\u200b</p> <p>\u200b\u8fd4\u56de\u200b: <pre><code>{\n    \"selector\": {...},  # Mango selector\n    \"fields\": [...],     # \u200b\u8fd4\u56de\u200b\u5b57\u200b\u6bb5\u200b\n    \"sort\": [...],       # \u200b\u6392\u5e8f\u200b\n    \"limit\": int,        # \u200b\u9650\u5236\u200b\u6570\u91cf\u200b\n    \"skip\": int          # \u200b\u8df3\u8fc7\u200b\u6570\u91cf\u200b\n}\n</code></pre></p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy import text\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\ncompiler = CouchDBCompiler(dialect, None)\nsql = text(\"SELECT * FROM users WHERE age &gt; 25\")\nmango = compiler.visit_select(sql)\n</code></pre></p>"},{"location":"api/compiler/#visit_insert","title":"visit_insert()","text":"<p>\u200b\u7f16\u8bd1\u200b INSERT \u200b\u8bed\u53e5\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def visit_insert(self, insert, **kwargs) -&gt; dict:\n    \"\"\"\u200b\u7f16\u8bd1\u200b INSERT \u200b\u8bed\u53e5\u200b\"\"\"\n</code></pre></p> <p>\u200b\u8fd4\u56de\u200b: <pre><code>{\n    \"method\": \"POST\",\n    \"docs\": [...],  # \u200b\u8981\u200b\u63d2\u5165\u200b\u7684\u200b\u6587\u6863\u200b\u5217\u8868\u200b\n    \"endpoint\": \"/_bulk_docs\"  # \u200b\u6216\u200b \"/\"\n}\n</code></pre></p>"},{"location":"api/compiler/#visit_update","title":"visit_update()","text":"<p>\u200b\u7f16\u8bd1\u200b UPDATE \u200b\u8bed\u53e5\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def visit_update(self, update, **kwargs) -&gt; dict:\n    \"\"\"\u200b\u7f16\u8bd1\u200b UPDATE \u200b\u8bed\u53e5\u200b\"\"\"\n</code></pre></p> <p>\u200b\u7279\u70b9\u200b: - \u200b\u81ea\u52a8\u200b\u5904\u7406\u200b\u4e50\u89c2\u200b\u9501\u200b\uff08<code>_rev</code>\uff09 - \u200b\u4f7f\u7528\u200b <code>$set</code> \u200b\u64cd\u4f5c\u200b\u907f\u514d\u200b\u8986\u76d6\u200b\u6574\u4e2a\u200b\u6587\u6863\u200b</p>"},{"location":"api/compiler/#visit_delete","title":"visit_delete()","text":"<p>\u200b\u7f16\u8bd1\u200b DELETE \u200b\u8bed\u53e5\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def visit_delete(self, delete, **kwargs) -&gt; dict:\n    \"\"\"\u200b\u7f16\u8bd1\u200b DELETE \u200b\u8bed\u53e5\u200b\"\"\"\n</code></pre></p> <p>\u200b\u8fd4\u56de\u200b: <pre><code>{\n    \"method\": \"POST\",\n    \"endpoint\": \"/_bulk_docs\",\n    \"docs\": [\n        {\n            \"_id\": \"...\",\n            \"_rev\": \"...\",\n            \"_deleted\": True\n        }\n    ]\n}\n</code></pre></p>"},{"location":"api/compiler/#_compile_where","title":"_compile_where()","text":"<p>\u200b\u7f16\u8bd1\u200b WHERE \u200b\u6761\u4ef6\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def _compile_where(self, whereclause) -&gt; dict:\n    \"\"\"\u200b\u7f16\u8bd1\u200b WHERE \u200b\u6761\u4ef6\u200b\u4e3a\u200b Mango selector\"\"\"\n</code></pre></p> <p>\u200b\u8f6c\u6362\u89c4\u5219\u200b:</p> SQL Mango \u200b\u793a\u4f8b\u200b <code>=</code> <code>$eq</code> <code>age = 25</code> <code>&gt;</code> <code>$gt</code> <code>age &gt; 25</code> <code>&gt;=</code> <code>$gte</code> <code>age &gt;= 25</code> <code>&lt;</code> <code>$lt</code> <code>age &lt; 30</code> <code>&lt;=</code> <code>$lte</code> <code>age &lt;= 30</code> <code>!=</code> <code>$ne</code> <code>age != 25</code> <code>IN</code> <code>$in</code> <code>name IN ('A', 'B')</code> <code>LIKE</code> <code>$regex</code> <code>name LIKE '%Alice%'</code> <code>AND</code> \u200b\u5408\u5e76\u200b <code>age &gt; 25 AND active</code> <code>OR</code> <code>$or</code> <code>age &gt; 30 OR name = 'Bob'</code>"},{"location":"api/compiler/#_compile_order_by","title":"_compile_order_by()","text":"<p>\u200b\u7f16\u8bd1\u200b ORDER BY \u200b\u5b50\u53e5\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def _compile_order_by(self, order_by) -&gt; list:\n    \"\"\"\u200b\u7f16\u8bd1\u200b ORDER BY \u200b\u4e3a\u200b sort \u200b\u6570\u7ec4\u200b\"\"\"\n</code></pre></p> <p>\u200b\u7279\u70b9\u200b: - \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u6240\u200b\u9700\u200b\u7d22\u5f15\u200b - \u200b\u652f\u6301\u200b ASC/DESC - \u200b\u590d\u5408\u200b\u6392\u5e8f\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code># SQL: ORDER BY age DESC, name ASC\n# \u200b\u8fd4\u56de\u200b:\n[\n    {\"age\": \"desc\"},\n    {\"name\": \"asc\"}\n]\n</code></pre></p>"},{"location":"api/compiler/#_extract_value","title":"_extract_value()","text":"<p>\u200b\u63d0\u53d6\u200b\u7ed1\u5b9a\u200b\u53c2\u6570\u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def _extract_value(self, value) -&gt; Any:\n    \"\"\"\u200b\u63d0\u53d6\u200b BindParameter \u200b\u7684\u200b\u503c\u200b\"\"\"\n</code></pre></p>"},{"location":"api/compiler/#_serialize_for_json","title":"_serialize_for_json()","text":"<p>\u200b\u5e8f\u5217\u5316\u200b\u503c\u4e3a\u200b JSON \u200b\u517c\u5bb9\u200b\u683c\u5f0f\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def _serialize_for_json(self, value) -&gt; Any:\n    \"\"\"\u200b\u5e8f\u5217\u5316\u200b\u503c\u4e3a\u200b JSON\"\"\"\n</code></pre></p> <p>\u200b\u5904\u7406\u200b\u7c7b\u578b\u200b: - <code>datetime</code> \u2192 ISO 8601 \u200b\u5b57\u7b26\u4e32\u200b - <code>date</code> \u2192 ISO 8601 \u200b\u65e5\u671f\u200b\u5b57\u7b26\u4e32\u200b - <code>Decimal</code> \u2192 \u200b\u5b57\u7b26\u4e32\u200b - <code>dict</code>/<code>list</code> \u2192 \u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b - \u200b\u5176\u4ed6\u200b \u2192 \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5b57\u7b26\u4e32\u200b</p>"},{"location":"api/compiler/#_4","title":"\u4f7f\u7528\u200b\u793a\u4f8b","text":""},{"location":"api/compiler/#sql","title":"\u624b\u52a8\u200b\u7f16\u8bd1\u200b SQL","text":"<pre><code>from sqlalchemy import text, create_engine\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\n# \u200b\u521b\u5efa\u200b\u5f15\u64ce\u200b\nengine = create_engine('couchdb://localhost:5984/mydb')\n\n# \u200b\u521b\u5efa\u200b\u7f16\u8bd1\u5668\u200b\ndialect = engine.dialect\ncompiler = CouchDBCompiler(dialect, None)\n\n# \u200b\u7f16\u8bd1\u200b SQL\nsql = text(\"SELECT * FROM users WHERE age &gt; 25 ORDER BY age DESC LIMIT 10\")\nmango_query = compiler.visit_select(sql)\n\nprint(mango_query)\n# \u200b\u8f93\u51fa\u200b:\n# {\n#     \"selector\": {\"age\": {\"$gt\": 25}},\n#     \"fields\": [\"_id\", \"_rev\", \"name\", \"age\"],\n#     \"sort\": [{\"age\": \"desc\"}],\n#     \"limit\": 10\n# }\n</code></pre>"},{"location":"api/compiler/#_5","title":"\u81ea\u5b9a\u4e49\u200b\u7f16\u8bd1\u5668\u200b\u884c\u4e3a","text":"<pre><code>from sqlalchemy_couchdb.compiler import CouchDBCompiler\n\nclass CustomCompiler(CouchDBCompiler):\n    \"\"\"\u200b\u81ea\u5b9a\u4e49\u200b\u7f16\u8bd1\u5668\u200b\"\"\"\n\n    def visit_select(self, select, **kwargs):\n        # \u200b\u8c03\u7528\u200b\u7236\u7c7b\u200b\u65b9\u6cd5\u200b\n        mango = super().visit_select(select, **kwargs)\n\n        # \u200b\u6dfb\u52a0\u200b\u81ea\u5b9a\u4e49\u200b\u903b\u8f91\u200b\n        # \u200b\u4f8b\u5982\u200b\uff1a\u200b\u603b\u662f\u200b\u5305\u542b\u200b _id \u200b\u548c\u200b _rev\n        if \"_id\" not in mango[\"fields\"]:\n            mango[\"fields\"].insert(0, \"_id\")\n        if \"_rev\" not in mango[\"fields\"]:\n            mango[\"fields\"].insert(1, \"_rev\")\n\n        return mango\n\n# \u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7f16\u8bd1\u5668\u200b\ncompiler = CustomCompiler(dialect, None)\n</code></pre>"},{"location":"api/compiler/#_6","title":"\u5185\u90e8\u200b\u5b9e\u73b0","text":""},{"location":"api/compiler/#_7","title":"\u7f16\u8bd1\u5668\u200b\u521d\u59cb\u5316","text":"<pre><code>def __init__(self, dialect, statement, **kwargs):\n    super().__init__(dialect, statement, **kwargs)\n    self.client = None  # \u200b\u5c06\u200b\u5728\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u8bbe\u7f6e\u200b\n</code></pre>"},{"location":"api/compiler/#_8","title":"\u7f16\u8bd1\u200b\u6d41\u7a0b","text":"<pre><code>graph TD\n    A[SQL \u200b\u8bed\u53e5\u200b] --&gt; B[visit_select/insert/update/delete]\n    B --&gt; C[\u200b\u63d0\u53d6\u200b\u7ec4\u4ef6\u200b]\n    C --&gt; D[_compile_where]\n    C --&gt; E[_compile_order_by]\n    C --&gt; F[_compile_fields]\n    D,G,E,F --&gt; G[\u200b\u7ec4\u88c5\u200b Mango Query]\n    G --&gt; H[\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b]</code></pre>"},{"location":"api/compiler/#_9","title":"\u7d22\u5f15\u200b\u7ba1\u7406","text":"<pre><code>def _ensure_indexes(self, fields):\n    \"\"\"\u200b\u786e\u4fdd\u200b\u7d22\u5f15\u200b\u5b58\u5728\u200b\"\"\"\n    for field in fields:\n        self.client.ensure_index(field)\n</code></pre>"},{"location":"api/compiler/#_10","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"api/compiler/#_11","title":"\u7f16\u8bd1\u200b\u9519\u8bef","text":"<pre><code>try:\n    mango = compiler.visit_select(sql)\nexcept Exception as e:\n    print(f\"\u200b\u7f16\u8bd1\u200b\u5931\u8d25\u200b: {e}\")\n    # \u200b\u53ef\u80fd\u200b\u7684\u200b\u539f\u56e0\u200b\uff1a\n    # - \u200b\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b SQL \u200b\u8bed\u6cd5\u200b\n    # - \u200b\u7f3a\u5c11\u200b\u5fc5\u8981\u200b\u5b57\u200b\u6bb5\u200b\n    # - \u200b\u7c7b\u578b\u8f6c\u6362\u200b\u9519\u8bef\u200b\n</code></pre>"},{"location":"api/compiler/#_12","title":"\u8c03\u8bd5\u200b\u7f16\u8bd1\u200b\u8fc7\u7a0b","text":"<pre><code>import logging\n\n# \u200b\u542f\u7528\u200b\u8c03\u8bd5\u200b\u65e5\u5fd7\u200b\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger('sqlalchemy_couchdb.compiler')\n\n# \u200b\u7f16\u8bd1\u200b\u65f6\u4f1a\u200b\u5728\u200b\u65e5\u5fd7\u200b\u4e2d\u200b\u770b\u5230\u200b\u8be6\u7ec6\u4fe1\u606f\u200b\nmango = compiler.visit_select(sql)\n</code></pre>"},{"location":"api/compiler/#_13","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"api/compiler/#_14","title":"\u7f13\u5b58\u200b\u7f16\u8bd1\u200b\u7ed3\u679c","text":"<pre><code>from functools import lru_cache\n\nclass CachedCompiler(CouchDBCompiler):\n    @lru_cache(maxsize=100)\n    def visit_select_cached(self, sql_str):\n        \"\"\"\u200b\u7f13\u5b58\u200b\u7f16\u8bd1\u200b\u7ed3\u679c\u200b\"\"\"\n        sql = text(sql_str)\n        return self.visit_select(sql)\n</code></pre>"},{"location":"api/compiler/#_15","title":"\u6279\u91cf\u200b\u7f16\u8bd1","text":"<pre><code>def compile_batch(self, statements):\n    \"\"\"\u200b\u6279\u91cf\u200b\u7f16\u8bd1\u200b\"\"\"\n    results = []\n    for stmt in statements:\n        try:\n            result = self.visit_select(stmt)\n            results.append(result)\n        except Exception as e:\n            results.append({\"error\": str(e)})\n    return results\n</code></pre>"},{"location":"api/compiler/#_16","title":"\u6269\u5c55\u200b\u6307\u5357","text":""},{"location":"api/compiler/#sql_1","title":"\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b SQL \u200b\u7279\u6027","text":"<pre><code>class ExtendedCompiler(CouchDBCompiler):\n    \"\"\"\u200b\u6269\u5c55\u200b\u7f16\u8bd1\u5668\u200b\u4ee5\u200b\u652f\u6301\u200b\u65b0\u200b\u7279\u6027\u200b\"\"\"\n\n    def visit_custom_clause(self, clause, **kwargs):\n        \"\"\"\u200b\u5904\u7406\u200b\u81ea\u5b9a\u4e49\u200b SQL \u200b\u5b50\u53e5\u200b\"\"\"\n        # \u200b\u5b9e\u73b0\u200b\u903b\u8f91\u200b\n        return {\"custom\": \"value\"}\n</code></pre>"},{"location":"api/compiler/#_17","title":"\u81ea\u5b9a\u4e49\u200b\u8f6c\u6362\u89c4\u5219","text":"<pre><code>class CustomCompiler(CouchDBCompiler):\n    \"\"\"\u200b\u81ea\u5b9a\u4e49\u200b\u8f6c\u6362\u89c4\u5219\u200b\"\"\"\n\n    def _compile_condition(self, condition):\n        \"\"\"\u200b\u91cd\u5199\u200b\u6761\u4ef6\u200b\u7f16\u8bd1\u200b\"\"\"\n        # \u200b\u81ea\u5b9a\u4e49\u200b\u903b\u8f91\u200b\n        return super()._compile_condition(condition)\n</code></pre>"},{"location":"api/compiler/#_18","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ol> <li>\u200b\u59cb\u7ec8\u200b\u5305\u542b\u200b <code>_id</code>: \u200b\u786e\u4fdd\u200b\u67e5\u8be2\u200b\u5305\u542b\u200b\u4e3b\u952e\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b: ORDER BY \u200b\u5b57\u6bb5\u200b\u5e94\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b</li> <li>\u200b\u9650\u5236\u200b\u5b57\u200b\u6bb5\u200b: \u200b\u53ea\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b: \u200b\u59cb\u7ec8\u200b\u6355\u83b7\u200b\u7f16\u8bd1\u200b\u9519\u8bef\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b: \u200b\u9a8c\u8bc1\u200b\u751f\u6210\u200b\u7684\u200b Mango Query</li> </ol>"},{"location":"api/compiler/#_19","title":"\u76f8\u5173\u200b\u8d44\u6e90","text":"<ul> <li>Mango Query \u200b\u6587\u6863\u200b</li> <li>SQLAlchemy \u200b\u7f16\u8bd1\u5668\u200b API</li> </ul>"},{"location":"api/dialect/","title":"Dialect API","text":""},{"location":"api/dialect/#_1","title":"\u6982\u8ff0","text":"<p><code>CouchDBDialect</code> \u200b\u662f\u200b SQLAlchemy \u200b\u65b9\u8a00\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u5c06\u200b SQLAlchemy \u200b\u7684\u200b\u8fde\u63a5\u200b\u3001\u200b\u6e38\u6807\u200b\u7b49\u200b\u6982\u5ff5\u200b\u6620\u5c04\u200b\u5230\u200b CouchDB\u3002</p>"},{"location":"api/dialect/#_2","title":"\u7c7b\u200b\u5c42\u6b21","text":"<pre><code>CouchDBDialect\n\u251c\u2500\u2500 CouchDBDialect  (\u200b\u57fa\u7c7b\u200b)\n\u251c\u2500\u2500 AsyncCouchDBDialect (\u200b\u5f02\u6b65\u200b\u65b9\u8a00\u200b)\n</code></pre>"},{"location":"api/dialect/#couchdbdialect","title":"CouchDBDialect","text":""},{"location":"api/dialect/#_3","title":"\u7c7b\u200b\u5b9a\u4e49","text":"<pre><code>from sqlalchemy.dialects.postgresql.base import PGDialect\nfrom sqlalchemy.engine.interfaces import Dialect\n\nclass CouchDBDialect(PGDialect):\n    \"\"\"CouchDB \u200b\u65b9\u8a00\u200b\u5b9e\u73b0\u200b\"\"\"\n</code></pre>"},{"location":"api/dialect/#_4","title":"\u521d\u59cb\u5316","text":"<pre><code>def __init__(self, **kwargs):\n    super().__init__(**kwargs)\n    self.client = None  # \u200b\u5c06\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\n</code></pre>"},{"location":"api/dialect/#_5","title":"\u4e3b\u8981\u200b\u5c5e\u6027","text":"<ul> <li>name: <code>'couchdb'</code></li> <li>driver: <code>'couchdb'</code></li> <li>default_schema_name: <code>'main'</code></li> </ul>"},{"location":"api/dialect/#_6","title":"\u5173\u952e\u200b\u65b9\u6cd5","text":""},{"location":"api/dialect/#create_connect_args","title":"create_connect_args()","text":"<p>\u200b\u521b\u5efa\u200b\u8fde\u63a5\u200b\u53c2\u6570\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def create_connect_args(self, url) -&gt; Tuple[dict, dict]:\n    \"\"\"\u200b\u89e3\u6790\u200b URL \u200b\u5e76\u200b\u8fd4\u56de\u200b\u8fde\u63a5\u200b\u53c2\u6570\u200b\"\"\"\n</code></pre></p> <p>\u200b\u8fd4\u56de\u200b: <pre><code>(\n    {  # \u200b\u4f4d\u7f6e\u200b\u53c2\u6570\u200b\n        'base_url': 'http://localhost:5984',\n        'database': 'mydb',\n        'username': 'admin',\n        'password': 'password'\n    },\n    {}  # \u200b\u5173\u952e\u5b57\u200b\u53c2\u6570\u200b\n)\n</code></pre></p> <p>URL \u200b\u89e3\u6790\u200b\u89c4\u5219\u200b:</p> URL \u200b\u683c\u5f0f\u200b \u200b\u89e3\u6790\u200b\u7ed3\u679c\u200b <code>couchdb://localhost/mydb</code> \u200b\u65e0\u200b\u8ba4\u8bc1\u200b <code>couchdb://user:pass@host/db</code> \u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\u8ba4\u8bc1\u200b <code>couchdb+async://...</code> \u200b\u5f02\u6b65\u200b\u6a21\u5f0f"},{"location":"api/dialect/#get_dbapi_module","title":"get_dbapi_module()","text":"<p>\u200b\u8fd4\u56de\u200b DBAPI \u200b\u6a21\u5757\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def get_dbapi_module(self) -&gt; ModuleType:\n    \"\"\"\u200b\u8fd4\u56de\u200b DBAPI \u200b\u6a21\u5757\u200b\"\"\"\n</code></pre></p> <p>\u200b\u8fd4\u56de\u200b: - \u200b\u540c\u6b65\u200b\u6a21\u5f0f\u200b: <code>sqlalchemy_couchdb.dbapi.sync</code> - \u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b: <code>sqlalchemy_couchdb.dbapi.async_</code></p>"},{"location":"api/dialect/#create_client","title":"create_client()","text":"<p>\u200b\u521b\u5efa\u200b CouchDB \u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def create_client(self, **kwargs) -&gt; CouchDBClient:\n    \"\"\"\u200b\u521b\u5efa\u200b CouchDB \u200b\u5ba2\u6237\u7aef\u200b\"\"\"\n</code></pre></p>"},{"location":"api/dialect/#get_indexes","title":"get_indexes()","text":"<p>\u200b\u83b7\u53d6\u200b\u7d22\u5f15\u200b\u5217\u8868\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def get_indexes(self, connection, table_name, schema=None, **kwargs) -&gt; List[dict]:\n    \"\"\"\u200b\u83b7\u53d6\u200b\u8868\u200b\u7684\u200b\u7d22\u5f15\u200b\"\"\"\n</code></pre></p>"},{"location":"api/dialect/#get_columns","title":"get_columns()","text":"<p>\u200b\u83b7\u53d6\u200b\u5217\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def get_columns(self, connection, table_name, schema=None, **kwargs) -&gt; List[dict]:\n    \"\"\"\u200b\u83b7\u53d6\u200b\u8868\u200b\u7684\u200b\u5217\u200b\u4fe1\u606f\u200b\"\"\"\n</code></pre></p>"},{"location":"api/dialect/#get_table_names","title":"get_table_names()","text":"<p>\u200b\u83b7\u53d6\u200b\u8868\u540d\u200b\u5217\u8868\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def get_table_names(self, connection, schema=None, **kwargs) -&gt; List[str]:\n    \"\"\"\u200b\u83b7\u53d6\u200b\u6240\u6709\u200b\u8868\u540d\u200b\"\"\"\n</code></pre></p> <p>\u200b\u6ce8\u610f\u200b: \u200b\u5728\u200b CouchDB \u200b\u4e2d\u200b\uff0c\"\u200b\u8868\u200b\"\u200b\u901a\u8fc7\u200b <code>type</code> \u200b\u5b57\u200b\u6bb5\u200b\u6a21\u62df\u200b\u3002</p>"},{"location":"api/dialect/#get_view_names","title":"get_view_names()","text":"<p>\u200b\u83b7\u53d6\u200b\u89c6\u56fe\u200b\u540d\u200b\u5217\u8868\u200b\u3002</p> <p>\u200b\u7b7e\u540d\u200b: <pre><code>def get_view_names(self, connection, schema=None, **kwargs) -&gt; List[str]:\n    \"\"\"\u200b\u83b7\u53d6\u200b\u6240\u6709\u200b\u89c6\u56fe\u200b\u540d\u200b\"\"\"\n</code></pre></p>"},{"location":"api/dialect/#asynccouchdbdialect","title":"AsyncCouchDBDialect","text":"<p>\u200b\u5f02\u6b65\u200b\u65b9\u8a00\u200b\u5b9e\u73b0\u200b\u3002</p> <pre><code>class AsyncCouchDBDialect(CouchDBDialect):\n    \"\"\"\u200b\u5f02\u6b65\u200b CouchDB \u200b\u65b9\u8a00\u200b\"\"\"\n</code></pre>"},{"location":"api/dialect/#_7","title":"\u7279\u6b8a\u200b\u5904\u7406","text":"<ul> <li>\u200b\u4f7f\u7528\u200b <code>@await_only</code> \u200b\u88c5\u9970\u200b\u5668\u200b\u5305\u88c5\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u901a\u8fc7\u200b greenlet \u200b\u5b9e\u73b0\u200b\u540c\u6b65\u200b\u5230\u200b\u5f02\u6b65\u200b\u7684\u200b\u6865\u63a5\u200b</li> </ul>"},{"location":"api/dialect/#_8","title":"\u4f7f\u7528\u200b\u793a\u4f8b","text":""},{"location":"api/dialect/#_9","title":"\u521b\u5efa\u200b\u65b9\u8a00","text":"<pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy_couchdb.dialect import CouchDBDialect\n\n# \u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u65b9\u8a00\u200b\ndialect = CouchDBDialect()\n\n# \u200b\u6216\u200b\u901a\u8fc7\u200b\u5f15\u64ce\u200b\nengine = create_engine('couchdb://localhost:5984/mydb')\ndialect = engine.dialect\n\nprint(f\"\u200b\u65b9\u8a00\u200b\u540d\u79f0\u200b: {dialect.name}\")\nprint(f\"\u200b\u9a71\u52a8\u200b: {dialect.driver}\")\n</code></pre>"},{"location":"api/dialect/#_10","title":"\u81ea\u5b9a\u4e49\u200b\u65b9\u8a00","text":"<pre><code>from sqlalchemy_couchdb.dialect import CouchDBDialect\n\nclass CustomCouchDBDialect(CouchDBDialect):\n    \"\"\"\u200b\u81ea\u5b9a\u4e49\u200b\u65b9\u8a00\u200b\"\"\"\n\n    def create_client(self, **kwargs):\n        \"\"\"\u200b\u91cd\u5199\u200b\u5ba2\u6237\u7aef\u200b\u521b\u5efa\u200b\"\"\"\n        # \u200b\u81ea\u5b9a\u4e49\u200b\u903b\u8f91\u200b\n        return super().create_client(**kwargs)\n\n    def get_table_names(self, connection, schema=None, **kwargs):\n        \"\"\"\u200b\u81ea\u5b9a\u4e49\u200b\u8868\u540d\u200b\u83b7\u53d6\u200b\"\"\"\n        # \u200b\u81ea\u5b9a\u4e49\u200b\u903b\u8f91\u200b\n        return super().get_table_names(connection, schema, **kwargs)\n\n# \u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u65b9\u8a00\u200b\ndialect = CustomCouchDBDialect()\nengine = create_engine('couchdb://localhost:5984/mydb', dialect=dialect)\n</code></pre>"},{"location":"api/dialect/#_11","title":"\u5185\u90e8\u200b\u5b9e\u73b0","text":""},{"location":"api/dialect/#_12","title":"\u8fde\u63a5\u200b\u5efa\u7acb\u200b\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant U as User\n    participant E as Engine\n    participant D as Dialect\n    participant C as Client\n    participant DB as CouchDB\n\n    U-&gt;&gt;E: create_engine()\n    E-&gt;&gt;D: create_connect_args()\n    D-&gt;&gt;C: create_client()\n    D-&gt;&gt;DB: ping() \u200b\u68c0\u67e5\u200b\u8fde\u63a5\u200b\n    DB--&gt;&gt;D: OK\n    D--&gt;&gt;E: \u200b\u8fde\u63a5\u200b\u53c2\u6570\u200b\n    E--&gt;&gt;U: \u200b\u5f15\u64ce\u200b\u521b\u5efa\u200b\u5b8c\u6210\u200b</code></pre>"},{"location":"api/dialect/#sql","title":"SQL \u200b\u7f16\u8bd1\u200b\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant C as Client\n    participant S as SQL\n    participant Comp as Compiler\n    participant M as Mango Query\n    participant DB as CouchDB\n\n    C-&gt;&gt;S: execute()\n    S-&gt;&gt;Comp: visit_select()\n    Comp-&gt;&gt;Comp: _compile_where()\n    Comp-&gt;&gt;Comp: _compile_order_by()\n    Comp-&gt;&gt;M: \u200b\u751f\u6210\u200b\u67e5\u8be2\u200b\n    M-&gt;&gt;DB: POST /_find\n    DB--&gt;&gt;M: \u200b\u7ed3\u679c\u200b\n    M--&gt;&gt;C: \u200b\u6587\u6863\u200b\u5217\u8868\u200b\n    C--&gt;&gt;S: Result\n    S--&gt;&gt;Client: \u200b\u884c\u200b\u6570\u636e\u200b</code></pre>"},{"location":"api/dialect/#_13","title":"\u4e8b\u52a1\u200b\u652f\u6301","text":""},{"location":"api/dialect/#_14","title":"\u4e8b\u52a1\u5904\u7406","text":"<pre><code>def supports_sane_rowcount(self) -&gt; bool:\n    \"\"\"\u200b\u662f\u5426\u200b\u652f\u6301\u200b\u884c\u200b\u6570\u200b\u7edf\u8ba1\u200b\"\"\"\n    return False\n\ndef supports_sane_multi_rowcount(self) -&gt; bool:\n    \"\"\"\u200b\u662f\u5426\u200b\u652f\u6301\u200b\u591a\u884c\u200b\u7edf\u8ba1\u200b\"\"\"\n    return False\n\ndef supports_unicode_statements(self) -&gt; bool:\n    \"\"\"\u200b\u662f\u5426\u200b\u652f\u6301\u200b Unicode SQL\"\"\"\n    return True\n</code></pre>"},{"location":"api/dialect/#_15","title":"\u63d0\u4ea4\u200b\u884c\u4e3a","text":"<pre><code># \u200b\u5728\u200b CouchDB \u200b\u4e2d\u200b\uff0ccommit() \u200b\u662f\u200b no-op\n# \u200b\u56e0\u4e3a\u200b CouchDB \u200b\u6587\u6863\u200b\u7ea7\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c\u200b\u65e0\u591a\u200b\u6587\u6863\u200b\u4e8b\u52a1\u200b\ndef do_commit(self, connection):\n    \"\"\"\u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b (\u200b\u7a7a\u200b\u5b9e\u73b0\u200b)\"\"\"\n    pass\n\ndef do_rollback(self, connection):\n    \"\"\"\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b (\u200b\u7a7a\u200b\u5b9e\u73b0\u200b)\"\"\"\n    pass\n</code></pre>"},{"location":"api/dialect/#_16","title":"\u53cd\u5c04\u200b\u652f\u6301","text":""},{"location":"api/dialect/#_17","title":"\u8868\u200b\u53cd\u5c04","text":"<pre><code># \u200b\u67e5\u8be2\u200b\u8868\u200b\u7ed3\u6784\u200b\nfrom sqlalchemy import inspect\n\ninspector = inspect(engine)\ntables = inspector.get_table_names()\ncolumns = inspector.get_columns('users')\nindexes = inspector.get_indexes('users')\n</code></pre>"},{"location":"api/dialect/#_18","title":"\u53cd\u5c04\u200b\u7ed3\u679c\u200b\u793a\u4f8b","text":"<pre><code># \u200b\u8868\u540d\u200b\u5217\u8868\u200b\n['users', 'orders', 'products']\n\n# \u200b\u5217\u200b\u4fe1\u606f\u200b\n[\n    {'name': '_id', 'type': VARCHAR(), 'nullable': False},\n    {'name': '_rev', 'type': VARCHAR(), 'nullable': True},\n    {'name': 'name', 'type': VARCHAR(), 'nullable': True},\n    {'name': 'age', 'type': INTEGER(), 'nullable': True},\n    {'name': 'type', 'type': VARCHAR(), 'nullable': False},\n]\n\n# \u200b\u7d22\u5f15\u200b\u4fe1\u606f\u200b\n[\n    {\n        'name': 'age-index',\n        'column_names': ['age'],\n        'unique': False\n    }\n]\n</code></pre>"},{"location":"api/dialect/#_19","title":"\u8fde\u63a5\u6c60\u200b\u652f\u6301","text":""},{"location":"api/dialect/#_20","title":"\u8fde\u63a5\u6c60\u200b\u7c7b\u578b","text":"<pre><code># \u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b QueuePool\nengine = create_engine(\n    'couchdb://localhost:5984/mydb',\n    poolclass=QueuePool,\n    pool_size=10,\n    max_overflow=20,\n    pool_recycle=3600,\n)\n</code></pre>"},{"location":"api/dialect/#_21","title":"\u8fde\u63a5\u200b\u9884\u200b\u68c0\u67e5","text":"<pre><code># \u200b\u542f\u7528\u200b\u9884\u200b\u68c0\u67e5\u200b\nengine = create_engine(\n    'couchdb://localhost:5984/mydb',\n    pool_pre_ping=True,  # \u200b\u4ece\u6c60\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u524d\u200b\u6d4b\u8bd5\u200b\n)\n</code></pre>"},{"location":"api/dialect/#_22","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"api/dialect/#_23","title":"\u9519\u8bef\u200b\u8f6c\u6362","text":"<pre><code>def _handle_exception(self, e):\n    \"\"\"\u200b\u5c06\u200b CouchDB HTTP \u200b\u9519\u8bef\u200b\u8f6c\u6362\u200b\u4e3a\u200b DB-API \u200b\u5f02\u5e38\u200b\"\"\"\n    if e.status_code == 404:\n        raise NoSuchTableError(e)\n    elif e.status_code == 409:\n        raise DocumentConflictError(e)\n    elif e.status_code == 500:\n        raise CouchDBError(e)\n    else:\n        raise DatabaseError(e)\n</code></pre>"},{"location":"api/dialect/#_24","title":"\u5f02\u5e38\u200b\u6620\u5c04","text":"HTTP \u200b\u72b6\u6001\u200b\u7801\u200b SQLAlchemy \u200b\u5f02\u5e38\u200b 404 <code>NoSuchTableError</code> 409 <code>DocumentConflictError</code> 500 <code>DatabaseError</code> \u200b\u5176\u4ed6\u200b <code>DatabaseError</code>"},{"location":"api/dialect/#_25","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"api/dialect/#1","title":"1. \u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e","text":"<pre><code>engine = create_engine(\n    'couchdb://localhost:5984/mydb',\n    pool_size=10,\n    max_overflow=20,\n    pool_recycle=3600,\n    pool_pre_ping=True,\n)\n</code></pre>"},{"location":"api/dialect/#2","title":"2. \u200b\u7981\u7528\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u53cd\u5c04","text":"<pre><code># \u200b\u624b\u52a8\u200b\u6307\u5b9a\u200b\u8868\u200b\u7ed3\u6784\u200b\nusers = Table('users', metadata,\n    Column('_id', String, primary_key=True),\n    Column('name', String),\n    Column('type', String),\n    schema=None  # \u200b\u4e0d\u200b\u4f7f\u7528\u200b schema\n)\n\n# \u200b\u6216\u200b\u7981\u7528\u200b\u81ea\u52a8\u200b\u53cd\u5c04\u200b\nmetadata = MetaData()\nmetadata.reflect(bind=engine, views=True)  # \u200b\u4ec5\u200b\u5728\u200b\u9700\u8981\u200b\u65f6\u200b\u53cd\u5c04\u200b\n</code></pre>"},{"location":"api/dialect/#_26","title":"\u6269\u5c55\u200b\u6307\u5357","text":""},{"location":"api/dialect/#_27","title":"\u6dfb\u52a0\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b","text":"<pre><code>from sqlalchemy_couchdb.dialect import CouchDBDialect\n\nclass CustomCouchDBDialect(CouchDBDialect):\n    \"\"\"\u200b\u652f\u6301\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b\"\"\"\n\n    @property\n    def colspecs(self):\n        \"\"\"\u200b\u8fd4\u56de\u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b\"\"\"\n        base = super().colspecs or {}\n        base.update({\n            MyCustomType: MyCustomCouchDBType\n        })\n        return base\n</code></pre>"},{"location":"api/dialect/#_28","title":"\u81ea\u5b9a\u4e49\u200b\u7f16\u8bd1\u5668","text":"<pre><code>from sqlalchemy_couchdb.dialect import CouchDBDialect\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\nclass CustomCouchDBDialect(CouchDBDialect):\n    \"\"\"\u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7f16\u8bd1\u5668\u200b\"\"\"\n\n    def create_compiler(self, compiler, **kwargs):\n        \"\"\"\u200b\u521b\u5efa\u200b\u7f16\u8bd1\u5668\u200b\u5b9e\u4f8b\u200b\"\"\"\n        return CustomCompiler(compiler.dialect, compiler.statement, **kwargs)\n</code></pre>"},{"location":"api/dialect/#_29","title":"\u76f8\u5173\u200b\u8d44\u6e90","text":"<ul> <li>SQLAlchemy \u200b\u65b9\u8a00\u200b\u5f00\u53d1\u200b\u6307\u5357\u200b</li> <li>Compiler API</li> <li>Client API</li> <li>\u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b</li> </ul>"},{"location":"api/exceptions/","title":"\u5f02\u5e38\u200b\u5904\u7406\u200b API","text":""},{"location":"api/exceptions/#_1","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u63d0\u4f9b\u200b\u5b8c\u6574\u200b\u7684\u200b DB-API 2.0 \u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u7cfb\u7edf\u200b\u3002</p>"},{"location":"api/exceptions/#_2","title":"\u5f02\u5e38\u200b\u5c42\u6b21\u7ed3\u6784","text":"<pre><code>StandardError (Python)\n\u251c\u2500\u2500 DatabaseError\n\u2502   \u251c\u2500\u2500 CouchDBError (\u200b\u57fa\u7840\u200b\u5f02\u5e38\u200b)\n\u2502   \u251c\u2500\u2500 NotFoundError (404)\n\u2502   \u251c\u2500\u2500 DocumentConflictError (409)\n\u2502   \u2514\u2500\u2500 InvalidRequestError (400)\n\u251c\u2500\u2500 OperationalError\n\u2502   \u251c\u2500\u2500 ConnectionError\n\u2502   \u2514\u2500\u2500 TimeoutError\n\u251c\u2500\u2500 IntegrityError\n\u2502   \u2514\u2500\u2500 UniqueConstraintError\n\u2514\u2500\u2500 InternalError\n</code></pre>"},{"location":"api/exceptions/#_3","title":"\u57fa\u7c7b\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#couchdberror","title":"CouchDBError","text":"<p>\u200b\u6240\u6709\u200b CouchDB \u200b\u76f8\u5173\u200b\u9519\u8bef\u200b\u7684\u200b\u57fa\u7c7b\u200b\u3002</p> <pre><code>class CouchDBError(DatabaseError):\n    \"\"\"CouchDB \u200b\u57fa\u7840\u200b\u5f02\u5e38\u200b\"\"\"\n\n    def __init__(self, message: str, error_code: Optional[str] = None, details: Optional[dict] = None):\n        self.error_code = error_code\n        self.details = details or {}\n        super().__init__(message)\n</code></pre> <p>\u200b\u5c5e\u6027\u200b: - <code>error_code</code>: \u200b\u9519\u8bef\u4ee3\u7801\u200b - <code>details</code>: \u200b\u8be6\u7ec6\u4fe1\u606f\u200b\u5b57\u5178\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy_couchdb.exceptions import CouchDBError\n\ntry:\n    # \u200b\u64cd\u4f5c\u200b\n    pass\nexcept CouchDBError as e:\n    print(f\"\u200b\u9519\u8bef\u200b: {e}\")\n    print(f\"\u200b\u4ee3\u7801\u200b: {e.error_code}\")\n    print(f\"\u200b\u8be6\u60c5\u200b: {e.details}\")\n</code></pre></p>"},{"location":"api/exceptions/#_4","title":"\u8fde\u63a5\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#connectionerror","title":"ConnectionError","text":"<p>\u200b\u8fde\u63a5\u200b\u76f8\u5173\u200b\u9519\u8bef\u200b\u3002</p> <pre><code>class ConnectionError(OperationalError):\n    \"\"\"\u200b\u65e0\u6cd5\u200b\u8fde\u63a5\u200b\u5230\u200b CouchDB\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u5e38\u89c1\u200b\u573a\u666f\u200b: - CouchDB \u200b\u670d\u52a1\u200b\u672a\u200b\u542f\u52a8\u200b - \u200b\u4e3b\u673a\u200b\u4e0d\u53ef\u200b\u8fbe\u200b - \u200b\u7aef\u53e3\u200b\u88ab\u200b\u62d2\u7edd\u200b - SSL \u200b\u9519\u8bef\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy_couchdb.exceptions import ConnectionError\n\ntry:\n    engine = create_engine('couchdb://localhost:5984/nonexistent')\n    with engine.connect() as conn:\n        conn.execute(text(\"SELECT 1\"))\nexcept ConnectionError as e:\n    print(f\"\u200b\u8fde\u63a5\u200b\u5931\u8d25\u200b: {e}\")\n</code></pre></p>"},{"location":"api/exceptions/#timeouterror","title":"TimeoutError","text":"<p>\u200b\u8d85\u65f6\u200b\u9519\u8bef\u200b\u3002</p> <pre><code>class TimeoutError(OperationalError):\n    \"\"\"\u200b\u8bf7\u6c42\u200b\u8d85\u65f6\u200b\"\"\"\n\n    pass\n</code></pre>"},{"location":"api/exceptions/#_5","title":"\u6587\u6863\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#notfounderror","title":"NotFoundError","text":"<p>\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\u3002</p> <pre><code>class NotFoundError(CouchDBError):\n    \"\"\"\u200b\u6587\u6863\u200b\u672a\u627e\u5230\u200b (404)\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy_couchdb.exceptions import NotFoundError\n\ntry:\n    doc = client.get(\"nonexistent:doc\")\nexcept NotFoundError:\n    print(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n</code></pre></p>"},{"location":"api/exceptions/#documentconflicterror","title":"DocumentConflictError","text":"<p>\u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b\uff08\u200b\u4e50\u89c2\u200b\u9501\u200b\uff09\u3002</p> <pre><code>class DocumentConflictError(CouchDBError):\n    \"\"\"\u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b (409)\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy_couchdb.exceptions import DocumentConflictError\n\ntry:\n    # \u200b\u5c1d\u8bd5\u200b\u66f4\u65b0\u200b\u8fc7\u671f\u200b\u6587\u6863\u200b\n    conn.execute(text(\"\"\"\n        UPDATE users\n        SET age = 31\n        WHERE _id = 'user:123'\n    \"\"\"))\nexcept DocumentConflictError:\n    print(\"\u200b\u6587\u6863\u200b\u5df2\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u8bf7\u200b\u91cd\u8bd5\u200b\")\n</code></pre></p> <p>\u200b\u89e3\u51b3\u200b\u65b9\u5f0f\u200b: <pre><code>def update_with_retry(conn, doc_id, new_data, max_retries=3):\n    \"\"\"\u200b\u5e26\u200b\u91cd\u8bd5\u200b\u7684\u200b\u66f4\u65b0\u200b\"\"\"\n    for attempt in range(max_retries):\n        try:\n            result = conn.execute(text(\"UPDATE ...\"), new_data)\n            conn.commit()\n            return result\n        except DocumentConflictError:\n            if attempt == max_retries - 1:\n                raise\n            # \u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u6587\u6863\u200b\n            time.sleep(0.1)\n</code></pre></p>"},{"location":"api/exceptions/#_6","title":"\u8bf7\u6c42\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#invalidrequesterror","title":"InvalidRequestError","text":"<p>\u200b\u65e0\u6548\u200b\u8bf7\u6c42\u200b\u3002</p> <pre><code>class InvalidRequestError(CouchDBError):\n    \"\"\"\u200b\u65e0\u6548\u200b\u8bf7\u6c42\u200b (400)\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u5e38\u89c1\u200b\u539f\u56e0\u200b: - SQL \u200b\u8bed\u6cd5\u9519\u8bef\u200b - \u200b\u7f3a\u5c11\u200b\u5fc5\u9700\u200b\u5b57\u200b\u6bb5\u200b - \u200b\u65e0\u6548\u200b\u7684\u200b JSON - \u200b\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b\u67e5\u8be2\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy_couchdb.exceptions import InvalidRequestError\n\ntry:\n    conn.execute(text(\"INVALID SQL\"))\nexcept InvalidRequestError as e:\n    print(f\"\u200b\u65e0\u6548\u200b\u8bf7\u6c42\u200b: {e}\")\n</code></pre></p>"},{"location":"api/exceptions/#queryerror","title":"QueryError","text":"<p>\u200b\u67e5\u8be2\u200b\u9519\u8bef\u200b\u3002</p> <pre><code>class QueryError(InvalidRequestError):\n    \"\"\"\u200b\u67e5\u8be2\u200b\u9519\u8bef\u200b\"\"\"\n\n    pass\n</code></pre>"},{"location":"api/exceptions/#_7","title":"\u8d44\u6e90\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#databasenotfounderror","title":"DatabaseNotFoundError","text":"<p>\u200b\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728\u200b\u3002</p> <pre><code>class DatabaseNotFoundError(CouchDBError):\n    \"\"\"\u200b\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728\u200b\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u793a\u4f8b\u200b: <pre><code>try:\n    engine = create_engine('couchdb://localhost:5984/nonexistent_db')\nexcept DatabaseNotFoundError:\n    print(\"\u200b\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n</code></pre></p>"},{"location":"api/exceptions/#designdocumentnotfounderror","title":"DesignDocumentNotFoundError","text":"<p>\u200b\u8bbe\u8ba1\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\u3002</p> <pre><code>class DesignDocumentNotFoundError(CouchDBError):\n    \"\"\"\u200b\u8bbe\u8ba1\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\"\"\"\n\n    pass\n</code></pre>"},{"location":"api/exceptions/#_8","title":"\u5b8c\u6574\u6027\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#uniqueconstrainterror","title":"UniqueConstraintError","text":"<p>\u200b\u552f\u4e00\u200b\u7ea6\u675f\u200b\u51b2\u7a81\u200b\u3002</p> <pre><code>class UniqueConstraintError(IntegrityError):\n    \"\"\"\u200b\u552f\u4e00\u200b\u7ea6\u675f\u200b\u51b2\u7a81\u200b\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u573a\u666f\u200b: - \u200b\u63d2\u5165\u200b\u91cd\u590d\u200b\u7684\u200b <code>_id</code> - \u200b\u8fdd\u53cd\u200b\u552f\u4e00\u200b\u7d22\u5f15\u200b</p> <p>\u200b\u793a\u4f8b\u200b: <pre><code>from sqlalchemy_couchdb.exceptions import UniqueConstraintError\n\ntry:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, type)\n        VALUES ('user:123', 'Alice', 'user')\n    \"\"\"))\n    conn.commit()\n\n    # \u200b\u518d\u6b21\u200b\u63d2\u5165\u200b\u76f8\u540c\u200b ID\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, type)\n        VALUES ('user:123', 'Bob', 'user')\n    \"\"\"))\n    conn.commit()\nexcept UniqueConstraintError:\n    print(\"\u200b\u7528\u6237\u200b ID \u200b\u5df2\u200b\u5b58\u5728\u200b\")\n</code></pre></p>"},{"location":"api/exceptions/#_9","title":"\u5185\u90e8\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#internalerror","title":"InternalError","text":"<p>\u200b\u5185\u90e8\u200b\u9519\u8bef\u200b\u3002</p> <pre><code>class InternalError(CouchDBError):\n    \"\"\"\u200b\u5185\u90e8\u200b\u9519\u8bef\u200b (500)\"\"\"\n\n    pass\n</code></pre> <p>\u200b\u5e38\u89c1\u200b\u539f\u56e0\u200b: - CouchDB \u200b\u5185\u90e8\u200b\u9519\u8bef\u200b - \u200b\u5185\u5b58\u4e0d\u8db3\u200b - \u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u4e0d\u8db3\u200b - \u200b\u89c6\u56fe\u200b\u6784\u5efa\u200b\u5931\u8d25\u200b</p>"},{"location":"api/exceptions/#_10","title":"\u5f02\u5e38\u200b\u8f6c\u6362","text":""},{"location":"api/exceptions/#http","title":"HTTP \u200b\u9519\u8bef\u200b\u6620\u5c04","text":"<pre><code>from httpx import Response\n\ndef convert_http_error(response: Response) -&gt; CouchDBError:\n    \"\"\"\u200b\u5c06\u200b HTTP \u200b\u54cd\u5e94\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5f02\u5e38\u200b\"\"\"\n    status_code = response.status_code\n\n    if status_code == 400:\n        return InvalidRequestError(response.text)\n    elif status_code == 404:\n        if 'database' in response.text.lower():\n            return DatabaseNotFoundError(response.text)\n        else:\n            return NotFoundError(response.text)\n    elif status_code == 409:\n        return DocumentConflictError(response.text)\n    elif status_code == 500:\n        return InternalError(response.text)\n    else:\n        return CouchDBError(response.text)\n</code></pre>"},{"location":"api/exceptions/#_11","title":"\u9519\u8bef\u5904\u7406\u200b\u6700\u4f73\u200b\u5b9e\u8df5","text":""},{"location":"api/exceptions/#1","title":"1. \u200b\u6355\u83b7\u200b\u7279\u5b9a\u200b\u5f02\u5e38","text":"<pre><code>from sqlalchemy_couchdb.exceptions import (\n    NotFoundError,\n    DocumentConflictError,\n    UniqueConstraintError\n)\n\ntry:\n    conn.execute(text(\"UPDATE users SET age=31 WHERE _id='user:123'\"))\n    conn.commit()\nexcept NotFoundError:\n    # \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\n    print(\"\u200b\u7528\u6237\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\nexcept DocumentConflictError:\n    # \u200b\u7248\u672c\u200b\u51b2\u7a81\u200b\n    print(\"\u200b\u7528\u6237\u200b\u4fe1\u606f\u200b\u5df2\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8bf7\u200b\u5237\u65b0\u200b\u540e\u200b\u91cd\u8bd5\u200b\")\nexcept UniqueConstraintError:\n    # \u200b\u7ea6\u675f\u200b\u51b2\u7a81\u200b\n    print(\"\u200b\u7528\u6237\u200b ID \u200b\u5df2\u200b\u5b58\u5728\u200b\")\nexcept CouchDBError as e:\n    # \u200b\u5176\u4ed6\u200b CouchDB \u200b\u9519\u8bef\u200b\n    print(f\"CouchDB \u200b\u9519\u8bef\u200b: {e}\")\nexcept Exception as e:\n    # \u200b\u901a\u7528\u200b\u9519\u8bef\u200b\n    print(f\"\u200b\u672a\u77e5\u200b\u9519\u8bef\u200b: {e}\")\n</code></pre>"},{"location":"api/exceptions/#2","title":"2. \u200b\u91cd\u8bd5\u200b\u673a\u5236","text":"<pre><code>from functools import wraps\nimport time\nfrom sqlalchemy_couchdb.exceptions import DocumentConflictError\n\ndef retry_on_conflict(max_attempts=3, delay=0.1):\n    \"\"\"\u200b\u6587\u6863\u200b\u51b2\u7a81\u200b\u91cd\u8bd5\u200b\u88c5\u9970\u200b\u5668\u200b\"\"\"\n    def decorator(func):\n        @wraps(func)\n        def wrapper(*args, **kwargs):\n            for attempt in range(max_attempts):\n                try:\n                    return func(*args, **kwargs)\n                except DocumentConflictError:\n                    if attempt == max_attempts - 1:\n                        raise\n                    time.sleep(delay)\n            return None\n        return wrapper\n    return decorator\n\n@retry_on_conflict(max_attempts=3)\ndef update_user(conn, user_id, data):\n    \"\"\"\u200b\u66f4\u65b0\u200b\u7528\u6237\u200b\u4fe1\u606f\u200b\"\"\"\n    result = conn.execute(text(\"\"\"\n        UPDATE users\n        SET name = :name, age = :age\n        WHERE _id = :id AND type = 'user'\n    \"\"\"), data)\n    conn.commit()\n    return result\n</code></pre>"},{"location":"api/exceptions/#3","title":"3. \u200b\u9519\u8bef\u200b\u4e0a\u4e0b\u6587","text":"<pre><code>from contextlib import contextmanager\n\n@contextmanager\ndef error_handler(operation):\n    \"\"\"\u200b\u9519\u8bef\u5904\u7406\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668\u200b\"\"\"\n    try:\n        yield\n    except NotFoundError:\n        print(f\"{operation}: \u200b\u8d44\u6e90\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n    except DocumentConflictError:\n        print(f\"{operation}: \u200b\u8d44\u6e90\u200b\u5df2\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8bf7\u200b\u91cd\u8bd5\u200b\")\n    except ConnectionError:\n        print(f\"{operation}: \u200b\u8fde\u63a5\u200b\u9519\u8bef\u200b\uff0c\u200b\u8bf7\u200b\u68c0\u67e5\u200b\u7f51\u7edc\u200b\")\n    except CouchDBError as e:\n        print(f\"{operation}: CouchDB \u200b\u9519\u8bef\u200b - {e}\")\n    except Exception as e:\n        print(f\"{operation}: \u200b\u672a\u77e5\u200b\u9519\u8bef\u200b - {e}\")\n\n# \u200b\u4f7f\u7528\u200b\nwith error_handler(\"\u200b\u66f4\u65b0\u200b\u7528\u6237\u200b\"):\n    conn.execute(text(\"UPDATE ...\"))\n    conn.commit()\n</code></pre>"},{"location":"api/exceptions/#4","title":"4. \u200b\u8bb0\u5f55\u200b\u9519\u8bef","text":"<pre><code>import logging\n\nlogger = logging.getLogger(__name__)\n\ntry:\n    conn.execute(text(\"...\"))\n    conn.commit()\nexcept CouchDBError as e:\n    logger.error(f\"CouchDB \u200b\u9519\u8bef\u200b: {e}\", extra={\n        'error_code': e.error_code,\n        'details': e.details\n    })\n    raise\n</code></pre>"},{"location":"api/exceptions/#_12","title":"\u8c03\u8bd5\u200b\u6280\u5de7","text":""},{"location":"api/exceptions/#1_1","title":"1. \u200b\u542f\u7528\u200b\u8be6\u7ec6\u200b\u65e5\u5fd7","text":"<pre><code>import logging\n\nlogging.basicConfig(level=logging.DEBUG)\nlogging.getLogger('sqlalchemy_couchdb').setLevel(logging.DEBUG)\n</code></pre>"},{"location":"api/exceptions/#2_1","title":"2. \u200b\u6253\u5370\u200b\u5b8c\u6574\u200b\u9519\u8bef\u4fe1\u606f","text":"<pre><code>import traceback\n\ntry:\n    conn.execute(text(\"...\"))\nexcept Exception as e:\n    print(f\"\u200b\u9519\u8bef\u200b\u7c7b\u578b\u200b: {type(e).__name__}\")\n    print(f\"\u200b\u9519\u8bef\u4fe1\u606f\u200b: {e}\")\n    print(f\"\u200b\u5806\u6808\u200b\u8ddf\u8e2a\u200b:\\n{traceback.format_exc()}\")\n</code></pre>"},{"location":"api/exceptions/#3_1","title":"3. \u200b\u68c0\u67e5\u200b\u5f02\u5e38\u200b\u5c5e\u6027","text":"<pre><code>except CouchDBError as e:\n    print(f\"\u200b\u9519\u8bef\u4ee3\u7801\u200b: {e.error_code}\")\n    print(f\"\u200b\u8be6\u7ec6\u4fe1\u606f\u200b: {e.details}\")\n    print(f\"\u200b\u539f\u59cb\u200b\u6d88\u606f\u200b: {str(e)}\")\n</code></pre>"},{"location":"api/exceptions/#_13","title":"\u6d4b\u8bd5\u200b\u5f02\u5e38","text":""},{"location":"api/exceptions/#_14","title":"\u6d4b\u8bd5\u200b\u5f02\u5e38\u200b\u629b\u51fa","text":"<pre><code>import pytest\nfrom sqlalchemy_couchdb.exceptions import NotFoundError\n\ndef test_not_found():\n    with pytest.raises(NotFoundError):\n        client.get(\"nonexistent\")\n\ndef test_document_conflict():\n    with pytest.raises(DocumentConflictError):\n        # \u200b\u89e6\u53d1\u200b\u51b2\u7a81\u200b\n        conn.execute(text(\"UPDATE ...\"))\n</code></pre>"},{"location":"api/exceptions/#_15","title":"\u6d4b\u8bd5\u200b\u5f02\u5e38\u200b\u5c5e\u6027","text":"<pre><code>def test_error_attributes():\n    try:\n        client.get(\"nonexistent\")\n    except NotFoundError as e:\n        assert e.error_code is not None\n        assert isinstance(e.details, dict)\n</code></pre>"},{"location":"api/exceptions/#_16","title":"\u76f8\u5173\u200b\u8d44\u6e90","text":"<ul> <li>DB-API 2.0 \u200b\u89c4\u8303\u200b</li> <li>SQLAlchemy \u200b\u5f02\u5e38\u200b</li> <li>CouchDB \u200b\u9519\u8bef\u200b\u6587\u6863\u200b</li> </ul>"},{"location":"api/types/","title":"\u7c7b\u578b\u200b\u7cfb\u7edf\u200b API","text":""},{"location":"api/types/#_1","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b Python \u2194 JSON \u200b\u7684\u200b\u53cc\u5411\u200b\u8f6c\u6362\u200b\u3002</p>"},{"location":"api/types/#_2","title":"\u7c7b\u578b\u200b\u5c42\u6b21","text":"<pre><code>BaseType (SQLAlchemy)\n\u251c\u2500\u2500 CouchDBString\n\u251c\u2500\u2500 CouchDBText\n\u251c\u2500\u2500 CouchDBInteger\n\u251c\u2500\u2500 CouchDBFloat\n\u251c\u2500\u2500 CouchDBBoolean\n\u251c\u2500\u2500 CouchDBDateTime\n\u251c\u2500\u2500 CouchDBDate\n\u251c\u2500\u2500 CouchDBJSON\n\u2514\u2500\u2500 CouchDBNumeric\n</code></pre>"},{"location":"api/types/#_3","title":"\u7c7b\u578b\u200b\u8be6\u60c5","text":""},{"location":"api/types/#couchdbstring","title":"CouchDBString","text":"<p>\u200b\u5b57\u7b26\u4e32\u200b\u7c7b\u578b\u200b\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBString\n\nColumn('name', CouchDBString(255))\n\n# \u200b\u7ed1\u5b9a\u200b\u5904\u7406\u5668\u200b\nprocessor = column_type.bind_processor(dialect)\nresult = processor(\"Alice\")  # \"Alice\"\n\n# \u200b\u7ed3\u679c\u200b\u5904\u7406\u5668\u200b\nprocessor = column_type.result_processor(dialect, coltype)\nresult = processor(\"Alice\")  # \"Alice\"\n</code></pre>"},{"location":"api/types/#couchdbtext","title":"CouchDBText","text":"<p>\u200b\u6587\u672c\u200b\u7c7b\u578b\u200b\uff08\u200b\u957f\u200b\u5b57\u7b26\u4e32\u200b\uff09\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBText\n\nColumn('description', CouchDBText())\n\n# \u200b\u4e0e\u200b CouchDBString \u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u200b\u8bed\u4e49\u4e0a\u200b\u8868\u793a\u200b\u957f\u200b\u6587\u672c\u200b\n</code></pre>"},{"location":"api/types/#couchdbinteger","title":"CouchDBInteger","text":"<p>\u200b\u6574\u6570\u200b\u7c7b\u578b\u200b\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBInteger\n\nColumn('age', CouchDBInteger())\n\n# Python \u2192 JSON\nprocessor = CouchDBInteger().bind_processor(dialect)\nresult = processor(30)  # 30\n\n# JSON \u2192 Python\nprocessor = CouchDBInteger().result_processor(dialect, 'integer')\nresult = processor(30)  # 30\n</code></pre>"},{"location":"api/types/#couchdbfloat","title":"CouchDBFloat","text":"<p>\u200b\u6d6e\u70b9\u6570\u200b\u7c7b\u578b\u200b\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBFloat\n\nColumn('price', CouchDBFloat())\n\n# Python \u2192 JSON\nprocessor = CouchDBFloat().bind_processor(dialect)\nresult = processor(99.99)  # 99.99\n\n# JSON \u2192 Python\nprocessor = CouchDBFloat().result_processor(dialect, 'float')\nresult = processor(99.99)  # 99.99\n</code></pre>"},{"location":"api/types/#couchdbboolean","title":"CouchDBBoolean","text":"<p>\u200b\u5e03\u5c14\u200b\u7c7b\u578b\u200b\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBBoolean\n\nColumn('is_active', CouchDBBoolean())\n\n# Python \u2192 JSON\nprocessor = CouchDBBoolean().bind_processor(dialect)\nresult = processor(True)  # True\nresult = processor(False)  # False\nresult = processor(None)  # None\n\n# JSON \u2192 Python\nprocessor = CouchDBBoolean().result_processor(dialect, 'boolean')\nresult = processor(True)  # True\nresult = processor(False)  # False\nresult = processor(None)  # None\n</code></pre>"},{"location":"api/types/#couchdbdatetime","title":"CouchDBDateTime","text":"<p>\u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\u7c7b\u578b\u200b\uff08ISO 8601 \u200b\u683c\u5f0f\u200b\uff09\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBDateTime\nfrom datetime import datetime\n\nColumn('created_at', CouchDBDateTime())\n\n# Python \u2192 JSON\nprocessor = CouchDBDateTime().bind_processor(dialect)\ndt = datetime(2025, 1, 2, 15, 30, 0)\nresult = processor(dt)  # \"2025-01-02T15:30:00\"\n\n# JSON \u2192 Python\nprocessor = CouchDBDateTime().result_processor(dialect, 'datetime')\nresult = processor(\"2025-01-02T15:30:00\")  # datetime(2025, 1, 2, 15, 30, 0)\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u4f7f\u7528\u200b ISO 8601 \u200b\u683c\u5f0f\u200b - \u200b\u652f\u6301\u200b\u65f6\u200b\u533a\u200b - \u200b\u81ea\u52a8\u200b\u5904\u7406\u200b None \u200b\u503c\u200b</p>"},{"location":"api/types/#couchdbdate","title":"CouchDBDate","text":"<p>\u200b\u65e5\u671f\u200b\u7c7b\u578b\u200b\uff08ISO 8601 \u200b\u683c\u5f0f\u200b\uff09\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBDate\nfrom datetime import date\n\nColumn('birth_date', CouchDBDate())\n\n# Python \u2192 JSON\nprocessor = CouchDBDate().bind_processor(dialect)\nd = date(2025, 1, 2)\nresult = processor(d)  # \"2025-01-02\"\n\n# JSON \u2192 Python\nprocessor = CouchDBDate().result_processor(dialect, 'date')\nresult = processor(\"2025-01-02\")  # date(2025, 1, 2)\n</code></pre>"},{"location":"api/types/#couchdbjson","title":"CouchDBJSON","text":"<p>JSON \u200b\u7c7b\u578b\u200b\uff08\u200b\u5bf9\u8c61\u200b\u6216\u200b\u6570\u7ec4\u200b\uff09\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBJSON\n\nColumn('metadata', CouchDBJSON())\n\n# Python \u2192 JSON (\u200b\u65e0\u200b\u8f6c\u6362\u200b)\nprocessor = CouchDBJSON().bind_processor(dialect)\ndata = {\"key\": \"value\", \"list\": [1, 2, 3]}\nresult = processor(data)  # {\"key\": \"value\", \"list\": [1, 2, 3]}\n\n# JSON \u2192 Python (\u200b\u65e0\u200b\u8f6c\u6362\u200b)\nprocessor = CouchDBJSON().result_processor(dialect, 'json')\nresult = processor({\"key\": \"value\"})  # {\"key\": \"value\"}\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - CouchDB \u200b\u539f\u751f\u200b\u652f\u6301\u200b JSON - \u200b\u65e0\u9700\u200b\u8f6c\u6362\u200b - \u200b\u652f\u6301\u200b\u5d4c\u5957\u200b\u5bf9\u8c61\u200b\u548c\u200b\u6570\u7ec4\u200b</p>"},{"location":"api/types/#couchdbnumeric","title":"CouchDBNumeric","text":"<p>\u200b\u9ad8\u7cbe\u5ea6\u200b\u6570\u503c\u200b\u7c7b\u578b\u200b\u3002</p> <pre><code>from sqlalchemy_couchdb.types import CouchDBNumeric\nfrom decimal import Decimal\n\nColumn('amount', CouchDBNumeric(precision=10, scale=2, as_string=True))\n\n# as_string=True (\u200b\u9ed8\u8ba4\u200b\uff0c\u200b\u4fdd\u6301\u200b\u7cbe\u5ea6\u200b)\nprocessor = CouchDBNumeric(as_string=True).bind_processor(dialect)\nresult = processor(Decimal(\"123.456789\"))  # \"123.456789\"\n\nprocessor = CouchDBNumeric(as_string=True).result_processor(dialect, 'numeric')\nresult = processor(\"123.456789\")  # Decimal(\"123.456789\")\n\n# as_string=False (\u200b\u53ef\u80fd\u200b\u635f\u5931\u200b\u7cbe\u5ea6\u200b)\nprocessor = CouchDBNumeric(as_string=False).bind_processor(dialect)\nresult = processor(Decimal(\"123.456789\"))  # 123.456789\n\nprocessor = CouchDBNumeric(as_string=False).result_processor(dialect, 'numeric')\nresult = processor(123.456789)  # 123.456789 (float)\n</code></pre> <p>\u200b\u53c2\u6570\u200b: - <code>precision</code>: \u200b\u603b\u200b\u4f4d\u6570\u200b - <code>scale</code>: \u200b\u5c0f\u6570\u4f4d\u200b\u6570\u200b - <code>as_string</code>: \u200b\u662f\u5426\u200b\u5b58\u50a8\u200b\u4e3a\u200b\u5b57\u7b26\u4e32\u200b\uff08\u200b\u9ed8\u8ba4\u200b True\uff09</p>"},{"location":"api/types/#_4","title":"\u7c7b\u578b\u200b\u6620\u5c04\u200b\u914d\u7f6e","text":""},{"location":"api/types/#colspecs","title":"colspecs \u200b\u6620\u5c04","text":"<pre><code>from sqlalchemy import types as sa_types\nfrom sqlalchemy_couchdb.types import *\n\ncolspecs = {\n    sa_types.String: CouchDBString,\n    sa_types.Text: CouchDBText,\n    sa_types.Integer: CouchDBInteger,\n    sa_types.SmallInteger: CouchDBInteger,\n    sa_types.BigInteger: CouchDBInteger,\n    sa_types.Float: CouchDBFloat,\n    sa_types.Numeric: CouchDBNumeric,\n    sa_types.Boolean: CouchDBBoolean,\n    sa_types.DateTime: CouchDBDateTime,\n    sa_types.Date: CouchDBDate,\n    sa_types.JSON: CouchDBJSON,\n}\n</code></pre>"},{"location":"api/types/#_5","title":"\u65b9\u8a00\u200b\u6ce8\u518c\u200b\u7c7b\u578b","text":"<pre><code># \u200b\u5728\u200b\u65b9\u8a00\u200b\u4e2d\u200b\u4f7f\u7528\u200b\nclass CouchDBDialect:\n    @property\n    def colspecs(self):\n        from sqlalchemy_couchdb.types import colspecs\n        return colspecs\n</code></pre>"},{"location":"api/types/#_6","title":"\u4f7f\u7528\u200b\u793a\u4f8b","text":""},{"location":"api/types/#_7","title":"\u5728\u200b\u8868\u200b\u5b9a\u4e49\u200b\u4e2d\u200b\u4f7f\u7528","text":"<pre><code>from sqlalchemy import Table, Column, MetaData, String, Integer, Float, Boolean, DateTime, Date, JSON\nfrom sqlalchemy_couchdb.types import *\n\nmetadata = MetaData()\n\nusers = Table('users', metadata,\n    Column('_id', String, primary_key=True),\n    Column('_rev', String),\n    Column('name', CouchDBString(255)),\n    Column('age', CouchDBInteger()),\n    Column('price', CouchDBFloat()),\n    Column('is_active', CouchDBBoolean()),\n    Column('created_at', CouchDBDateTime()),\n    Column('birth_date', CouchDBDate()),\n    Column('metadata', CouchDBJSON()),\n    Column('amount', CouchDBNumeric(precision=10, scale=2)),\n    Column('type', String)\n)\n</code></pre>"},{"location":"api/types/#_8","title":"\u6df7\u5408\u200b\u4f7f\u7528","text":"<pre><code>from sqlalchemy import String, Integer\nfrom sqlalchemy_couchdb.types import CouchDBString, CouchDBInteger\n\n# \u200b\u6807\u51c6\u200b\u7c7b\u578b\u200b\uff08\u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\uff09\nColumn('name', String)  # \u2192 CouchDBString\nColumn('age', Integer)  # \u2192 CouchDBInteger\n\n# \u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b\nColumn('name', CouchDBString(255))\nColumn('age', CouchDBInteger())\n</code></pre>"},{"location":"api/types/#_9","title":"\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b","text":"<pre><code>from sqlalchemy import types\nfrom sqlalchemy_couchdb.types import CouchDBString\n\nclass CouchDBEmail(CouchDBString):\n    \"\"\"\u200b\u90ae\u7bb1\u200b\u7c7b\u578b\u200b\"\"\"\n\n    def bind_processor(self, dialect):\n        def process(value):\n            if value is None:\n                return None\n            if '@' not in str(value):\n                raise ValueError(f\"\u200b\u65e0\u6548\u200b\u90ae\u7bb1\u200b: {value}\")\n            return str(value)\n        return process\n\n# \u200b\u4f7f\u7528\u200b\nColumn('email', CouchDBEmail())\n</code></pre>"},{"location":"api/types/#_10","title":"\u8f6c\u6362\u200b\u8fc7\u7a0b","text":""},{"location":"api/types/#python-couchdb","title":"Python \u2192 CouchDB (\u200b\u7ed1\u5b9a\u200b\u5904\u7406\u200b)","text":"<pre><code>def bind_processor(self, dialect: Dialect):\n    \"\"\"\u200b\u5c06\u200b Python \u200b\u503c\u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB JSON\"\"\"\n    def process(value):\n        if value is None:\n            return None\n        # \u200b\u7c7b\u578b\u200b\u7279\u5b9a\u200b\u8f6c\u6362\u200b\n        return self._convert_python_to_json(value)\n    return process\n</code></pre>"},{"location":"api/types/#couchdb-python","title":"CouchDB \u2192 Python (\u200b\u7ed3\u679c\u200b\u5904\u7406\u200b)","text":"<pre><code>def result_processor(self, dialect: Dialect, coltype):\n    \"\"\"\u200b\u5c06\u200b CouchDB JSON \u200b\u8f6c\u6362\u200b\u4e3a\u200b Python\"\"\"\n    def process(value):\n        if value is None:\n            return None\n        # \u200b\u7c7b\u578b\u200b\u7279\u5b9a\u200b\u8f6c\u6362\u200b\n        return self._convert_json_to_python(value)\n    return process\n</code></pre>"},{"location":"api/types/#_11","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"api/types/#1","title":"1. \u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7c7b\u578b","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u4f7f\u7528\u200b\u9002\u5f53\u200b\u7cbe\u5ea6\u200b\nColumn('amount', CouchDBNumeric(precision=10, scale=2))\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u4e0d\u5fc5\u8981\u200b\u9ad8\u7cbe\u5ea6\u200b\nColumn('amount', CouchDBNumeric(precision=38, scale=20))\n</code></pre>"},{"location":"api/types/#2","title":"2. \u200b\u907f\u514d\u200b\u4e0d\u5fc5\u8981\u200b\u8f6c\u6362","text":"<pre><code># CouchDBJSON \u200b\u65e0\u200b\u8f6c\u6362\u200b\uff0c\u200b\u6027\u80fd\u200b\u6700\u4f73\u200b\nColumn('data', CouchDBJSON())\n\n# \u200b\u5176\u4ed6\u200b\u7c7b\u578b\u200b\u90fd\u200b\u6709\u200b\u8f6c\u6362\u200b\u5f00\u9500\u200b\n</code></pre>"},{"location":"api/types/#3","title":"3. \u200b\u9884\u200b\u7f16\u8bd1\u200b\u5904\u7406\u5668","text":"<pre><code># \u200b\u9884\u200b\u83b7\u53d6\u200b\u5904\u7406\u5668\u200b\ndialect = engine.dialect\nprocessor = dialect.type_descriptor(CouchDBString()).bind_processor(dialect)\n\n# \u200b\u591a\u6b21\u200b\u4f7f\u7528\u200b\nfor value in values:\n    json_value = processor(value)\n</code></pre>"},{"location":"api/types/#_12","title":"\u6d4b\u8bd5\u200b\u7c7b\u578b","text":""},{"location":"api/types/#_13","title":"\u6d4b\u8bd5\u200b\u7ed1\u5b9a\u200b\u5904\u7406\u5668","text":"<pre><code>from sqlalchemy_couchdb.types import CouchDBString\nfrom sqlalchemy.engine.interfaces import Dialect\n\ndef test_bind_processor():\n    dialect = Mock(spec=Dialect)\n    processor = CouchDBString().bind_processor(dialect)\n\n    # \u200b\u6d4b\u8bd5\u200b\u503c\u200b\u8f6c\u6362\u200b\n    assert processor(\"Alice\") == \"Alice\"\n    assert processor(123) == \"123\"\n    assert processor(None) is None\n</code></pre>"},{"location":"api/types/#_14","title":"\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\u5904\u7406\u5668","text":"<pre><code>from sqlalchemy_couchdb.types import CouchDBInteger\n\ndef test_result_processor():\n    dialect = Mock(spec=Dialect)\n    processor = CouchDBInteger().result_processor(dialect, 'integer')\n\n    assert processor(123) == 123\n    assert processor(None) is None\n</code></pre>"},{"location":"api/types/#_15","title":"\u6d4b\u8bd5\u200b\u65e5\u671f\u200b\u65f6\u95f4","text":"<pre><code>from sqlalchemy_couchdb.types import CouchDBDateTime\nfrom datetime import datetime\n\ndef test_datetime_conversion():\n    dialect = Mock(spec=Dialect)\n    bind_processor = CouchDBDateTime().bind_processor(dialect)\n    result_processor = CouchDBDateTime().result_processor(dialect, 'datetime')\n\n    dt = datetime(2025, 1, 2, 15, 30, 0)\n    json_value = bind_processor(dt)\n    assert json_value == \"2025-01-02T15:30:00\"\n\n    restored = result_processor(json_value)\n    assert restored == dt\n</code></pre>"},{"location":"api/types/#_16","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ol> <li>\u200b\u59cb\u7ec8\u200b\u6d4b\u8bd5\u200b\u8f6c\u6362\u200b: \u200b\u9a8c\u8bc1\u200b bind_processor \u200b\u548c\u200b result_processor</li> <li>\u200b\u4f7f\u7528\u200b\u6807\u51c6\u200b\u7c7b\u578b\u200b: \u200b\u4f18\u5148\u200b\u4f7f\u7528\u200b\u6807\u51c6\u200b SQLAlchemy \u200b\u7c7b\u578b\u200b\uff08\u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\uff09</li> <li>\u200b\u5904\u7406\u200b None \u200b\u503c\u200b: \u200b\u6240\u6709\u200b\u7c7b\u578b\u200b\u90fd\u200b\u5e94\u200b\u6b63\u786e\u5904\u7406\u200b None</li> <li>\u200b\u9a8c\u8bc1\u200b\u6570\u636e\u200b: \u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b\u5e94\u200b\u9a8c\u8bc1\u200b\u8f93\u5165\u200b</li> <li>\u200b\u6587\u6863\u200b\u683c\u5f0f\u200b: \u200b\u660e\u786e\u200b\u8bf4\u660e\u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\u683c\u5f0f\u200b\uff08ISO 8601\uff09</li> </ol>"},{"location":"api/types/#_17","title":"\u76f8\u5173\u200b\u8d44\u6e90","text":"<ul> <li>Python JSON \u200b\u6570\u636e\u7c7b\u578b\u200b</li> <li>CouchDB \u200b\u6570\u636e\u7c7b\u578b\u200b</li> <li>ISO 8601 \u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\u683c\u5f0f\u200b</li> </ul>"},{"location":"dev/architecture/","title":"SQLAlchemy CouchDB \u200b\u9a71\u52a8\u200b - \u200b\u67b6\u6784\u8bbe\u8ba1\u200b\u6587\u6863","text":""},{"location":"dev/architecture/#1","title":"1. \u200b\u6982\u8ff0","text":""},{"location":"dev/architecture/#11","title":"1.1 \u200b\u9879\u76ee\u200b\u80cc\u666f","text":"<p>\u200b\u9879\u76ee\u540d\u79f0\u200b: sqlalchemy-couchdb</p> <p>\u200b\u6838\u5fc3\u200b\u76ee\u6807\u200b: - \u200b\u4e3a\u200b CouchDB \u200b\u63d0\u4f9b\u200b SQLAlchemy 2.0+ \u200b\u9a71\u52a8\u200b\u652f\u6301\u200b - \u200b\u652f\u6301\u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b - \u200b\u5b9e\u73b0\u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u67b6\u6784\u200b\uff08CouchDB + \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\uff09</p> <p>\u200b\u6280\u672f\u200b\u6808\u200b: - Python 3.11+ - SQLAlchemy 2.0+ - httpx (HTTP \u200b\u5ba2\u6237\u7aef\u200b) - CouchDB 3.x</p>"},{"location":"dev/architecture/#12","title":"1.2 \u200b\u6838\u5fc3\u200b\u7279\u6027","text":""},{"location":"dev/architecture/#phase-1-couchdb","title":"Phase 1: \u200b\u7eaf\u200b CouchDB \u200b\u9a71\u52a8","text":"<ul> <li>\u2705 \u200b\u5b8c\u6574\u200b\u7684\u200b SQLAlchemy Dialect \u200b\u5b9e\u73b0\u200b</li> <li>\u2705 SQL \u2192 Mango Query \u200b\u7f16\u8bd1\u5668\u200b</li> <li>\u2705 \u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b DBAPI</li> <li>\u2705 \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\uff08SQL \u2194 JSON\uff09</li> <li>\u2705 \u200b\u57fa\u4e8e\u200b httpx \u200b\u7684\u200b HTTP \u200b\u5ba2\u6237\u7aef\u200b</li> </ul>"},{"location":"dev/architecture/#phase-2","title":"Phase 2: \u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u67b6\u6784","text":"<ul> <li>\u2705 \u200b\u81ea\u52a8\u200b\u67e5\u8be2\u200b\u8def\u7531\u200b\uff08\u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\uff0c\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\uff09</li> <li>\u2705 \u200b\u53cc\u5199\u200b\u540c\u6b65\u200b\u673a\u5236\u200b\uff08\u200b\u5b9e\u65f6\u200b\u53cc\u5199\u200b + \u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b\uff09</li> <li>\u2705 \u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b\u7cfb\u7edf\u200b\uff08CouchDB \u2194 RDBMS\uff09</li> <li>\u2705 \u200b\u540e\u53f0\u200b\u4e00\u81f4\u6027\u200b\u76d1\u63a7\u200b</li> <li>\u2705 \u200b\u652f\u6301\u200b\u4efb\u610f\u200b SQLAlchemy \u200b\u517c\u5bb9\u200b\u7684\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b</li> </ul>"},{"location":"dev/architecture/#2","title":"2. \u200b\u7cfb\u7edf\u200b\u67b6\u6784","text":""},{"location":"dev/architecture/#21-phase-1-couchdb","title":"2.1 Phase 1 \u200b\u67b6\u6784\u200b\uff08\u200b\u7eaf\u200b CouchDB \u200b\u6a21\u5f0f\u200b\uff09","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Application Layer                            \u2502\n\u2502              (User's SQLAlchemy Code)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                SQLAlchemy Core API Layer                         \u2502\n\u2502  \u2022 create_engine()                                               \u2502\n\u2502  \u2022 Connection.execute()                                          \u2502\n\u2502  \u2022 text(), select(), insert(), update(), delete()                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              CouchDBDialect (sqlalchemy_couchdb/dialect.py)      \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  1. create_connect_args()                              \u2502     \u2502\n\u2502  \u2502     - \u200b\u89e3\u6790\u200b URL: couchdb://user:pass@host:port/db       \u2502     \u2502\n\u2502  \u2502     - \u200b\u8fd4\u56de\u200b\u8fde\u63a5\u200b\u53c2\u6570\u200b                                       \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  2. import_dbapi()                                     \u2502     \u2502\n\u2502  \u2502     - \u200b\u8fd4\u56de\u200b DBAPI \u200b\u6a21\u5757\u200b                                    \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  3. statement_compiler                                 \u2502     \u2502\n\u2502  \u2502     - CouchDBCompiler                                  \u2502     \u2502\n\u2502  \u2502     - SQL \u2192 Mango Query \u200b\u8f6c\u6362\u200b                            \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  4. type_compiler                                      \u2502     \u2502\n\u2502  \u2502     - CouchDBTypeCompiler                              \u2502     \u2502\n\u2502  \u2502     - \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\u6620\u5c04\u200b                                       \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SQL Compiler (sqlalchemy_couchdb/compiler.py)            \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  visit_select()  \u2502  visit_insert()  \u2502  visit_update()  \u2502     \u2502\n\u2502  \u2502  visit_delete()  \u2502  visit_where()   \u2502  visit_column()  \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  SQL AST \u2192 Mango Query JSON                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          DBAPI Layer (sqlalchemy_couchdb/dbapi/)                 \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502  Sync DBAPI          \u2502  Async DBAPI                 \u2502        \u2502\n\u2502  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                  \u2502        \u2502\n\u2502  \u2502  \u2022 Connection        \u2502  \u2022 AsyncConnection           \u2502        \u2502\n\u2502  \u2502  \u2022 Cursor            \u2502  \u2022 AsyncCursor               \u2502        \u2502\n\u2502  \u2502  \u2022 execute()         \u2502  \u2022 async execute()           \u2502        \u2502\n\u2502  \u2502  \u2022 fetchall()        \u2502  \u2022 async fetchall()          \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                                  \u2502\n\u2502  \u200b\u7b26\u5408\u200b DB-API 2.0 \u200b\u89c4\u8303\u200b                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        CouchDB Client (sqlalchemy_couchdb/client.py)             \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502  SyncCouchDBClient   \u2502  AsyncCouchDBClient          \u2502        \u2502\n\u2502  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500         \u2502        \u2502\n\u2502  \u2502  \u2022 httpx.Client      \u2502  \u2022 httpx.AsyncClient         \u2502        \u2502\n\u2502  \u2502  \u2022 create_document() \u2502  \u2022 async create_document()   \u2502        \u2502\n\u2502  \u2502  \u2022 get_document()    \u2502  \u2022 async get_document()      \u2502        \u2502\n\u2502  \u2502  \u2022 update_document() \u2502  \u2022 async update_document()   \u2502        \u2502\n\u2502  \u2502  \u2022 delete_document() \u2502  \u2022 async delete_document()   \u2502        \u2502\n\u2502  \u2502  \u2022 find()            \u2502  \u2022 async find()              \u2502        \u2502\n\u2502  \u2502  \u2022 bulk_docs()       \u2502  \u2022 async bulk_docs()         \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                   \u2502   CouchDB Server     \u2502\n                   \u2502   HTTP/JSON API      \u2502\n                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"dev/architecture/#22-phase-2","title":"2.2 Phase 2 \u200b\u67b6\u6784\u200b\uff08\u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u6a21\u5f0f\u200b\uff09","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Application Layer                            \u2502\n\u2502              (User's SQLAlchemy Code)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                SQLAlchemy Core API Layer                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        HybridCouchDBDialect (sqlalchemy_couchdb/hybrid/)         \u2502\n\u2502                                                                  \u2502\n\u2502  \u200b\u7ee7\u627f\u200b\u81ea\u200b CouchDBDialect + \u200b\u65b0\u589e\u200b\u6df7\u5408\u200b\u529f\u80fd\u200b                              \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  1. Query Analyzer (router.py)                         \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  \u200b\u5206\u6790\u200b SQL \u200b\u8bed\u53e5\u200b\u590d\u6742\u5ea6\u200b                      \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 \u200b\u68c0\u67e5\u200b JOIN                             \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 \u200b\u68c0\u67e5\u200b GROUP BY / HAVING                \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 \u200b\u68c0\u67e5\u200b\u5b50\u200b\u67e5\u8be2\u200b                             \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 \u200b\u68c0\u67e5\u200b\u7a97\u53e3\u200b\u51fd\u6570\u200b                           \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2502     \u2193                                                  \u2502     \u2502\n\u2502  \u2502     \u200b\u8def\u7531\u200b\u51b3\u7b56\u200b:                                           \u2502     \u2502\n\u2502  \u2502     \u2022 \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB                               \u2502     \u2502\n\u2502  \u2502     \u2022 \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b                           \u2502     \u2502\n\u2502  \u2502     \u2022 \u200b\u5199\u200b\u64cd\u4f5c\u200b \u2192 \u200b\u53cc\u5199\u200b\uff08both\uff09                            \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  2. Dual Write Coordinator (dual_write.py)            \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  INSERT:                                 \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  1. \u200b\u5199\u5165\u200b CouchDB (\u200b\u4e3b\u5e93\u200b)                   \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  2. \u200b\u5199\u5165\u200b RDBMS (\u200b\u4ece\u5e93\u200b)                     \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  3. \u200b\u5931\u8d25\u200b \u2192 \u200b\u8865\u507f\u200b\u961f\u5217\u200b                       \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  UPDATE:                                 \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  1. \u200b\u83b7\u53d6\u200b _rev                            \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  2. \u200b\u66f4\u65b0\u200b CouchDB                         \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  3. \u200b\u66f4\u65b0\u200b RDBMS                           \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  4. \u200b\u5931\u8d25\u200b \u2192 \u200b\u8865\u507f\u200b\u961f\u5217\u200b                       \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  DELETE:                                 \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  1. \u200b\u5220\u9664\u200b CouchDB                         \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  2. \u200b\u5220\u9664\u200b RDBMS                           \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  3. \u200b\u5931\u8d25\u200b \u2192 \u200b\u8865\u507f\u200b\u961f\u5217\u200b                       \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  3. Field Mapper (field_mapper.py)                     \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  CouchDB \u2192 RDBMS:                        \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 _id  \u2192 id                             \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 _rev \u2192 rev                            \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 type \u2192 (\u200b\u4e0d\u200b\u6620\u5c04\u200b)                        \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 field1 \u2192 field1                       \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  RDBMS \u2192 CouchDB:                        \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 id  \u2192 _id                             \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 rev \u2192 _rev                            \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 \u200b\u6dfb\u52a0\u200b type \u200b\u5b57\u200b\u6bb5\u200b                         \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  \u2022 field1 \u2192 field1                       \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  4. Sync Monitor (sync_monitor.py)                    \u2502     \u2502\n\u2502  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502     \u2502\n\u2502  \u2502     \u2502  \u200b\u540e\u53f0\u4efb\u52a1\u200b\uff08\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\uff09:                     \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  1. \u200b\u83b7\u53d6\u200b CouchDB \u200b\u6240\u6709\u200b\u6587\u6863\u200b                 \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  2. \u200b\u83b7\u53d6\u200b RDBMS \u200b\u6240\u6709\u200b\u884c\u200b                     \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  3. \u200b\u6bd4\u200b\u5bf9\u200b\u5dee\u5f02\u200b                              \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502  4. \u200b\u4fee\u590d\u200b\u4e0d\u200b\u4e00\u81f4\u200b                            \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502     \u2022 CouchDB \u200b\u6709\u200b RDBMS \u200b\u65e0\u200b \u2192 \u200b\u8865\u5199\u200b         \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502     \u2022 RDBMS \u200b\u6709\u200b CouchDB \u200b\u65e0\u200b \u2192 \u200b\u5220\u9664\u200b         \u2502        \u2502     \u2502\n\u2502  \u2502     \u2502     \u2022 \u200b\u6570\u636e\u200b\u4e0d\u200b\u5339\u914d\u200b \u2192 \u200b\u4ee5\u200b CouchDB \u200b\u4e3a\u51c6\u200b        \u2502        \u2502     \u2502\n\u2502  \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2193                               \u2193\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  CouchDB Backend      \u2502       \u2502  \u200b\u4efb\u610f\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b      \u2502\n  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502       \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502\n  \u2502  \u2022 \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\uff08\u200b\u5feb\u200b\uff09      \u2502       \u2502  \u2022 \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\uff08\u200b\u5f3a\u5927\u200b\uff09    \u2502\n  \u2502  \u2022 \u200b\u4e3b\u200b\u5199\u5165\u200b             \u2502       \u2502  \u2022 \u200b\u4ece\u200b\u5199\u5165\u200b             \u2502\n  \u2502  \u2022 \u200b\u6587\u6863\u200b\u5b58\u50a8\u200b           \u2502       \u2502  \u2022 \u200b\u5907\u4efd\u200b\u548c\u200b\u67e5\u8be2\u200b         \u2502\n  \u2502  \u2022 Mango Query       \u2502       \u2502  \u2022 JOIN/GROUP BY\u200b\u7b49\u200b    \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502  \u2022 PostgreSQL         \u2502\n                                  \u2502  \u2022 MySQL              \u2502\n                                  \u2502  \u2022 SQLite             \u2502\n                                  \u2502  \u2022 Oracle             \u2502\n                                  \u2502  \u2022 ...                \u2502\n                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"dev/architecture/#3","title":"3. \u200b\u6838\u5fc3\u200b\u6a21\u5757\u200b\u8bbe\u8ba1","text":""},{"location":"dev/architecture/#31-sql-compiler","title":"3.1 SQL \u200b\u7f16\u8bd1\u5668\u200b\uff08Compiler\uff09","text":""},{"location":"dev/architecture/#311","title":"3.1.1 \u200b\u804c\u8d23","text":"<p>\u200b\u5c06\u200b SQLAlchemy SQL AST \u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB Mango Query JSON\u3002</p>"},{"location":"dev/architecture/#312","title":"3.1.2 \u200b\u8f6c\u6362\u89c4\u5219","text":"<p>SELECT \u200b\u8bed\u53e5\u200b: <pre><code># SQL\nSELECT name, age FROM users WHERE age &gt; 25 ORDER BY age DESC LIMIT 10\n\n# Mango Query\n{\n  \"selector\": {\n    \"type\": \"users\",\n    \"age\": {\"$gt\": 25}\n  },\n  \"fields\": [\"name\", \"age\"],\n  \"sort\": [{\"age\": \"desc\"}],\n  \"limit\": 10\n}\n</code></pre></p> <p>INSERT \u200b\u8bed\u53e5\u200b: <pre><code># SQL\nINSERT INTO users (name, age) VALUES ('Alice', 30)\n\n# CouchDB Document\n{\n  \"type\": \"users\",\n  \"name\": \"Alice\",\n  \"age\": 30\n}\n</code></pre></p> <p>UPDATE \u200b\u8bed\u53e5\u200b: <pre><code># SQL\nUPDATE users SET age = 31 WHERE name = 'Alice'\n\n# \u200b\u5206\u200b\u4e24\u6b65\u200b:\n# 1. Find: {\"selector\": {\"type\": \"users\", \"name\": \"Alice\"}}\n# 2. Update: {\"age\": 31}\n</code></pre></p> <p>DELETE \u200b\u8bed\u53e5\u200b: <pre><code># SQL\nDELETE FROM users WHERE age &lt; 18\n\n# \u200b\u5206\u200b\u4e24\u6b65\u200b:\n# 1. Find: {\"selector\": {\"type\": \"users\", \"age\": {\"$lt\": 18}}}\n# 2. Delete each document\n</code></pre></p>"},{"location":"dev/architecture/#313-where","title":"3.1.3 WHERE \u200b\u5b50\u53e5\u200b\u64cd\u4f5c\u7b26\u200b\u6620\u5c04","text":"SQL \u200b\u64cd\u4f5c\u7b26\u200b Mango Query \u200b\u64cd\u4f5c\u7b26\u200b \u200b\u793a\u4f8b\u200b <code>=</code> \u200b\u76f4\u63a5\u200b\u503c\u200b <code>{\"age\": 25}</code> <code>&gt;</code> <code>$gt</code> <code>{\"age\": {\"$gt\": 25}}</code> <code>&gt;=</code> <code>$gte</code> <code>{\"age\": {\"$gte\": 25}}</code> <code>&lt;</code> <code>$lt</code> <code>{\"age\": {\"$lt\": 25}}</code> <code>&lt;=</code> <code>$lte</code> <code>{\"age\": {\"$lte\": 25}}</code> <code>!=</code> <code>$ne</code> <code>{\"age\": {\"$ne\": 25}}</code> <code>IN</code> <code>$in</code> <code>{\"age\": {\"$in\": [25, 30]}}</code> <code>NOT IN</code> <code>$nin</code> <code>{\"age\": {\"$nin\": [25, 30]}}</code> <code>LIKE</code> <code>$regex</code> <code>{\"name\": {\"$regex\": \"^A\"}}</code> <code>AND</code> <code>$and</code> <code>{\"$and\": [{...}, {...}]}</code> <code>OR</code> <code>$or</code> <code>{\"$or\": [{...}, {...}]}</code>"},{"location":"dev/architecture/#32-types","title":"3.2 \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\uff08Types\uff09","text":""},{"location":"dev/architecture/#321","title":"3.2.1 \u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b\u8868","text":"SQLAlchemy \u200b\u7c7b\u578b\u200b Python \u200b\u7c7b\u578b\u200b CouchDB JSON \u200b\u7c7b\u578b\u200b \u200b\u5904\u7406\u5668\u200b <code>Integer</code> <code>int</code> <code>number</code> <code>CouchDBInteger</code> <code>String</code> <code>str</code> <code>string</code> <code>CouchDBString</code> <code>Text</code> <code>str</code> <code>string</code> <code>CouchDBString</code> <code>Boolean</code> <code>bool</code> <code>boolean</code> <code>CouchDBBoolean</code> <code>DateTime</code> <code>datetime</code> <code>string (ISO 8601)</code> <code>CouchDBDateTime</code> <code>Float</code> <code>float</code> <code>number</code> <code>Float</code> (\u200b\u539f\u751f\u200b) <code>JSON</code> <code>dict/list</code> <code>object/array</code> <code>CouchDBJSON</code>"},{"location":"dev/architecture/#322","title":"3.2.2 \u200b\u7c7b\u578b\u200b\u5904\u7406\u5668","text":"<p>\u200b\u7ed1\u5b9a\u200b\u5904\u7406\u5668\u200b\uff08bind_processor\uff09: Python \u2192 JSON <pre><code>class CouchDBDateTime(sa_types.DateTime):\n    def bind_processor(self, dialect):\n        def process(value):\n            if value is None:\n                return None\n            return value.isoformat()  # \u200b\u8f6c\u4e3a\u200b ISO 8601 \u200b\u5b57\u7b26\u4e32\u200b\n        return process\n</code></pre></p> <p>\u200b\u7ed3\u679c\u200b\u5904\u7406\u5668\u200b\uff08result_processor\uff09: JSON \u2192 Python <pre><code>class CouchDBDateTime(sa_types.DateTime):\n    def result_processor(self, dialect, coltype):\n        def process(value):\n            if value is None:\n                return None\n            from datetime import datetime\n            return datetime.fromisoformat(value)  # \u200b\u4ece\u200b ISO 8601 \u200b\u89e3\u6790\u200b\n        return process\n</code></pre></p>"},{"location":"dev/architecture/#33-dbapi","title":"3.3 DBAPI \u200b\u5c42","text":""},{"location":"dev/architecture/#331","title":"3.3.1 \u200b\u63a5\u53e3\u200b\u89c4\u8303","text":"<p>\u200b\u7b26\u5408\u200b PEP 249 (DB-API 2.0)</p>"},{"location":"dev/architecture/#332","title":"3.3.2 \u200b\u6838\u5fc3\u200b\u5bf9\u8c61","text":"<p>Connection: <pre><code>class Connection:\n    def cursor() -&gt; Cursor\n    def commit()   # CouchDB \u200b\u81ea\u52a8\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u7a7a\u200b\u64cd\u4f5c\u200b\n    def rollback() # \u200b\u4e0d\u200b\u652f\u6301\u200b\uff0c\u200b\u629b\u51fa\u200b NotSupportedError\n    def close()\n</code></pre></p> <p>Cursor: <pre><code>class Cursor:\n    # \u200b\u5c5e\u6027\u200b\n    description: Optional[List[Tuple]]  # \u200b\u5217\u200b\u63cf\u8ff0\u200b\n    rowcount: int                        # \u200b\u5f71\u54cd\u200b\u884c\u200b\u6570\u200b\n    arraysize: int = 1                   # fetchmany \u200b\u9ed8\u8ba4\u200b\u5927\u5c0f\u200b\n\n    # \u200b\u65b9\u6cd5\u200b\n    def execute(operation, parameters=None)\n    def executemany(operation, seq_of_parameters)\n    def fetchone() -&gt; Optional[Tuple]\n    def fetchmany(size=None) -&gt; List[Tuple]\n    def fetchall() -&gt; List[Tuple]\n    def close()\n</code></pre></p>"},{"location":"dev/architecture/#333-execute","title":"3.3.3 execute \u200b\u6267\u884c\u200b\u6d41\u7a0b","text":"<pre><code>execute(operation, parameters)\n    \u2193\n\u200b\u89e3\u6790\u200b operation (\u200b\u5df2\u7ecf\u200b\u662f\u200b Mango Query JSON \u200b\u5b57\u7b26\u4e32\u200b)\n    \u2193\n\u200b\u8c03\u7528\u200b CouchDB Client \u200b\u76f8\u5e94\u200b\u65b9\u6cd5\u200b\n    \u2193\n\u200b\u5b58\u50a8\u200b\u7ed3\u679c\u200b\u5230\u200b self._rows\n    \u2193\n\u200b\u66f4\u65b0\u200b description \u200b\u548c\u200b rowcount\n    \u2193\n\u200b\u8fd4\u56de\u200b self\n</code></pre>"},{"location":"dev/architecture/#34-http-client","title":"3.4 HTTP \u200b\u5ba2\u6237\u7aef\u200b\uff08Client\uff09","text":""},{"location":"dev/architecture/#341","title":"3.4.1 \u200b\u63a5\u53e3\u200b\u8bbe\u8ba1","text":"<pre><code>class SyncCouchDBClient:\n    def __init__(self, host, port, username, password, database, use_ssl=False)\n    def connect() -&gt; httpx.Client\n    def close()\n    def ping() -&gt; bool\n    def create_document(doc: dict) -&gt; dict  # \u200b\u8fd4\u56de\u200b {'id': ..., 'rev': ...}\n    def get_document(doc_id: str) -&gt; dict\n    def update_document(doc_id: str, doc: dict, rev: str) -&gt; dict\n    def delete_document(doc_id: str, rev: str) -&gt; dict\n    def find(selector: dict, fields=None, limit=None, skip=None) -&gt; list\n    def bulk_docs(docs: list) -&gt; list\n</code></pre>"},{"location":"dev/architecture/#342-couchdb-api","title":"3.4.2 CouchDB API \u200b\u6620\u5c04","text":"\u5ba2\u6237\u7aef\u200b\u65b9\u6cd5\u200b HTTP \u200b\u65b9\u6cd5\u200b CouchDB API \u200b\u7aef\u70b9\u200b <code>create_document</code> POST <code>/{db}</code> <code>get_document</code> GET <code>/{db}/{doc_id}</code> <code>update_document</code> PUT <code>/{db}/{doc_id}?rev={rev}</code> <code>delete_document</code> DELETE <code>/{db}/{doc_id}?rev={rev}</code> <code>find</code> POST <code>/{db}/_find</code> (Mango Query) <code>bulk_docs</code> POST <code>/{db}/_bulk_docs</code>"},{"location":"dev/architecture/#4","title":"4. \u200b\u6570\u636e\u6d41","text":""},{"location":"dev/architecture/#41-phase-1","title":"4.1 \u200b\u67e5\u8be2\u200b\u6d41\u7a0b\u200b\uff08Phase 1\uff09","text":"<pre><code>\u200b\u7528\u6237\u200b\u4ee3\u7801\u200b:\n  engine.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n       \u2193\nSQLAlchemy Core:\n  \u200b\u89e3\u6790\u200b SQL \u2192 SQL AST\n       \u2193\nCouchDBDialect:\n  \u200b\u8c03\u7528\u200b CouchDBCompiler.compile(sql_ast)\n       \u2193\nCouchDBCompiler:\n  visit_select() \u2192 \u200b\u751f\u6210\u200b Mango Query JSON\n  {\n    \"selector\": {\"type\": \"users\", \"age\": {\"$gt\": 25}},\n    \"fields\": [\"*\"]\n  }\n       \u2193\nDBAPI Cursor:\n  execute(mango_query_json)\n       \u2193\nCouchDB Client:\n  find(selector={\"type\": \"users\", \"age\": {\"$gt\": 25}})\n       \u2193\nhttpx:\n  POST /{db}/_find\n  {\n    \"selector\": {\"type\": \"users\", \"age\": {\"$gt\": 25}}\n  }\n       \u2193\nCouchDB Server:\n  \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\n       \u2193\nhttpx:\n  \u200b\u8fd4\u56de\u200b JSON \u200b\u54cd\u5e94\u200b\n       \u2193\nCouchDB Client:\n  \u200b\u89e3\u6790\u200b\u54cd\u5e94\u200b\uff0c\u200b\u8fd4\u56de\u200b\u6587\u6863\u200b\u5217\u8868\u200b\n       \u2193\nDBAPI Cursor:\n  \u200b\u5b58\u50a8\u200b\u7ed3\u679c\u200b\u5230\u200b self._rows\n  \u200b\u6784\u5efa\u200b description\n       \u2193\nSQLAlchemy ResultProxy:\n  \u200b\u5305\u88c5\u200b\u7ed3\u679c\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u8fed\u4ee3\u200b\u5668\u200b\n       \u2193\n\u200b\u7528\u6237\u200b\u4ee3\u7801\u200b:\n  for row in result:\n      print(row)\n</code></pre>"},{"location":"dev/architecture/#42-phase-2","title":"4.2 \u200b\u63d2\u5165\u200b\u6d41\u7a0b\u200b\uff08Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\uff09","text":"<pre><code>\u200b\u7528\u6237\u200b\u4ee3\u7801\u200b:\n  conn.execute(text(\"INSERT INTO users (name, age) VALUES ('Alice', 30)\"))\n       \u2193\nHybridCouchDBDialect:\n  Query Analyzer \u200b\u5206\u6790\u200b \u2192 \u200b\u5224\u5b9a\u200b\u4e3a\u200b\u5199\u200b\u64cd\u4f5c\u200b \u2192 \u200b\u8def\u7531\u200b\u5230\u200b 'both'\n       \u2193\nDual Write Coordinator:\n  execute_insert(table='users', values={'name': 'Alice', 'age': 30})\n       \u2193\n\u200b\u6b65\u9aa4\u200b 1: \u200b\u5199\u5165\u200b CouchDB (\u200b\u4e3b\u5e93\u200b)\n  couchdb_doc = {\n    'type': 'users',\n    'name': 'Alice',\n    'age': 30\n  }\n  result = couchdb.create_document(couchdb_doc)\n  # \u200b\u8fd4\u56de\u200b: {'id': 'abc123', 'rev': '1-xyz'}\n       \u2193\n\u200b\u6b65\u9aa4\u200b 2: \u200b\u5199\u5165\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b (\u200b\u4ece\u5e93\u200b)\n  rdbms_values = FieldMapper.to_rdbms(couchdb_doc, 'abc123', '1-xyz')\n  # \u200b\u8fd4\u56de\u200b: {'id': 'abc123', 'rev': '1-xyz', 'name': 'Alice', 'age': 30}\n       \u2193\n  secondary_engine.execute(\n    \"INSERT INTO users (id, rev, name, age) VALUES (:id, :rev, :name, :age)\",\n    rdbms_values\n  )\n       \u2193\n\u200b\u6210\u529f\u200b \u2192 \u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\n\u200b\u5931\u8d25\u200b \u2192 \u200b\u8bb0\u5f55\u200b\u5230\u200b\u8865\u507f\u200b\u961f\u5217\u200b\uff0c\u200b\u540e\u53f0\u200b\u91cd\u8bd5\u200b\n</code></pre>"},{"location":"dev/architecture/#43-phase-2","title":"4.3 \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u6d41\u7a0b\u200b\uff08Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\uff09","text":"<pre><code>\u200b\u7528\u6237\u200b\u4ee3\u7801\u200b:\n  conn.execute(text(\"\"\"\n    SELECT u.name, COUNT(o.id) as order_count\n    FROM users u\n    JOIN orders o ON u.id = o.user_id\n    GROUP BY u.name\n  \"\"\"))\n       \u2193\nHybridCouchDBDialect:\n  Query Analyzer \u200b\u5206\u6790\u200b:\n    - \u200b\u68c0\u6d4b\u200b\u5230\u200b JOIN \u2192 \u200b\u6dfb\u52a0\u200b 'has_join' \u200b\u7279\u5f81\u200b\n    - \u200b\u68c0\u6d4b\u200b\u5230\u200b GROUP BY \u2192 \u200b\u6dfb\u52a0\u200b 'has_group_by' \u200b\u7279\u5f81\u200b\n  \u200b\u8def\u7531\u200b\u51b3\u7b56\u200b: 'secondary' (\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b)\n       \u2193\n\u200b\u76f4\u63a5\u200b\u8f6c\u53d1\u200b\u5230\u200b\u4e8c\u7ea7\u200b\u6570\u636e\u5e93\u200b\u5f15\u64ce\u200b:\n  secondary_engine.execute(\u200b\u539f\u59cb\u200b SQL)\n       \u2193\nPostgreSQL/MySQL/... \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\n       \u2193\n\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u7ed9\u200b\u7528\u6237\u200b\n</code></pre>"},{"location":"dev/architecture/#5","title":"5. \u200b\u9519\u8bef\u5904\u7406","text":""},{"location":"dev/architecture/#51","title":"5.1 \u200b\u5f02\u5e38\u200b\u5c42\u6b21\u7ed3\u6784","text":"<pre><code>Exception\n  \u2514\u2500 CouchDBError (\u200b\u57fa\u7840\u200b\u5f02\u5e38\u200b)\n      \u251c\u2500 DatabaseError\n      \u2502   \u251c\u2500 OperationalError (\u200b\u8fde\u63a5\u200b\u3001\u200b\u7f51\u7edc\u200b\u9519\u8bef\u200b)\n      \u2502   \u251c\u2500 ProgrammingError (SQL \u200b\u8bed\u6cd5\u9519\u8bef\u200b)\n      \u2502   \u251c\u2500 IntegrityError (\u200b\u6570\u636e\u5b8c\u6574\u6027\u200b\u9519\u8bef\u200b)\n      \u2502   \u251c\u2500 DataError (\u200b\u7c7b\u578b\u8f6c\u6362\u200b\u9519\u8bef\u200b)\n      \u2502   \u251c\u2500 InternalError (\u200b\u5185\u90e8\u200b\u9519\u8bef\u200b)\n      \u2502   \u2514\u2500 NotSupportedError (\u200b\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b\u64cd\u4f5c\u200b)\n      \u2514\u2500 Warning\n</code></pre>"},{"location":"dev/architecture/#52","title":"5.2 \u200b\u9519\u8bef\u5904\u7406\u200b\u7b56\u7565","text":"\u9519\u8bef\u200b\u7c7b\u578b\u200b \u200b\u5904\u7406\u200b\u7b56\u7565\u200b \u200b\u8fde\u63a5\u200b\u5931\u8d25\u200b \u200b\u629b\u51fa\u200b <code>OperationalError</code>\uff0c\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\u68c0\u67e5\u200b CouchDB \u200b\u662f\u5426\u200b\u8fd0\u884c\u200b \u200b\u8ba4\u8bc1\u200b\u5931\u8d25\u200b \u200b\u629b\u51fa\u200b <code>OperationalError</code>\uff0c\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\u68c0\u67e5\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b \u200b\u629b\u51fa\u200b <code>DataError</code>\uff0c\u200b\u5305\u542b\u200b\u6587\u6863\u200b ID \u200b\u51b2\u7a81\u200b\uff08_rev \u200b\u4e0d\u200b\u5339\u914d\u200b\uff09 \u200b\u629b\u51fa\u200b <code>IntegrityError</code>\uff0c\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\u91cd\u8bd5\u200b \u200b\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b SQL \u200b\u7279\u6027\u200b \u200b\u629b\u51fa\u200b <code>NotSupportedError</code>\uff0c\u200b\u8bf4\u660e\u200b\u9650\u5236\u200b \u200b\u53cc\u5199\u200b\u4ece\u5e93\u200b\u5931\u8d25\u200b \u200b\u8bb0\u5f55\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u4e0d\u200b\u629b\u200b\u5f02\u5e38\u200b\uff0c\u200b\u540e\u53f0\u200b\u8865\u507f"},{"location":"dev/architecture/#6","title":"6. \u200b\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"dev/architecture/#61","title":"6.1 \u200b\u8fde\u63a5\u6c60","text":"<p>httpx \u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e\u200b: <pre><code>limits = httpx.Limits(\n    max_connections=100,        # \u200b\u6700\u5927\u200b\u8fde\u63a5\u6570\u200b\n    max_keepalive_connections=20  # \u200b\u4fdd\u6301\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u8fde\u63a5\u6570\u200b\n)\nclient = httpx.Client(limits=limits)\n</code></pre></p>"},{"location":"dev/architecture/#62","title":"6.2 \u200b\u6279\u91cf\u200b\u64cd\u4f5c","text":"<p>\u200b\u4f7f\u7528\u200b bulk_docs API: <pre><code># \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b 1000 \u200b\u6761\u200b\u6587\u6863\u200b\ndocs = [{\"type\": \"users\", \"name\": f\"User{i}\"} for i in range(1000)]\nresults = client.bulk_docs(docs)\n</code></pre></p>"},{"location":"dev/architecture/#63","title":"6.3 \u200b\u67e5\u8be2\u200b\u4f18\u5316","text":"<p>\u200b\u5efa\u8bae\u200b\u7528\u6237\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b: <pre><code># \u200b\u5728\u200b CouchDB \u200b\u4e2d\u4e3a\u200b\u5e38\u7528\u200b\u67e5\u8be2\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nPOST /{db}/_index\n{\n  \"index\": {\n    \"fields\": [\"type\", \"age\"]\n  },\n  \"name\": \"type-age-index\"\n}\n</code></pre></p>"},{"location":"dev/architecture/#64","title":"6.4 \u200b\u7f13\u5b58\u200b\uff08\u200b\u672a\u6765\u200b\uff09","text":"<ul> <li>\u200b\u7ed3\u679c\u200b\u96c6\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u7f16\u8bd1\u200b\u540e\u200b\u7684\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u5143\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b</li> </ul>"},{"location":"dev/architecture/#7","title":"7. \u200b\u5b89\u5168\u6027","text":""},{"location":"dev/architecture/#71","title":"7.1 \u200b\u8ba4\u8bc1","text":"<p>\u200b\u652f\u6301\u200b CouchDB Basic Auth: <pre><code>engine = create_engine('couchdb://username:password@localhost:5984/mydb')\n</code></pre></p>"},{"location":"dev/architecture/#72-sql","title":"7.2 SQL \u200b\u6ce8\u5165\u200b\u9632\u62a4","text":"<p>\u200b\u4f7f\u7528\u200b\u53c2\u6570\u200b\u5316\u200b\u67e5\u8be2\u200b: <pre><code># \u200b\u5b89\u5168\u200b \u2705\nconn.execute(text(\"SELECT * FROM users WHERE name = :name\"), {\"name\": user_input})\n\n# \u200b\u4e0d\u200b\u5b89\u5168\u200b \u274c\nconn.execute(text(f\"SELECT * FROM users WHERE name = '{user_input}'\"))\n</code></pre></p>"},{"location":"dev/architecture/#73-https","title":"7.3 HTTPS \u200b\u652f\u6301","text":"<pre><code>engine = create_engine('couchdb://user:pass@localhost:5984/mydb?use_ssl=true')\n</code></pre>"},{"location":"dev/architecture/#8","title":"8. \u200b\u9650\u5236\u200b\u548c\u200b\u7ea6\u675f","text":""},{"location":"dev/architecture/#81-phase-1","title":"8.1 Phase 1 \u200b\u9650\u5236","text":"SQL \u200b\u7279\u6027\u200b \u200b\u652f\u6301\u200b\u60c5\u51b5\u200b \u200b\u8bf4\u660e\u200b <code>SELECT</code> \u2705 \u200b\u90e8\u5206\u200b\u652f\u6301\u200b \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\uff0c\u200b\u65e0\u200b JOIN <code>INSERT</code> \u2705 \u200b\u652f\u6301\u200b <code>UPDATE</code> \u2705 \u200b\u652f\u6301\u200b <code>DELETE</code> \u2705 \u200b\u652f\u6301\u200b <code>JOIN</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b CouchDB \u200b\u4e0d\u200b\u652f\u6301\u200b <code>GROUP BY</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b <code>HAVING</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b <code>UNION</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b <code>\u200b\u5b50\u200b\u67e5\u8be2\u200b</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b <code>\u200b\u4e8b\u52a1\u200b</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b CouchDB \u200b\u53ea\u6709\u200b\u6587\u6863\u200b\u7ea7\u200b\u539f\u5b50\u200b\u6027\u200b <code>\u200b\u5916\u952e\u200b</code> \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b \u200b\u6587\u6863\u200b\u6570\u636e\u5e93\u200b\u65e0\u5916\u952e\u200b\u6982\u5ff5"},{"location":"dev/architecture/#82-phase-2","title":"8.2 Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f","text":"<p>\u200b\u901a\u8fc7\u200b\u8def\u7531\u200b\u5230\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u4e0a\u8ff0\u200b\u9650\u5236\u200b\u5f97\u5230\u200b\u7f13\u89e3\u200b\uff1a - \u2705 \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\uff08JOIN, GROUP BY \u200b\u7b49\u200b\uff09\u200b\u8def\u7531\u200b\u5230\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b - \u2705 \u200b\u4fdd\u7559\u200b CouchDB \u200b\u7684\u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\u4f18\u52bf\u200b</p>"},{"location":"dev/architecture/#9","title":"9. \u200b\u6d4b\u8bd5\u200b\u7b56\u7565","text":""},{"location":"dev/architecture/#91","title":"9.1 \u200b\u5355\u5143\u6d4b\u8bd5","text":"<ul> <li>\u200b\u7c7b\u578b\u8f6c\u6362\u200b\u6d4b\u8bd5\u200b</li> <li>SQL \u200b\u7f16\u8bd1\u200b\u6d4b\u8bd5\u200b</li> <li>DBAPI \u200b\u63a5\u53e3\u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u8def\u7531\u200b\u51b3\u7b56\u200b\u6d4b\u8bd5\u200b</li> </ul>"},{"location":"dev/architecture/#92","title":"9.2 \u200b\u96c6\u6210\u200b\u6d4b\u8bd5","text":"<ul> <li>\u200b\u7aef\u5230\u200b\u7aef\u200b CRUD \u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u540c\u6b65\u200b/\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u53cc\u5199\u200b\u4e00\u81f4\u6027\u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u591a\u200b\u6570\u636e\u5e93\u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\uff08PostgreSQL, MySQL, SQLite\uff09</li> </ul>"},{"location":"dev/architecture/#93","title":"9.3 \u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<ul> <li>\u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\u5ef6\u8fdf\u200b</li> <li>\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u541e\u5410\u91cf\u200b</li> <li>\u200b\u53cc\u5199\u200b\u5ef6\u8fdf\u200b</li> <li>\u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b\u6027\u80fd\u200b</li> </ul>"},{"location":"dev/architecture/#10","title":"10. \u200b\u90e8\u7f72\u200b\u548c\u200b\u8fd0\u7ef4","text":""},{"location":"dev/architecture/#101","title":"10.1 \u200b\u4f9d\u8d56","text":"<p>\u200b\u5fc5\u9700\u200b: - Python &gt;= 3.11 - SQLAlchemy &gt;= 2.0.0 - httpx &gt;= 0.27.0 - CouchDB &gt;= 3.0</p> <p>\u200b\u53ef\u200b\u9009\u200b\uff08Phase 2\uff09: - PostgreSQL + asyncpg - MySQL + aiomysql - SQLite (\u200b\u5185\u7f6e\u200b)</p>"},{"location":"dev/architecture/#102","title":"10.2 \u200b\u914d\u7f6e\u200b\u793a\u4f8b","text":"<p>Phase 1: <pre><code>from sqlalchemy import create_engine\n\n# \u200b\u540c\u6b65\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u200b\u5f02\u6b65\u200b\nfrom sqlalchemy.ext.asyncio import create_async_engine\nengine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n</code></pre></p> <p>Phase 2: <pre><code># \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n)\n</code></pre></p>"},{"location":"dev/architecture/#103","title":"10.3 \u200b\u76d1\u63a7","text":"<p>\u200b\u5173\u952e\u200b\u6307\u6807\u200b: - CouchDB \u200b\u8fde\u63a5\u6570\u200b - \u200b\u67e5\u8be2\u200b\u5ef6\u8fdf\u200b\uff08P50, P95, P99\uff09 - \u200b\u53cc\u5199\u200b\u6210\u529f\u7387\u200b - \u200b\u8865\u507f\u200b\u961f\u5217\u200b\u957f\u5ea6\u200b - \u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b\u7ed3\u679c\u200b</p>"},{"location":"dev/architecture/#11_1","title":"11. \u200b\u672a\u6765\u200b\u6269\u5c55","text":""},{"location":"dev/architecture/#phase-3-orm","title":"Phase 3: ORM \u200b\u652f\u6301","text":"<ul> <li>\u200b\u6a21\u578b\u200b\u6620\u5c04\u200b</li> <li>Relationship\uff08\u200b\u6587\u6863\u200b\u5f15\u7528\u200b\u6a21\u5f0f\u200b\uff09</li> <li>Session \u200b\u7ba1\u7406\u200b</li> <li>Lazy/Eager Loading</li> </ul>"},{"location":"dev/architecture/#phase-4","title":"Phase 4: \u200b\u9ad8\u7ea7\u200b\u7279\u6027","text":"<ul> <li>\u200b\u89c6\u56fe\u200b\u548c\u200b\u7d22\u5f15\u200b\u7ba1\u7406\u200b</li> <li>\u200b\u9644\u4ef6\u200b\u5904\u7406\u200b</li> <li>\u200b\u53d8\u66f4\u200b Feed</li> <li>\u200b\u590d\u5236\u200b\u529f\u80fd\u200b</li> </ul>"},{"location":"dev/architecture/#phase-5","title":"Phase 5: \u200b\u6027\u80fd\u200b\u4f18\u5316","text":"<ul> <li>\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u5143\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u4f18\u5316\u200b</li> <li>\u200b\u8fde\u63a5\u6c60\u200b\u8c03\u4f18\u200b</li> </ul> <p>\u200b\u6587\u6863\u200b\u7248\u672c\u200b: v1.0 \u200b\u521b\u5efa\u200b\u65e5\u671f\u200b: 2025-01-02 \u200b\u6700\u540e\u200b\u66f4\u65b0\u200b: 2025-01-02</p>"},{"location":"dev/coding-standards/","title":"\u4ee3\u7801\u200b\u89c4\u8303","text":""},{"location":"dev/coding-standards/#_2","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u9075\u5faa\u200b\u4e25\u683c\u200b\u7684\u200b\u4ee3\u7801\u200b\u89c4\u8303\u200b\uff0c\u200b\u786e\u4fdd\u200b\u4ee3\u7801\u200b\u8d28\u91cf\u200b\u3001\u200b\u53ef\u8bfb\u6027\u200b\u548c\u200b\u53ef\u7ef4\u62a4\u6027\u200b\u3002</p>"},{"location":"dev/coding-standards/#python","title":"Python \u200b\u4ee3\u7801\u200b\u89c4\u8303","text":""},{"location":"dev/coding-standards/#pep-8","title":"PEP 8 \u200b\u5408\u89c4","text":"<p>\u200b\u9075\u5faa\u200b PEP 8 Python \u200b\u7f16\u7801\u200b\u89c4\u8303\u200b\uff1a</p> <pre><code># \u2705 \u200b\u6b63\u786e\u200b\uff1a\u200b\u4f7f\u7528\u200b 4 \u200b\u4e2a\u200b\u7a7a\u683c\u200b\u7f29\u8fdb\u200b\ndef example_function():\n    if True:\n        print(\"\u200b\u6b63\u786e\u200b\u7f29\u8fdb\u200b\")\n\n# \u274c \u200b\u9519\u8bef\u200b\uff1a\u200b\u4f7f\u7528\u200b Tab\ndef example_function():\n    if True:\n        print(\"\u200b\u9519\u8bef\u200b\u7f29\u8fdb\u200b\")\n</code></pre>"},{"location":"dev/coding-standards/#_3","title":"\u884c\u200b\u957f\u5ea6","text":"<ul> <li>\u200b\u6700\u5927\u200b\u884c\u200b\u957f\u5ea6\u200b: 88 \u200b\u5b57\u7b26\u200b\uff08Black \u200b\u9ed8\u8ba4\u200b\uff09</li> <li>\u200b\u957f\u884c\u200b\u5904\u7406\u200b: \u200b\u4f7f\u7528\u200b\u62ec\u53f7\u200b\u6216\u200b\u53cd\u200b\u659c\u6760\u200b</li> </ul> <pre><code># \u2705 \u200b\u6b63\u786e\u200b\uff1a\u200b\u4f7f\u7528\u200b\u62ec\u53f7\u200b\nresult = some_function(\n    arg1='value1',\n    arg2='value2',\n    arg3='value3'\n)\n\n# \u2705 \u200b\u6b63\u786e\u200b\uff1a\u200b\u5b57\u7b26\u4e32\u200b\u62fc\u63a5\u200b\nlong_string = (\n    \"\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5f88\u957f\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b \"\n    \"\u200b\u9700\u8981\u200b\u8de8\u200b\u591a\u884c\u200b\u663e\u793a\u200b\"\n)\n</code></pre>"},{"location":"dev/coding-standards/#_4","title":"\u5bfc\u5165\u200b\u89c4\u8303","text":"<pre><code># \u2705 \u200b\u6807\u51c6\u200b\u5e93\u200b\nimport os\nimport sys\nfrom datetime import datetime\n\n# \u2705 \u200b\u7b2c\u4e09\u65b9\u200b\u5e93\u200b\nimport httpx\nimport pytest\nfrom sqlalchemy import text\n\n# \u2705 \u200b\u672c\u5730\u200b\u6a21\u5757\u200b\nfrom sqlalchemy_couchdb.client import SyncCouchDBClient\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\n# \u274c \u200b\u907f\u514d\u200b\uff1a\u200b\u6df7\u4e71\u200b\u7684\u200b\u5bfc\u5165\u200b\nfrom sqlalchemy import *\nimport os, sys\n</code></pre>"},{"location":"dev/coding-standards/#_5","title":"\u51fd\u6570\u200b\u548c\u200b\u7c7b\u200b\u547d\u540d","text":"<pre><code># \u2705 \u200b\u51fd\u6570\u200b\uff1a\u200b\u5c0f\u5199\u200b\u4e0b\u5212\u7ebf\u200b\ndef get_user_info():\n    pass\n\ndef fetch_document():\n    pass\n\n# \u2705 \u200b\u7c7b\u200b\uff1aPascalCase\nclass CouchDBDialect:\n    pass\n\nclass AsyncCouchDBClient:\n    pass\n\n# \u2705 \u200b\u5e38\u91cf\u200b\uff1a\u200b\u5927\u5199\u200b\u4e0b\u5212\u7ebf\u200b\nDEFAULT_TIMEOUT = 30\nMAX_RETRIES = 3\n\n# \u2705 \u200b\u79c1\u6709\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u524d\u5bfc\u200b\u4e0b\u5212\u7ebf\u200b\nclass Example:\n    def _private_method(self):\n        pass\n\n# \u2705 \u200b\u79c1\u6709\u200b\u5c5e\u6027\u200b\uff1a\u200b\u524d\u5bfc\u200b\u4e0b\u5212\u7ebf\u200b\nclass Example:\n    def __init__(self):\n        self._private_attr = None\n</code></pre>"},{"location":"dev/coding-standards/#_6","title":"\u53d8\u91cf\u200b\u547d\u540d","text":"<pre><code># \u2705 \u200b\u63cf\u8ff0\u6027\u200b\u540d\u79f0\u200b\nuser_id = 'user:123'\ndocument_count = 0\nis_active = True\n\n# \u274c \u200b\u6a21\u7cca\u200b\u540d\u79f0\u200b\nx = 'user:123'\nc = 0\nflag = True\n</code></pre>"},{"location":"dev/coding-standards/#_7","title":"\u6587\u6863\u200b\u5b57\u7b26\u4e32","text":""},{"location":"dev/coding-standards/#google","title":"\u4f7f\u7528\u200b Google \u200b\u98ce\u683c","text":"<pre><code>def compile_select(\n    self,\n    select: Select,\n    **kwargs: Any\n) -&gt; dict:\n    \"\"\"\n    \u200b\u7f16\u8bd1\u200b SELECT \u200b\u8bed\u53e5\u200b\u4e3a\u200b Mango Query\u3002\n\n    \u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5c06\u200b SQLAlchemy Select \u200b\u5bf9\u8c61\u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB Mango Query\uff0c\n    \u200b\u652f\u6301\u200b WHERE\u3001ORDER BY\u3001LIMIT \u200b\u7b49\u200b\u5b50\u53e5\u200b\u3002\n\n    \u200b\u53c2\u6570\u200b:\n        select: SQLAlchemy Select \u200b\u5bf9\u8c61\u200b\n        **kwargs: \u200b\u5176\u4ed6\u200b\u7f16\u8bd1\u200b\u53c2\u6570\u200b\n\n    \u200b\u8fd4\u56de\u200b:\n        \u200b\u5305\u542b\u200b selector\u3001fields\u3001sort \u200b\u7b49\u200b\u7684\u200b\u5b57\u5178\u200b\n\n    \u200b\u5f02\u5e38\u200b:\n        CompileError: \u200b\u7f16\u8bd1\u200b\u5931\u8d25\u200b\u65f6\u200b\u629b\u51fa\u200b\n\n    \u200b\u793a\u4f8b\u200b:\n        &gt;&gt;&gt; compiler = CouchDBCompiler(dialect, None)\n        &gt;&gt;&gt; sql = text(\"SELECT * FROM users WHERE age &gt; 25\")\n        &gt;&gt;&gt; mango = compiler.compile_select(sql)\n        &gt;&gt;&gt; print(mango)\n        {\n            'selector': {'age': {'$gt': 25}},\n            'fields': ['_id', 'name', 'age']\n        }\n\n    \u200b\u6ce8\u610f\u200b:\n        \u200b\u6b64\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u7d22\u5f15\u200b\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/coding-standards/#_8","title":"\u7c7b\u200b\u6587\u6863","text":"<pre><code>class CouchDBCompiler:\n    \"\"\"\n    SQL \u2192 Mango Query \u200b\u7f16\u8bd1\u5668\u200b\u3002\n\n    \u200b\u8d1f\u8d23\u200b\u5c06\u200b SQLAlchemy SQL \u200b\u8bed\u53e5\u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB Mango Query\uff0c\n    \u200b\u652f\u6301\u200b SELECT\u3001INSERT\u3001UPDATE\u3001DELETE \u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002\n\n    \u200b\u5c5e\u6027\u200b:\n        dialect: \u200b\u5173\u8054\u200b\u7684\u200b\u65b9\u8a00\u200b\u5b9e\u4f8b\u200b\n        client: CouchDB \u200b\u5ba2\u6237\u7aef\u200b\n    \"\"\"\n\n    def __init__(self, dialect, statement, **kwargs):\n        \"\"\"\u200b\u521d\u59cb\u5316\u200b\u7f16\u8bd1\u5668\u200b\u3002\"\"\"\n        self.dialect = dialect\n        self.statement = statement\n</code></pre>"},{"location":"dev/coding-standards/#_9","title":"\u7c7b\u578b\u200b\u63d0\u793a","text":""},{"location":"dev/coding-standards/#_10","title":"\u5fc5\u9700\u200b\u7684\u200b\u7c7b\u578b\u200b\u63d0\u793a","text":"<pre><code>from typing import Dict, List, Optional, Union, Any\n\ndef process_value(\n    value: Union[str, int],\n    default: Optional[str] = None\n) -&gt; Dict[str, Any]:\n    \"\"\"\n    \u200b\u5904\u7406\u200b\u8f93\u5165\u200b\u503c\u200b\u3002\n\n    \u200b\u53c2\u6570\u200b:\n        value: \u200b\u8981\u200b\u5904\u7406\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u5b57\u7b26\u4e32\u200b\u6216\u200b\u6574\u6570\u200b\n        default: \u200b\u9ed8\u8ba4\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u8f93\u5165\u200b\u4e3a\u200b\u7a7a\u5219\u200b\u4f7f\u7528\u200b\n\n    \u200b\u8fd4\u56de\u200b:\n        \u200b\u5305\u542b\u200b\u5904\u7406\u7ed3\u679c\u200b\u7684\u200b\u5b57\u5178\u200b\n    \"\"\"\n    pass\n</code></pre>"},{"location":"dev/coding-standards/#_11","title":"\u590d\u6742\u200b\u7c7b\u578b","text":"<pre><code>from typing import Protocol, TypeVar\n\nT = TypeVar('T')\n\n# Protocol \u200b\u7528\u4e8e\u200b\u5b9a\u4e49\u200b\u63a5\u53e3\u200b\nclass ClientProtocol(Protocol):\n    def find(self, selector: dict) -&gt; List[dict]:\n        \"\"\"\u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\u3002\"\"\"\n        ...\n\n# \u200b\u6cdb\u578b\u200b\ndef process_list(items: List[T]) -&gt; List[T]:\n    \"\"\"\u200b\u5904\u7406\u200b\u5217\u8868\u200b\u3002\"\"\"\n    return items\n\n# \u200b\u53ef\u200b\u8c03\u7528\u200b\u7c7b\u578b\u200b\nfrom typing import Callable\n\nCallback = Callable[[dict], None]\n\ndef process_with_callback(data: dict, callback: Callback) -&gt; None:\n    \"\"\"\u200b\u4f7f\u7528\u200b\u56de\u8c03\u200b\u5904\u7406\u200b\u6570\u636e\u200b\u3002\"\"\"\n    callback(data)\n</code></pre>"},{"location":"dev/coding-standards/#_12","title":"\u4ee3\u7801\u200b\u7ed3\u6784","text":""},{"location":"dev/coding-standards/#_13","title":"\u7c7b\u200b\u7ed3\u6784","text":"<pre><code>class ExampleClass:\n    \"\"\"\u200b\u793a\u4f8b\u200b\u7c7b\u200b\u3002\"\"\"\n\n    # \u200b\u7c7b\u200b\u53d8\u91cf\u200b\n    default_value = 100\n\n    def __init__(self, value: int):\n        \"\"\"\u200b\u521d\u59cb\u5316\u200b\u3002\"\"\"\n        self.value = value\n        self._private = None\n\n    # \u200b\u516c\u5171\u200b\u65b9\u6cd5\u200b\n    def public_method(self) -&gt; str:\n        \"\"\"\u200b\u516c\u5171\u200b\u65b9\u6cd5\u200b\u3002\"\"\"\n        return f\"Value: {self.value}\"\n\n    # \u200b\u79c1\u6709\u200b\u65b9\u6cd5\u200b\n    def _private_method(self) -&gt; None:\n        \"\"\"\u200b\u79c1\u6709\u200b\u65b9\u6cd5\u200b\u3002\"\"\"\n        pass\n\n    # \u200b\u9759\u6001\u65b9\u6cd5\u200b\n    @staticmethod\n    def static_method() -&gt; str:\n        \"\"\"\u200b\u9759\u6001\u65b9\u6cd5\u200b\u3002\"\"\"\n        return \"Static\"\n\n    # \u200b\u7c7b\u200b\u65b9\u6cd5\u200b\n    @classmethod\n    def from_string(cls, s: str) -&gt; 'ExampleClass':\n        \"\"\"\u200b\u4ece\u200b\u5b57\u7b26\u4e32\u200b\u521b\u5efa\u200b\u5b9e\u4f8b\u200b\u3002\"\"\"\n        return cls(int(s))\n\n    # \u200b\u5c5e\u6027\u200b\n    @property\n    def doubled(self) -&gt; int:\n        \"\"\"\u200b\u53ea\u8bfb\u200b\u5c5e\u6027\u200b\u3002\"\"\"\n        return self.value * 2\n</code></pre>"},{"location":"dev/coding-standards/#_14","title":"\u6a21\u5757\u200b\u7ed3\u6784","text":"<pre><code>\"\"\"\n\u200b\u6a21\u5757\u200b\u8bf4\u660e\u200b\u3002\n\n\u200b\u6b64\u200b\u6a21\u5757\u200b\u63d0\u4f9b\u200b ... \u200b\u529f\u80fd\u200b\u3002\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom typing import List, Optional\nimport logging\n\n# \u200b\u65e5\u5fd7\u200b\u914d\u7f6e\u200b\nlogger = logging.getLogger(__name__)\n\n# \u200b\u5e38\u91cf\u200b\nDEFAULT_TIMEOUT = 30\n\n# \u200b\u5f02\u5e38\u200b\nclass CustomError(Exception):\n    \"\"\"\u200b\u81ea\u5b9a\u4e49\u200b\u5f02\u5e38\u200b\u3002\"\"\"\n    pass\n\n# \u200b\u8f85\u52a9\u200b\u51fd\u6570\u200b\ndef helper_function(arg: str) -&gt; bool:\n    \"\"\"\u200b\u8f85\u52a9\u200b\u51fd\u6570\u200b\u3002\"\"\"\n    return True\n\n# \u200b\u4e3b\u8981\u200b\u7c7b\u200b\nclass MainClass:\n    \"\"\"\u200b\u4e3b\u8981\u200b\u7c7b\u200b\u3002\"\"\"\n    pass\n\n# \u200b\u516c\u5f00\u200b API\n__all__ = [\n    'MainClass',\n    'helper_function',\n    'CustomError',\n]\n</code></pre>"},{"location":"dev/coding-standards/#_15","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"dev/coding-standards/#_16","title":"\u5f02\u5e38\u200b\u4f7f\u7528","text":"<pre><code># \u2705 \u200b\u7279\u5b9a\u200b\u5f02\u5e38\u200b\nfrom sqlalchemy_couchdb.exceptions import CouchDBError\n\ntry:\n    result = client.get(doc_id)\nexcept NotFoundError:\n    logger.warning(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b: %s\", doc_id)\n    return None\nexcept DocumentConflictError:\n    logger.error(\"\u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b: %s\", doc_id)\n    raise\nexcept CouchDBError as e:\n    logger.error(\"CouchDB \u200b\u9519\u8bef\u200b: %s\", e)\n    raise\nexcept Exception as e:\n    logger.exception(\"\u200b\u672a\u200b\u9884\u671f\u200b\u9519\u8bef\u200b\")\n    raise\n\n# \u274c \u200b\u901a\u7528\u200b\u5f02\u5e38\u200b\u6355\u83b7\u200b\ntry:\n    result = client.get(doc_id)\nexcept Exception:\n    # \u200b\u592a\u200b\u5bbd\u6cdb\u200b\n    pass\n</code></pre>"},{"location":"dev/coding-standards/#_17","title":"\u6e05\u7406\u200b\u8d44\u6e90","text":"<pre><code># \u2705 \u200b\u4f7f\u7528\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668\u200b\ndef process_data(data: list) -&gt; list:\n    \"\"\"\u200b\u5904\u7406\u200b\u6570\u636e\u200b\u3002\"\"\"\n    with open('output.txt', 'w') as f:\n        for item in data:\n            f.write(f\"{item}\\n\")\n\n# \u2705 \u200b\u663e\u5f0f\u200b\u6e05\u7406\u200b\nclient = None\ntry:\n    client = SyncCouchDBClient(...)\n    # \u200b\u4f7f\u7528\u200b client\nfinally:\n    if client:\n        client.close()\n\n# \u274c \u200b\u8d44\u6e90\u200b\u6cc4\u9732\u200b\nclient = SyncCouchDBClient(...)\n# \u200b\u6ca1\u6709\u200b\u5173\u95ed\u200b\u5ba2\u6237\u7aef\u200b\n</code></pre>"},{"location":"dev/coding-standards/#_18","title":"\u6d4b\u8bd5\u200b\u89c4\u8303","text":""},{"location":"dev/coding-standards/#_19","title":"\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\u547d\u540d","text":"<pre><code>test_compiler.py           # \u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\ntest_compiler_unit.py      # \u200b\u5355\u5143\u6d4b\u8bd5\u200b\ntest_compiler_integration.py  # \u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\n</code></pre>"},{"location":"dev/coding-standards/#_20","title":"\u6d4b\u8bd5\u200b\u7c7b\u200b\u548c\u200b\u65b9\u6cd5","text":"<pre><code>import pytest\nfrom sqlalchemy import text\n\nclass TestCouchDBCompiler:\n    \"\"\"\u200b\u7f16\u8bd1\u5668\u200b\u6d4b\u8bd5\u200b\u3002\"\"\"\n\n    @pytest.fixture\n    def compiler(self, dialect):\n        \"\"\"\u200b\u521b\u5efa\u200b\u7f16\u8bd1\u5668\u200b\u5b9e\u4f8b\u200b\u3002\"\"\"\n        return CouchDBCompiler(dialect, None)\n\n    def test_simple_select(self, compiler):\n        \"\"\"\u200b\u7b80\u5355\u200b SELECT \u200b\u6d4b\u8bd5\u200b\u3002\"\"\"\n        # Arrange\n        sql = text(\"SELECT * FROM users WHERE type = 'user'\")\n\n        # Act\n        mango = compiler.visit_select(sql)\n\n        # Assert\n        assert mango['selector'] == {\"type\": {\"$eq\": \"user\"}}\n        assert 'fields' in mango\n        assert 'limit' in mango\n</code></pre>"},{"location":"dev/coding-standards/#_21","title":"\u6d4b\u8bd5\u200b\u6ce8\u91ca","text":"<pre><code>def test_update_with_conflict(engine):\n    \"\"\"\u200b\u6d4b\u8bd5\u200b\u66f4\u65b0\u200b\u65f6\u200b\u7684\u200b\u4e50\u89c2\u200b\u9501\u200b\u51b2\u7a81\u200b\u3002\"\"\"\n    # \u200b\u6b64\u200b\u6d4b\u8bd5\u200b\u9a8c\u8bc1\u200b\uff1a\u200b\u5f53\u200b\u6587\u6863\u200b\u88ab\u200b\u5916\u90e8\u200b\u4fee\u6539\u200b\u540e\u200b\uff0c\n    # UPDATE \u200b\u64cd\u4f5c\u200b\u6b63\u786e\u200b\u629b\u51fa\u200b DocumentConflictError\n    pass\n\ndef test_concurrent_queries(async_engine):\n    \"\"\"\u200b\u6d4b\u8bd5\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u3002\"\"\"\n    # \u200b\u6ce8\u610f\u200b\uff1a\u200b\u6b64\u200b\u6d4b\u8bd5\u200b\u9700\u8981\u200b\u771f\u5b9e\u200b\u7684\u200b\u5f02\u6b65\u200b\u73af\u5883\u200b\n    pass\n</code></pre>"},{"location":"dev/coding-standards/#_22","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"dev/coding-standards/#_23","title":"\u907f\u514d\u200b\u6027\u80fd\u200b\u9677\u9631","text":"<pre><code># \u2705 \u200b\u4f7f\u7528\u200b\u5c40\u90e8\u53d8\u91cf\u200b\ndef process_data(data):\n    result = []\n    append = result.append  # \u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff0c\u200b\u52a0\u901f\u200b\n    for item in data:\n        append(item)\n    return result\n\n# \u274c \u200b\u9891\u7e41\u200b\u5c5e\u6027\u200b\u8bbf\u95ee\u200b\ndef process_data_slow(data):\n    result = []\n    for item in data:\n        result.append(item)  # \u200b\u6bcf\u6b21\u200b\u90fd\u200b\u8bbf\u95ee\u200b result\n    return result\n\n# \u2705 \u200b\u9884\u8ba1\u200b\u7b97\u503c\u200b\ndef calculate_values(items):\n    # \u200b\u9884\u8ba1\u200b\u7b97\u200b\u5e38\u7528\u200b\u503c\u200b\n    count = len(items)\n    sum_value = sum(item.value for item in items)\n    avg_value = sum_value / count if count &gt; 0 else 0\n    return {'count': count, 'avg': avg_value}\n</code></pre>"},{"location":"dev/coding-standards/#_24","title":"\u5185\u5b58\u200b\u4f18\u5316","text":"<pre><code># \u2705 \u200b\u751f\u6210\u5668\u200b\uff08\u200b\u60f0\u6027\u200b\u6c42\u503c\u200b\uff09\ndef process_large_dataset(data):\n    for item in data:\n        yield process_item(item)\n\n# \u274c \u200b\u5217\u8868\u200b\uff08\u200b\u7acb\u5373\u200b\u6c42\u503c\u200b\uff09\ndef process_large_dataset_slow(data):\n    return [process_item(item) for item in data]\n\n# \u2705 \u200b\u5206\u5757\u200b\u5904\u7406\u200b\ndef process_in_chunks(data, chunk_size=1000):\n    for i in range(0, len(data), chunk_size):\n        chunk = data[i:i + chunk_size]\n        yield process_chunk(chunk)\n</code></pre>"},{"location":"dev/coding-standards/#_25","title":"\u5b89\u5168\u200b\u89c4\u8303","text":""},{"location":"dev/coding-standards/#_26","title":"\u8f93\u5165\u200b\u9a8c\u8bc1","text":"<pre><code>def validate_doc_id(doc_id: str) -&gt; str:\n    \"\"\"\u200b\u9a8c\u8bc1\u200b\u6587\u6863\u200b ID\u3002\"\"\"\n    if not doc_id:\n        raise ValueError(\"\u200b\u6587\u6863\u200b ID \u200b\u4e0d\u80fd\u200b\u4e3a\u7a7a\u200b\")\n\n    if ':' not in doc_id:\n        raise ValueError(\"\u200b\u6587\u6863\u200b ID \u200b\u5fc5\u987b\u200b\u5305\u542b\u200b ':'\")\n\n    # \u200b\u957f\u5ea6\u200b\u9650\u5236\u200b\n    if len(doc_id) &gt; 256:\n        raise ValueError(\"\u200b\u6587\u6863\u200b ID \u200b\u8fc7\u957f\u200b\")\n\n    return doc_id\n</code></pre>"},{"location":"dev/coding-standards/#_27","title":"\u53c2\u6570\u200b\u5316\u200b\u67e5\u8be2","text":"<pre><code># \u2705 \u200b\u59cb\u7ec8\u200b\u4f7f\u7528\u200b\u53c2\u6570\u200b\u5316\u200b\nconn.execute(\n    text(\"SELECT * FROM users WHERE age &gt; :age\"),\n    {\"age\": 25}\n)\n\n# \u274c \u200b\u5b57\u7b26\u4e32\u200b\u62fc\u63a5\u200b\uff08SQL \u200b\u6ce8\u5165\u200b\u98ce\u9669\u200b\uff09\nage = 25\nconn.execute(\n    text(f\"SELECT * FROM users WHERE age &gt; {age}\")\n)\n</code></pre>"},{"location":"dev/coding-standards/#_28","title":"\u654f\u611f\u200b\u4fe1\u606f","text":"<pre><code>import os\n\n# \u2705 \u200b\u4f7f\u7528\u200b\u73af\u5883\u53d8\u91cf\u200b\nPASSWORD = os.getenv('COUCHDB_PASSWORD')\n\n# \u274c \u200b\u786c\u200b\u7f16\u7801\u200b\u5bc6\u7801\u200b\nPASSWORD = 'password123'\n</code></pre>"},{"location":"dev/coding-standards/#git","title":"Git \u200b\u63d0\u4ea4\u200b\u89c4\u8303","text":""},{"location":"dev/coding-standards/#_29","title":"\u63d0\u4ea4\u200b\u4fe1\u606f\u683c\u5f0f","text":"<pre><code>type(scope): subject\n\nbody\n\nfooter\n</code></pre> <p>\u200b\u7c7b\u578b\u200b: - <code>feat</code>: \u200b\u65b0\u200b\u529f\u80fd\u200b - <code>fix</code>: \u200b\u4fee\u590d\u200b - <code>docs</code>: \u200b\u6587\u6863\u200b\u66f4\u65b0\u200b - <code>style</code>: \u200b\u4ee3\u7801\u200b\u683c\u5f0f\u200b - <code>refactor</code>: \u200b\u91cd\u6784\u200b - <code>test</code>: \u200b\u6d4b\u8bd5\u200b - <code>chore</code>: \u200b\u6784\u5efa\u200b/\u200b\u5de5\u5177\u200b</p> <p>\u200b\u793a\u4f8b\u200b:</p> <pre><code>feat(compiler): \u200b\u6dfb\u52a0\u200b ORDER BY \u200b\u652f\u6301\u200b\n\n- \u200b\u5b9e\u73b0\u200b _compile_order_by \u200b\u65b9\u6cd5\u200b\n- \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\n- \u200b\u6dfb\u52a0\u200b\u6d4b\u8bd5\u7528\u4f8b\u200b\n\nCloses #123\n</code></pre>"},{"location":"dev/coding-standards/#_30","title":"\u4ee3\u7801\u200b\u5ba1\u67e5\u200b\u68c0\u67e5\u8868","text":""},{"location":"dev/coding-standards/#_31","title":"\u529f\u80fd\u200b\u6b63\u786e\u6027","text":"<ul> <li> \u200b\u4ee3\u7801\u200b\u5b8c\u6210\u200b\u6240\u200b\u9700\u200b\u529f\u80fd\u200b</li> <li> \u200b\u5305\u542b\u200b\u5355\u5143\u6d4b\u8bd5\u200b</li> <li> \u200b\u901a\u8fc7\u200b\u6240\u6709\u200b\u6d4b\u8bd5\u200b</li> <li> \u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u5b8c\u6574\u200b</li> </ul>"},{"location":"dev/coding-standards/#_32","title":"\u4ee3\u7801\u200b\u8d28\u91cf","text":"<ul> <li> \u200b\u9075\u5faa\u200b PEP 8</li> <li> \u200b\u7c7b\u578b\u200b\u63d0\u793a\u200b\u5b8c\u6574\u200b</li> <li> \u200b\u6587\u6863\u200b\u5b57\u7b26\u4e32\u200b\u6e05\u6670\u200b</li> <li> \u200b\u65e0\u6b7b\u200b\u4ee3\u7801\u200b</li> </ul>"},{"location":"dev/coding-standards/#_33","title":"\u6027\u80fd","text":"<ul> <li> \u200b\u65e0\u200b\u660e\u663e\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b</li> <li> \u200b\u8d44\u6e90\u200b\u6b63\u786e\u200b\u91ca\u653e\u200b</li> <li> \u200b\u907f\u514d\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u8ba1\u7b97\u200b</li> </ul>"},{"location":"dev/coding-standards/#_34","title":"\u5b89\u5168","text":"<ul> <li> \u200b\u65e0\u200b\u5b89\u5168\u6f0f\u6d1e\u200b</li> <li> \u200b\u53c2\u6570\u200b\u5316\u200b\u67e5\u8be2\u200b</li> <li> \u200b\u8f93\u5165\u200b\u9a8c\u8bc1\u200b</li> <li> \u200b\u65e0\u786c\u200b\u7f16\u7801\u200b\u654f\u611f\u200b\u4fe1\u606f\u200b</li> </ul>"},{"location":"dev/coding-standards/#_35","title":"\u5de5\u5177\u200b\u914d\u7f6e","text":""},{"location":"dev/coding-standards/#black","title":"Black (\u200b\u4ee3\u7801\u200b\u683c\u5f0f\u5316\u200b)","text":"<pre><code># pyproject.toml\n[tool.black]\nline-length = 88\ntarget-version = ['py311']\ninclude = '\\.pyi?$'\n</code></pre>"},{"location":"dev/coding-standards/#isort","title":"isort (\u200b\u5bfc\u5165\u200b\u6392\u5e8f\u200b)","text":"<pre><code># pyproject.toml\n[tool.isort]\nprofile = \"black\"\nmulti_line_output = 3\nline_length = 88\n</code></pre>"},{"location":"dev/coding-standards/#mypy","title":"mypy (\u200b\u7c7b\u578b\u200b\u68c0\u67e5\u200b)","text":"<pre><code># mypy.ini\n[mypy]\npython_version = 3.11\nwarn_return_any = True\nwarn_unused_configs = True\ndisallow_untyped_defs = True\n\n[mypy-sqlalchemy_couchdb.*]\nignore_missing_imports = True\n</code></pre>"},{"location":"dev/coding-standards/#pytest","title":"pytest (\u200b\u6d4b\u8bd5\u200b)","text":"<pre><code># pytest.ini\n[tool:pytest]\ntestpaths = tests\npython_files = test_*.py\npython_classes = Test*\npython_functions = test_*\naddopts = -v --strict-markers\nmarkers =\n    unit: \u200b\u5355\u5143\u6d4b\u8bd5\u200b\n    integration: \u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\n    slow: \u200b\u6162\u901f\u200b\u6d4b\u8bd5\u200b\n</code></pre>"},{"location":"dev/coding-standards/#_36","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u6d4b\u8bd5\u200b\u6307\u5357\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b</li> <li>\u200b\u8d21\u732e\u200b\u6307\u5357\u200b</li> </ul>"},{"location":"dev/performance/","title":"\u6027\u80fd\u200b\u4f18\u5316\u200b\u6307\u5357","text":""},{"location":"dev/performance/#_2","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u7684\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u6d89\u53ca\u200b\u591a\u4e2a\u200b\u5c42\u9762\u200b\uff1a\u200b\u8fde\u63a5\u200b\u7ba1\u7406\u200b\u3001\u200b\u67e5\u8be2\u200b\u4f18\u5316\u200b\u3001\u200b\u7d22\u5f15\u200b\u8bbe\u8ba1\u200b\u3001\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u7b49\u200b\u3002</p>"},{"location":"dev/performance/#_3","title":"\u57fa\u51c6\u200b\u6027\u80fd","text":""},{"location":"dev/performance/#phase-1","title":"Phase 1 \u200b\u6027\u80fd\u6307\u6807","text":"\u64cd\u4f5c\u200b \u200b\u5ef6\u8fdf\u200b \u200b\u541e\u5410\u91cf\u200b \u200b\u8bf4\u660e\u200b \u200b\u7b80\u5355\u200b SELECT &lt; 50ms ~200 qps \u200b\u5355\u8868\u200b\uff0c\u200b\u65e0\u200b JOIN INSERT (\u200b\u5355\u6761\u200b) &lt; 30ms ~300 qps \u200b\u5355\u200b\u6587\u6863\u200b INSERT (\u200b\u6279\u91cf\u200b 100) &lt; 100ms ~1000 docs/s \u200b\u4f7f\u7528\u200b bulk_docs UPDATE &lt; 40ms ~250 qps \u200b\u5305\u542b\u200b\u4e50\u89c2\u200b\u9501\u200b\u68c0\u67e5\u200b DELETE &lt; 30ms ~300 qps \u200b\u6807\u8bb0\u200b\u5220\u9664"},{"location":"dev/performance/#phase-2","title":"Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u6027\u80fd","text":"\u64cd\u4f5c\u200b \u200b\u5ef6\u8fdf\u200b \u200b\u8bf4\u660e\u200b \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\uff08CouchDB\uff09 &lt; 50ms \u200b\u6027\u80fd\u200b\u4e0d\u200b\u4e0b\u964d\u200b \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\uff08PostgreSQL\uff09 \u200b\u53d6\u51b3\u4e8e\u200b PG JOIN \u200b\u7b49\u200b\u64cd\u4f5c\u200b\u4f18\u5f02\u200b \u200b\u53cc\u5199\u200b\uff08INSERT\uff09 &lt; 100ms \u200b\u53ef\u200b\u63a5\u53d7\u200b\u7684\u200b\u989d\u5916\u200b\u5f00\u9500\u200b \u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b\uff081000 docs\uff09 &lt; 10s \u200b\u540e\u53f0\u200b\u5f02\u6b65\u200b\u6267\u884c"},{"location":"dev/performance/#_4","title":"\u8fde\u63a5\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_5","title":"\u8fde\u63a5\u6c60\u200b\u914d\u7f6e","text":"<pre><code>from sqlalchemy import create_engine\n\n# \u200b\u63a8\u8350\u200b\u914d\u7f6e\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=10,              # \u200b\u57fa\u7840\u200b\u8fde\u63a5\u6570\u200b\n    max_overflow=20,           # \u200b\u6700\u5927\u200b\u6ea2\u51fa\u200b\u8fde\u63a5\u200b\n    pool_recycle=3600,         # \u200b\u8fde\u63a5\u200b\u56de\u6536\u200b\u65f6\u95f4\u200b\uff081\u200b\u5c0f\u65f6\u200b\uff09\n    pool_timeout=30,           # \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u8d85\u65f6\u200b\n    pool_pre_ping=True,        # \u200b\u9884\u200b\u68c0\u67e5\u200b\u8fde\u63a5\u200b\n)\n\n# \u200b\u9ad8\u200b\u5e76\u53d1\u200b\u914d\u7f6e\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=20,              # \u200b\u589e\u52a0\u200b\u6c60\u200b\u5927\u5c0f\u200b\n    max_overflow=50,           # \u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u5e76\u53d1\u200b\n    pool_recycle=1800,         # \u200b\u66f4\u200b\u9891\u7e41\u200b\u56de\u6536\u200b\n    pool_pre_ping=True,        # \u200b\u542f\u7528\u200b\u9884\u200b\u68c0\u67e5\u200b\n)\n</code></pre>"},{"location":"dev/performance/#_6","title":"\u76d1\u63a7\u200b\u8fde\u63a5\u6c60","text":"<pre><code>def check_pool_performance(engine):\n    \"\"\"\u200b\u68c0\u67e5\u200b\u8fde\u63a5\u6c60\u200b\u6027\u80fd\u200b\"\"\"\n    pool = engine.pool\n\n    print(f\"\u200b\u6c60\u200b\u5927\u5c0f\u200b: {pool.size()}\")\n    print(\"\u200b\u5df2\u200b\u501f\u51fa\u200b\u8fde\u63a5\u200b:\", pool.checkedout())\n    print(\"\u200b\u5df2\u200b\u8fd4\u56de\u200b\u8fde\u63a5\u200b:\", pool.returned())\n    print(\"\u200b\u6ea2\u51fa\u200b\u8fde\u63a5\u200b:\", pool.overflow())\n\n    # \u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u63a5\u8fd1\u200b\u6ee1\u8f7d\u200b\n    if pool.checkedout() &gt; pool.size() * 0.8:\n        print(\"\u26a0\ufe0f  \u200b\u8fde\u63a5\u6c60\u200b\u4f7f\u7528\u7387\u200b\u8d85\u8fc7\u200b 80%\uff0c\u200b\u5efa\u8bae\u200b\u589e\u52a0\u200b pool_size\")\n\ncheck_pool_performance(engine)\n</code></pre>"},{"location":"dev/performance/#_7","title":"\u8fde\u63a5\u200b\u91cd\u7528","text":"<pre><code># \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u91cd\u7528\u200b\u8fde\u63a5\u200b\ndef process_batch(items):\n    with engine.connect() as conn:\n        for item in items:\n            result = conn.execute(text(\"SELECT * FROM users WHERE _id = :id\"), {'id': item})\n            process_result(result)\n\n# \u274c \u200b\u907f\u514d\u200b\uff1a\u200b\u9891\u7e41\u200b\u521b\u5efa\u200b\u8fde\u63a5\u200b\ndef process_batch_inefficient(items):\n    for item in items:\n        with engine.connect() as conn:  # \u200b\u6bcf\u6b21\u200b\u521b\u5efa\u200b\u65b0\u200b\u8fde\u63a5\u200b\n            result = conn.execute(text(\"SELECT * FROM users WHERE _id = :id\"), {'id': item})\n            process_result(result)\n</code></pre>"},{"location":"dev/performance/#_8","title":"\u67e5\u8be2\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#1","title":"1. \u200b\u53ea\u200b\u67e5\u8be2\u200b\u5fc5\u8981\u200b\u5b57\u200b\u6bb5","text":"<pre><code># \u2705 \u200b\u9ad8\u6548\u200b\uff1a\u200b\u53ea\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT _id, name, age\n    FROM users\n    WHERE type = 'user'\n\"\"\"))\n\n# \u274c \u200b\u4f4e\u6548\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT *\n    FROM users\n    WHERE type = 'user'\n\"\"\"))\n</code></pre>"},{"location":"dev/performance/#2-limit","title":"2. \u200b\u4f7f\u7528\u200b LIMIT","text":"<pre><code># \u2705 \u200b\u603b\u662f\u200b\u9650\u5236\u200b\u7ed3\u679c\u200b\u96c6\u200b\u5927\u5c0f\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n    LIMIT 100  -- \u200b\u9650\u5236\u200b\u8fd4\u56de\u200b\u6570\u91cf\u200b\n\"\"\"))\n\n# \u274c \u200b\u65e0\u200b\u9650\u5236\u200b\u67e5\u8be2\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n\"\"\"))\n</code></pre>"},{"location":"dev/performance/#3","title":"3. \u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5","text":"<pre><code># \u2705 \u200b\u9ad8\u6548\u200b\uff1aORDER BY \u200b\u5b57\u6bb5\u200b\u6709\u200b\u7d22\u5f15\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n    ORDER BY age DESC  -- age \u200b\u5b57\u6bb5\u200b\u6709\u200b\u7d22\u5f15\u200b\n    LIMIT 100\n\"\"\"))\n\n# \u274c \u200b\u4f4e\u6548\u200b\uff1aORDER BY \u200b\u65e0\u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n    ORDER BY name ASC  -- name \u200b\u5b57\u6bb5\u200b\u65e0\u200b\u7d22\u5f15\u200b\n    LIMIT 100\n\"\"\"))\n</code></pre>"},{"location":"dev/performance/#4-where","title":"4. \u200b\u7cbe\u786e\u200b\u7684\u200b WHERE \u200b\u6761\u4ef6","text":"<pre><code># \u2705 \u200b\u9ad8\u6548\u200b\uff1a\u200b\u7cbe\u786e\u200b\u7b5b\u9009\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user' AND age &gt; 25 AND age &lt; 35\n\"\"\"))\n\n# \u274c \u200b\u4f4e\u6548\u200b\uff1a\u200b\u5bbd\u6cdb\u200b\u7b5b\u9009\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n\"\"\"))\n</code></pre>"},{"location":"dev/performance/#_9","title":"\u7d22\u5f15\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_10","title":"\u81ea\u52a8\u200b\u7d22\u5f15\u200b\u521b\u5efa","text":"<pre><code># ORDER BY \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n    ORDER BY age DESC, name ASC  -- \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\n\"\"\"))\n\n# \u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u5e38\u7528\u200b\u7d22\u5f15\u200b\nfrom sqlalchemy_couchdb.client import SyncCouchDBClient\n\nclient = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb'\n)\n\n# \u200b\u5355\u5b57\u200b\u6bb5\u200b\u7d22\u5f15\u200b\nclient.ensure_index('age', name='age-index')\n\n# \u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\uff08\u200b\u5e38\u7528\u200b\u67e5\u8be2\u200b\u7ec4\u5408\u200b\uff09\nclient.ensure_index(['type', 'age'], name='type-age-index')\n\n# \u200b\u90e8\u5206\u200b\u7d22\u5f15\u200b\uff08CouchDB \u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\uff09\n# \u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u8bbe\u8ba1\u200b\u6587\u6863\u200b\n</code></pre>"},{"location":"dev/performance/#_11","title":"\u7d22\u5f15\u200b\u7b56\u7565","text":"<pre><code># \u2705 \u200b\u9ad8\u9891\u200b\u67e5\u8be2\u200b\u5b57\u200b\u6bb5\u200b\nfor field in ['type', 'age', 'created_at', 'status']:\n    client.ensure_index(field)\n\n# \u2705 \u200b\u5e38\u7528\u200b\u6392\u5e8f\u200b\u5b57\u200b\u6bb5\u200b\nclient.ensure_index('age')\nclient.ensure_index('created_at')\n\n# \u2705 \u200b\u590d\u5408\u200b\u67e5\u8be2\u200b\u5b57\u200b\u6bb5\u200b\nclient.ensure_index(['type', 'age'])\nclient.ensure_index(['status', 'created_at'])\n</code></pre>"},{"location":"dev/performance/#_12","title":"\u7d22\u5f15\u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code>def benchmark_index_performance(client):\n    \"\"\"\u200b\u6d4b\u8bd5\u200b\u7d22\u5f15\u200b\u6027\u80fd\u200b\"\"\"\n    import time\n\n    # \u200b\u6d4b\u8bd5\u200b\u65e0\u200b\u7d22\u5f15\u200b\u67e5\u8be2\u200b\n    start = time.time()\n    client.find({\"type\": {\"$eq\": \"user\"}}, limit=1000)\n    no_index_time = time.time() - start\n\n    # \u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\n    client.ensure_index('type')\n\n    # \u200b\u6d4b\u8bd5\u200b\u6709\u200b\u7d22\u5f15\u200b\u67e5\u8be2\u200b\n    start = time.time()\n    client.find({\"type\": {\"$eq\": \"user\"}}, limit=1000)\n    with_index_time = time.time() - start\n\n    print(f\"\u200b\u65e0\u200b\u7d22\u5f15\u200b\u67e5\u8be2\u200b: {no_index_time:.3f}s\")\n    print(f\"\u200b\u6709\u200b\u7d22\u5f15\u200b\u67e5\u8be2\u200b: {with_index_time:.3f}s\")\n    print(f\"\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b: {(no_index_time / with_index_time):.2f}x\")\n\nbenchmark_index_performance(client)\n</code></pre>"},{"location":"dev/performance/#_13","title":"\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_14","title":"\u6279\u91cf\u200b\u63d2\u5165","text":"<pre><code># \u2705 \u200b\u9ad8\u6548\u200b\uff1a\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\nusers_data = [\n    {'id': f'user:{i}', 'name': f'User{i}', 'age': i, 'type': 'user'}\n    for i in range(1000)\n]\n\nwith engine.connect() as conn:\n    # \u200b\u4e00\u6b21\u200b\u8c03\u7528\u200b\u63d2\u5165\u200b\u6240\u6709\u200b\u6570\u636e\u200b\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, type)\n        VALUES (:id, :name, :age, 'user')\n    \"\"\"), users_data)\n    conn.commit()\n    print(f\"\u2705 \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b {len(users_data)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n\n# \u274c \u200b\u4f4e\u6548\u200b\uff1a\u200b\u5faa\u73af\u200b\u63d2\u5165\u200b\nwith engine.connect() as conn:\n    for data in users_data:\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, type)\n            VALUES (:id, :name, :age, 'user')\n        \"\"\"), data)\n    conn.commit()\n</code></pre>"},{"location":"dev/performance/#_15","title":"\u5206\u6279\u200b\u5904\u7406\u200b\u5927\u200b\u6570\u636e\u200b\u96c6","text":"<pre><code>def insert_large_dataset(engine, data, batch_size=1000):\n    \"\"\"\u200b\u5206\u6279\u200b\u63d2\u5165\u200b\u5927\u200b\u6570\u636e\u200b\u96c6\u200b\"\"\"\n    with engine.connect() as conn:\n        for i in range(0, len(data), batch_size):\n            batch = data[i:i + batch_size]\n            conn.execute(text(\"INSERT INTO ...\"), batch)\n            conn.commit()  # \u200b\u6bcf\u6279\u200b\u63d0\u4ea4\u200b\u4e00\u6b21\u200b\n            print(f\"\u200b\u5df2\u200b\u63d2\u5165\u200b {i + len(batch)} / {len(data)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n\n# \u200b\u4f7f\u7528\u200b\ninsert_large_dataset(engine, all_data, batch_size=500)\n</code></pre>"},{"location":"dev/performance/#_16","title":"\u6279\u91cf\u200b\u66f4\u65b0","text":"<pre><code># \u200b\u83b7\u53d6\u200b\u6240\u6709\u200b\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u6587\u6863\u200b\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        SELECT _id, _rev FROM users\n        WHERE type = 'user' AND status = 'pending'\n    \"\"\"))\n    docs_to_update = result.fetchall()\n\n# \u200b\u6279\u91cf\u200b\u66f4\u65b0\u200b\nfor i in range(0, len(docs_to_update), 100):\n    batch = docs_to_update[i:i + 100]\n\n    # \u200b\u66f4\u65b0\u200b\u6bcf\u4e2a\u200b\u6587\u6863\u200b\n    updated_docs = []\n    for doc in batch:\n        updated_doc = {\n            '_id': doc._id,\n            '_rev': doc._rev,\n            'status': 'processed',\n            'type': 'user'\n        }\n        updated_docs.append(updated_doc)\n\n    # \u200b\u6279\u91cf\u200b\u63d0\u4ea4\u200b\n    client.bulk_docs(updated_docs)\n</code></pre>"},{"location":"dev/performance/#_17","title":"\u5185\u5b58\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_18","title":"\u6d41\u5f0f\u200b\u5904\u7406\u200b\u5927\u200b\u7ed3\u679c\u200b\u96c6","text":"<pre><code># \u2705 \u200b\u5185\u5b58\u200b\u53cb\u597d\u200b\uff1a\u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\ndef process_large_result_set(engine):\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT * FROM large_table\n            WHERE type = 'data'\n        \"\"\"))\n\n        while True:\n            # \u200b\u5206\u6279\u200b\u83b7\u53d6\u200b\n            batch = result.fetchmany(1000)\n            if not batch:\n                break\n\n            # \u200b\u5904\u7406\u200b\u6279\u6b21\u200b\n            for row in batch:\n                process_row(row)\n\n# \u274c \u200b\u5185\u5b58\u200b\u5360\u7528\u200b\u9ad8\u200b\uff1a\u200b\u4e00\u6b21\u6027\u200b\u52a0\u8f7d\u200b\ndef process_large_result_set_inefficient(engine):\n    with engine.connect() as conn:\n        result = conn.execute(text(\"SELECT * FROM large_table\"))\n        all_rows = result.fetchall()  # \u200b\u5168\u90e8\u200b\u52a0\u8f7d\u200b\u5230\u200b\u5185\u5b58\u200b\n\n        for row in all_rows:\n            process_row(row)\n</code></pre>"},{"location":"dev/performance/#_19","title":"\u5f02\u6b65\u200b\u5e76\u53d1\u200b\u63a7\u5236","text":"<pre><code>import asyncio\nfrom asyncio import Semaphore\n\n# \u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\u6570\u200b\nMAX_CONCURRENT = 10\nsemaphore = Semaphore(MAX_CONCURRENT)\n\nasync def concurrent_query(query):\n    \"\"\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\uff08\u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\u6570\u200b\uff09\"\"\"\n    async with semaphore:\n        # \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\n        async with engine.connect() as conn:\n            result = await conn.execute(query)\n            return result.fetchall()\n\nasync def run_concurrent_queries(queries):\n    \"\"\"\u200b\u8fd0\u884c\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\"\"\"\n    tasks = [concurrent_query(q) for q in queries]\n    results = await asyncio.gather(*tasks)\n    return results\n\n# \u200b\u4f7f\u7528\u200b\nqueries = [text(\"SELECT * FROM users WHERE age &gt; :age\") for age in range(20, 30)]\nresults = asyncio.run(run_concurrent_queries(queries))\n</code></pre>"},{"location":"dev/performance/#_20","title":"\u7f13\u5b58\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_21","title":"\u67e5\u8be2\u200b\u7f13\u5b58","text":"<pre><code>from functools import lru_cache\nfrom datetime import datetime, timedelta\n\nclass QueryCache:\n    \"\"\"\u200b\u7b80\u5355\u200b\u7684\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b\"\"\"\n    def __init__(self, ttl=300):  # 5\u200b\u5206\u949f\u200b TTL\n        self.cache = {}\n        self.ttl = ttl\n\n    def get(self, key):\n        if key in self.cache:\n            value, timestamp = self.cache[key]\n            if datetime.now() - timestamp &lt; timedelta(seconds=self.ttl):\n                return value\n            else:\n                del self.cache[key]\n        return None\n\n    def set(self, key, value):\n        self.cache[key] = (value, datetime.now())\n\n    def clear(self):\n        self.cache.clear()\n\n# \u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\ncache = QueryCache(ttl=300)\n\ndef get_users(conn, min_age):\n    cache_key = f\"users_age_{min_age}\"\n    result = cache.get(cache_key)\n\n    if result is None:\n        result = conn.execute(\n            text(\"SELECT * FROM users WHERE age &gt; :age\"),\n            {'age': min_age}\n        ).fetchall()\n        cache.set(cache_key, result)\n\n    return result\n</code></pre>"},{"location":"dev/performance/#redis","title":"Redis \u200b\u7f13\u5b58\u200b\uff08\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\uff09","text":"<pre><code>import redis\n\nredis_client = redis.Redis(host='localhost', port=6379, db=0)\n\ndef cached_query(conn, key, query, params):\n    \"\"\"\u200b\u4f7f\u7528\u200b Redis \u200b\u7f13\u5b58\u200b\u67e5\u8be2\u200b\"\"\"\n    # \u200b\u5148\u200b\u4ece\u200b\u7f13\u5b58\u200b\u83b7\u53d6\u200b\n    cached_result = redis_client.get(key)\n    if cached_result:\n        return json.loads(cached_result)\n\n    # \u200b\u7f13\u5b58\u200b\u672a\u200b\u547d\u4e2d\u200b\uff0c\u200b\u67e5\u8be2\u6570\u636e\u5e93\u200b\n    result = conn.execute(query, params).fetchall()\n\n    # \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u53ef\u200b\u5e8f\u5217\u5316\u200b\u683c\u5f0f\u200b\n    serialized_result = [dict(row) for row in result]\n\n    # \u200b\u5b58\u5165\u200b\u7f13\u5b58\u200b\uff08TTL: 5\u200b\u5206\u949f\u200b\uff09\n    redis_client.setex(key, 300, json.dumps(serialized_result))\n\n    return serialized_result\n\n# \u200b\u4f7f\u7528\u200b\nresult = cached_query(\n    conn,\n    \"users_over_25\",\n    text(\"SELECT * FROM users WHERE age &gt; :age\"),\n    {'age': 25}\n)\n</code></pre>"},{"location":"dev/performance/#_22","title":"\u5f02\u6b65\u200b\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_23","title":"\u6279\u91cf\u200b\u5f02\u6b65\u200b\u64cd\u4f5c","text":"<pre><code>async def batch_async_insert(engine, data):\n    \"\"\"\u200b\u6279\u91cf\u200b\u5f02\u6b65\u200b\u63d2\u5165\u200b\"\"\"\n    async with engine.connect() as conn:\n        # \u200b\u5e76\u53d1\u200b\u63d2\u5165\u200b\uff08\u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\u6570\u200b\uff09\n        semaphore = asyncio.Semaphore(10)\n        tasks = []\n\n        for item in data:\n            task = insert_single_item(conn, item, semaphore)\n            tasks.append(task)\n\n        await asyncio.gather(*tasks)\n        await conn.commit()\n\nasync def insert_single_item(conn, item, semaphore):\n    \"\"\"\u200b\u63d2\u5165\u200b\u5355\u4e2a\u200b\u9879\u76ee\u200b\"\"\"\n    async with semaphore:\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, type)\n            VALUES (:id, :name, 'user')\n        \"\"\"), item)\n</code></pre>"},{"location":"dev/performance/#_24","title":"\u5f02\u6b65\u200b\u8fde\u63a5\u6c60","text":"<pre><code>from sqlalchemy.ext.asyncio import create_async_engine\n\n# \u200b\u4f18\u5316\u200b\u5f02\u6b65\u200b\u8fde\u63a5\u6c60\u200b\nasync_engine = create_async_engine(\n    'couchdb+async://admin:password@localhost:5984/mydb',\n    pool_size=20,              # \u200b\u589e\u52a0\u200b\u6c60\u200b\u5927\u5c0f\u200b\n    max_overflow=30,           # \u200b\u5141\u8bb8\u200b\u66f4\u200b\u591a\u200b\u6ea2\u51fa\u200b\n    pool_recycle=1800,         # 30\u200b\u5206\u949f\u200b\u56de\u6536\u200b\n    pool_pre_ping=True,        # \u200b\u9884\u200b\u68c0\u67e5\u200b\n)\n</code></pre>"},{"location":"dev/performance/#_25","title":"\u6027\u80fd\u200b\u76d1\u63a7","text":""},{"location":"dev/performance/#_26","title":"\u76d1\u63a7\u200b\u6307\u6807","text":"<pre><code>import time\nfrom contextlib import contextmanager\n\n@contextmanager\ndef timer(name):\n    \"\"\"\u200b\u8ba1\u65f6\u5668\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668\u200b\"\"\"\n    start = time.time()\n    yield\n    elapsed = time.time() - start\n    print(f\"{name}: {elapsed:.3f}s\")\n\n# \u200b\u4f7f\u7528\u200b\nwith timer(\"\u200b\u67e5\u8be2\u200b\u7528\u6237\u200b\"):\n    result = conn.execute(text(\"SELECT * FROM users\"))\n\nwith timer(\"\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\"):\n    conn.execute(text(\"INSERT INTO ...\"), data)\n    conn.commit()\n</code></pre>"},{"location":"dev/performance/#_27","title":"\u6027\u80fd\u200b\u5206\u6790","text":"<pre><code>import cProfile\nimport pstats\n\ndef profile_query():\n    \"\"\"\u200b\u5206\u6790\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\"\"\"\n    profiler = cProfile.Profile()\n    profiler.enable()\n\n    # \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n\n    profiler.disable()\n    stats = pstats.Stats(profiler)\n    stats.sort_stats('cumulative')\n    stats.print_stats(10)  # \u200b\u663e\u793a\u200b\u524d\u200b 10 \u200b\u4e2a\u200b\u6700\u200b\u8017\u65f6\u200b\u7684\u200b\u51fd\u6570\u200b\n\nprofile_query()\n</code></pre>"},{"location":"dev/performance/#_28","title":"\u6162\u200b\u67e5\u8be2\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#_29","title":"\u8bc6\u522b\u200b\u6162\u200b\u67e5\u8be2","text":"<pre><code>import logging\n\n# \u200b\u542f\u7528\u200b\u6162\u200b\u67e5\u8be2\u200b\u65e5\u5fd7\u200b\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger('slow_queries')\n\ndef log_slow_query(query, execution_time):\n    \"\"\"\u200b\u8bb0\u5f55\u200b\u6162\u200b\u67e5\u8be2\u200b\"\"\"\n    if execution_time &gt; 0.1:  # \u200b\u8d85\u8fc7\u200b 100ms\n        logger.warning(\n            \"\u200b\u6162\u200b\u67e5\u8be2\u200b\u68c0\u6d4b\u200b: %s (\u200b\u8017\u65f6\u200b: %.3fs)\",\n            str(query), execution_time\n        )\n\ndef execute_with_monitoring(conn, query, params=None):\n    \"\"\"\u200b\u5e26\u200b\u76d1\u63a7\u200b\u7684\u200b\u6267\u884c\u200b\"\"\"\n    start = time.time()\n    try:\n        result = conn.execute(query, params or {})\n        execution_time = time.time() - start\n        log_slow_query(query, execution_time)\n        return result\n    finally:\n        pass\n</code></pre>"},{"location":"dev/performance/#_30","title":"\u751f\u4ea7\u200b\u73af\u5883\u200b\u4f18\u5316","text":""},{"location":"dev/performance/#1_1","title":"1. \u200b\u8fde\u63a5\u6c60\u200b\u8c03\u4f18","text":"<pre><code># \u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u63a8\u8350\u200b\u914d\u7f6e\u200b\nPRODUCTION_ENGINE = create_engine(\n    'couchdb://admin:password@localhost:5984/production',\n    pool_size=20,              # \u200b\u57fa\u4e8e\u200b CPU \u200b\u6838\u5fc3\u200b\u6570\u200b\n    max_overflow=50,           # \u200b\u5904\u7406\u200b\u7a81\u53d1\u200b\u8d1f\u8f7d\u200b\n    pool_recycle=1800,         # 30\u200b\u5206\u949f\u200b\u56de\u6536\u200b\n    pool_timeout=60,           # \u200b\u589e\u52a0\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n    pool_pre_ping=True,        # \u200b\u786e\u4fdd\u200b\u8fde\u63a5\u200b\u6709\u6548\u200b\n    max_identifier_length=256,  # \u200b\u652f\u6301\u200b\u957f\u200b\u6807\u8bc6\u7b26\u200b\n)\n</code></pre>"},{"location":"dev/performance/#2-http","title":"2. HTTP \u200b\u5ba2\u6237\u7aef\u200b\u4f18\u5316","text":"<pre><code>from sqlalchemy_couchdb.client import SyncCouchDBClient\nimport httpx\n\n# \u200b\u4f18\u5316\u200b\u7684\u200b HTTP \u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u200b\nclient = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    database='mydb',\n    timeout=httpx.Timeout(60.0, connect=10.0),\n    limits=httpx.Limits(\n        max_keepalive_connections=20,\n        max_connections=100,\n        keepalive_expiry=30\n    )\n)\n</code></pre>"},{"location":"dev/performance/#3_1","title":"3. \u200b\u76d1\u63a7\u200b\u548c\u200b\u544a\u8b66","text":"<pre><code>from prometheus_client import Counter, Histogram\n\n# \u200b\u6027\u80fd\u6307\u6807\u200b\nquery_counter = Counter('couchdb_queries_total', 'Total queries', ['operation'])\nquery_duration = Histogram('couchdb_query_duration_seconds', 'Query duration')\n\ndef execute_with_metrics(operation):\n    \"\"\"\u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\u5e76\u200b\u8bb0\u5f55\u200b\u6307\u6807\u200b\"\"\"\n    query_counter.labels(operation=operation).inc()\n\n    with query_duration.time():\n        result = conn.execute(text(operation))\n\n    return result\n\n# \u200b\u4f7f\u7528\u200b\nresult = execute_with_metrics(\"SELECT * FROM users\")\n</code></pre>"},{"location":"dev/performance/#_31","title":"\u5e38\u89c1\u200b\u6027\u80fd\u200b\u9677\u9631","text":""},{"location":"dev/performance/#1-n1","title":"1. N+1 \u200b\u67e5\u8be2","text":"<pre><code># \u274c \u200b\u9677\u9631\u200b\uff1aN+1 \u200b\u67e5\u8be2\u200b\nusers = conn.execute(text(\"SELECT * FROM users\")).fetchall()\nfor user in users:\n    # \u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u90fd\u200b\u6267\u884c\u200b\u65b0\u200b\u67e5\u8be2\u200b\n    orders = conn.execute(\n        text(\"SELECT * FROM orders WHERE user_id = :id\"),\n        {'id': user._id}\n    ).fetchall()\n    print(f\"{user.name}: {len(orders)} \u200b\u8ba2\u5355\u200b\")\n\n# \u2705 \u200b\u89e3\u51b3\u200b\uff1a\u200b\u9884\u200b\u67e5\u8be2\u200b\u6216\u200b JOIN\norders = conn.execute(text(\"\"\"\n    SELECT u.name, o.*\n    FROM users u\n    LEFT JOIN orders o ON u._id = o.user_id\n\"\"\")).fetchall()\n</code></pre>"},{"location":"dev/performance/#2","title":"2. \u200b\u8fc7\u5ea6\u200b\u6b63\u5219\u200b\u67e5\u8be2","text":"<pre><code># \u274c \u200b\u9677\u9631\u200b\uff1aLIKE \u200b\u67e5\u8be2\u200b\uff08\u200b\u4f7f\u7528\u200b\u6b63\u5219\u200b\uff0c\u200b\u6027\u80fd\u200b\u5dee\u200b\uff09\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE name LIKE '%Alice%'\n\"\"\"))\n\n# \u2705 \u200b\u89e3\u51b3\u200b\uff1a\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE name LIKE 'Alice%'\n\"\"\"))\n\n# \u2705 \u200b\u89e3\u51b3\u200b\uff1a\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b\u6216\u200b\u4f7f\u7528\u200b\u5168\u6587\u200b\u641c\u7d22\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE name = 'Alice'\n\"\"\"))\n</code></pre>"},{"location":"dev/performance/#3-json","title":"3. \u200b\u8fc7\u591a\u200b\u5d4c\u5957\u200b JSON","text":"<pre><code># \u274c \u200b\u9677\u9631\u200b\uff1a\u200b\u6df1\u5ea6\u200b\u5d4c\u5957\u200b JSON\uff08\u200b\u96be\u4ee5\u200b\u67e5\u8be2\u200b\uff09\nuser = {\n    \"profile\": {\n        \"personal\": {\n            \"name\": \"Alice\",\n            \"age\": 30\n        },\n        \"contact\": {\n            \"email\": \"alice@example.com\"\n        }\n    }\n}\n\n# \u2705 \u200b\u89e3\u51b3\u200b\uff1a\u200b\u6241\u5e73\u5316\u200b\nuser = {\n    \"name\": \"Alice\",\n    \"age\": 30,\n    \"email\": \"alice@example.com\"\n}\n</code></pre>"},{"location":"dev/performance/#_32","title":"\u6027\u80fd\u200b\u6d4b\u8bd5","text":""},{"location":"dev/performance/#_33","title":"\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\u811a\u672c","text":"<pre><code>def benchmark_crud_operations(engine):\n    \"\"\"CRUD \u200b\u64cd\u4f5c\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\"\"\"\n    import time\n\n    # INSERT \u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\n    start = time.time()\n    with engine.connect() as conn:\n        data = [{'id': f'bench:{i}', 'name': f'User{i}', 'type': 'user'}\n                for i in range(1000)]\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, type)\n            VALUES (:id, :name, 'user')\n        \"\"\"), data)\n        conn.commit()\n    insert_time = time.time() - start\n    print(f\"INSERT 1000 \u200b\u6761\u200b: {insert_time:.3f}s ({1000/insert_time:.1f} ops/s)\")\n\n    # SELECT \u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\n    start = time.time()\n    with engine.connect() as conn:\n        for i in range(100):\n            result = conn.execute(text(\"\"\"\n                SELECT * FROM users\n                WHERE _id = :id\n            \"\"\"), {'id': f'bench:{i}'})\n    select_time = time.time() - start\n    print(f\"SELECT 100 \u200b\u6b21\u200b: {select_time:.3f}s ({100/select_time:.1f} ops/s)\")\n\n# \u200b\u8fd0\u884c\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\nbenchmark_crud_operations(engine)\n</code></pre>"},{"location":"dev/performance/#_34","title":"\u603b\u7ed3","text":""},{"location":"dev/performance/#_35","title":"\u4f18\u5316\u200b\u4f18\u5148\u7ea7","text":"<ol> <li>\u200b\u9ad8\u200b\u4f18\u5148\u7ea7\u200b\uff1a</li> <li>\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u8fde\u63a5\u6c60\u200b</li> <li>\u200b\u53ea\u200b\u67e5\u8be2\u200b\u5fc5\u8981\u200b\u5b57\u200b\u6bb5\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b</li> <li> <p>\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b</p> </li> <li> <p>\u200b\u4e2d\u200b\u4f18\u5148\u7ea7\u200b\uff1a</p> </li> <li>\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\u5927\u200b\u6570\u636e\u200b\u96c6\u200b</li> <li>\u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\u6570\u200b</li> <li> <p>\u200b\u4f18\u5316\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</p> </li> <li> <p>\u200b\u4f4e\u4f18\u5148\u7ea7\u200b\uff1a</p> </li> <li>\u200b\u5185\u5b58\u200b\u4f18\u5316\u200b</li> <li>\u200b\u6027\u80fd\u200b\u76d1\u63a7\u200b</li> <li>\u200b\u6162\u200b\u67e5\u8be2\u200b\u65e5\u5fd7\u200b</li> <li>\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b</li> </ol>"},{"location":"dev/performance/#_36","title":"\u5173\u952e\u200b\u539f\u5219","text":"<ul> <li>\u200b\u6d4b\u91cf\u200b\u4f18\u4e8e\u200b\u731c\u6d4b\u200b\uff1a\u200b\u4f7f\u7528\u6027\u80fd\u200b\u5206\u6790\u200b\u5de5\u5177\u200b</li> <li>\u200b\u7f13\u5b58\u200b\u4e3a\u200b\u738b\u200b\uff1a\u200b\u5408\u7406\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b</li> <li>\u200b\u6279\u91cf\u200b\u4f18\u4e8e\u200b\u5355\u6761\u200b\uff1a\u200b\u51cf\u5c11\u200b\u7f51\u7edc\u200b\u5f80\u8fd4\u200b</li> <li>\u200b\u7d22\u5f15\u200b\u5fc5\u5907\u200b\uff1a\u200b\u5408\u7406\u200b\u8bbe\u8ba1\u200b\u7d22\u5f15\u200b</li> <li>\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\uff1a\u200b\u907f\u514d\u200b\u8fde\u63a5\u200b\u5f00\u9500\u200b</li> </ul>"},{"location":"dev/performance/#_37","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u6d4b\u8bd5\u200b\u6307\u5357\u200b</li> <li>\u200b\u4ee3\u7801\u200b\u89c4\u8303\u200b</li> <li>API \u200b\u53c2\u8003\u200b</li> </ul>"},{"location":"dev/testing/","title":"\u6d4b\u8bd5\u200b\u6307\u5357","text":""},{"location":"dev/testing/#_2","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u4f7f\u7528\u200b pytest \u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u6d4b\u8bd5\u200b\u8986\u76d6\u200b\u7f16\u8bd1\u5668\u200b\u3001\u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u3002</p>"},{"location":"dev/testing/#_3","title":"\u6d4b\u8bd5\u73af\u5883\u200b\u8bbe\u7f6e","text":""},{"location":"dev/testing/#1","title":"1. \u200b\u5b89\u88c5\u200b\u5f00\u53d1\u200b\u4f9d\u8d56","text":"<pre><code># \u200b\u514b\u9686\u200b\u4ed3\u5e93\u200b\ngit clone https://github.com/getaix/sqlalchemy-couchdb.git\ncd sqlalchemy-couchdb\n\n# \u200b\u521b\u5efa\u200b\u865a\u62df\u73af\u5883\u200b\npython -m venv .venv\nsource .venv/bin/activate  # Linux/Mac\n# .venv\\Scripts\\activate  # Windows\n\n# \u200b\u5b89\u88c5\u200b\u5f00\u53d1\u200b\u4f9d\u8d56\u200b\npip install -e \".[dev]\"\n</code></pre>"},{"location":"dev/testing/#2-couchdb","title":"2. \u200b\u542f\u52a8\u200b CouchDB","text":"<pre><code># \u200b\u4f7f\u7528\u200b Docker\ndocker run -d -p 5984:5984 \\\n  -e COUCHDB_USER=admin \\\n  -e COUCHDB_PASSWORD=password \\\n  --name couchdb-test couchdb:3\n\n# \u200b\u7b49\u5f85\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\nsleep 5\n\n# \u200b\u521b\u5efa\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\ncurl -X PUT http://admin:password@localhost:5984/testdb\n</code></pre>"},{"location":"dev/testing/#3","title":"3. \u200b\u9a8c\u8bc1\u200b\u5b89\u88c5","text":"<pre><code># \u200b\u68c0\u67e5\u200b Python \u200b\u5305\u200b\npython -c \"import sqlalchemy_couchdb; print(sqlalchemy_couchdb.__version__)\"\n\n# \u200b\u68c0\u67e5\u200b\u6d4b\u8bd5\u200b\npytest --version\n</code></pre>"},{"location":"dev/testing/#_4","title":"\u8fd0\u884c\u200b\u6d4b\u8bd5","text":""},{"location":"dev/testing/#_5","title":"\u6240\u6709\u200b\u6d4b\u8bd5","text":"<pre><code># \u200b\u8fd0\u884c\u200b\u6240\u6709\u200b\u6d4b\u8bd5\u200b\npytest tests/\n\n# \u200b\u5e26\u200b\u8be6\u7ec6\u200b\u8f93\u51fa\u200b\npytest tests/ -v\n\n# \u200b\u5e26\u200b\u8986\u76d6\u7387\u200b\u62a5\u544a\u200b\npytest tests/ --cov=sqlalchemy_couchdb --cov-report=html --cov-report=term-missing\n</code></pre>"},{"location":"dev/testing/#_6","title":"\u7279\u5b9a\u200b\u6d4b\u8bd5\u200b\u7c7b\u522b","text":"<pre><code># \u200b\u7f16\u8bd1\u5668\u200b\u6d4b\u8bd5\u200b\npytest tests/test_compiler.py -v\n\n# \u200b\u540c\u6b65\u200b\u6d4b\u8bd5\u200b\npytest tests/test_sync.py -v\n\n# \u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b\npytest tests/test_async.py -v\n\n# \u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\npytest tests/test_couchdb_integration.py -v\n</code></pre>"},{"location":"dev/testing/#_7","title":"\u5355\u4e2a\u200b\u6d4b\u8bd5","text":"<pre><code># \u200b\u8fd0\u884c\u200b\u7279\u5b9a\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\npytest tests/test_compiler.py::TestSelectCompilation::test_simple_select -v\n\n# \u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b\u7c7b\u200b\npytest tests/test_compiler.py::TestSelectCompilation -v\n</code></pre>"},{"location":"dev/testing/#_8","title":"\u6d4b\u8bd5\u200b\u6807\u8bb0","text":"<pre><code># \u200b\u53ea\u200b\u8fd0\u884c\u200b\u5355\u5143\u6d4b\u8bd5\u200b\npytest -m unit\n\n# \u200b\u53ea\u200b\u8fd0\u884c\u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\npytest -m integration\n\n# \u200b\u53ea\u200b\u8fd0\u884c\u200b\u540c\u6b65\u200b\u6d4b\u8bd5\u200b\npytest -m sync\n\n# \u200b\u53ea\u200b\u8fd0\u884c\u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b\npytest -m async_\n\n# \u200b\u8df3\u8fc7\u200b\u6162\u901f\u200b\u6d4b\u8bd5\u200b\npytest -m \"not slow\"\n</code></pre>"},{"location":"dev/testing/#_9","title":"\u6d4b\u8bd5\u200b\u7ed3\u6784","text":""},{"location":"dev/testing/#_10","title":"\u6d4b\u8bd5\u200b\u76ee\u5f55\u200b\u7ed3\u6784","text":"<pre><code>tests/\n\u251c\u2500\u2500 conftest.py                 # pytest \u200b\u914d\u7f6e\u200b\u548c\u200b fixtures\n\u251c\u2500\u2500 test_compiler.py           # \u200b\u7f16\u8bd1\u5668\u200b\u6d4b\u8bd5\u200b\n\u251c\u2500\u2500 test_sync.py               # \u200b\u540c\u6b65\u64cd\u4f5c\u200b\u6d4b\u8bd5\u200b\n\u251c\u2500\u2500 test_async.py              # \u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6d4b\u8bd5\u200b\n\u251c\u2500\u2500 test_couchdb_integration.py # \u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\n\u251c\u2500\u2500 test_types.py              # \u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\u6d4b\u8bd5\u200b\n\u251c\u2500\u2500 test_exceptions.py         # \u200b\u5f02\u5e38\u200b\u6d4b\u8bd5\u200b\n\u2514\u2500\u2500 unit/                      # \u200b\u5355\u5143\u6d4b\u8bd5\u200b\n    \u251c\u2500\u2500 test_compiler_unit.py\n    \u251c\u2500\u2500 test_client_unit.py\n    \u2514\u2500\u2500 test_dialect_unit.py\n</code></pre>"},{"location":"dev/testing/#_11","title":"\u6838\u5fc3\u200b\u6d4b\u8bd5\u200b\u6587\u4ef6","text":""},{"location":"dev/testing/#test_compilerpy","title":"test_compiler.py","text":"<p>\u200b\u6d4b\u8bd5\u200b SQL \u2192 Mango Query \u200b\u8f6c\u6362\u200b\u3002</p> <pre><code>class TestSelectCompilation:\n    \"\"\"SELECT \u200b\u7f16\u8bd1\u200b\u6d4b\u8bd5\u200b\"\"\"\n\n    def test_simple_select(self, dialect):\n        \"\"\"\u200b\u7b80\u5355\u200b SELECT \u200b\u7f16\u8bd1\u200b\"\"\"\n        sql = text(\"SELECT * FROM users WHERE type = 'user'\")\n        compiler = CouchDBCompiler(dialect, sql)\n        mango = compiler.visit_select(sql)\n\n        assert mango['selector'] == {\"type\": {\"$eq\": \"user\"}}\n        assert \"fields\" in mango\n        assert \"limit\" in mango\n\n    def test_where_conditions(self, dialect):\n        \"\"\"WHERE \u200b\u6761\u4ef6\u200b\u7f16\u8bd1\u200b\"\"\"\n        sql = text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user' AND age &gt; 25\n        \"\"\")\n        compiler = CouchDBCompiler(dialect, sql)\n        mango = compiler.visit_select(sql)\n\n        assert mango['selector']['type'] == {\"$eq\": \"user\"}\n        assert mango['selector']['age'] == {\"$gt\": 25}\n\n    def test_order_by(self, dialect):\n        \"\"\"ORDER BY \u200b\u7f16\u8bd1\u200b\"\"\"\n        sql = text(\"\"\"\n            SELECT * FROM users\n            ORDER BY age DESC, name ASC\n        \"\"\")\n        compiler = CouchDBCompiler(dialect, sql)\n        mango = compiler.visit_select(sql)\n\n        assert mango['sort'] == [\n            {\"age\": \"desc\"},\n            {\"name\": \"asc\"}\n        ]\n</code></pre>"},{"location":"dev/testing/#test_syncpy","title":"test_sync.py","text":"<p>\u200b\u6d4b\u8bd5\u200b\u540c\u6b65\u64cd\u4f5c\u200b\u3002</p> <pre><code>class TestSyncCRUD:\n    \"\"\"\u200b\u540c\u6b65\u200b CRUD \u200b\u6d4b\u8bd5\u200b\"\"\"\n\n    @pytest.fixture\n    def engine(self):\n        \"\"\"\u200b\u521b\u5efa\u200b\u6d4b\u8bd5\u200b\u5f15\u64ce\u200b\"\"\"\n        engine = create_engine('couchdb://admin:password@localhost:5984/testdb')\n        yield engine\n        engine.dispose()\n\n    def test_insert(self, engine):\n        \"\"\"\u200b\u63d2\u5165\u200b\u6d4b\u8bd5\u200b\"\"\"\n        with engine.connect() as conn:\n            conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id, :name, :age, 'user')\n            \"\"\"), {\n                'id': 'test:user:1',\n                'name': 'Test User',\n                'age': 30\n            })\n            conn.commit()\n\n        # \u200b\u9a8c\u8bc1\u200b\u63d2\u5165\u200b\n        with engine.connect() as conn:\n            result = conn.execute(text(\"\"\"\n                SELECT * FROM users WHERE _id = 'test:user:1'\n            \"\"\"))\n            row = result.fetchone()\n            assert row.name == 'Test User'\n            assert row.age == 30\n\n    def test_select(self, engine):\n        \"\"\"\u200b\u67e5\u8be2\u200b\u6d4b\u8bd5\u200b\"\"\"\n        # \u200b\u5148\u200b\u63d2\u5165\u200b\u6570\u636e\u200b\n        self.test_insert(engine)\n\n        # \u200b\u67e5\u8be2\u200b\n        with engine.connect() as conn:\n            result = conn.execute(text(\"\"\"\n                SELECT * FROM users WHERE type = 'user'\n            \"\"\"))\n\n            rows = result.fetchall()\n            assert len(rows) &gt; 0\n            assert rows[0].name == 'Test User'\n\n    def test_update(self, engine):\n        \"\"\"\u200b\u66f4\u65b0\u200b\u6d4b\u8bd5\u200b\"\"\"\n        # \u200b\u5148\u200b\u63d2\u5165\u200b\u6570\u636e\u200b\n        self.test_insert(engine)\n\n        # \u200b\u66f4\u65b0\u200b\n        with engine.connect() as conn:\n            result = conn.execute(text(\"\"\"\n                UPDATE users\n                SET age = :age\n                WHERE _id = :id AND type = 'user'\n                RETURNING *\n            \"\"\"), {\n                'id': 'test:user:1',\n                'age': 31\n            })\n\n            updated_row = result.fetchone()\n            assert updated_row.age == 31\n            conn.commit()\n\n    def test_delete(self, engine):\n        \"\"\"\u200b\u5220\u9664\u200b\u6d4b\u8bd5\u200b\"\"\"\n        # \u200b\u5148\u200b\u63d2\u5165\u200b\u6570\u636e\u200b\n        self.test_insert(engine)\n\n        # \u200b\u5220\u9664\u200b\n        with engine.connect() as conn:\n            conn.execute(text(\"\"\"\n                DELETE FROM users\n                WHERE _id = :id AND type = 'user'\n            \"\"\"), {\n                'id': 'test:user:1'\n            })\n            conn.commit()\n\n        # \u200b\u9a8c\u8bc1\u200b\u5220\u9664\u200b\n        with engine.connect() as conn:\n            result = conn.execute(text(\"\"\"\n                SELECT * FROM users WHERE _id = 'test:user:1'\n            \"\"\"))\n            assert result.rowcount == 0\n</code></pre>"},{"location":"dev/testing/#test_asyncpy","title":"test_async.py","text":"<p>\u200b\u6d4b\u8bd5\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u3002</p> <pre><code>class TestAsyncCRUD:\n    \"\"\"\u200b\u5f02\u6b65\u200b CRUD \u200b\u6d4b\u8bd5\u200b\"\"\"\n\n    @pytest.fixture\n    async def engine(self):\n        \"\"\"\u200b\u521b\u5efa\u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b\u5f15\u64ce\u200b\"\"\"\n        engine = create_async_engine('couchdb+async://admin:password@localhost:5984/testdb')\n        yield engine\n        await engine.dispose()\n\n    @pytest.mark.asyncio\n    async def test_async_insert(self, engine):\n        \"\"\"\u200b\u5f02\u6b65\u200b\u63d2\u5165\u200b\u6d4b\u8bd5\u200b\"\"\"\n        async with engine.connect() as conn:\n            await conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id, :name, :age, 'user')\n            \"\"\"), {\n                'id': 'async:user:1',\n                'name': 'Async User',\n                'age': 25\n            })\n            await conn.commit()\n\n    @pytest.mark.asyncio\n    async def test_async_select(self, engine):\n        \"\"\"\u200b\u5f02\u6b65\u200b\u67e5\u8be2\u200b\u6d4b\u8bd5\u200b\"\"\"\n        # \u200b\u5148\u200b\u63d2\u5165\u200b\n        await self.test_async_insert(engine)\n\n        # \u200b\u67e5\u8be2\u200b\n        async with engine.connect() as conn:\n            result = await conn.execute(text(\"\"\"\n                SELECT * FROM users WHERE type = 'user'\n            \"\"\"))\n\n            # \u200b\u6ce8\u610f\u200b\uff1a\u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\n            rows = result.fetchall()\n            assert len(rows) &gt; 0\n            assert rows[0].name == 'Async User'\n\n    @pytest.mark.asyncio\n    async def test_concurrent_queries(self, engine):\n        \"\"\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u6d4b\u8bd5\u200b\"\"\"\n        async with engine.connect() as conn:\n            # \u200b\u5e76\u53d1\u200b\u6267\u884c\u200b\u591a\u4e2a\u200b\u67e5\u8be2\u200b\n            tasks = [\n                conn.execute(text(\"SELECT * FROM users WHERE type = 'user' AND age &gt; :age\"), {'age': 20}),\n                conn.execute(text(\"SELECT * FROM users WHERE type = 'user' AND age &lt; :age\"), {'age': 30}),\n            ]\n\n            results = await asyncio.gather(*tasks)\n\n            assert len(results) == 2\n            assert results[0].rowcount &gt;= 0\n            assert results[1].rowcount &gt;= 0\n</code></pre>"},{"location":"dev/testing/#conftestpy","title":"conftest.py","text":"<p>\u200b\u5168\u5c40\u200b\u6d4b\u8bd5\u200b\u914d\u7f6e\u200b\u3002</p> <pre><code>import pytest\nfrom sqlalchemy import create_engine\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\n@pytest.fixture(scope='session')\ndef couchdb_url():\n    \"\"\"CouchDB \u200b\u8fde\u63a5\u200b URL\"\"\"\n    return 'couchdb://admin:password@localhost:5984/testdb'\n\n@pytest.fixture\ndef engine(couchdb_url):\n    \"\"\"\u200b\u540c\u6b65\u200b\u5f15\u64ce\u200b\"\"\"\n    engine = create_engine(couchdb_url)\n    yield engine\n    engine.dispose()\n\n@pytest.fixture\nasync def async_engine(couchdb_url):\n    \"\"\"\u200b\u5f02\u6b65\u200b\u5f15\u64ce\u200b\"\"\"\n    engine = create_async_engine(couchdb_url.replace('couchdb://', 'couchdb+async://'))\n    yield engine\n    await engine.dispose()\n\n@pytest.fixture\ndef dialect(engine):\n    \"\"\"\u200b\u65b9\u8a00\u200b\u5b9e\u4f8b\u200b\"\"\"\n    return engine.dialect\n\n@pytest.fixture(scope='session', autouse=True)\ndef setup_database():\n    \"\"\"\u200b\u8bbe\u7f6e\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\"\"\"\n    import httpx\n\n    # \u200b\u6e05\u7406\u200b\u73b0\u6709\u200b\u6570\u636e\u200b\n    try:\n        with httpx.Client() as client:\n            # \u200b\u5220\u9664\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\uff08\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\uff09\n            client.delete('http://admin:password@localhost:5984/testdb')\n    except:\n        pass\n\n    # \u200b\u521b\u5efa\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\n    with httpx.Client() as client:\n        client.put('http://admin:password@localhost:5984/testdb')\n\n    yield\n\n    # \u200b\u6e05\u7406\u200b\n    try:\n        with httpx.Client() as client:\n            client.delete('http://admin:password@localhost:5984/testdb')\n    except:\n        pass\n</code></pre>"},{"location":"dev/testing/#_12","title":"\u7f16\u5199\u200b\u6d4b\u8bd5","text":""},{"location":"dev/testing/#_13","title":"\u7f16\u5199\u200b\u65b0\u200b\u6d4b\u8bd5","text":"<ol> <li>\u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b:</li> <li>\u200b\u7f16\u8bd1\u5668\u200b\u6d4b\u8bd5\u200b \u2192 <code>test_compiler.py</code></li> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b \u2192 <code>test_sync.py</code></li> <li> <p>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b \u2192 <code>test_async.py</code></p> </li> <li> <p>\u200b\u4f7f\u7528\u200b\u6d4b\u8bd5\u200b\u7c7b\u200b\u7ec4\u7ec7\u200b: <pre><code>class TestYourFeature:\n    \"\"\"\u200b\u4f60\u200b\u7684\u200b\u529f\u80fd\u6d4b\u8bd5\u200b\"\"\"\n\n    def test_something(self):\n        \"\"\"\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\"\"\"\n        # Arrange\n        ...\n\n        # Act\n        ...\n\n        # Assert\n        assert ...\n</code></pre></p> </li> <li> <p>\u200b\u4f7f\u7528\u200b pytest fixtures: <pre><code>class TestYourFeature:\n    def test_with_fixture(self, engine, dialect):\n        \"\"\"\u200b\u4f7f\u7528\u200b fixtures\"\"\"\n        ...\n</code></pre></p> </li> </ol>"},{"location":"dev/testing/#_14","title":"\u6d4b\u8bd5\u200b\u6700\u4f73\u200b\u5b9e\u8df5","text":""},{"location":"dev/testing/#1_1","title":"1. \u200b\u72ec\u7acb\u200b\u6d4b\u8bd5","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u6d4b\u8bd5\u200b\u72ec\u7acb\u200b\ndef test_insert(self, engine):\n    with engine.connect() as conn:\n        conn.execute(text(\"...\"), data)\n        conn.commit()\n\n    # \u200b\u9a8c\u8bc1\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u6d4b\u8bd5\u200b\u4e2d\u200b\n    with engine.connect() as conn:\n        result = conn.execute(text(\"...\"))\n        assert result.rowcount &gt; 0\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u4f9d\u8d56\u200b\u5176\u4ed6\u200b\u6d4b\u8bd5\u200b\ndef test_insert(self, engine):\n    # \u200b\u5047\u8bbe\u200b\u6d4b\u8bd5\u200b\u5df2\u7ecf\u200b\u8fd0\u884c\u200b\n    result = conn.execute(text(\"...\"))\n</code></pre>"},{"location":"dev/testing/#2","title":"2. \u200b\u6e05\u7406\u200b\u6570\u636e","text":"<pre><code>class TestCleanup:\n    def test_with_cleanup(self, engine):\n        user_id = 'test:cleanup:1'\n        try:\n            # \u200b\u6d4b\u8bd5\u200b\u64cd\u4f5c\u200b\n            with engine.connect() as conn:\n                conn.execute(text(\"INSERT INTO ...\"), {'id': user_id})\n                conn.commit()\n        finally:\n            # \u200b\u6e05\u7406\u200b\n            with engine.connect() as conn:\n                conn.execute(text(\"DELETE FROM users WHERE _id = :id\"), {'id': user_id})\n                conn.commit()\n</code></pre>"},{"location":"dev/testing/#3_1","title":"3. \u200b\u53c2\u6570\u200b\u5316\u200b\u6d4b\u8bd5","text":"<pre><code>@pytest.mark.parametrize(\"age,expected_count\", [\n    (25, 1),\n    (30, 2),\n    (35, 0),\n])\ndef test_age_filter(self, engine, age, expected_count):\n    # \u200b\u5148\u200b\u63d2\u5165\u200b\u6d4b\u8bd5\u6570\u636e\u200b\n    ...\n\n    # \u200b\u67e5\u8be2\u200b\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT * FROM users WHERE age &gt; :age\n        \"\"\"), {'age': age})\n        assert result.rowcount == expected_count\n</code></pre>"},{"location":"dev/testing/#4","title":"4. \u200b\u4f7f\u7528\u200b\u6807\u8bb0","text":"<pre><code>import pytest\n\nclass TestYourFeature:\n    @pytest.mark.unit\n    def test_compiler(self, dialect):\n        \"\"\"\u200b\u5355\u5143\u6d4b\u8bd5\u200b\uff1a\u200b\u7f16\u8bd1\u5668\u200b\"\"\"\n        ...\n\n    @pytest.mark.integration\n    def test_real_operation(self, engine):\n        \"\"\"\u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\uff1a\u200b\u771f\u5b9e\u200b\u64cd\u4f5c\u200b\"\"\"\n        ...\n\n    @pytest.mark.slow\n    def test_performance(self, engine):\n        \"\"\"\u200b\u6162\u901f\u200b\u6d4b\u8bd5\u200b\uff1a\u200b\u6027\u80fd\u200b\"\"\"\n        ...\n</code></pre>"},{"location":"dev/testing/#_15","title":"\u4ee3\u7801\u200b\u8986\u76d6\u7387","text":""},{"location":"dev/testing/#_16","title":"\u751f\u6210\u200b\u8986\u76d6\u7387\u200b\u62a5\u544a","text":"<pre><code># HTML \u200b\u62a5\u544a\u200b\npytest --cov=sqlalchemy_couchdb --cov-report=html\n\n# \u200b\u7ec8\u7aef\u200b\u62a5\u544a\u200b\npytest --cov=sqlalchemy_couchdb --cov-report=term-missing\n\n# \u200b\u5e26\u200b\u8be6\u7ec6\u200b\u8f93\u51fa\u200b\npytest --cov=sqlalchemy_couchdb --cov-report=term-missing --cov-report=html --cov-append\n</code></pre>"},{"location":"dev/testing/#_17","title":"\u67e5\u770b\u200b\u8986\u76d6\u7387","text":"<pre><code># \u200b\u6253\u5f00\u200b HTML \u200b\u62a5\u544a\u200b\nopen htmlcov/index.html  # macOS\nxdg-open htmlcov/index.html  # Linux\nstart htmlcov/index.html  # Windows\n</code></pre>"},{"location":"dev/testing/#_18","title":"\u8986\u76d6\u7387\u200b\u76ee\u6807","text":"<ul> <li>\u200b\u5f53\u524d\u200b\u8986\u76d6\u7387\u200b: 64%</li> <li>\u200b\u76ee\u6807\u200b\u8986\u76d6\u7387\u200b: 80%+</li> <li>\u200b\u65b0\u200b\u4ee3\u7801\u200b: \u200b\u5fc5\u987b\u200b\u8fbe\u5230\u200b 90%+</li> </ul>"},{"location":"dev/testing/#_19","title":"\u6027\u80fd\u200b\u6d4b\u8bd5","text":""},{"location":"dev/testing/#_20","title":"\u57fa\u51c6\u200b\u6d4b\u8bd5","text":"<pre><code>import time\nfrom contextlib import contextmanager\n\n@contextmanager\ndef timer():\n    \"\"\"\u200b\u8ba1\u65f6\u5668\u200b\"\"\"\n    start = time.time()\n    yield\n    elapsed = time.time() - start\n    print(f\"\u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n\nclass TestPerformance:\n    def test_bulk_insert_performance(self, engine):\n        \"\"\"\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\"\"\"\n        data = [{'id': f'perf:{i}', 'name': f'User{i}', 'type': 'user'}\n                for i in range(1000)]\n\n        with timer():\n            with engine.connect() as conn:\n                conn.execute(text(\"\"\"\n                    INSERT INTO users (_id, name, type)\n                    VALUES (:id, :name, 'user')\n                \"\"\"), data)\n                conn.commit()\n\n        # \u200b\u9a8c\u8bc1\u200b\u6027\u80fd\u200b\uff1a1000 \u200b\u6761\u200b\u8bb0\u5f55\u200b &lt; 2 \u200b\u79d2\u200b\n        # assert elapsed &lt; 2.0\n</code></pre>"},{"location":"dev/testing/#_21","title":"\u5185\u5b58\u200b\u6d4b\u8bd5","text":"<pre><code>import psutil\nimport os\n\nclass TestMemory:\n    def test_memory_usage(self, engine):\n        \"\"\"\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u6d4b\u8bd5\u200b\"\"\"\n        process = psutil.Process(os.getpid())\n        initial_memory = process.memory_info().rss\n\n        # \u200b\u6267\u884c\u200b\u5927\u91cf\u200b\u64cd\u4f5c\u200b\n        for i in range(10000):\n            with engine.connect() as conn:\n                conn.execute(text(\"INSERT INTO ...\"), data)\n                conn.commit()\n\n        final_memory = process.memory_info().rss\n        memory_increase = (final_memory - initial_memory) / 1024 / 1024  # MB\n\n        # \u200b\u5185\u5b58\u200b\u589e\u957f\u200b &lt; 100MB\n        assert memory_increase &lt; 100\n</code></pre>"},{"location":"dev/testing/#_22","title":"\u6301\u7eed\u200b\u96c6\u6210","text":""},{"location":"dev/testing/#github-actions","title":"GitHub Actions \u200b\u914d\u7f6e","text":"<pre><code># .github/workflows/test.yml\nname: Test\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        python-version: ['3.11', '3.12']\n\n    services:\n      couchdb:\n        image: couchdb:3\n        ports:\n          - 5984:5984\n        env:\n          COUCHDB_USER: admin\n          COUCHDB_PASSWORD: password\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Set up Python ${{ matrix.python-version }}\n        uses: actions/setup-python@v4\n        with:\n          python-version: ${{ matrix.python-version }}\n\n      - name: Install dependencies\n        run: |\n          pip install -e \".[dev]\"\n\n      - name: Create test database\n        run: |\n          sleep 5\n          curl -X PUT http://admin:password@localhost:5984/testdb\n\n      - name: Run tests\n        run: |\n          pytest tests/ --cov=sqlalchemy_couchdb --cov-report=xml\n\n      - name: Upload coverage\n        uses: codecov/codecov-action@v3\n        with:\n          file: ./coverage.xml\n</code></pre>"},{"location":"dev/testing/#_23","title":"\u6545\u969c\u200b\u6392\u9664","text":""},{"location":"dev/testing/#_24","title":"\u5e38\u89c1\u200b\u6d4b\u8bd5\u200b\u5931\u8d25","text":""},{"location":"dev/testing/#1_2","title":"1. \u200b\u8fde\u63a5\u200b\u5931\u8d25","text":"<pre><code># \u200b\u9519\u8bef\u200b: \u200b\u65e0\u6cd5\u200b\u8fde\u63a5\u200b\u5230\u200b CouchDB\n# \u200b\u89e3\u51b3\u200b: \u200b\u786e\u4fdd\u200b CouchDB \u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\ndocker ps\ncurl http://localhost:5984/\n</code></pre>"},{"location":"dev/testing/#2_1","title":"2. \u200b\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728","text":"<pre><code># \u200b\u9519\u8bef\u200b: \u200b\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728\u200b\n# \u200b\u89e3\u51b3\u200b: \u200b\u521b\u5efa\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\ncurl -X PUT http://admin:password@localhost:5984/testdb\n</code></pre>"},{"location":"dev/testing/#3_2","title":"3. \u200b\u6d4b\u8bd5\u6570\u636e\u200b\u6b8b\u7559","text":"<pre><code># \u200b\u9519\u8bef\u200b: \u200b\u6d4b\u8bd5\u6570\u636e\u200b\u51b2\u7a81\u200b\n# \u200b\u89e3\u51b3\u200b: \u200b\u6e05\u7406\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\ncurl -X DELETE http://admin:password@localhost:5984/testdb\ncurl -X PUT http://admin:password@localhost:5984/testdb\n</code></pre>"},{"location":"dev/testing/#4_1","title":"4. \u200b\u7aef\u53e3\u200b\u5360\u7528","text":"<pre><code># \u200b\u9519\u8bef\u200b: \u200b\u7aef\u53e3\u200b 5984 \u200b\u5df2\u200b\u88ab\u200b\u5360\u7528\u200b\n# \u200b\u89e3\u51b3\u200b: \u200b\u505c\u6b62\u200b\u73b0\u6709\u200b\u670d\u52a1\u200b\u6216\u200b\u4f7f\u7528\u200b\u5176\u4ed6\u200b\u7aef\u53e3\u200b\nlsof -i :5984\ndocker stop couchdb\n</code></pre>"},{"location":"dev/testing/#_25","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u4ee3\u7801\u200b\u89c4\u8303\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b</li> <li>\u200b\u8d21\u732e\u200b\u6307\u5357\u200b</li> </ul>"},{"location":"examples/","title":"\u793a\u4f8b\u200b\u96c6\u5408","text":""},{"location":"examples/#_2","title":"\u6982\u8ff0","text":"<p>\u200b\u672c\u200b\u76ee\u5f55\u200b\u5305\u542b\u200b SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u7684\u200b\u5b8c\u6574\u200b\u793a\u4f8b\u200b\uff0c\u200b\u6db5\u76d6\u200b\u4ece\u200b\u57fa\u7840\u200b\u7528\u6cd5\u200b\u5230\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u7684\u200b\u5404\u79cd\u200b\u573a\u666f\u200b\u3002</p>"},{"location":"examples/#_3","title":"\u793a\u4f8b\u200b\u5217\u8868","text":""},{"location":"examples/#_4","title":"\u57fa\u7840\u200b\u793a\u4f8b","text":""},{"location":"examples/#1","title":"1. \u200b\u57fa\u7840\u200b\u540c\u6b65\u64cd\u4f5c","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/basic_sync.py</code></p> <p>\u200b\u6f14\u793a\u200b\u57fa\u672c\u200b\u7684\u200b\u540c\u6b65\u200b CRUD \u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>\u200b\u8fde\u63a5\u200b CouchDB</li> <li>\u200b\u63d2\u5165\u200b\u6587\u6863\u200b</li> <li>\u200b\u67e5\u8be2\u200b\u6587\u6863\u200b</li> <li>\u200b\u66f4\u65b0\u200b\u6587\u6863\u200b</li> <li>\u200b\u5220\u9664\u200b\u6587\u6863\u200b</li> </ul> <pre><code>from sqlalchemy import create_engine, text\n\n# \u200b\u521b\u5efa\u200b\u5f15\u64ce\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u200b\u4f7f\u7528\u200b\u8fde\u63a5\u200b\nwith engine.connect() as conn:\n    # \u200b\u63d2\u5165\u200b\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, type)\n        VALUES (:id, :name, :age, 'user')\n    \"\"\"), {\n        'id': 'user:1',\n        'name': 'Alice',\n        'age': 30\n    })\n\n    # \u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"SELECT * FROM users WHERE type = 'user'\"))\n    for row in result:\n        print(f\"{row.name}: {row.age}\")\n\n    conn.commit()\n</code></pre> <p>\u200b\u8fd0\u884c\u200b\u65b9\u5f0f\u200b: <pre><code>python examples/basic_sync.py\n</code></pre></p>"},{"location":"examples/#2","title":"2. \u200b\u57fa\u7840\u200b\u5f02\u6b65\u200b\u64cd\u4f5c","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/basic_async.py</code></p> <p>\u200b\u6f14\u793a\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>\u200b\u521b\u5efa\u200b\u5f02\u6b65\u200b\u5f15\u64ce\u200b</li> <li>\u200b\u5f02\u6b65\u200b CRUD \u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b</li> </ul> <pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def main():\n    # \u200b\u521b\u5efa\u200b\u5f02\u6b65\u200b\u5f15\u64ce\u200b\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        # \u200b\u63d2\u5165\u200b\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, type)\n            VALUES (:id, :name, :age, 'user')\n        \"\"\"), {\n            'id': 'user:async:1',\n            'name': 'Bob Async',\n            'age': 25\n        })\n\n        # \u200b\u67e5\u8be2\u200b\n        result = await conn.execute(text(\"\"\"\n            SELECT * FROM users WHERE type = 'user'\n        \"\"\"))\n\n        # \u200b\u6ce8\u610f\u200b\uff1a\u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\uff08\u200b\u7ed3\u679c\u200b\u5df2\u200b\u7f13\u5b58\u200b\uff09\n        for row in result:\n            print(f\"{row.name}: {row.age}\")\n\n        await conn.commit()\n\n    await engine.dispose()\n\nasyncio.run(main())\n</code></pre> <p>\u200b\u8fd0\u884c\u200b\u65b9\u5f0f\u200b: <pre><code>python examples/basic_async.py\n</code></pre></p>"},{"location":"examples/#3","title":"3. \u200b\u5b8c\u6574\u200b\u793a\u4f8b","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/async_example.py</code></p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u5f02\u6b65\u200b\u5e94\u7528\u200b\u793a\u4f8b\u200b\uff1a</p> <ul> <li>\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b</li> <li>\u200b\u4e8b\u52a1\u7ba1\u7406\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b</li> </ul>"},{"location":"examples/#_5","title":"\u9ad8\u7ea7\u200b\u793a\u4f8b","text":""},{"location":"examples/#1_1","title":"1. \u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u6f14\u793a","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/advanced_features.py</code></p> <p>\u200b\u6f14\u793a\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u6761\u4ef6\u200b</li> <li>\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u7d22\u5f15\u200b\u4f18\u5316\u200b</li> <li>\u200b\u6027\u80fd\u200b\u76d1\u63a7\u200b</li> </ul> <pre><code>from sqlalchemy import text\nfrom datetime import datetime\n\n# \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n      AND age &gt; 25\n      AND age &lt; 35\n      AND name LIKE 'A%'\n    ORDER BY age DESC\n    LIMIT 10\n\"\"\"))\n\n# \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\nusers_data = [\n    {'id': f'user:{i}', 'name': f'User{i}', 'age': 20 + i, 'type': 'user'}\n    for i in range(100)\n]\n\nconn.execute(text(\"\"\"\n    INSERT INTO users (_id, name, age, type)\n    VALUES (:id, :name, :age, 'user')\n\"\"\"), users_data)\n\nconn.commit()\n</code></pre>"},{"location":"examples/#2_1","title":"2. \u200b\u6027\u80fd\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/performance_benchmark.py</code></p> <p>\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u548c\u200b\u57fa\u51c6\u200b\uff1a</p> <ul> <li>CRUD \u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b</li> <li>\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b</li> <li>\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b</li> <li>\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u6d4b\u8bd5\u200b</li> </ul> <pre><code>import time\nfrom contextlib import contextmanager\n\n@contextmanager\ndef timer():\n    start = time.time()\n    yield\n    elapsed = time.time() - start\n    print(f\"\u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n\n# \u200b\u6d4b\u8bd5\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\nwith timer():\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, type)\n        VALUES (:id, :name, :age, 'user')\n    \"\"\"), users_data)\n    conn.commit()\n\nprint(f\"\u200b\u63d2\u5165\u200b {len(users_data)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u541e\u5410\u91cf\u200b: {len(users_data)/elapsed:.1f} docs/s\")\n</code></pre>"},{"location":"examples/#orm","title":"ORM \u200b\u793a\u4f8b","text":""},{"location":"examples/#1_2","title":"1. \u200b\u58f0\u660e\u200b\u5f0f\u200b\u6a21\u578b","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/orm_example.py</code></p> <p>\u200b\u6ce8\u610f\u200b: ORM \u200b\u652f\u6301\u200b\u5c06\u200b\u5728\u200b Phase 3 \u200b\u4e2d\u200b\u5b9e\u73b0\u200b</p> <pre><code>from sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy import Column, String, Integer\nfrom sqlalchemy_couchdb.types import CouchDBString, CouchDBInteger\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = 'users'\n\n    _id = Column(String, primary_key=True)\n    name = Column(CouchDBString(255))\n    age = Column(CouchDBInteger())\n    type = Column(CouchDBString(50))\n\n# \u200b\u4f7f\u7528\u200b ORM\nuser = User(_id='user:orm:1', name='ORM User', age=30, type='user')\nsession.add(user)\nsession.commit()\n</code></pre>"},{"location":"examples/#phase-2","title":"Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u793a\u4f8b","text":""},{"location":"examples/#1_3","title":"1. \u200b\u667a\u80fd\u200b\u67e5\u8be2\u200b\u8def\u7531","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/hybrid_routing.py</code></p> <p>\u200b\u6ce8\u610f\u200b: \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u5c06\u200b\u5728\u200b Phase 2 \u200b\u4e2d\u200b\u5b9e\u73b0\u200b</p> <pre><code>from sqlalchemy import create_engine\n\n# \u200b\u521b\u5efa\u200b\u6df7\u5408\u200b\u5f15\u64ce\u200b\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n)\n\n# \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users WHERE age &gt; 25\n\"\"\"))\n\n# \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 PostgreSQL\nresult = conn.execute(text(\"\"\"\n    SELECT u.name, COUNT(o.id) as order_count\n    FROM users u\n    JOIN orders o ON u.id = o.user_id\n    GROUP BY u.name\n\"\"\"))\n</code></pre>"},{"location":"examples/#2_2","title":"2. \u200b\u53cc\u5199\u200b\u673a\u5236","text":"<p>\u200b\u6587\u4ef6\u200b: <code>examples/dual_write.py</code></p> <p>\u200b\u6f14\u793a\u200b\u53cc\u5199\u200b\u673a\u5236\u200b\uff1a</p> <ul> <li>\u200b\u540c\u65f6\u200b\u5199\u5165\u200b CouchDB \u200b\u548c\u200b PostgreSQL</li> <li>\u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b</li> </ul> <pre><code>from sqlalchemy import text\n\n# \u200b\u53cc\u5199\u200b\nwith engine.connect() as conn:\n    try:\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, type)\n            VALUES (:id, :name, :age, 'user')\n        \"\"\"), {\n            'id': 'user:dual:1',\n            'name': 'Dual Write User',\n            'age': 28\n        })\n\n        conn.commit()\n        print(\"\u2705 \u200b\u53cc\u5199\u200b\u6210\u529f\u200b\")\n\n    except Exception as e:\n        conn.rollback()\n        print(f\"\u274c \u200b\u53cc\u5199\u200b\u5931\u8d25\u200b: {e}\")\n</code></pre>"},{"location":"examples/#_6","title":"\u793a\u4f8b\u200b\u6570\u636e","text":""},{"location":"examples/#_7","title":"\u793a\u4f8b\u200b\u6570\u636e\u200b\u96c6","text":"<p>\u200b\u8fd0\u884c\u200b\u793a\u4f8b\u200b\u524d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u52a0\u8f7d\u200b\u793a\u4f8b\u200b\u6570\u636e\u200b\uff1a</p> <pre><code>python examples/load_sample_data.py\n</code></pre> <p>\u200b\u8fd9\u4f1a\u200b\u521b\u5efa\u200b\u5305\u542b\u200b\u4ee5\u4e0b\u200b\u6570\u636e\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\uff1a</p> <ul> <li>100 \u200b\u4e2a\u200b\u7528\u6237\u200b</li> <li>500 \u200b\u4e2a\u200b\u8ba2\u5355\u200b</li> <li>1000 \u200b\u4e2a\u200b\u4ea7\u54c1\u200b</li> </ul>"},{"location":"examples/#_8","title":"\u6e05\u7406\u200b\u793a\u4f8b\u200b\u6570\u636e","text":"<pre><code>python examples/cleanup_sample_data.py\n</code></pre>"},{"location":"examples/#_9","title":"\u6700\u4f73\u200b\u5b9e\u8df5\u200b\u793a\u4f8b","text":""},{"location":"examples/#1_4","title":"1. \u200b\u8fde\u63a5\u200b\u7ba1\u7406","text":"<p>\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b: \u200b\u4f7f\u7528\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668\u200b</p> <pre><code># \u2705 \u200b\u63a8\u8350\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"...\"))\n    conn.commit()\n\n# \u274c \u200b\u4e0d\u200b\u63a8\u8350\u200b\nconn = engine.connect()\nconn.execute(text(\"...\"))\nconn.commit()\nconn.close()\n</code></pre>"},{"location":"examples/#2_3","title":"2. \u200b\u9519\u8bef\u5904\u7406","text":"<p>\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b: \u200b\u6355\u83b7\u200b\u7279\u5b9a\u200b\u5f02\u5e38\u200b</p> <pre><code>from sqlalchemy_couchdb.exceptions import (\n    NotFoundError,\n    DocumentConflictError,\n    CouchDBError\n)\n\ntry:\n    conn.execute(text(\"UPDATE ...\"))\n    conn.commit()\nexcept NotFoundError:\n    print(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\nexcept DocumentConflictError:\n    print(\"\u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b\")\nexcept CouchDBError as e:\n    print(f\"CouchDB \u200b\u9519\u8bef\u200b: {e}\")\n</code></pre>"},{"location":"examples/#3_1","title":"3. \u200b\u6027\u80fd\u200b\u4f18\u5316","text":"<p>\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b: \u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b</p> <pre><code># \u2705 \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\ndata = [{...}, {...}, ...]\nconn.execute(text(\"INSERT INTO ...\"), data)\n\n# \u274c \u200b\u5faa\u73af\u200b\u63d2\u5165\u200b\nfor item in data:\n    conn.execute(text(\"INSERT INTO ...\"), item)\n</code></pre>"},{"location":"examples/#_10","title":"\u8fd0\u884c\u200b\u793a\u4f8b","text":""},{"location":"examples/#_11","title":"\u73af\u5883\u200b\u51c6\u5907","text":"<pre><code># 1. \u200b\u542f\u52a8\u200b CouchDB\ndocker run -d -p 5984:5984 \\\n  -e COUCHDB_USER=admin \\\n  -e COUCHDB_PASSWORD=password \\\n  couchdb:3\n\n# 2. \u200b\u521b\u5efa\u200b\u6570\u636e\u5e93\u200b\ncurl -X PUT http://admin:password@localhost:5984/examples\n\n# 3. \u200b\u5b89\u88c5\u200b\u4f9d\u8d56\u200b\npip install -e \".[dev]\"\n\n# 4. \u200b\u8fd0\u884c\u200b\u793a\u4f8b\u200b\npython examples/basic_sync.py\n</code></pre>"},{"location":"examples/#_12","title":"\u5b8c\u6574\u200b\u793a\u4f8b\u200b\u5217\u8868","text":"<pre><code># \u200b\u57fa\u7840\u200b\u793a\u4f8b\u200b\npython examples/basic_sync.py          # \u200b\u540c\u6b65\u64cd\u4f5c\u200b\npython examples/basic_async.py         # \u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\npython examples/async_example.py       # \u200b\u5b8c\u6574\u200b\u5f02\u6b65\u200b\u793a\u4f8b\u200b\n\n# \u200b\u9ad8\u7ea7\u200b\u793a\u4f8b\u200b\npython examples/advanced_features.py   # \u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\npython examples/performance_benchmark.py  # \u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\n\n# \u200b\u6570\u636e\u7ba1\u7406\u200b\npython examples/load_sample_data.py    # \u200b\u52a0\u8f7d\u200b\u793a\u4f8b\u200b\u6570\u636e\u200b\npython examples/cleanup_sample_data.py # \u200b\u6e05\u7406\u200b\u793a\u4f8b\u200b\u6570\u636e\u200b\n\n# Phase 2 \u200b\u793a\u4f8b\u200b\uff08\u200b\u5f00\u53d1\u200b\u4e2d\u200b\uff09\npython examples/hybrid_routing.py      # \u200b\u667a\u80fd\u200b\u8def\u7531\u200b\npython examples/dual_write.py          # \u200b\u53cc\u5199\u200b\u673a\u5236\u200b\n</code></pre>"},{"location":"examples/#_13","title":"\u81ea\u5b9a\u4e49\u200b\u793a\u4f8b","text":""},{"location":"examples/#_14","title":"\u521b\u5efa\u200b\u81ea\u5df1\u200b\u7684\u200b\u793a\u4f8b","text":"<ol> <li>\u200b\u5728\u200b <code>examples/</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u65b0\u200b\u6587\u4ef6\u200b</li> <li>\u200b\u9075\u5faa\u200b\u547d\u540d\u200b\u89c4\u8303\u200b\uff1a<code>feature_example.py</code></li> <li>\u200b\u6dfb\u52a0\u200b\u6e05\u6670\u200b\u7684\u200b\u6ce8\u91ca\u200b\u548c\u200b\u6587\u6863\u200b</li> <li>\u200b\u5305\u542b\u200b\u9519\u8bef\u5904\u7406\u200b</li> <li>\u200b\u4fdd\u6301\u200b\u4ee3\u7801\u200b\u7b80\u6d01\u200b</li> </ol>"},{"location":"examples/#_15","title":"\u793a\u4f8b\u200b\u6a21\u677f","text":"<pre><code>\"\"\"\n\u200b\u793a\u4f8b\u200b: \u200b\u529f\u80fd\u200b\u63cf\u8ff0\u200b\n\n\u200b\u6b64\u200b\u793a\u4f8b\u200b\u6f14\u793a\u200b...\n\"\"\"\n\nfrom sqlalchemy import create_engine, text\n\ndef main():\n    \"\"\"\u200b\u4e3b\u200b\u51fd\u6570\u200b\"\"\"\n    # \u200b\u8fde\u63a5\u200b\n    engine = create_engine('couchdb://localhost:5984/examples')\n\n    with engine.connect() as conn:\n        try:\n            # \u200b\u64cd\u4f5c\u200b\n            conn.execute(text(\"...\"))\n            conn.commit()\n            print(\"\u2705 \u200b\u6210\u529f\u200b\")\n\n        except Exception as e:\n            conn.rollback()\n            print(f\"\u274c \u200b\u9519\u8bef\u200b: {e}\")\n\nif __name__ == '__main__':\n    main()\n</code></pre>"},{"location":"examples/#_16","title":"\u8d21\u732e\u200b\u793a\u4f8b","text":"<p>\u200b\u6b22\u8fce\u200b\u63d0\u4ea4\u200b\u793a\u4f8b\u200b\uff01</p>"},{"location":"examples/#_17","title":"\u63d0\u4ea4\u200b\u6d41\u7a0b","text":"<ol> <li>Fork \u200b\u9879\u76ee\u200b</li> <li>\u200b\u521b\u5efa\u200b\u793a\u4f8b\u200b\u6587\u4ef6\u200b</li> <li>\u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b\u786e\u4fdd\u200b\u793a\u4f8b\u200b\u5de5\u4f5c\u200b</li> <li>\u200b\u63d0\u4ea4\u200b Pull Request</li> </ol>"},{"location":"examples/#_18","title":"\u793a\u4f8b\u200b\u8981\u6c42","text":"<ul> <li>\u200b\u4ee3\u7801\u200b\u6e05\u6670\u200b\u53ef\u200b\u8bfb\u200b</li> <li>\u200b\u5305\u542b\u200b\u8be6\u7ec6\u200b\u6ce8\u91ca\u200b</li> <li>\u200b\u6709\u200b\u9519\u8bef\u5904\u7406\u200b</li> <li>\u200b\u9075\u5faa\u200b\u9879\u76ee\u200b\u4ee3\u7801\u200b\u89c4\u8303\u200b</li> <li>\u200b\u5728\u200b\u6587\u6863\u200b\u4e2d\u200b\u5f15\u7528\u200b</li> </ul>"},{"location":"examples/#_19","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u5feb\u901f\u200b\u5f00\u59cb\u200b</li> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b\u6307\u5357\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6307\u5357\u200b</li> <li>API \u200b\u53c2\u8003\u200b</li> </ul>"},{"location":"examples/advanced-features/","title":"\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u793a\u4f8b","text":""},{"location":"examples/advanced-features/#_2","title":"\u6982\u8ff0","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u5c55\u793a\u200b SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u7684\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u548c\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b\u3002</p>"},{"location":"examples/advanced-features/#_3","title":"\u76ee\u5f55","text":"<ol> <li>\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b</li> <li>\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u4e8b\u52a1\u7ba1\u7406\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b</li> <li>\u200b\u5e76\u53d1\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u76d1\u63a7\u200b\u548c\u200b\u65e5\u5fd7\u200b</li> </ol>"},{"location":"examples/advanced-features/#_4","title":"\u590d\u6742\u200b\u67e5\u8be2","text":""},{"location":"examples/advanced-features/#1","title":"1. \u200b\u591a\u200b\u6761\u4ef6\u200b\u67e5\u8be2","text":"<pre><code>from sqlalchemy import text\n\ndef complex_where_query(engine):\n    \"\"\"\u200b\u590d\u6742\u200b WHERE \u200b\u6761\u4ef6\u200b\u67e5\u8be2\u200b\"\"\"\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user'\n              AND age &gt; 25\n              AND age &lt; 40\n              AND (status = 'active' OR status = 'pending')\n              AND name IN ('Alice', 'Bob', 'Charlie')\n            ORDER BY age DESC, name ASC\n            LIMIT 20\n        \"\"\"))\n\n        users = result.fetchall()\n        print(f\"\u200b\u627e\u5230\u200b {len(users)} \u200b\u4e2a\u200b\u7528\u6237\u200b\")\n\n        for user in users:\n            print(f\"{user.name} ({user.age} \u200b\u5c81\u200b) - {user.status}\")\n\n        return users\n</code></pre>"},{"location":"examples/advanced-features/#2","title":"2. \u200b\u5206\u9875\u200b\u67e5\u8be2","text":"<pre><code>def paginated_query(engine, page=1, page_size=10):\n    \"\"\"\u200b\u5206\u9875\u200b\u67e5\u8be2\u200b\"\"\"\n    offset = (page - 1) * page_size\n\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user'\n            ORDER BY _id\n            LIMIT :limit\n            OFFSET :offset\n        \"\"\"), {\n            'limit': page_size,\n            'offset': offset\n        })\n\n        users = result.fetchall()\n\n        # \u200b\u83b7\u53d6\u200b\u603b\u6570\u200b\uff08\u200b\u7528\u4e8e\u200b\u5206\u9875\u200b\u5bfc\u822a\u200b\uff09\n        count_result = conn.execute(text(\"\"\"\n            SELECT COUNT(*) as total\n            FROM users\n            WHERE type = 'user'\n        \"\"\"))\n\n        total = count_result.fetchone().total\n        total_pages = (total + page_size - 1) // page_size\n\n        print(f\"\u200b\u7b2c\u200b {page}/{total_pages} \u200b\u9875\u200b\uff0c\u200b\u6bcf\u9875\u200b {page_size} \u200b\u6761\u200b\uff0c\u200b\u5171\u200b {total} \u200b\u6761\u200b\")\n\n        return users, total, total_pages\n\n# \u200b\u4f7f\u7528\u200b\nusers, total, pages = paginated_query(engine, page=2, page_size=10)\n</code></pre>"},{"location":"examples/advanced-features/#3","title":"3. \u200b\u805a\u5408\u200b\u67e5\u8be2\u200b\uff08\u200b\u89c6\u56fe\u200b\uff09","text":"<pre><code>def aggregate_query(engine):\n    \"\"\"\u200b\u805a\u5408\u200b\u67e5\u8be2\u200b\uff08\u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b\uff09\"\"\"\n    with engine.connect() as conn:\n        # \u200b\u6ce8\u610f\u200b\uff1aCouchDB \u200b\u4e0d\u200b\u652f\u6301\u200b\u539f\u751f\u200b GROUP BY\n        # \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b MapReduce \u200b\u89c6\u56fe\u200b\n\n        # \u200b\u83b7\u53d6\u200b\u6240\u6709\u200b\u7528\u6237\u200b\n        users_result = conn.execute(text(\"\"\"\n            SELECT * FROM users WHERE type = 'user'\n        \"\"\"))\n\n        users = users_result.fetchall()\n\n        # \u200b\u5728\u200b\u5e94\u7528\u5c42\u200b\u805a\u5408\u200b\n        age_groups = {}\n        for user in users:\n            if user.age &lt; 20:\n                group = 'teen'\n            elif user.age &lt; 40:\n                group = 'adult'\n            else:\n                group = 'senior'\n\n            if group not in age_groups:\n                age_groups[group] = {'count': 0, 'total_age': 0}\n\n            age_groups[group]['count'] += 1\n            age_groups[group]['total_age'] += user.age\n\n        # \u200b\u8ba1\u7b97\u200b\u5e73\u5747\u503c\u200b\n        for group in age_groups:\n            data = age_groups[group]\n            data['avg_age'] = data['total_age'] / data['count']\n\n        print(\"\u200b\u5e74\u9f84\u7ec4\u200b\u7edf\u8ba1\u200b:\")\n        for group, data in age_groups.items():\n            print(f\"{group}: {data['count']} \u200b\u4eba\u200b\uff0c\u200b\u5e73\u5747\u5e74\u9f84\u200b {data['avg_age']:.1f}\")\n\n        return age_groups\n</code></pre>"},{"location":"examples/advanced-features/#_5","title":"\u6279\u91cf\u200b\u64cd\u4f5c","text":""},{"location":"examples/advanced-features/#1_1","title":"1. \u200b\u6279\u91cf\u200b\u63d2\u5165","text":"<pre><code>def batch_insert(engine, num_users=1000):\n    \"\"\"\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u7528\u6237\u200b\"\"\"\n    import uuid\n    from datetime import datetime\n\n    users_data = []\n    for i in range(num_users):\n        users_data.append({\n            'id': f'user:batch:{uuid.uuid4()}',\n            'name': f'User{i}',\n            'age': 20 + (i % 50),  # 20-69 \u200b\u5c81\u200b\n            'email': f'user{i}@example.com',\n            'status': 'active' if i % 3 == 0 else 'inactive',\n            'created_at': datetime.now().isoformat(),\n            'type': 'user'\n        })\n\n    import time\n    start = time.time()\n\n    with engine.connect() as conn:\n        # \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, email, status, created_at, type)\n            VALUES (:id, :name, :age, :email, :status, :created_at, 'user')\n        \"\"\"), users_data)\n\n        conn.commit()\n\n    elapsed = time.time() - start\n    throughput = num_users / elapsed\n\n    print(f\"\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b {num_users} \u200b\u7528\u6237\u200b\")\n    print(f\"\u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n    print(f\"\u200b\u541e\u5410\u91cf\u200b: {throughput:.1f} docs/s\")\n\n    return num_users, elapsed, throughput\n\n# \u200b\u4f7f\u7528\u200b\nbatch_insert(engine, 5000)\n</code></pre>"},{"location":"examples/advanced-features/#2_1","title":"2. \u200b\u6279\u91cf\u200b\u66f4\u65b0","text":"<pre><code>def batch_update(engine, min_age=30):\n    \"\"\"\u200b\u6279\u91cf\u200b\u66f4\u65b0\u200b\u7528\u6237\u200b\"\"\"\n    import time\n\n    # \u200b\u5148\u200b\u67e5\u8be2\u200b\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u7528\u6237\u200b\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT _id, _rev, age FROM users\n            WHERE type = 'user' AND age &gt; :min_age\n        \"\"\"), {'min_age': min_age})\n\n        users_to_update = result.fetchall()\n\n        print(f\"\u200b\u627e\u5230\u200b {len(users_to_update)} \u200b\u4e2a\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u66f4\u65b0\u200b\")\n\n        # \u200b\u6784\u5efa\u200b\u66f4\u65b0\u200b\u6587\u6863\u200b\n        update_docs = []\n        for user in users_to_update:\n            update_docs.append({\n                '_id': user._id,\n                '_rev': user._rev,\n                'status': 'senior',\n                'type': 'user'\n            })\n\n    start = time.time()\n\n    # \u200b\u6267\u884c\u200b\u6279\u91cf\u200b\u66f4\u65b0\u200b\n    from sqlalchemy_couchdb.client import SyncCouchDBClient\n    client = SyncCouchDBClient(\n        base_url='http://localhost:5984',\n        database='mydb'\n    )\n\n    results = client.bulk_docs(update_docs)\n\n    elapsed = time.time() - start\n    success_count = sum(1 for r in results if r.get('ok'))\n\n    print(f\"\u200b\u6279\u91cf\u200b\u66f4\u65b0\u200b\u5b8c\u6210\u200b\")\n    print(f\"\u200b\u6210\u529f\u200b: {success_count}/{len(users_to_update)}\")\n    print(f\"\u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n\n    return success_count\n\n# \u200b\u4f7f\u7528\u200b\nbatch_update(engine, min_age=30)\n</code></pre>"},{"location":"examples/advanced-features/#3_1","title":"3. \u200b\u6279\u91cf\u200b\u5220\u9664","text":"<pre><code>def batch_delete(engine, max_age=25):\n    \"\"\"\u200b\u6279\u91cf\u200b\u5220\u9664\u200b\u7528\u6237\u200b\"\"\"\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT _id, _rev FROM users\n            WHERE type = 'user' AND age &lt; :max_age\n        \"\"\"), {'max_age': max_age})\n\n        users_to_delete = result.fetchall()\n\n        print(f\"\u200b\u627e\u5230\u200b {len(users_to_delete)} \u200b\u4e2a\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u5220\u9664\u200b\")\n\n        # \u200b\u6279\u91cf\u200b\u5220\u9664\u200b\n        from sqlalchemy_couchdb.client import SyncCouchDBClient\n        client = SyncCouchDBClient(\n            base_url='http://localhost:5984',\n            database='mydb'\n        )\n\n        delete_docs = []\n        for user in users_to_delete:\n            delete_docs.append({\n                '_id': user._id,\n                '_rev': user._rev,\n                '_deleted': True\n            })\n\n        results = client.bulk_docs(delete_docs)\n\n        success_count = sum(1 for r in results if r.get('ok'))\n\n        print(f\"\u200b\u6279\u91cf\u200b\u5220\u9664\u200b\u5b8c\u6210\u200b\")\n        print(f\"\u200b\u6210\u529f\u200b: {success_count}/{len(users_to_delete)}\")\n\n        return success_count\n\n# \u200b\u4f7f\u7528\u200b\nbatch_delete(engine, max_age=20)\n</code></pre>"},{"location":"examples/advanced-features/#_6","title":"\u4e8b\u52a1\u7ba1\u7406","text":""},{"location":"examples/advanced-features/#1_2","title":"1. \u200b\u7b80\u5355\u200b\u4e8b\u52a1","text":"<pre><code>def simple_transaction(engine):\n    \"\"\"\u200b\u7b80\u5355\u200b\u4e8b\u52a1\u200b\"\"\"\n    with engine.connect() as conn:\n        try:\n            # \u200b\u5f00\u59cb\u200b\u4e8b\u52a1\u200b\uff08\u200b\u5728\u200b CouchDB \u200b\u4e2d\u662f\u200b no-op\uff09\n            conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id1, :name1, :age1, 'user')\n            \"\"\"), {\n                'id1': 'user:tx:1',\n                'name1': 'Alice',\n                'age1': 30\n            })\n\n            # \u200b\u63d2\u5165\u200b\u76f8\u5173\u200b\u8ba2\u5355\u200b\n            conn.execute(text(\"\"\"\n                INSERT INTO orders (_id, user_id, amount, type)\n                VALUES (:id2, :user_id, :amount, 'order')\n            \"\"\"), {\n                'id2': 'order:tx:1',\n                'user_id': 'user:tx:1',\n                'amount': 99.99\n            })\n\n            # \u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\n            conn.commit()\n            print(\"\u2705 \u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u6210\u529f\u200b\")\n\n        except Exception as e:\n            # \u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\n            conn.rollback()\n            print(f\"\u274c \u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b: {e}\")\n\n# \u200b\u4f7f\u7528\u200b\nsimple_transaction(engine)\n</code></pre>"},{"location":"examples/advanced-features/#2_2","title":"2. \u200b\u957f\u200b\u4e8b\u52a1","text":"<pre><code>def long_transaction(engine):\n    \"\"\"\u200b\u957f\u200b\u4e8b\u52a1\u200b\uff08\u200b\u5206\u6279\u200b\u5904\u7406\u200b\uff09\"\"\"\n    with engine.connect() as conn:\n        try:\n            batch_size = 100\n            total_users = 1000\n\n            for i in range(0, total_users, batch_size):\n                batch = [\n                    {\n                        'id': f'user:long:tx:{j}',\n                        'name': f'User{j}',\n                        'age': 20 + (j % 50),\n                        'type': 'user'\n                    }\n                    for j in range(i, min(i + batch_size, total_users))\n                ]\n\n                # \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\n                conn.execute(text(\"\"\"\n                    INSERT INTO users (_id, name, age, type)\n                    VALUES (:id, :name, :age, 'user')\n                \"\"\"), batch)\n\n                print(f\"\u200b\u5df2\u200b\u5904\u7406\u200b {min(i + batch_size, total_users)}/{total_users} \u200b\u7528\u6237\u200b\")\n\n            # \u200b\u63d0\u4ea4\u200b\u6240\u6709\u200b\u6279\u6b21\u200b\n            conn.commit()\n            print(\"\u2705 \u200b\u957f\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u6210\u529f\u200b\")\n\n        except Exception as e:\n            conn.rollback()\n            print(f\"\u274c \u200b\u957f\u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b: {e}\")\n            # \u200b\u6ce8\u610f\u200b\uff1aCouchDB \u200b\u6587\u6863\u200b\u7ea7\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u56de\u6eda\u200b\u5355\u4e2a\u200b\u6587\u6863\u200b\n            # \u200b\u5b9e\u9645\u200b\u751f\u4ea7\u200b\u4e2d\u5e94\u200b\u4f7f\u7528\u200b\u8865\u507f\u200b\u4e8b\u52a1\u200b\n\n# \u200b\u4f7f\u7528\u200b\nlong_transaction(engine)\n</code></pre>"},{"location":"examples/advanced-features/#_7","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"examples/advanced-features/#1_3","title":"1. \u200b\u4e50\u89c2\u200b\u9501\u200b\u5904\u7406","text":"<pre><code>def optimistic_lock_retry(engine, user_id, new_age, max_retries=3):\n    \"\"\"\u200b\u5e26\u200b\u91cd\u8bd5\u200b\u7684\u200b\u4e50\u89c2\u200b\u9501\u200b\u66f4\u65b0\u200b\"\"\"\n    import time\n\n    for attempt in range(max_retries):\n        with engine.connect() as conn:\n            try:\n                # \u200b\u67e5\u8be2\u200b\u5f53\u524d\u200b\u6587\u6863\u200b\n                result = conn.execute(text(\"\"\"\n                    SELECT * FROM users\n                    WHERE _id = :id AND type = 'user'\n                \"\"\"), {'id': user_id})\n\n                if result.rowcount == 0:\n                    print(f\"\u200b\u7528\u6237\u200b {user_id} \u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n                    return None\n\n                user = result.fetchone()\n                current_rev = user._rev\n\n                # \u200b\u5c1d\u8bd5\u200b\u66f4\u65b0\u200b\n                update_result = conn.execute(text(\"\"\"\n                    UPDATE users\n                    SET age = :age\n                    WHERE _id = :id AND type = 'user'\n                    RETURNING *\n                \"\"\"), {\n                    'id': user_id,\n                    'age': new_age\n                })\n\n                if update_result.rowcount &gt; 0:\n                    # \u200b\u66f4\u65b0\u200b\u6210\u529f\u200b\n                    conn.commit()\n                    updated_user = update_result.fetchone()\n                    print(f\"\u2705 \u200b\u66f4\u65b0\u200b\u6210\u529f\u200b (\u200b\u5c1d\u8bd5\u200b {attempt + 1})\")\n                    print(f\"  \u200b\u65b0\u200b\u7248\u672c\u200b: {updated_user._rev}\")\n                    return updated_user\n                else:\n                    # \u200b\u53ef\u80fd\u200b\u662f\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b\n                    raise Exception(\"\u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b\")\n\n            except Exception as e:\n                conn.rollback()\n\n                if attempt == max_retries - 1:\n                    print(f\"\u274c \u200b\u66f4\u65b0\u200b\u5931\u8d25\u200b\uff0c\u200b\u5df2\u200b\u91cd\u8bd5\u200b {max_retries} \u200b\u6b21\u200b: {e}\")\n                    raise\n\n                print(f\"\u26a0\ufe0f \u200b\u5c1d\u8bd5\u200b {attempt + 1} \u200b\u5931\u8d25\u200b: {e}\uff0c\u200b\u91cd\u8bd5\u200b\u4e2d\u200b...\")\n                time.sleep(0.1)  # \u200b\u77ed\u6682\u200b\u7b49\u5f85\u200b\n\n# \u200b\u4f7f\u7528\u200b\nuser = optimistic_lock_retry(engine, 'user:retry:1', 35)\n</code></pre>"},{"location":"examples/advanced-features/#2_3","title":"2. \u200b\u5b8c\u6574\u200b\u9519\u8bef\u5904\u7406","text":"<pre><code>def robust_operation(engine, user_id, data):\n    \"\"\"\u200b\u5065\u58ee\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff08\u200b\u591a\u79cd\u200b\u9519\u8bef\u5904\u7406\u200b\uff09\"\"\"\n    from sqlalchemy_couchdb.exceptions import (\n        CouchDBError,\n        NotFoundError,\n        DocumentConflictError,\n        ConnectionError\n    )\n\n    try:\n        with engine.connect() as conn:\n            result = conn.execute(text(\"\"\"\n                UPDATE users\n                SET age = :age, name = :name\n                WHERE _id = :id AND type = 'user'\n                RETURNING *\n            \"\"\"), {\n                'id': user_id,\n                'age': data.get('age'),\n                'name': data.get('name')\n            })\n\n            if result.rowcount == 0:\n                # \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\n                raise NotFoundError(f\"\u200b\u7528\u6237\u200b {user_id} \u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n            updated_user = result.fetchone()\n            conn.commit()\n\n            print(f\"\u2705 \u200b\u66f4\u65b0\u200b\u6210\u529f\u200b: {updated_user.name}\")\n            return updated_user\n\n    except NotFoundError as e:\n        print(f\"\u274c {e}\")\n        # \u200b\u7528\u6237\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u521b\u5efa\u200b\u65b0\u200b\u7528\u6237\u200b\n        with engine.connect() as conn:\n            conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id, :name, :age, 'user')\n            \"\"\"), {\n                'id': user_id,\n                'name': data.get('name'),\n                'age': data.get('age')\n            })\n            conn.commit()\n            print(f\"\u2705 \u200b\u521b\u5efa\u200b\u65b0\u200b\u7528\u6237\u200b: {data.get('name')}\")\n\n    except DocumentConflictError as e:\n        print(f\"\u274c \u200b\u6587\u6863\u200b\u7248\u672c\u200b\u51b2\u7a81\u200b: {e}\")\n        # \u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7248\u672c\u200b\u5e76\u91cd\u200b\u8bd5\u200b\n        latest_data = {**data, '_rev': None}\n        return robust_operation(engine, user_id, latest_data)\n\n    except ConnectionError as e:\n        print(f\"\u274c \u200b\u8fde\u63a5\u200b\u9519\u8bef\u200b: {e}\")\n        # \u200b\u8bb0\u5f55\u200b\u9519\u8bef\u200b\uff0c\u200b\u7b49\u5f85\u200b\u624b\u52a8\u200b\u5904\u7406\u200b\n        with open('error_log.txt', 'a') as f:\n            f.write(f\"{user_id}: {data}\\n\")\n        return None\n\n    except CouchDBError as e:\n        print(f\"\u274c CouchDB \u200b\u9519\u8bef\u200b: {e}\")\n        raise\n\n    except Exception as e:\n        print(f\"\u274c \u200b\u672a\u77e5\u200b\u9519\u8bef\u200b: {e}\")\n        raise\n\n# \u200b\u4f7f\u7528\u200b\nrobust_operation(engine, 'user:error:1', {'name': 'Alice', 'age': 31})\n</code></pre>"},{"location":"examples/advanced-features/#_8","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"examples/advanced-features/#1_4","title":"1. \u200b\u8fde\u63a5\u6c60\u200b\u4f18\u5316","text":"<pre><code>def optimized_connection_pool():\n    \"\"\"\u200b\u4f18\u5316\u200b\u7684\u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e\u200b\"\"\"\n    from sqlalchemy import create_engine\n\n    # \u200b\u9ad8\u200b\u5e76\u53d1\u200b\u914d\u7f6e\u200b\n    engine = create_engine(\n        'couchdb://admin:password@localhost:5984/mydb',\n        pool_size=20,              # \u200b\u6c60\u200b\u5927\u5c0f\u200b\n        max_overflow=30,           # \u200b\u6700\u5927\u200b\u6ea2\u51fa\u200b\n        pool_recycle=1800,         # 30\u200b\u5206\u949f\u200b\u56de\u6536\u200b\n        pool_timeout=60,           # \u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n        pool_pre_ping=True,        # \u200b\u9884\u200b\u68c0\u67e5\u200b\n    )\n\n    print(f\"\u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e\u200b:\")\n    print(f\"  \u200b\u6c60\u200b\u5927\u5c0f\u200b: {engine.pool.size()}\")\n    print(f\"  \u200b\u6700\u5927\u200b\u6ea2\u51fa\u200b: {engine.pool.overflow()}\")\n\n    return engine\n\n# \u200b\u4f7f\u7528\u200b\nengine = optimized_connection_pool()\n</code></pre>"},{"location":"examples/advanced-features/#2_4","title":"2. \u200b\u67e5\u8be2\u200b\u4f18\u5316","text":"<pre><code>def optimized_queries(engine):\n    \"\"\"\u200b\u4f18\u5316\u200b\u7684\u200b\u67e5\u8be2\u200b\"\"\"\n    import time\n\n    # \u200b\u53ea\u200b\u67e5\u8be2\u200b\u5fc5\u8981\u200b\u5b57\u200b\u6bb5\u200b\n    start = time.time()\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT _id, name, age FROM users\n            WHERE type = 'user' AND age &gt; 25\n            ORDER BY age DESC\n            LIMIT 100\n        \"\"\"))\n        users = result.fetchall()\n    elapsed = time.time() - start\n\n    print(f\"\u2705 \u200b\u4f18\u5316\u200b\u67e5\u8be2\u200b 1: {elapsed:.3f}s ({len(users)} \u200b\u7ed3\u679c\u200b)\")\n\n    # \u200b\u4f7f\u7528\u200b LIMIT\n    start = time.time()\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user'\n            LIMIT 1000\n        \"\"\"))\n        users = result.fetchall()\n    elapsed = time.time() - start\n\n    print(f\"\u2705 \u200b\u4f18\u5316\u200b\u67e5\u8be2\u200b 2: {elapsed:.3f}s ({len(users)} \u200b\u7ed3\u679c\u200b)\")\n\n# \u200b\u4f7f\u7528\u200b\noptimized_queries(engine)\n</code></pre>"},{"location":"examples/advanced-features/#_9","title":"\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b","text":""},{"location":"examples/advanced-features/#1_5","title":"1. \u200b\u90ae\u7bb1\u200b\u7c7b\u578b","text":"<pre><code>from sqlalchemy import types\nfrom sqlalchemy_couchdb.types import CouchDBString\n\nclass CouchDBEmail(CouchDBString):\n    \"\"\"\u200b\u90ae\u7bb1\u200b\u7c7b\u578b\u200b\"\"\"\n\n    def bind_processor(self, dialect):\n        def process(value):\n            if value is None:\n                return None\n\n            email = str(value)\n\n            # \u200b\u7b80\u5355\u200b\u90ae\u7bb1\u200b\u9a8c\u8bc1\u200b\n            if '@' not in email:\n                raise ValueError(f\"\u200b\u65e0\u6548\u200b\u7684\u200b\u90ae\u7bb1\u200b\u683c\u5f0f\u200b: {email}\")\n\n            return email\n\n        return process\n\n# \u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b\nfrom sqlalchemy import Table, Column, MetaData\n\nmetadata = MetaData()\nusers = Table('users', metadata,\n    Column('_id', CouchDBString, primary_key=True),\n    Column('email', CouchDBEmail()),  # \u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u90ae\u7bb1\u200b\u7c7b\u578b\u200b\n    Column('type', CouchDBString)\n)\n\n# \u200b\u521b\u5efa\u200b\u8868\u200b\nmetadata.create_all(engine)\n\n# \u200b\u63d2\u5165\u200b\u6570\u636e\u200b\uff08\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u9a8c\u8bc1\u200b\u90ae\u7bb1\u200b\uff09\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, email, type)\n        VALUES (:id, :email, 'user')\n    \"\"\"), {\n        'id': 'user:email:1',\n        'email': 'alice@example.com'  # \u200b\u6709\u6548\u200b\u90ae\u7bb1\u200b\n    })\n    conn.commit()\n\n    # \u200b\u65e0\u6548\u200b\u90ae\u7bb1\u200b\u4f1a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    try:\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, email, type)\n            VALUES (:id, :email, 'user')\n        \"\"\"), {\n            'id': 'user:email:2',\n            'email': 'not-an-email'  # \u200b\u65e0\u6548\u200b\u90ae\u7bb1\u200b\n        })\n        conn.commit()\n    except ValueError as e:\n        print(f\"\u274c \u200b\u90ae\u7bb1\u200b\u9a8c\u8bc1\u200b\u5931\u8d25\u200b: {e}\")\n</code></pre>"},{"location":"examples/advanced-features/#2_5","title":"2. \u200b\u679a\u4e3e\u200b\u7c7b\u578b","text":"<pre><code>from sqlalchemy import Enum\nfrom sqlalchemy_couchdb.types import CouchDBString\n\nclass StatusEnum:\n    \"\"\"\u200b\u72b6\u6001\u200b\u679a\u4e3e\u200b\"\"\"\n    ACTIVE = 'active'\n    INACTIVE = 'inactive'\n    PENDING = 'pending'\n\n    @classmethod\n    def values(cls):\n        return [cls.ACTIVE, cls.INACTIVE, cls.PENDING]\n\n# \u200b\u521b\u5efa\u200b\u72b6\u6001\u8868\u200b\nusers = Table('users', metadata,\n    Column('_id', CouchDBString, primary_key=True),\n    Column('status', Enum(*StatusEnum.values(), name='status_enum')),  # \u200b\u679a\u4e3e\u200b\u7c7b\u578b\u200b\n    Column('type', CouchDBString)\n)\n\n# \u200b\u4f7f\u7528\u200b\nwith engine.connect() as conn:\n    # \u200b\u63d2\u5165\u200b\u6709\u6548\u200b\u72b6\u6001\u200b\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, status, type)\n        VALUES (:id, :status, 'user')\n    \"\"\"), {\n        'id': 'user:enum:1',\n        'status': StatusEnum.ACTIVE\n    })\n    conn.commit()\n\n    # \u200b\u67e5\u8be2\u200b\u72b6\u6001\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users WHERE status = :status\n    \"\"\"), {'status': StatusEnum.ACTIVE})\n\n    for user in result:\n        print(f\"\u200b\u7528\u6237\u200b {user._id} \u200b\u72b6\u6001\u200b: {user.status}\")\n</code></pre>"},{"location":"examples/advanced-features/#_10","title":"\u5e76\u53d1\u200b\u64cd\u4f5c","text":""},{"location":"examples/advanced-features/#1_6","title":"1. \u200b\u540c\u6b65\u200b\u5e76\u53d1","text":"<pre><code>import concurrent.futures\nimport threading\n\ndef concurrent_queries(engine, query_count=10):\n    \"\"\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\"\"\"\n    import time\n\n    results = []\n    errors = []\n\n    start = time.time()\n\n    # \u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6267\u884c\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\n    with concurrent.futures.ThreadPoolExecutor(max_workers=10) as executor:\n        futures = []\n\n        for i in range(query_count):\n            future = executor.submit(\n                query_users,\n                engine,\n                {'min_age': 20 + i}\n            )\n            futures.append(future)\n\n        # \u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u67e5\u8be2\u200b\u5b8c\u6210\u200b\n        for future in concurrent.futures.as_completed(futures):\n            try:\n                result = future.result()\n                results.append(result)\n            except Exception as e:\n                errors.append(str(e))\n\n    elapsed = time.time() - start\n\n    print(f\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u5b8c\u6210\u200b\")\n    print(f\"\u200b\u603b\u200b\u67e5\u8be2\u200b: {query_count}\")\n    print(f\"\u200b\u6210\u529f\u200b: {len(results)}\")\n    print(f\"\u200b\u5931\u8d25\u200b: {len(errors)}\")\n    print(f\"\u200b\u603b\u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n    print(f\"\u200b\u5e73\u5747\u200b\u6bcf\u4e2a\u200b\u67e5\u8be2\u200b: {elapsed/query_count:.3f}s\")\n\n    return results, errors\n\ndef query_users(engine, params):\n    \"\"\"\u200b\u67e5\u8be2\u200b\u7528\u6237\u200b\u7684\u200b\u51fd\u6570\u200b\"\"\"\n    with engine.connect() as conn:\n        result = conn.execute(text(\"\"\"\n            SELECT COUNT(*) as count FROM users\n            WHERE type = 'user' AND age &gt; :min_age\n        \"\"\"), params)\n\n        return result.fetchone().count\n\n# \u200b\u4f7f\u7528\u200b\nconcurrent_queries(engine, query_count=50)\n</code></pre>"},{"location":"examples/advanced-features/#2_6","title":"2. \u200b\u5f02\u6b65\u200b\u5e76\u53d1","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\nasync def async_concurrent_queries(async_engine, query_count=10):\n    \"\"\"\u200b\u5f02\u6b65\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\"\"\"\n    results = []\n\n    async with async_engine.connect() as conn:\n        # \u200b\u521b\u5efa\u200b\u5e76\u53d1\u200b\u4efb\u52a1\u200b\n        tasks = []\n        for i in range(query_count):\n            task = async_query_users(\n                conn,\n                {'min_age': 20 + i}\n            )\n            tasks.append(task)\n\n        # \u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\n        results = await asyncio.gather(*tasks)\n\n    print(f\"\u200b\u5f02\u6b65\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u5b8c\u6210\u200b: {len(results)} \u200b\u67e5\u8be2\u200b\")\n    return results\n\nasync def async_query_users(async_conn, params):\n    \"\"\"\u200b\u5f02\u6b65\u200b\u67e5\u8be2\u200b\u7528\u6237\u200b\"\"\"\n    result = await async_conn.execute(text(\"\"\"\n        SELECT COUNT(*) as count FROM users\n        WHERE type = 'user' AND age &gt; :min_age\n    \"\"\"), params)\n\n    return result.fetchone().count\n\n# \u200b\u4f7f\u7528\u200b\nasync_engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\nresults = asyncio.run(async_concurrent_queries(async_engine, query_count=50))\n</code></pre>"},{"location":"examples/advanced-features/#_11","title":"\u76d1\u63a7\u200b\u548c\u200b\u65e5\u5fd7","text":""},{"location":"examples/advanced-features/#1_7","title":"1. \u200b\u67e5\u8be2\u200b\u76d1\u63a7","text":"<pre><code>import time\nimport logging\n\n# \u200b\u914d\u7f6e\u200b\u65e5\u5fd7\u200b\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\nlogger = logging.getLogger('couchdb_monitor')\n\nclass QueryMonitor:\n    \"\"\"\u200b\u67e5\u8be2\u200b\u76d1\u63a7\u5668\u200b\"\"\"\n\n    def __init__(self):\n        self.query_count = 0\n        self.total_time = 0\n        self.slow_queries = []\n\n    def execute_query(self, conn, query, params=None, slow_threshold=0.1):\n        \"\"\"\u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\u5e76\u200b\u76d1\u63a7\u200b\"\"\"\n        self.query_count += 1\n        start = time.time()\n\n        try:\n            result = conn.execute(text(query), params or {})\n            elapsed = time.time() - start\n            self.total_time += elapsed\n\n            # \u200b\u8bb0\u5f55\u200b\u6162\u200b\u67e5\u8be2\u200b\n            if elapsed &gt; slow_threshold:\n                self.slow_queries.append({\n                    'query': query[:100],\n                    'elapsed': elapsed,\n                    'params': params\n                })\n                logger.warning(f\"\u200b\u6162\u200b\u67e5\u8be2\u200b: {elapsed:.3f}s - {query[:100]}\")\n\n            logger.info(f\"\u200b\u67e5\u8be2\u200b {self.query_count}: {elapsed:.3f}s\")\n\n            return result\n\n        except Exception as e:\n            elapsed = time.time() - start\n            logger.error(f\"\u200b\u67e5\u8be2\u200b\u5931\u8d25\u200b: {elapsed:.3f}s - {e}\")\n            raise\n\n    def get_stats(self):\n        \"\"\"\u200b\u83b7\u53d6\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\"\"\"\n        avg_time = self.total_time / self.query_count if self.query_count &gt; 0 else 0\n\n        return {\n            'total_queries': self.query_count,\n            'total_time': self.total_time,\n            'avg_time': avg_time,\n            'slow_query_count': len(self.slow_queries)\n        }\n\n    def print_report(self):\n        \"\"\"\u200b\u6253\u5370\u200b\u62a5\u544a\u200b\"\"\"\n        stats = self.get_stats()\n        print(f\"\\n{'='*50}\")\n        print(f\"\u200b\u67e5\u8be2\u200b\u76d1\u63a7\u200b\u62a5\u544a\u200b\")\n        print(f\"{'='*50}\")\n        print(f\"\u200b\u603b\u200b\u67e5\u8be2\u200b\u6570\u200b: {stats['total_queries']}\")\n        print(f\"\u200b\u603b\u200b\u8017\u65f6\u200b: {stats['total_time']:.3f}s\")\n        print(f\"\u200b\u5e73\u5747\u200b\u8017\u65f6\u200b: {stats['avg_time']:.3f}s\")\n        print(f\"\u200b\u6162\u200b\u67e5\u8be2\u200b\u6570\u200b: {stats['slow_query_count']}\")\n\n        if self.slow_queries:\n            print(f\"\\n\u200b\u6162\u200b\u67e5\u8be2\u200b\u5217\u8868\u200b:\")\n            for i, query in enumerate(self.slow_queries[:10], 1):\n                print(f\"{i}. {query['elapsed']:.3f}s - {query['query']}\")\n\n# \u200b\u4f7f\u7528\u200b\nmonitor = QueryMonitor()\n\nwith engine.connect() as conn:\n    # \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\n    monitor.execute_query(conn, \"\"\"\n        SELECT * FROM users WHERE type = 'user' LIMIT 100\n    \"\"\")\n\n    monitor.execute_query(conn, \"\"\"\n        SELECT * FROM users WHERE age &gt; 30\n    \"\"\")\n\n# \u200b\u6253\u5370\u200b\u62a5\u544a\u200b\nmonitor.print_report()\n</code></pre>"},{"location":"examples/advanced-features/#_12","title":"\u603b\u7ed3","text":"<p>\u200b\u8fd9\u4e9b\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u793a\u4f8b\u200b\u5c55\u793a\u200b\u4e86\u200b\uff1a</p> <ol> <li>\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b - \u200b\u591a\u200b\u6761\u4ef6\u200b\u3001\u200b\u5206\u9875\u200b\u3001\u200b\u805a\u5408\u200b</li> <li>\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b - \u200b\u9ad8\u6548\u200b\u63d2\u5165\u200b\u3001\u200b\u66f4\u65b0\u200b\u3001\u200b\u5220\u9664\u200b</li> <li>\u200b\u4e8b\u52a1\u7ba1\u7406\u200b - \u200b\u7b80\u5355\u200b\u4e8b\u52a1\u200b\u3001\u200b\u957f\u200b\u4e8b\u52a1\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b - \u200b\u4e50\u89c2\u200b\u9501\u200b\u3001\u200b\u5b8c\u6574\u200b\u9519\u8bef\u5904\u7406\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b - \u200b\u8fde\u63a5\u6c60\u200b\u3001\u200b\u67e5\u8be2\u200b\u4f18\u5316\u200b</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b - \u200b\u90ae\u7bb1\u200b\u7c7b\u578b\u200b\u3001\u200b\u679a\u4e3e\u200b\u7c7b\u578b\u200b</li> <li>\u200b\u5e76\u53d1\u200b\u64cd\u4f5c\u200b - \u200b\u540c\u6b65\u200b\u5e76\u53d1\u200b\u3001\u200b\u5f02\u6b65\u200b\u5e76\u53d1\u200b</li> <li>\u200b\u76d1\u63a7\u200b\u65e5\u5fd7\u200b - \u200b\u67e5\u8be2\u200b\u76d1\u63a7\u200b\u3001\u200b\u6162\u200b\u67e5\u8be2\u200b\u68c0\u6d4b\u200b</li> </ol> <p>\u200b\u8fd9\u4e9b\u200b\u793a\u4f8b\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u60a8\u200b\u66f4\u597d\u200b\u5730\u200b\u7406\u89e3\u200b\u548c\u200b\u4f7f\u7528\u200b SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u7684\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"examples/advanced-features/#_13","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>API \u200b\u53c2\u8003\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u6307\u5357\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\u6307\u5357\u200b</li> </ul>"},{"location":"examples/performance/","title":"\u6027\u80fd\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\u793a\u4f8b","text":""},{"location":"examples/performance/#_2","title":"\u6982\u8ff0","text":"<p>\u200b\u672c\u200b\u793a\u4f8b\u200b\u5c55\u793a\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u8fdb\u884c\u200b\u6027\u80fd\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\u3002</p>"},{"location":"examples/performance/#_3","title":"\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\u5957\u4ef6","text":""},{"location":"examples/performance/#1-crud","title":"1. CRUD \u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code>import time\nfrom contextlib import contextmanager\nfrom sqlalchemy import create_engine, text\n\n@contextmanager\ndef timer(name):\n    \"\"\"\u200b\u8ba1\u65f6\u5668\u200b\"\"\"\n    start = time.time()\n    yield\n    elapsed = time.time() - start\n    print(f\"{name}: {elapsed:.3f}s\")\n\ndef benchmark_crud(engine, num_ops=1000):\n    \"\"\"CRUD \u200b\u64cd\u4f5c\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"CRUD \u200b\u6027\u80fd\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b - {num_ops} \u200b\u64cd\u4f5c\u200b\")\n    print(f\"{'='*60}\")\n\n    # INSERT \u200b\u6d4b\u8bd5\u200b\n    print(\"\\n1. INSERT \u200b\u6d4b\u8bd5\u200b\")\n    with timer(f\"\u200b\u63d2\u5165\u200b {num_ops} \u200b\u6761\u200b\u8bb0\u5f55\u200b\"):\n        with engine.connect() as conn:\n            data = [\n                {'id': f'bench:insert:{i}', 'name': f'User{i}', 'age': i % 100, 'type': 'user'}\n                for i in range(num_ops)\n            ]\n            conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id, :name, :age, 'user')\n            \"\"\"), data)\n            conn.commit()\n\n    insert_throughput = num_ops / elapsed\n    print(f\"\u200b\u63d2\u5165\u200b\u541e\u5410\u91cf\u200b: {insert_throughput:.1f} docs/s\")\n\n    # SELECT \u200b\u6d4b\u8bd5\u200b\n    print(\"\\n2. SELECT \u200b\u6d4b\u8bd5\u200b\")\n    select_count = min(num_ops, 1000)  # \u200b\u9650\u5236\u200b\u67e5\u8be2\u200b\u6570\u91cf\u200b\n    with timer(f\"\u200b\u67e5\u8be2\u200b {select_count} \u200b\u6b21\u200b\"):\n        with engine.connect() as conn:\n            for i in range(select_count):\n                result = conn.execute(text(\"\"\"\n                    SELECT * FROM users WHERE _id = :id\n                \"\"\"), {'id': f'bench:insert:{i}'})\n\n    select_throughput = select_count / elapsed\n    print(f\"\u200b\u67e5\u8be2\u200b\u541e\u5410\u91cf\u200b: {select_throughput:.1f} ops/s\")\n\n    # UPDATE \u200b\u6d4b\u8bd5\u200b\n    print(\"\\n3. UPDATE \u200b\u6d4b\u8bd5\u200b\")\n    update_count = min(num_ops, 1000)\n    with timer(f\"\u200b\u66f4\u65b0\u200b {update_count} \u200b\u6761\u200b\u8bb0\u5f55\u200b\"):\n        with engine.connect() as conn:\n            for i in range(update_count):\n                conn.execute(text(\"\"\"\n                    UPDATE users\n                    SET age = age + 1\n                    WHERE _id = :id AND type = 'user'\n                \"\"\"), {'id': f'bench:insert:{i}'})\n            conn.commit()\n\n    update_throughput = update_count / elapsed\n    print(f\"\u200b\u66f4\u65b0\u200b\u541e\u5410\u91cf\u200b: {update_throughput:.1f} ops/s\")\n\n    # DELETE \u200b\u6d4b\u8bd5\u200b\n    print(\"\\n4. DELETE \u200b\u6d4b\u8bd5\u200b\")\n    delete_count = min(num_ops, 1000)\n    with timer(f\"\u200b\u5220\u9664\u200b {delete_count} \u200b\u6761\u200b\u8bb0\u5f55\u200b\"):\n        with engine.connect() as conn:\n            for i in range(delete_count):\n                conn.execute(text(\"\"\"\n                    DELETE FROM users\n                    WHERE _id = :id AND type = 'user'\n                \"\"\"), {'id': f'bench:delete:{i}'})\n\n    delete_throughput = delete_count / elapsed\n    print(f\"\u200b\u5220\u9664\u200b\u541e\u5410\u91cf\u200b: {delete_throughput:.1f} ops/s\")\n\n    return {\n        'insert': insert_throughput,\n        'select': select_throughput,\n        'update': update_throughput,\n        'delete': delete_throughput\n    }\n\n# \u200b\u8fd0\u884c\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\nresults = benchmark_crud(engine, num_ops=1000)\n</code></pre>"},{"location":"examples/performance/#2","title":"2. \u200b\u5e76\u53d1\u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code>import concurrent.futures\nimport asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\ndef concurrent_select_test(engine, num_threads=10, queries_per_thread=100):\n    \"\"\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u6d4b\u8bd5\u200b - {num_threads} \u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6bcf\u200b\u7ebf\u7a0b\u200b {queries_per_thread} \u200b\u67e5\u8be2\u200b\")\n    print(f\"{'='*60}\")\n\n    def query_task(thread_id):\n        \"\"\"\u200b\u5355\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u67e5\u8be2\u200b\u4efb\u52a1\u200b\"\"\"\n        count = 0\n        with engine.connect() as conn:\n            for i in range(queries_per_thread):\n                result = conn.execute(text(\"\"\"\n                    SELECT COUNT(*) as c FROM users WHERE type = 'user'\n                \"\"\"))\n                count += result.fetchone().c\n        return count\n\n    start = time.time()\n    with concurrent.futures.ThreadPoolExecutor(max_workers=num_threads) as executor:\n        futures = [executor.submit(query_task, i) for i in range(num_threads)]\n        results = [f.result() for f in concurrent.futures.as_completed(futures)]\n    elapsed = time.time() - start\n\n    total_queries = num_threads * queries_per_thread\n    throughput = total_queries / elapsed\n\n    print(f\"\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\u5b8c\u6210\u200b:\")\n    print(f\"  \u200b\u603b\u200b\u67e5\u8be2\u200b\u6570\u200b: {total_queries}\")\n    print(f\"  \u200b\u603b\u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n    print(f\"  \u200b\u541e\u5410\u91cf\u200b: {throughput:.1f} queries/s\")\n    print(f\"  \u200b\u5e73\u5747\u200b\u6bcf\u4e2a\u200b\u67e5\u8be2\u200b: {elapsed/total_queries*1000:.3f}ms\")\n\n    return throughput\n\n# \u200b\u8fd0\u884c\u200b\u5e76\u53d1\u200b\u6d4b\u8bd5\u200b\nconcurrent_results = concurrent_select_test(engine, num_threads=10, queries_per_thread=100)\n</code></pre>"},{"location":"examples/performance/#3","title":"3. \u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code>def batch_operations_test(engine):\n    \"\"\"\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\")\n    print(f\"{'='*60}\")\n\n    # \u200b\u5355\u6761\u200b\u63d2\u5165\u200b vs \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\n    batch_sizes = [1, 10, 50, 100, 500, 1000]\n\n    for batch_size in batch_sizes:\n        print(f\"\\n\u200b\u6279\u91cf\u200b\u5927\u5c0f\u200b: {batch_size}\")\n\n        # \u200b\u51c6\u5907\u200b\u6570\u636e\u200b\n        data = [\n            {'id': f'batch:{batch_size}:{i}', 'name': f'User{i}', 'type': 'user'}\n            for i in range(batch_size)\n        ]\n\n        # \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\n        start = time.time()\n        with engine.connect() as conn:\n            conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, type)\n                VALUES (:id, :name, 'user')\n            \"\"\"), data)\n            conn.commit()\n        elapsed = time.time() - start\n\n        throughput = batch_size / elapsed\n        avg_per_doc = elapsed / batch_size * 1000\n\n        print(f\"  \u200b\u8017\u65f6\u200b: {elapsed:.3f}s\")\n        print(f\"  \u200b\u541e\u5410\u91cf\u200b: {throughput:.1f} docs/s\")\n        print(f\"  \u200b\u5e73\u5747\u200b\u6bcf\u4e2a\u200b\u6587\u6863\u200b: {avg_per_doc:.3f}ms\")\n\n# \u200b\u8fd0\u884c\u200b\u6279\u91cf\u200b\u6d4b\u8bd5\u200b\nbatch_operations_test(engine)\n</code></pre>"},{"location":"examples/performance/#4","title":"4. \u200b\u5f02\u6b65\u200b\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<pre><code>async def async_performance_test(async_engine, num_ops=1000):\n    \"\"\"\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b - {num_ops} \u200b\u64cd\u4f5c\u200b\")\n    print(f\"{'='*60}\")\n\n    # \u200b\u5f02\u6b65\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\n    print(\"\\n1. \u200b\u5f02\u6b65\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\")\n    data = [\n        {'id': f'async:insert:{i}', 'name': f'User{i}', 'type': 'user'}\n        for i in range(num_ops)\n    ]\n\n    start = time.time()\n    async with async_engine.connect() as conn:\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, type)\n            VALUES (:id, :name, 'user')\n        \"\"\"), data)\n        await conn.commit()\n    elapsed = time.time() - start\n\n    insert_throughput = num_ops / elapsed\n    print(f\"\u200b\u5f02\u6b65\u200b\u63d2\u5165\u200b\u541e\u5410\u91cf\u200b: {insert_throughput:.1f} docs/s\")\n\n    # \u200b\u5f02\u6b65\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\n    print(\"\\n2. \u200b\u5f02\u6b65\u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\")\n    query_count = min(num_ops, 1000)\n\n    start = time.time()\n    async with async_engine.connect() as conn:\n        tasks = []\n        for i in range(query_count):\n            task = conn.execute(text(\"\"\"\n                SELECT * FROM users WHERE _id = :id\n            \"\"\"), {'id': f'async:insert:{i}'})\n            tasks.append(task)\n\n        results = await asyncio.gather(*tasks)\n    elapsed = time.time() - start\n\n    async_throughput = query_count / elapsed\n    print(f\"\u200b\u5f02\u6b65\u200b\u67e5\u8be2\u200b\u541e\u5410\u91cf\u200b: {async_throughput:.1f} queries/s\")\n\n    return {\n        'insert': insert_throughput,\n        'select': async_throughput\n    }\n\n# \u200b\u8fd0\u884c\u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b\nasync_engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\nasync_results = asyncio.run(async_performance_test(async_engine, num_ops=5000))\n</code></pre>"},{"location":"examples/performance/#5","title":"5. \u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u6d4b\u8bd5","text":"<pre><code>import psutil\nimport os\n\ndef memory_usage_test(engine):\n    \"\"\"\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u6d4b\u8bd5\u200b\"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u6d4b\u8bd5\u200b\")\n    print(f\"{'='*60}\")\n\n    process = psutil.Process(os.getpid())\n    initial_memory = process.memory_info().rss / 1024 / 1024  # MB\n\n    print(f\"\u200b\u521d\u59cb\u200b\u5185\u5b58\u200b: {initial_memory:.2f} MB\")\n\n    # \u200b\u52a0\u8f7d\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\n    with timer(\"\u200b\u52a0\u8f7d\u200b 10000 \u200b\u6761\u200b\u8bb0\u5f55\u200b\"):\n        with engine.connect() as conn:\n            data = [\n                {'id': f'mem:{i}', 'name': f'User{i}', 'age': i % 100, 'type': 'user'}\n                for i in range(10000)\n            ]\n            conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id, :name, :age, 'user')\n            \"\"\"), data)\n            conn.commit()\n\n    peak_memory = process.memory_info().rss / 1024 / 1024  # MB\n    print(f\"\u200b\u5cf0\u503c\u200b\u5185\u5b58\u200b: {peak_memory:.2f} MB\")\n    print(f\"\u200b\u5185\u5b58\u200b\u589e\u957f\u200b: {peak_memory - initial_memory:.2f} MB\")\n\n    # \u200b\u67e5\u8be2\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\uff08\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\u96c6\u200b\u5185\u5b58\u200b\uff09\n    with timer(\"\u200b\u67e5\u8be2\u200b 10000 \u200b\u6761\u200b\u8bb0\u5f55\u200b\"):\n        with engine.connect() as conn:\n            result = conn.execute(text(\"\"\"\n                SELECT * FROM users WHERE type = 'user' LIMIT 10000\n            \"\"\"))\n            all_rows = result.fetchall()\n\n    query_memory = process.memory_info().rss / 1024 / 1024  # MB\n    print(f\"\u200b\u67e5\u8be2\u200b\u540e\u200b\u5185\u5b58\u200b: {query_memory:.2f} MB\")\n    print(f\"\u200b\u67e5\u8be2\u200b\u5185\u5b58\u200b\u589e\u957f\u200b: {query_memory - peak_memory:.2f} MB\")\n\n    # \u200b\u6e05\u7406\u200b\n    with timer(\"\u200b\u6e05\u7406\u200b\u6570\u636e\u200b\"):\n        with engine.connect() as conn:\n            conn.execute(text(\"\"\"\n                DELETE FROM users WHERE _id LIKE 'mem:%'\n            \"\"\"))\n\n    final_memory = process.memory_info().rss / 1024 / 1024  # MB\n    print(f\"\u200b\u6e05\u7406\u200b\u540e\u200b\u5185\u5b58\u200b: {final_memory:.2f} MB\")\n\n    return {\n        'initial': initial_memory,\n        'peak': peak_memory,\n        'query': query_memory,\n        'final': final_memory\n    }\n\n# \u200b\u8fd0\u884c\u200b\u5185\u5b58\u200b\u6d4b\u8bd5\u200b\nmemory_results = memory_usage_test(engine)\n</code></pre>"},{"location":"examples/performance/#6","title":"6. \u200b\u5b8c\u6574\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u62a5\u544a","text":"<pre><code>def generate_benchmark_report(results):\n    \"\"\"\u200b\u751f\u6210\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u62a5\u544a\u200b\"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"\u200b\u6027\u80fd\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u62a5\u544a\u200b\")\n    print(f\"{'='*60}\")\n\n    print(\"\\n\ud83d\udcca CRUD \u200b\u64cd\u4f5c\u200b\u6027\u80fd\u200b:\")\n    print(f\"  INSERT: {results['crud']['insert']:.1f} docs/s\")\n    print(f\"  SELECT: {results['crud']['select']:.1f} ops/s\")\n    print(f\"  UPDATE: {results['crud']['update']:.1f} ops/s\")\n    print(f\"  DELETE: {results['crud']['delete']:.1f} ops/s\")\n\n    print(\"\\n\ud83d\ude80 \u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b:\")\n    print(f\"  \u200b\u541e\u5410\u91cf\u200b: {results['concurrent']:.1f} queries/s\")\n\n    print(\"\\n\u26a1 \u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b:\")\n    print(f\"  INSERT: {results['async']['insert']:.1f} docs/s\")\n    print(f\"  SELECT: {results['async']['select']:.1f} queries/s\")\n\n    print(\"\\n\ud83d\udcbe \u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b:\")\n    print(f\"  \u200b\u521d\u59cb\u200b: {results['memory']['initial']:.2f} MB\")\n    print(f\"  \u200b\u5cf0\u503c\u200b: {results['memory']['peak']:.2f} MB\")\n    print(f\"  \u200b\u67e5\u8be2\u200b\u540e\u200b: {results['memory']['query']:.2f} MB\")\n\n    print(f\"\\n{'='*60}\")\n    print(f\"\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\u5b8c\u6210\u200b\")\n    print(f\"{'='*60}\")\n\n# \u200b\u8fd0\u884c\u200b\u5b8c\u6574\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\ndef run_full_benchmark():\n    \"\"\"\u200b\u8fd0\u884c\u200b\u5b8c\u6574\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\"\"\"\n    engine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n    results = {}\n\n    # CRUD \u200b\u6d4b\u8bd5\u200b\n    results['crud'] = benchmark_crud(engine, num_ops=1000)\n\n    # \u200b\u5e76\u53d1\u200b\u6d4b\u8bd5\u200b\n    results['concurrent'] = concurrent_select_test(engine, num_threads=10, queries_per_thread=100)\n\n    # \u200b\u5f02\u6b65\u200b\u6d4b\u8bd5\u200b\n    results['async'] = asyncio.run(async_performance_test(async_engine, num_ops=1000))\n\n    # \u200b\u5185\u5b58\u200b\u6d4b\u8bd5\u200b\n    results['memory'] = memory_usage_test(engine)\n\n    # \u200b\u751f\u6210\u200b\u62a5\u544a\u200b\n    generate_benchmark_report(results)\n\n# \u200b\u8fd0\u884c\u200b\u5b8c\u6574\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\nrun_full_benchmark()\n</code></pre>"},{"location":"examples/performance/#_4","title":"\u6027\u80fd\u200b\u4f18\u5316\u200b\u5efa\u8bae","text":"<p>\u200b\u57fa\u4e8e\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\uff1a</p>"},{"location":"examples/performance/#1","title":"1. \u200b\u63d2\u5165\u200b\u4f18\u5316","text":"<ul> <li>\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\uff1a\u200b\u6bd4\u200b\u5355\u6761\u200b\u63d2\u5165\u200b\u5feb\u200b 10-100 \u200b\u500d\u200b</li> <li>\u200b\u63a8\u8350\u200b\u6279\u91cf\u200b\u5927\u5c0f\u200b\uff1a100-1000 \u200b\u6761\u200b\u8bb0\u5f55\u200b</li> <li>\u200b\u66f4\u200b\u5927\u6279\u91cf\u200b\uff1a\u200b\u6536\u76ca\u200b\u9012\u51cf\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u8d85\u65f6\u200b</li> </ul>"},{"location":"examples/performance/#2_1","title":"2. \u200b\u67e5\u8be2\u200b\u4f18\u5316","text":"<ul> <li>\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\uff1aORDER BY \u200b\u5b57\u200b\u6bb5\u200b\u5fc5\u987b\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b</li> <li>\u200b\u9650\u5236\u200b\u7ed3\u679c\u200b\u96c6\u200b\uff1a\u200b\u59cb\u7ec8\u200b\u4f7f\u7528\u200b LIMIT</li> <li>\u200b\u53ea\u200b\u67e5\u8be2\u200b\u5fc5\u8981\u200b\u5b57\u200b\u6bb5\u200b\uff1a\u200b\u51cf\u5c11\u200b\u6570\u636e\u4f20\u8f93\u200b\u91cf\u200b</li> </ul>"},{"location":"examples/performance/#3_1","title":"3. \u200b\u5e76\u53d1\u200b\u4f18\u5316","text":"<ul> <li>\u200b\u8fde\u63a5\u6c60\u200b\u5927\u5c0f\u200b\uff1a\u200b\u57fa\u4e8e\u200b\u5e76\u53d1\u200b\u7528\u6237\u6570\u200b\u8c03\u6574\u200b\uff08\u200b\u901a\u5e38\u200b 10-50\uff09</li> <li>\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff1a\u200b\u4e0d\u200b\u8d85\u8fc7\u200b CPU \u200b\u6838\u5fc3\u200b\u6570\u200b\u7684\u200b 2-4 \u200b\u500d\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u9002\u5408\u200b I/O \u200b\u5bc6\u96c6\u578b\u200b\u4efb\u52a1\u200b</li> </ul>"},{"location":"examples/performance/#4_1","title":"4. \u200b\u5185\u5b58\u200b\u4f18\u5316","text":"<ul> <li>\u200b\u5206\u9875\u200b\u67e5\u8be2\u200b\uff1a\u200b\u907f\u514d\u200b\u4e00\u6b21\u6027\u200b\u52a0\u8f7d\u200b\u5927\u91cf\u200b\u6570\u636e\u200b</li> <li>\u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\uff1a\u200b\u4f7f\u7528\u200b fetchmany() \u200b\u5206\u6279\u200b\u83b7\u53d6\u200b</li> <li>\u200b\u53ca\u65f6\u200b\u6e05\u7406\u200b\uff1a\u200b\u5220\u9664\u200b\u4e0d\u200b\u9700\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> </ul>"},{"location":"examples/performance/#_5","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u793a\u4f8b\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u6307\u5357\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\u6307\u5357\u200b</li> </ul>"},{"location":"faq/limitations/","title":"\u9650\u5236\u200b\u548c\u200b\u6ce8\u610f\u4e8b\u9879","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u8bf4\u660e\u200b SQLAlchemy CouchDB Dialect \u200b\u7684\u200b\u5f53\u524d\u200b\u9650\u5236\u200b\u548c\u200b\u6ce8\u610f\u4e8b\u9879\u200b\u3002</p>"},{"location":"faq/limitations/#sql","title":"SQL \u200b\u529f\u80fd\u200b\u9650\u5236","text":""},{"location":"faq/limitations/#phase-1","title":"Phase 1 \u200b\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b\u529f\u80fd","text":"<p>Phase 1\uff08\u200b\u7eaf\u200b CouchDB \u200b\u6a21\u5f0f\u200b\uff09\u200b\u76ee\u524d\u200b\u4e0d\u200b\u652f\u6301\u200b\u4ee5\u4e0b\u200b SQL \u200b\u529f\u80fd\u200b\uff1a</p>"},{"location":"faq/limitations/#1-join","title":"1. JOIN \u200b\u64cd\u4f5c","text":"<p>\u200b\u9650\u5236\u200b: CouchDB \u200b\u4e0d\u200b\u652f\u6301\u200b\u591a\u8868\u200b\u8054\u63a5\u200b\u3002</p> <p>\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b:</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nSELECT u.name, o.total\nFROM users u\nJOIN orders o ON u.id = o.user_id\n\n# \u2705 \u200b\u65b9\u6848\u200b 1: \u200b\u5ba2\u6237\u7aef\u200b\u8054\u63a5\u200b\nusers = conn.execute(\"SELECT * FROM users\").fetchall()\norders = conn.execute(\"SELECT * FROM orders\").fetchall()\n\n# \u200b\u5728\u200b Python \u200b\u4e2d\u200b\u8fdb\u884c\u200b\u8054\u63a5\u200b\nfor user in users:\n    user_orders = [o for o in orders if o.user_id == user.id]\n    # \u200b\u5904\u7406\u7ed3\u679c\u200b\n\n# \u2705 \u200b\u65b9\u6848\u200b 2: \u200b\u6587\u6863\u200b\u5d4c\u5957\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\n# \u200b\u5c06\u200b\u8ba2\u5355\u200b\u5d4c\u5165\u200b\u7528\u6237\u6587\u6863\u200b\nuser_doc = {\n    \"_id\": \"user:1\",\n    \"name\": \"Alice\",\n    \"orders\": [\n        {\"id\": \"order:1\", \"total\": 100},\n        {\"id\": \"order:2\", \"total\": 200}\n    ]\n}\n\n# \u2705 \u200b\u65b9\u6848\u200b 3: Phase 2 \u200b\u6df7\u5408\u200b\u67b6\u6784\u200b\n# \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u81ea\u52a8\u200b\u8def\u7531\u200b\u5230\u200b RDBMS\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost/pgdb'\n)\n</code></pre>"},{"location":"faq/limitations/#2","title":"2. \u200b\u5b50\u200b\u67e5\u8be2","text":"<p>\u200b\u9650\u5236\u200b: \u200b\u4e0d\u200b\u652f\u6301\u200b\u5d4c\u5957\u200b SELECT\u3002</p> <p>\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b:</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nSELECT * FROM users WHERE age &gt; (\n    SELECT AVG(age) FROM users\n)\n\n# \u2705 \u200b\u5206\u6b65\u200b\u67e5\u8be2\u200b\navg_age_result = conn.execute(\"SELECT age FROM users\").fetchall()\navg_age = sum(r.age for r in avg_age_result) / len(avg_age_result)\n\nusers = conn.execute(\n    \"SELECT * FROM users WHERE age &gt; :avg\",\n    {\"avg\": avg_age}\n).fetchall()\n\n# \u2705 \u200b\u4f7f\u7528\u200b CouchDB \u200b\u89c6\u56fe\u200b\uff08\u200b\u9ad8\u7ea7\u200b\uff09\nfrom sqlalchemy_couchdb.management import ViewManager\n\nview_manager = ViewManager(client)\nview_manager.create_view(\n    'mydb',\n    'stats',\n    'average_age',\n    map_function=\"\"\"function(doc) {\n        if (doc.type === 'users') {\n            emit(null, doc.age);\n        }\n    }\"\"\",\n    reduce_function=\"_stats\"\n)\n</code></pre>"},{"location":"faq/limitations/#3-group-by","title":"3. GROUP BY\uff08\u200b\u90e8\u5206\u200b\u652f\u6301\u200b\uff09","text":"<p>\u200b\u9650\u5236\u200b: \u200b\u57fa\u7840\u200b GROUP BY \u200b\u9700\u8981\u200b\u5ba2\u6237\u7aef\u200b\u5904\u7406\u200b\u6216\u200b CouchDB \u200b\u89c6\u56fe\u200b\u3002</p> <p>\u200b\u652f\u6301\u200b\u60c5\u51b5\u200b: - \u2705 \u200b\u7b80\u5355\u200b\u805a\u5408\u200b\uff08COUNT, SUM, AVG, MIN, MAX\uff09- \u200b\u4f7f\u7528\u200b <code>advanced.py</code> - \u2705 \u200b\u5355\u5b57\u200b\u6bb5\u200b GROUP BY - \u200b\u4f7f\u7528\u200b <code>QueryProcessor</code> - \u274c \u200b\u590d\u6742\u200b GROUP BY\uff08\u200b\u591a\u5b57\u6bb5\u200b\u3001HAVING\uff09- \u200b\u9700\u8981\u200b Phase 2</p> <p>\u200b\u793a\u4f8b\u200b:</p> <pre><code>from sqlalchemy_couchdb.advanced import QueryProcessor\n\n# \u200b\u83b7\u53d6\u200b\u539f\u59cb\u6570\u636e\u200b\nresult = conn.execute(\"SELECT * FROM orders\").fetchall()\n\n# \u200b\u5ba2\u6237\u7aef\u200b\u5206\u7ec4\u200b\nprocessor = QueryProcessor(result)\ngrouped = processor.group_by(\n    ['user_id'],\n    {'total': 'sum', 'order_id': 'count'}\n)\n\nfor group in grouped:\n    print(f\"\u200b\u7528\u6237\u200b {group['user_id']}: \u200b\u603b\u91d1\u989d\u200b {group['total_sum']}, \u200b\u8ba2\u5355\u6570\u200b {group['order_id_count']}\")\n</code></pre>"},{"location":"faq/limitations/#4-unionintersectexcept","title":"4. UNION/INTERSECT/EXCEPT","text":"<p>\u200b\u9650\u5236\u200b: \u200b\u4e0d\u200b\u652f\u6301\u200b\u96c6\u5408\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b:</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nSELECT id FROM users\nUNION\nSELECT id FROM customers\n\n# \u2705 \u200b\u5ba2\u6237\u7aef\u200b\u5408\u5e76\u200b\nusers = set(r.id for r in conn.execute(\"SELECT id FROM users\"))\ncustomers = set(r.id for r in conn.execute(\"SELECT id FROM customers\"))\n\n# UNION\nall_ids = users.union(customers)\n\n# INTERSECT\ncommon_ids = users.intersection(customers)\n\n# EXCEPT\nonly_users = users.difference(customers)\n</code></pre>"},{"location":"faq/limitations/#5","title":"5. \u200b\u7a97\u53e3\u200b\u51fd\u6570","text":"<p>\u200b\u9650\u5236\u200b: \u200b\u4e0d\u200b\u652f\u6301\u200b <code>ROW_NUMBER()</code>, <code>RANK()</code>, <code>LEAD()</code>, <code>LAG()</code> \u200b\u7b49\u200b\u3002</p> <p>\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b: \u200b\u5ba2\u6237\u7aef\u200b\u5904\u7406\u200b\u6216\u200b\u4f7f\u7528\u200b Phase 2\u3002</p>"},{"location":"faq/limitations/#6-transaction","title":"6. \u200b\u4e8b\u52a1\u200b\uff08Transaction\uff09","text":"<p>\u200b\u9650\u5236\u200b: CouchDB \u200b\u4e0d\u200b\u652f\u6301\u200b\u591a\u200b\u6587\u6863\u200b ACID \u200b\u4e8b\u52a1\u200b\u3002</p> <p>\u200b\u7279\u70b9\u200b: - \u2705 \u200b\u5355\u200b\u6587\u6863\u200b\u64cd\u4f5c\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b - \u2705 \u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\uff08<code>bulk_docs</code>\uff09\u200b\u4fdd\u8bc1\u200b\u5168\u90e8\u200b\u6210\u529f\u200b\u6216\u200b\u5168\u90e8\u200b\ufffd\ufffd\ufffd\u200b\u8d25\u200b - \u274c \u200b\u8de8\u200b\u6587\u6863\u200b\u4e8b\u52a1\u200b\u9700\u8981\u200b\u5e94\u7528\u5c42\u200b\u5904\u7406\u200b - \u274c <code>ROLLBACK</code> \u200b\u662f\u200b no-op\uff08\u200b\u65e0\u200b\u64cd\u4f5c\u200b\uff09</p> <p>\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b:</p> <pre><code># \u2705 \u200b\u4f7f\u7528\u200b\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\nfrom sqlalchemy import insert\n\nstmt = insert(users_table)\nconn.execute(stmt, [\n    {\"name\": \"Alice\", \"age\": 30},\n    {\"name\": \"Bob\", \"age\": 25}\n])  # \u200b\u5168\u90e8\u200b\u6210\u529f\u200b\u6216\u200b\u5168\u90e8\u200b\u5931\u8d25\u200b\n\n# \u2705 \u200b\u5355\u200b\u6587\u6863\u200b\u64cd\u4f5c\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\nconn.execute(\n    \"UPDATE users SET balance = balance - 100 WHERE _id = :id\",\n    {\"id\": \"user:1\"}\n)\n\n# \u274c \u200b\u8de8\u200b\u6587\u6863\u200b\u4e8b\u52a1\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\n# \u200b\u9700\u8981\u200b\u5e94\u7528\u5c42\u200b\u5b9e\u73b0\u200b\u8865\u507f\u200b\u903b\u8f91\u200b\ntry:\n    conn.execute(\"UPDATE account_a SET balance = balance - 100\")\n    conn.execute(\"UPDATE account_b SET balance = balance + 100\")\nexcept Exception as e:\n    # \u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u56de\u6eda\u200b account_a\n    pass\n</code></pre>"},{"location":"faq/limitations/#couchdb","title":"CouchDB \u200b\u7279\u5b9a\u200b\u9650\u5236","text":""},{"location":"faq/limitations/#1-_rev","title":"1. _rev \u200b\u7248\u672c\u63a7\u5236","text":"<p>\u200b\u8981\u6c42\u200b: UPDATE/DELETE \u200b\u5fc5\u987b\u200b\u63d0\u4f9b\u200b\u6b63\u786e\u200b\u7684\u200b <code>_rev</code>\u3002</p> <pre><code># \u2705 \u200b\u6b63\u786e\u200b\u7684\u200b\u66f4\u65b0\u200b\u6d41\u7a0b\u200b\n# 1. \u200b\u5148\u200b\u67e5\u8be2\u200b\u83b7\u53d6\u200b _rev\nresult = conn.execute(\n    \"SELECT _id, _rev, name FROM users WHERE _id = :id\",\n    {\"id\": \"user:1\"}\n)\nrow = result.fetchone()\n\n# 2. \u200b\u4f7f\u7528\u200b _rev \u200b\u66f4\u65b0\u200b\nconn.execute(\n    \"UPDATE users SET name = :name WHERE _id = :id AND _rev = :rev\",\n    {\"id\": row._id, \"rev\": row._rev, \"name\": \"New Name\"}\n)\n\n# \u274c \u200b\u4e0d\u200b\u63d0\u4f9b\u200b _rev \u200b\u4f1a\u200b\u5931\u8d25\u200b\nconn.execute(\n    \"UPDATE users SET name = :name WHERE _id = :id\",\n    {\"id\": \"user:1\", \"name\": \"New Name\"}\n)  # \u200b\u9519\u8bef\u200b\uff1a\u200b\u9700\u8981\u200b _rev\n</code></pre> <p>\u200b\u51b2\u7a81\u200b\u5904\u7406\u200b:</p> <pre><code>from sqlalchemy_couchdb.exceptions import OperationalError\n\ntry:\n    conn.execute(update_stmt)\nexcept OperationalError as e:\n    if \"409\" in str(e):  # Conflict\n        # \u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b _rev \u200b\u5e76\u91cd\u200b\u8bd5\u200b\n        pass\n</code></pre>"},{"location":"faq/limitations/#2_1","title":"2. \u200b\u7d22\u5f15\u200b\u9650\u5236","text":"<p>Mango Query \u200b\u7d22\u5f15\u200b\u8981\u6c42\u200b: - ORDER BY \u200b\u5b57\u200b\u6bb5\u200b\u5fc5\u987b\u200b\u6709\u200b\u7d22\u5f15\u200b - \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u590d\u5408\u200b\u7d22\u5f15\u200b - \u200b\u7d22\u5f15\u200b\u521b\u5efa\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b</p> <p>\u200b\u81ea\u52a8\u200b\u7d22\u5f15\u200b:</p> <pre><code># \u2705 ORDER BY \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nconn.execute(\"SELECT * FROM users ORDER BY age\")  # \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b age \u200b\u7d22\u5f15\u200b\n\n# \u2705 \u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\nfrom sqlalchemy_couchdb.management import IndexManager\n\nindex_mgr = IndexManager(client)\nindex_mgr.create_index(\n    'mydb',\n    fields=['age', 'name'],\n    index_name='idx_age_name'\n)\n</code></pre>"},{"location":"faq/limitations/#3","title":"3. \u200b\u67e5\u8be2\u200b\u6027\u80fd","text":"<p>\u200b\u9650\u5236\u200b: - \u200b\u5168\u8868\u200b\u626b\u63cf\u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b - \u200b\u6ca1\u6709\u200b\u7d22\u5f15\u200b\u7684\u200b\u67e5\u8be2\u200b\u4f1a\u200b\u5f88\u6162\u200b - LIKE \u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\u4f4e\u4e8e\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b</p> <p>\u200b\u4f18\u5316\u200b\u5efa\u8bae\u200b:</p> <pre><code># \u274c \u200b\u6162\u200b\uff1a\u200b\u5168\u8868\u200b\u626b\u63cf\u200b\nSELECT * FROM users WHERE description LIKE '%keyword%'\n\n# \u2705 \u200b\u5feb\u200b\uff1a\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\nSELECT * FROM users WHERE status = 'active' AND age &gt; 25\n\n# \u2705 \u200b\u4f7f\u7528\u200b\u5b57\u200b\u6bb5\u200b\u9009\u62e9\u200b\nSELECT _id, name FROM users  # \u200b\u53ea\u200b\u8fd4\u56de\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\n\n# \u2705 \u200b\u4f7f\u7528\u200b LIMIT\nSELECT * FROM users ORDER BY created_at DESC LIMIT 100\n</code></pre>"},{"location":"faq/limitations/#_2","title":"\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u9650\u5236","text":""},{"location":"faq/limitations/#1","title":"1. \u200b\u8fed\u4ee3\u200b\u9650\u5236","text":"<p>\u200b\u9650\u5236\u200b: \u200b\u5f02\u6b65\u200b\u7ed3\u679c\u200b\u4e0d\u200b\u652f\u6301\u200b <code>async for</code>\u3002</p> <pre><code># \u274c \u200b\u4e0d\u200b\u652f\u6301\u200b\nasync for row in result:  # \u200b\u9519\u8bef\u200b\uff01\n    print(row)\n\n# \u2705 \u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\uff08greenlet \u200b\u673a\u5236\u200b\uff09\nresult = await conn.execute(stmt)\nfor row in result:  # \u200b\u6b63\u786e\u200b\n    print(row)\n\n# \u2705 \u200b\u6216\u200b\u4f7f\u7528\u200b fetch \u200b\u65b9\u6cd5\u200b\nrows = result.fetchall()\nfor row in rows:\n    print(row)\n</code></pre> <p>\u200b\u539f\u56e0\u200b: SQLAlchemy 2.0 \u200b\u7684\u200b greenlet \u200b\u673a\u5236\u200b\u9650\u5236\u200b\u3002</p>"},{"location":"faq/limitations/#2_2","title":"2. \u200b\u5e76\u53d1\u200b\u9650\u5236","text":"<p>\u200b\u5efa\u8bae\u200b:</p> <pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\nasync def main():\n    engine = create_async_engine(\n        'couchdb+async://admin:password@localhost:5984/mydb',\n        pool_size=20,  # \u200b\u63a7\u5236\u200b\u8fde\u63a5\u6c60\u200b\u5927\u5c0f\u200b\n        max_overflow=10\n    )\n\n    # \u2705 \u200b\u4f7f\u7528\u200b Semaphore \u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\n    sem = asyncio.Semaphore(10)  # \u200b\u6700\u200b\u591a\u200b 10 \u200b\u4e2a\u200b\u5e76\u53d1\u200b\n\n    async def query_with_limit(id):\n        async with sem:\n            async with engine.connect() as conn:\n                return await conn.execute(\n                    text(\"SELECT * FROM users WHERE _id = :id\"),\n                    {\"id\": id}\n                )\n\n    # \u200b\u5e76\u53d1\u200b\u67e5\u8be2\u200b\n    tasks = [query_with_limit(f\"user:{i}\") for i in range(100)]\n    results = await asyncio.gather(*tasks)\n\nasyncio.run(main())\n</code></pre>"},{"location":"faq/limitations/#_3","title":"\u6570\u636e\u7c7b\u578b\u200b\u9650\u5236","text":""},{"location":"faq/limitations/#1-couchdb","title":"1. CouchDB \u200b\u539f\u751f\u200b\u7c7b\u578b","text":"<p>CouchDB \u200b\u5b58\u50a8\u200b\u7684\u200b\u662f\u200b JSON \u200b\u6587\u6863\u200b\uff0c\u200b\u652f\u6301\u200b\u7684\u200b\u7c7b\u578b\u200b\u6709\u9650\u200b\uff1a</p> \u200b\u652f\u6301\u200b \u200b\u4e0d\u200b\u652f\u6301\u200b String Binary/BLOB Number (int, float) Decimal\uff08\u200b\u7cbe\u5ea6\u200b\uff09 Boolean Enum Date/DateTime\uff08\u200b\u5b57\u7b26\u4e32\u200b\uff09 Time Object/Array \u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b null - <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b:</p> <pre><code># \u2705 Decimal \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5b57\u7b26\u4e32\u200b\u5b58\u50a8\u200b\nfrom decimal import Decimal\nimport json\n\nclass DecimalEncoder(json.JSONEncoder):\n    def default(self, obj):\n        if isinstance(obj, Decimal):\n            return str(obj)\n        return super().default(obj)\n\n# \u2705 Binary \u200b\u6570\u636e\u200b\u4f7f\u7528\u200b\u9644\u4ef6\u200b\nfrom sqlalchemy_couchdb.attachments import AttachmentManager\n\natt_mgr = AttachmentManager(client)\natt_mgr.upload_attachment(\n    doc_id=\"user:1\",\n    filename=\"avatar.jpg\",\n    content=image_bytes,\n    content_type=\"image/jpeg\"\n)\n</code></pre>"},{"location":"faq/limitations/#2_3","title":"2. \u200b\u5b57\u6bb5\u540d\u200b\u9650\u5236","text":"<p>\u200b\u4fdd\u7559\u5b57\u200b\u6bb5\u200b: - <code>_id</code>: \u200b\u6587\u6863\u200b ID\uff08\u200b\u5fc5\u9700\u200b\uff09 - <code>_rev</code>: \u200b\u7248\u672c\u53f7\u200b\uff08\u200b\u81ea\u52a8\u200b\uff09 - <code>type</code>: \u200b\u8868\u540d\u200b\u6620\u5c04\u200b\uff08\u200b\u63a8\u8350\u200b\uff09 - <code>_attachments</code>: \u200b\u9644\u4ef6\u200b\uff08\u200b\u7279\u6b8a\u200b\uff09 - <code>_conflicts</code>: \u200b\u51b2\u7a81\u200b\uff08\u200b\u7279\u6b8a\u200b\uff09 - <code>_deleted</code>: \u200b\u5220\u9664\u200b\u6807\u8bb0\u200b\uff08\u200b\u7279\u6b8a\u200b\uff09</p> <p>\u200b\u547d\u540d\u200b\u5efa\u8bae\u200b: - \u200b\u907f\u514d\u200b\u4ee5\u200b <code>_</code> \u200b\u5f00\u5934\u200b\uff08\u200b\u4fdd\u7559\u200b\u7ed9\u200b CouchDB\uff09 - \u200b\u4f7f\u7528\u200b <code>snake_case</code> - \u200b\u907f\u514d\u200b\u7279\u6b8a\u5b57\u7b26\u200b</p>"},{"location":"faq/limitations/#phase-2","title":"Phase 2 \u200b\u89c4\u5212","text":"<p>\u200b\u4ee5\u4e0b\u200b\u9650\u5236\u200b\u5c06\u200b\u5728\u200b Phase 2\uff08\u200b\u6df7\u5408\u200b\u67b6\u6784\u200b\uff09\u200b\u4e2d\u200b\u89e3\u51b3\u200b\uff1a</p>"},{"location":"faq/limitations/#_4","title":"\u5373\u5c06\u200b\u652f\u6301","text":"<ul> <li>\u2705 JOIN \u200b\u64cd\u4f5c\u200b\uff08\u200b\u901a\u8fc7\u200b RDBMS\uff09</li> <li>\u2705 \u200b\u5b50\u200b\u67e5\u8be2\u200b\uff08\u200b\u901a\u8fc7\u200b RDBMS\uff09</li> <li>\u2705 \u200b\u590d\u6742\u200b GROUP BY\uff08\u200b\u901a\u8fc7\u200b RDBMS\uff09</li> <li>\u2705 \u200b\u7a97\u53e3\u200b\u51fd\u6570\u200b\uff08\u200b\u901a\u8fc7\u200b RDBMS\uff09</li> <li>\u2705 UNION/INTERSECT\uff08\u200b\u901a\u8fc7\u200b RDBMS\uff09</li> <li>\u2705 \u200b\u5b8c\u6574\u200b\u7684\u200b\u4e8b\u52a1\u200b\u652f\u6301\u200b\uff08\u200b\u901a\u8fc7\u200b RDBMS\uff09</li> </ul>"},{"location":"faq/limitations/#_5","title":"\u6df7\u5408\u200b\u67b6\u6784\u200b\u5de5\u4f5c\u200b\u539f\u7406","text":"<pre><code># \u200b\u81ea\u52a8\u200b\u8def\u7531\u200b\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost/pgdb'\n)\n\n# \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\nresult = conn.execute(\"SELECT * FROM users WHERE age &gt; 25\")\n\n# \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 PostgreSQL\nresult = conn.execute(\"\"\"\n    SELECT u.name, COUNT(o.id) as order_count\n    FROM users u\n    JOIN orders o ON u.id = o.user_id\n    GROUP BY u.name\n    HAVING COUNT(o.id) &gt; 10\n\"\"\")  # \u200b\u81ea\u52a8\u200b\u8def\u7531\u200b\u5230\u200b PostgreSQL\n</code></pre>"},{"location":"faq/limitations/#_6","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":""},{"location":"faq/limitations/#1_1","title":"1. \u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u573a\u666f","text":"<p>\u200b\u9002\u5408\u200b\u4f7f\u7528\u200b CouchDB: - \u2705 \u200b\u6587\u6863\u200b\u5b58\u50a8\u200b\uff08\u200b\u7528\u6237\u200b\u8d44\u6599\u200b\u3001\u200b\u914d\u7f6e\u200b\uff09 - \u2705 \u200b\u952e\u503c\u200b\u67e5\u8be2\u200b\uff08\u200b\u6309\u200b ID \u200b\u67e5\u627e\u200b\uff09 - \u2705 \u200b\u7b80\u5355\u200b\u8303\u56f4\u200b\u67e5\u8be2\u200b\uff08\u200b\u5e74\u9f84\u200b\u3001\u200b\u65e5\u671f\u200b\uff09 - \u2705 \u200b\u79bb\u7ebf\u200b\u4f18\u5148\u200b\u5e94\u7528\u200b\uff08\u200b\u590d\u5236\u200b\uff09 - \u2705 \u200b\u9ad8\u53ef\u7528\u6027\u200b\u9700\u6c42\u200b</p> <p>\u200b\u4e0d\u200b\u9002\u5408\u200b\u4f7f\u7528\u200b CouchDB: - \u274c \u200b\u590d\u6742\u200b\u5173\u7cfb\u200b\u67e5\u8be2\u200b - \u274c \u200b\u591a\u8868\u200b\u8054\u63a5\u200b - \u274c \u200b\u590d\u6742\u200b\u805a\u5408\u200b\u7edf\u8ba1\u200b - \u274c \u200b\u5f3a\u200b\u4e00\u81f4\u6027\u200b\u4e8b\u52a1\u200b - \u274c \u200b\u5168\u6587\u200b\u641c\u7d22\u200b\uff08\u200b\u4f7f\u7528\u200b Elasticsearch\uff09</p>"},{"location":"faq/limitations/#2_4","title":"2. \u200b\u6587\u6863\u200b\u8bbe\u8ba1","text":"<p>\u200b\u63a8\u8350\u200b:</p> <pre><code># \u2705 \u200b\u5d4c\u5165\u200b\u76f8\u5173\u200b\u6570\u636e\u200b\nuser_doc = {\n    \"_id\": \"user:1\",\n    \"type\": \"users\",\n    \"name\": \"Alice\",\n    \"profile\": {\n        \"bio\": \"...\",\n        \"avatar_url\": \"...\"\n    },\n    \"recent_orders\": [\n        {\"id\": \"order:1\", \"total\": 100},\n        {\"id\": \"order:2\", \"total\": 200}\n    ]\n}\n\n# \u2705 \u200b\u4f7f\u7528\u200b\u6709\u200b\u610f\u4e49\u200b\u7684\u200b ID\n# \u200b\u683c\u5f0f\u200b: {type}:{unique_id}\n\"user:alice@example.com\"\n\"order:2024-001\"\n\"product:SKU-12345\"\n</code></pre> <p>\u200b\u907f\u514d\u200b:</p> <pre><code># \u274c \u200b\u8fc7\u5ea6\u200b\u89c4\u8303\u5316\u200b\nuser_doc = {\"_id\": \"user:1\", \"name\": \"Alice\"}\nprofile_doc = {\"_id\": \"profile:1\", \"user_id\": \"user:1\", ...}\norders_doc = {\"_id\": \"order:1\", \"user_id\": \"user:1\", ...}\n# \u200b\u8fd9\u200b\u9700\u8981\u200b\u591a\u6b21\u200b\u67e5\u8be2\u200b\uff01\n\n# \u2705 \u200b\u5408\u7406\u200b\u5d4c\u5957\u200b\nuser_doc = {\n    \"_id\": \"user:1\",\n    \"name\": \"Alice\",\n    \"profile\": {...},\n    \"recent_orders\": [...]  # \u200b\u53ea\u200b\u4fdd\u7559\u200b\u6700\u8fd1\u200b\u7684\u200b\n}\n</code></pre>"},{"location":"faq/limitations/#3_1","title":"3. \u200b\u76d1\u63a7\u200b\u548c\u200b\u8c03\u8bd5","text":"<pre><code>import logging\n\n# \u200b\u5f00\u542f\u200b\u65e5\u5fd7\u200b\nlogging.basicConfig(level=logging.DEBUG)\nlogging.getLogger('sqlalchemy_couchdb').setLevel(logging.DEBUG)\n\n# \u200b\u67e5\u770b\u200b\u751f\u6210\u200b\u7684\u200b Mango Query\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\ncompiler = CouchDBCompiler(...)\nmango_query = compiler.process(stmt)\nprint(json.dumps(mango_query, indent=2))\n\n# \u200b\u67e5\u770b\u200b CouchDB \u200b\u67e5\u8be2\u200b\u7edf\u8ba1\u200b\ncurl http://admin:password@localhost:5984/mydb/_index\n</code></pre>"},{"location":"faq/limitations/#_7","title":"\u83b7\u53d6\u200b\u5e2e\u52a9","text":"<p>\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u9650\u5236\u200b\u76f8\u5173\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a</p> <ol> <li>\u200b\u67e5\u770b\u200b\u6587\u6863\u200b: \u200b\u6545\u969c\u200b\u6392\u67e5\u200b\u6307\u5357\u200b</li> <li>\u200b\u63d0\u95ee\u200b: \u200b\u4f7f\u7528\u200b \u200b\u95ee\u9898\u200b\u6a21\u677f\u200b</li> <li>\u200b\u529f\u80fd\u200b\u8bf7\u6c42\u200b: \u200b\u4f7f\u7528\u200b \u200b\u529f\u80fd\u200b\u8bf7\u6c42\u200b\u6a21\u677f\u200b</li> </ol> <p>\u200b\u63d0\u793a\u200b: \u200b\u8bb8\u591a\u200b\u9650\u5236\u200b\u5c06\u200b\u5728\u200b Phase 2 \u200b\u6df7\u5408\u200b\u67b6\u6784\u200b\u4e2d\u200b\u89e3\u51b3\u200b\u3002\u200b\u656c\u8bf7\u671f\u5f85\u200b\uff01</p>"},{"location":"faq/troubleshooting/","title":"\u6545\u969c\u200b\u6392\u67e5\u200b\u6307\u5357","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u63d0\u4f9b\u200b\u5e38\u89c1\u95ee\u9898\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\u548c\u200b\u8c03\u8bd5\u200b\u6280\u5de7\u200b\u3002</p>"},{"location":"faq/troubleshooting/#_2","title":"\u76ee\u5f55","text":"<ul> <li>\u200b\u8fde\u63a5\u200b\u95ee\u9898\u200b</li> <li>\u200b\u67e5\u8be2\u200b\u95ee\u9898\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u95ee\u9898\u200b</li> <li>\u200b\u6df7\u5408\u200b\u67b6\u6784\u200b\u95ee\u9898\u200b</li> <li>\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\u95ee\u9898\u200b</li> <li>\u200b\u8c03\u8bd5\u200b\u6280\u5de7\u200b</li> </ul>"},{"location":"faq/troubleshooting/#_3","title":"\u8fde\u63a5\u200b\u95ee\u9898","text":""},{"location":"faq/troubleshooting/#couchdb","title":"CouchDB \u200b\u8fde\u63a5\u200b\u5931\u8d25","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>httpx.ConnectError: [Errno 61] Connection refused\n</code></pre></p> <p>\u200b\u53ef\u80fd\u200b\u539f\u56e0\u200b: 1. CouchDB \u200b\u670d\u52a1\u200b\u672a\u200b\u542f\u52a8\u200b 2. \u200b\u7aef\u53e3\u53f7\u200b\u9519\u8bef\u200b\uff08\u200b\u9ed8\u8ba4\u200b 5984\uff09 3. \u200b\u9632\u706b\u5899\u200b\u963b\u6b62\u200b\u8fde\u63a5\u200b</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># 1. \u200b\u68c0\u67e5\u200b CouchDB \u200b\u662f\u5426\u200b\u8fd0\u884c\u200b\ncurl http://localhost:5984/\n# \u200b\u5e94\u8be5\u200b\u8fd4\u56de\u200b: {\"couchdb\":\"Welcome\",...}\n\n# 2. \u200b\u68c0\u67e5\u200b\u7aef\u53e3\u200b\nlsof -i :5984\nnetstat -an | grep 5984\n\n# 3. \u200b\u542f\u52a8\u200b CouchDB\n# Docker\ndocker run -d -p 5984:5984 -e COUCHDB_USER=admin -e COUCHDB_PASSWORD=password couchdb:3\n\n# \u200b\u7cfb\u7edf\u200b\u670d\u52a1\u200b\nsudo systemctl start couchdb\n</code></pre></p>"},{"location":"faq/troubleshooting/#_4","title":"\u8ba4\u8bc1\u200b\u9519\u8bef","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>sqlalchemy_couchdb.exceptions.OperationalError: HTTP 401: Unauthorized\n</code></pre></p> <p>\u200b\u53ef\u80fd\u200b\u539f\u56e0\u200b: 1. \u200b\u7528\u6237\u540d\u200b\u6216\u200b\u5bc6\u7801\u200b\u9519\u8bef\u200b 2. \u200b\u6570\u636e\u5e93\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\u4e0d\u8db3\u200b 3. URL \u200b\u683c\u5f0f\u200b\u9519\u8bef\u200b</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u2705 \u200b\u6b63\u786e\u200b\u7684\u200b URL \u200b\u683c\u5f0f\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u274c \u200b\u5e38\u89c1\u200b\u9519\u8bef\u200b\nengine = create_engine('couchdb://localhost:5984/mydb')  # \u200b\u7f3a\u5c11\u200b\u51ed\u8bc1\u200b\nengine = create_engine('couchdb://admin@localhost:5984/mydb')  # \u200b\u7f3a\u5c11\u200b\u5bc6\u7801\u200b\n\n# \u200b\u4f7f\u7528\u200b\u73af\u5883\u53d8\u91cf\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\nimport os\nurl = f\"couchdb://{os.getenv('COUCHDB_USER')}:{os.getenv('COUCHDB_PASSWORD')}@localhost:5984/mydb\"\nengine = create_engine(url)\n</code></pre></p> <p>\u200b\u9a8c\u8bc1\u200b\u51ed\u8bc1\u200b: <pre><code>curl -X GET http://admin:password@localhost:5984/_session\n</code></pre></p>"},{"location":"faq/troubleshooting/#_5","title":"\u8d85\u65f6\u200b\u95ee\u9898","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>httpx.ReadTimeout: Read timeout\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u200b\u589e\u52a0\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    connect_args={\n        'timeout': 30.0,  # 30\u200b\u79d2\u200b\u8d85\u65f6\u200b\n    }\n)\n\n# \u200b\u6216\u8005\u200b\u5728\u200b\u5ba2\u6237\u7aef\u200b\u7ea7\u522b\u200b\u8bbe\u7f6e\u200b\nfrom sqlalchemy_couchdb.client import SyncCouchDBClient\n\nclient = SyncCouchDBClient(\n    'http://admin:password@localhost:5984',\n    timeout=30.0\n)\n</code></pre></p>"},{"location":"faq/troubleshooting/#_6","title":"\u6570\u636e\u5e93\u200b\u4e0d\u200b\u5b58\u5728","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>sqlalchemy_couchdb.exceptions.OperationalError: HTTP 404: Database does not exist\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u200b\u521b\u5efa\u200b\u6570\u636e\u5e93\u200b\ncurl -X PUT http://admin:password@localhost:5984/mydb\n\n# \u200b\u6216\u200b\u5728\u200b Python \u200b\u4e2d\u200b\nfrom sqlalchemy_couchdb.client import SyncCouchDBClient\n\nclient = SyncCouchDBClient('http://admin:password@localhost:5984')\nclient.create_database('mydb')\n</code></pre></p>"},{"location":"faq/troubleshooting/#_7","title":"\u67e5\u8be2\u200b\u95ee\u9898","text":""},{"location":"faq/troubleshooting/#_8","title":"\u6162\u200b\u67e5\u8be2\u200b\u4f18\u5316","text":"<p>\u200b\u75c7\u72b6\u200b: \u200b\u67e5\u8be2\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u8fc7\u957f\u200b</p> <p>\u200b\u8bca\u65ad\u200b: <pre><code>import logging\nimport time\n\n# \u200b\u5f00\u542f\u200b\u65e5\u5fd7\u200b\nlogging.basicConfig(level=logging.INFO)\n\n# \u200b\u6d4b\u91cf\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u200b\nstart = time.time()\nresult = conn.execute(text(\"SELECT * FROM users WHERE age &gt; :age\"), {\"age\": 25})\nrows = list(result)\nprint(f\"\u200b\u67e5\u8be2\u200b\u8017\u65f6\u200b: {time.time() - start:.2f}\u200b\u79d2\u200b\")\nprint(f\"\u200b\u8fd4\u56de\u200b\u884c\u200b\u6570\u200b: {len(rows)}\")\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b:</p> <ol> <li> <p>\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b: <pre><code>from sqlalchemy_couchdb.management import IndexManager\n\nindex_manager = IndexManager(client)\n\n# \u200b\u4e3a\u200b\u7ecf\u5e38\u200b\u67e5\u8be2\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nindex_manager.create_index(\n    'mydb',\n    fields=['age', 'name'],\n    index_name='idx_age_name'\n)\n</code></pre></p> </li> <li> <p>\u200b\u4f7f\u7528\u200b\u5b57\u200b\u6bb5\u200b\u9009\u62e9\u200b: <pre><code># \u274c \u200b\u67e5\u8be2\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b\uff08\u200b\u6162\u200b\uff09\nresult = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n\n# \u2705 \u200b\u53ea\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff08\u200b\u5feb\u200b\uff09\nresult = conn.execute(text(\"SELECT name, email FROM users WHERE age &gt; 25\"))\n</code></pre></p> </li> <li> <p>\u200b\u542f\u7528\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b: <pre><code>from sqlalchemy_couchdb.cache import QueryCache\n\n# \u200b\u521b\u5efa\u200b\u7f13\u5b58\u200b\ncache = QueryCache(max_size=1000, ttl=300)  # 5\u200b\u5206\u949f\u200b TTL\n\n# \u200b\u5728\u200b\u67e5\u8be2\u200b\u524d\u200b\u68c0\u67e5\u200b\u7f13\u5b58\u200b\ncache_key = (query_string, params)\nif cache_key in cache:\n    return cache[cache_key]\n\n# \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\u5e76\u200b\u7f13\u5b58\u200b\u7ed3\u679c\u200b\nresult = conn.execute(query)\nrows = list(result)\ncache[cache_key] = rows\n</code></pre></p> </li> </ol>"},{"location":"faq/troubleshooting/#_9","title":"\u7d22\u5f15\u200b\u7f3a\u5931\u200b\u8b66\u544a","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>WARNING: No index found for query, using sequential scan\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u200b\u67e5\u770b\u200b\u73b0\u6709\u200b\u7d22\u5f15\u200b\nindex_manager.list_indexes('mydb')\n\n# \u200b\u521b\u5efa\u200b\u7f3a\u5931\u200b\u7684\u200b\u7d22\u5f15\u200b\nindex_manager.create_index(\n    'mydb',\n    fields=['age'],\n    index_name='idx_age'\n)\n</code></pre></p>"},{"location":"faq/troubleshooting/#mango-query","title":"Mango Query \u200b\u9650\u5236","text":"<p>\u200b\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b SQL \u200b\u529f\u80fd\u200b: - JOIN \u200b\u64cd\u4f5c\u200b\uff08Phase 1\uff09 - \u200b\u5b50\u200b\u67e5\u8be2\u200b - UNION/INTERSECT - \u200b\u7a97\u53e3\u200b\u51fd\u6570\u200b - \u200b\u590d\u6742\u200b\u7684\u200b\u805a\u5408\u200b\uff08\u200b\u9700\u8981\u200b\u89c6\u56fe\u200b\uff09</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b:</p> <ol> <li> <p>\u200b\u4f7f\u7528\u200b\u6df7\u5408\u200b\u67b6\u6784\u200b (Phase 2): <pre><code># \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u8def\u7531\u200b\u5230\u200b RDBMS\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost/postgres_db'\n)\n</code></pre></p> </li> <li> <p>\u200b\u5ba2\u6237\u7aef\u200b\u5904\u7406\u200b: <pre><code>from sqlalchemy_couchdb.advanced import QueryProcessor\n\n# \u200b\u83b7\u53d6\u200b\u539f\u59cb\u6570\u636e\u200b\nresult = conn.execute(text(\"SELECT * FROM users\"))\nrows = list(result)\n\n# \u200b\u5ba2\u6237\u7aef\u200b\u805a\u5408\u200b\nprocessor = QueryProcessor(rows)\nagg_result = processor.group_by(['department'], {'salary': 'avg'})\n</code></pre></p> </li> </ol>"},{"location":"faq/troubleshooting/#_10","title":"\u5f02\u6b65\u200b\u95ee\u9898","text":""},{"location":"faq/troubleshooting/#greenlet","title":"greenlet \u200b\u9519\u8bef","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>greenlet.error: cannot switch to a different thread\n</code></pre></p> <p>\u200b\u539f\u56e0\u200b: \u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u5728\u200b\u9519\u8bef\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5faa\u73af\u200b\u4e2d\u200b\u6267\u884c\u200b</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\nasync def main():\n    # \u2705 \u200b\u4f7f\u7528\u200b async \u200b\u5f15\u64ce\u200b\n    engine = create_async_engine(\n        'couchdb+async://admin:password@localhost:5984/mydb'\n    )\n\n    async with engine.connect() as conn:\n        result = await conn.execute(text(\"SELECT * FROM users\"))\n        # \u2705 \u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b async for\uff08\u200b\u5f02\u6b65\u200b\u5f15\u64ce\u200b\u4e0d\u200b\u652f\u6301\u200b\uff09\n        rows = result.fetchall()  # \u2705 \u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\n\n    await engine.dispose()\n\n# \u2705 \u200b\u8fd0\u884c\u200b\nasyncio.run(main())\n</code></pre></p>"},{"location":"faq/troubleshooting/#_11","title":"\u4e8b\u4ef6\u200b\u5faa\u73af\u200b\u95ee\u9898","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>RuntimeError: This event loop is already running\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u274c \u200b\u4e0d\u8981\u200b\u5728\u200b\u5df2\u200b\u8fd0\u884c\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5faa\u73af\u200b\u4e2d\u200b\u4f7f\u7528\u200b asyncio.run()\nimport asyncio\n\nasync def query_data():\n    engine = create_async_engine('couchdb+async://...')\n    # ...\n\n# \u274c \u200b\u5728\u200b Jupyter Notebook \u200b\u4e2d\u200b\nasyncio.run(query_data())  # \u200b\u9519\u8bef\u200b\uff01\n\n# \u2705 \u200b\u4f7f\u7528\u200b await\nawait query_data()  # Jupyter \u200b\u4e2d\u200b\u6b63\u786e\u200b\n\n# \u2705 \u200b\u6216\u200b\u4f7f\u7528\u200b nest_asyncio\nimport nest_asyncio\nnest_asyncio.apply()\nasyncio.run(query_data())  # \u200b\u73b0\u5728\u200b\u53ef\u4ee5\u200b\u4e86\u200b\n</code></pre></p>"},{"location":"faq/troubleshooting/#_12","title":"\u5e76\u53d1\u200b\u9650\u5236","text":"<p>\u200b\u75c7\u72b6\u200b: \u200b\u5927\u91cf\u200b\u5e76\u53d1\u200b\u8bf7\u6c42\u200b\u5bfc\u81f4\u200b\u6027\u80fd\u200b\u4e0b\u964d\u200b</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\nasync def main():\n    engine = create_async_engine(\n        'couchdb+async://admin:password@localhost:5984/mydb',\n        pool_size=20,  # \u200b\u9650\u5236\u200b\u8fde\u63a5\u6c60\u200b\u5927\u5c0f\u200b\n        max_overflow=10\n    )\n\n    # \u2705 \u200b\u4f7f\u7528\u200b Semaphore \u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\n    semaphore = asyncio.Semaphore(10)  # \u200b\u6700\u200b\u591a\u200b 10 \u200b\u4e2a\u200b\u5e76\u53d1\u200b\n\n    async def query_with_limit(query):\n        async with semaphore:\n            async with engine.connect() as conn:\n                return await conn.execute(query)\n\n    # \u200b\u6279\u91cf\u200b\u67e5\u8be2\u200b\n    tasks = [query_with_limit(q) for q in queries]\n    results = await asyncio.gather(*tasks)\n\nasyncio.run(main())\n</code></pre></p>"},{"location":"faq/troubleshooting/#_13","title":"\u6df7\u5408\u200b\u67b6\u6784\u200b\u95ee\u9898","text":""},{"location":"faq/troubleshooting/#_14","title":"\u6570\u636e\u200b\u540c\u6b65\u200b\u5931\u8d25","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>DualWriteError: Failed to write to secondary database\n</code></pre></p> <p>\u200b\u8bca\u65ad\u200b: <pre><code>from sqlalchemy_couchdb.hybrid import DualWriteManager\n\nmanager = DualWriteManager(couchdb_engine, rdbms_engine)\n\n# \u200b\u68c0\u67e5\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\nresult = manager.write(data)\nif not result.success:\n    print(f\"\u200b\u5931\u8d25\u200b\u539f\u56e0\u200b: {result.errors}\")\n    print(f\"CouchDB \u200b\u72b6\u6001\u200b: {result.couchdb_success}\")\n    print(f\"RDBMS \u200b\u72b6\u6001\u200b: {result.rdbms_success}\")\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># 1. \u200b\u542f\u7528\u200b\u91cd\u8bd5\u200b\nmanager = DualWriteManager(\n    couchdb_engine,\n    rdbms_engine,\n    retry_config=RetryConfig(max_retries=3)\n)\n\n# 2. \u200b\u4f7f\u7528\u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\nmanager = DualWriteManager(\n    couchdb_engine,\n    rdbms_engine,\n    mode=WriteMode.ASYNC  # \u200b\u5f02\u6b65\u200b\u5199\u5165\u200b\n)\n\n# 3. \u200b\u68c0\u67e5\u200b\u5931\u8d25\u200b\u7684\u200b\u5199\u5165\u200b\nfailed_writes = manager.get_failed_writes()\nfor write in failed_writes:\n    print(f\"\u200b\u5931\u8d25\u200b\u8bb0\u5f55\u200b: {write}\")\n    # \u200b\u624b\u52a8\u200b\u91cd\u8bd5\u200b\n    manager.retry_failed_write(write)\n</code></pre></p>"},{"location":"faq/troubleshooting/#_15","title":"\u8def\u7531\u200b\u51b3\u7b56\u200b\u9519\u8bef","text":"<p>\u200b\u75c7\u72b6\u200b: \u200b\u67e5\u8be2\u200b\u88ab\u200b\u8def\u7531\u200b\u5230\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u5e93\u200b</p> <p>\u200b\u8bca\u65ad\u200b: <pre><code>from sqlalchemy_couchdb.hybrid import QueryRouter\n\nrouter = QueryRouter()\nanalysis = router.analyze_query(query)\n\nprint(f\"\u200b\u67e5\u8be2\u200b\u590d\u6742\u5ea6\u200b: {analysis.complexity}\")\nprint(f\"\u200b\u8def\u7531\u200b\u5230\u200b: {analysis.target_database}\")\nprint(f\"\u200b\u539f\u56e0\u200b: {analysis.reason}\")\nprint(f\"\u200b\u7f6e\u4fe1\u5ea6\u200b: {analysis.confidence}\")\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u200b\u81ea\u5b9a\u4e49\u200b\u8def\u7531\u200b\u89c4\u5219\u200b\nrouter = QueryRouter(\n    complexity_threshold=5,  # \u200b\u8c03\u6574\u200b\u590d\u6742\u5ea6\u200b\u9608\u503c\u200b\n    prefer_couchdb=True  # \u200b\u4f18\u5148\u200b\u4f7f\u7528\u200b CouchDB\n)\n\n# \u200b\u6216\u200b\u624b\u52a8\u200b\u6307\u5b9a\u200b\u8def\u7531\u200b\nwith engine.connect() as conn:\n    # \u200b\u5f3a\u5236\u200b\u4f7f\u7528\u200b CouchDB\n    result = conn.execute(\n        query,\n        execution_options={'force_couchdb': True}\n    )\n</code></pre></p>"},{"location":"faq/troubleshooting/#_16","title":"\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b\u51b2\u7a81","text":"<p>\u200b\u75c7\u72b6\u200b: <pre><code>FieldMappingError: Conflict in field '_id'\n</code></pre></p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>from sqlalchemy_couchdb.hybrid import FieldMapper\n\n# \u200b\u81ea\u5b9a\u4e49\u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b\nmapper = FieldMapper(\n    id_mapping={'_id': 'document_id', 'id': 'record_id'},\n    rev_mapping={'_rev': 'version'}\n)\n\n# \u200b\u5e94\u7528\u200b\u6620\u5c04\u200b\ncouchdb_doc = mapper.to_couchdb(rdbms_record)\nrdbms_record = mapper.to_rdbms(couchdb_doc)\n</code></pre></p>"},{"location":"faq/troubleshooting/#_17","title":"\u6027\u80fd\u200b\u95ee\u9898","text":""},{"location":"faq/troubleshooting/#_18","title":"\u6279\u91cf\u200b\u64cd\u4f5c\u200b\u4f18\u5316","text":"<p>\u200b\u75c7\u72b6\u200b: \u200b\u63d2\u5165\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\u5f88\u200b\u6162\u200b</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>from sqlalchemy import insert\n\n# \u274c \u200b\u9010\u6761\u200b\u63d2\u5165\u200b\uff08\u200b\u6162\u200b\uff09\nfor user in users:\n    conn.execute(insert(users_table).values(user))\n\n# \u2705 \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\uff08\u200b\u5feb\u200b 3-10x\uff09\nconn.execute(insert(users_table), users)\n\n# \u2705 \u200b\u63a7\u5236\u200b\u6279\u6b21\u200b\u5927\u5c0f\u200b\ndef bulk_insert(data, batch_size=100):\n    for i in range(0, len(data), batch_size):\n        batch = data[i:i + batch_size]\n        conn.execute(insert(users_table), batch)\n</code></pre></p>"},{"location":"faq/troubleshooting/#_19","title":"\u7f13\u5b58\u200b\u914d\u7f6e","text":"<p>\u200b\u75c7\u72b6\u200b: \u200b\u91cd\u590d\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\u5dee\u200b</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>from sqlalchemy_couchdb.cache import QueryCache\n\n# \u200b\u5168\u5c40\u200b\u7f13\u5b58\u200b\ncache = QueryCache(\n    max_size=1000,  # \u200b\u6700\u200b\u591a\u200b\u7f13\u5b58\u200b 1000 \u200b\u4e2a\u200b\u67e5\u8be2\u200b\n    ttl=300,  # 5 \u200b\u5206\u949f\u200b\u8fc7\u671f\u200b\n    strategy='lru'  # LRU \u200b\u6dd8\u6c70\u200b\u7b56\u7565\u200b\n)\n\n# \u200b\u67e5\u8be2\u200b\u65f6\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\ndef cached_query(query, params):\n    key = (query, tuple(sorted(params.items())))\n\n    if key in cache:\n        cache_stats = cache.get_stats()\n        print(f\"\u200b\u7f13\u5b58\u200b\u547d\u4e2d\u7387\u200b: {cache_stats['hit_rate']:.1%}\")\n        return cache[key]\n\n    result = conn.execute(text(query), params)\n    rows = list(result)\n    cache[key] = rows\n    return rows\n</code></pre></p>"},{"location":"faq/troubleshooting/#_20","title":"\u8fde\u63a5\u6c60\u200b\u8c03\u4f18","text":"<p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>engine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=20,  # \u200b\u8fde\u63a5\u6c60\u200b\u5927\u5c0f\u200b\n    max_overflow=10,  # \u200b\u6700\u5927\u200b\u6ea2\u51fa\u200b\u8fde\u63a5\u200b\n    pool_timeout=30,  # \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u8d85\u65f6\u200b\n    pool_pre_ping=True,  # \u200b\u4f7f\u7528\u200b\u524d\u200b\u6d4b\u8bd5\u200b\u8fde\u63a5\u200b\n    pool_recycle=3600  # 1\u200b\u5c0f\u65f6\u200b\u56de\u6536\u200b\u8fde\u63a5\u200b\n)\n\n# \u200b\u76d1\u63a7\u200b\u8fde\u63a5\u6c60\u200b\npool = engine.pool\nprint(f\"\u200b\u8fde\u63a5\u6c60\u200b\u5927\u5c0f\u200b: {pool.size()}\")\nprint(f\"\u200b\u6d3b\u8dc3\u200b\u8fde\u63a5\u200b: {pool.checked_out()}\")\n</code></pre></p>"},{"location":"faq/troubleshooting/#_21","title":"\u6d4b\u8bd5\u200b\u95ee\u9898","text":""},{"location":"faq/troubleshooting/#_22","title":"\u6d4b\u8bd5\u73af\u5883\u200b\u8bbe\u7f6e","text":"<p>Docker Compose \u200b\u914d\u7f6e\u200b: <pre><code># docker-compose.test.yml\nversion: '3'\nservices:\n  couchdb:\n    image: couchdb:3\n    ports:\n      - \"5984:5984\"\n    environment:\n      - COUCHDB_USER=admin\n      - COUCHDB_PASSWORD=password\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:5984/_up\"]\n      interval: 5s\n      timeout: 3s\n      retries: 5\n</code></pre></p> <p>\u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b: <pre><code># \u200b\u542f\u52a8\u200b\u6d4b\u8bd5\u73af\u5883\u200b\ndocker-compose -f docker-compose.test.yml up -d\n\n# \u200b\u7b49\u5f85\u200b CouchDB \u200b\u542f\u52a8\u200b\nsleep 10\n\n# \u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u200b\npytest tests/ -v --cov=sqlalchemy_couchdb\n\n# \u200b\u6e05\u7406\u200b\ndocker-compose -f docker-compose.test.yml down\n</code></pre></p>"},{"location":"faq/troubleshooting/#_23","title":"\u8c03\u8bd5\u200b\u6280\u5de7","text":""},{"location":"faq/troubleshooting/#_24","title":"\u5f00\u542f\u200b\u65e5\u5fd7","text":"<pre><code>import logging\n\n# \u200b\u8be6\u7ec6\u200b\u65e5\u5fd7\u200b\nlogging.basicConfig(\n    level=logging.DEBUG,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\n\n# \u200b\u53ea\u200b\u770b\u200b SQLAlchemy \u200b\u65e5\u5fd7\u200b\nlogging.getLogger('sqlalchemy.engine').setLevel(logging.INFO)\nlogging.getLogger('sqlalchemy_couchdb').setLevel(logging.DEBUG)\n</code></pre>"},{"location":"faq/troubleshooting/#mango-query_1","title":"\u67e5\u770b\u200b\u751f\u6210\u200b\u7684\u200b Mango Query","text":"<pre><code>from sqlalchemy import text\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\n# \u200b\u7f16\u8bd1\u200b\u67e5\u8be2\u200b\nstmt = text(\"SELECT * FROM users WHERE age &gt; :age\")\ncompiler = CouchDBCompiler(dialect, stmt)\nmango_query = compiler.process(stmt)\n\nprint(\"\u200b\u751f\u6210\u200b\u7684\u200b Mango Query:\")\nimport json\nprint(json.dumps(mango_query, indent=2))\n</code></pre>"},{"location":"faq/troubleshooting/#_25","title":"\u6027\u80fd\u200b\u5206\u6790","text":"<pre><code>import cProfile\nimport pstats\n\n# \u200b\u6027\u80fd\u200b\u5206\u6790\u200b\nwith cProfile.Profile() as pr:\n    # \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\n    result = conn.execute(query)\n    rows = list(result)\n\n# \u200b\u67e5\u770b\u200b\u7edf\u8ba1\u200b\nstats = pstats.Stats(pr)\nstats.sort_stats('cumulative')\nstats.print_stats(10)  # \u200b\u524d\u200b 10 \u200b\u4e2a\u200b\u6700\u6162\u200b\u7684\u200b\u51fd\u6570\u200b\n</code></pre>"},{"location":"faq/troubleshooting/#couchdb_1","title":"\u68c0\u67e5\u200b CouchDB \u200b\u72b6\u6001","text":"<pre><code># \u200b\u670d\u52a1\u5668\u200b\u4fe1\u606f\u200b\ncurl http://admin:password@localhost:5984/\n\n# \u200b\u6570\u636e\u5e93\u200b\u5217\u8868\u200b\ncurl http://admin:password@localhost:5984/_all_dbs\n\n# \u200b\u6570\u636e\u5e93\u200b\u4fe1\u606f\u200b\ncurl http://admin:password@localhost:5984/mydb\n\n# \u200b\u67e5\u770b\u200b\u7d22\u5f15\u200b\ncurl http://admin:password@localhost:5984/mydb/_index\n\n# \u200b\u67e5\u770b\u200b\u6d3b\u52a8\u200b\u4efb\u52a1\u200b\ncurl http://admin:password@localhost:5984/_active_tasks\n</code></pre>"},{"location":"faq/troubleshooting/#_26","title":"\u5e38\u89c1\u200b\u9519\u8bef\u4ee3\u7801","text":""},{"location":"faq/troubleshooting/#http","title":"HTTP \u200b\u9519\u8bef\u7801","text":"\u9519\u8bef\u7801\u200b \u200b\u542b\u4e49\u200b \u200b\u5e38\u89c1\u200b\u539f\u56e0\u200b 400 Bad Request \u200b\u8bf7\u6c42\u200b\u683c\u5f0f\u200b\u9519\u8bef\u200b\uff0cJSON \u200b\u65e0\u6548\u200b 401 Unauthorized \u200b\u8ba4\u8bc1\u200b\u5931\u8d25\u200b\uff0c\u200b\u7528\u6237\u540d\u200b/\u200b\u5bc6\u7801\u200b\u9519\u8bef\u200b 403 Forbidden \u200b\u6743\u9650\u200b\u4e0d\u8db3\u200b 404 Not Found \u200b\u6570\u636e\u5e93\u200b\u6216\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b 409 Conflict \u200b\u6587\u6863\u200b\u51b2\u7a81\u200b\uff0c<code>_rev</code> \u200b\u4e0d\u200b\u5339\u914d\u200b 412 Precondition Failed \u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6ee1\u8db3\u200b 500 Internal Server Error CouchDB \u200b\u5185\u90e8\u200b\u9519\u8bef"},{"location":"faq/troubleshooting/#sqlalchemy","title":"SQLAlchemy \u200b\u5f02\u5e38","text":"\u5f02\u5e38\u200b \u200b\u542b\u4e49\u200b \u200b\u89e3\u51b3\u65b9\u6848\u200b <code>OperationalError</code> \u200b\u64cd\u4f5c\u200b\u9519\u8bef\u200b \u200b\u68c0\u67e5\u200b\u8fde\u63a5\u200b\u3001\u200b\u7f51\u7edc\u200b\u3001\u200b\u6743\u9650\u200b <code>ProgrammingError</code> \u200b\u7f16\u7a0b\u200b\u9519\u8bef\u200b \u200b\u68c0\u67e5\u200b SQL \u200b\u8bed\u6cd5\u200b <code>IntegrityError</code> \u200b\u5b8c\u6574\u6027\u200b\u9519\u8bef\u200b \u200b\u68c0\u67e5\u200b\u7ea6\u675f\u200b\u3001\u200b\u552f\u4e00\u6027\u200b <code>DataError</code> \u200b\u6570\u636e\u200b\u9519\u8bef\u200b \u200b\u68c0\u67e5\u200b\u6570\u636e\u7c7b\u578b\u200b\u3001\u200b\u683c\u5f0f"},{"location":"faq/troubleshooting/#_27","title":"\u83b7\u53d6\u200b\u5e2e\u52a9","text":"<p>\u200b\u5982\u679c\u200b\u4ee5\u4e0a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u89e3\u51b3\u95ee\u9898\u200b\uff0c\u200b\u8bf7\u200b\uff1a</p> <ol> <li>\u200b\u67e5\u770b\u200b\u6587\u6863\u200b: https://getaix.github.io/sqlalchemy-couchdb</li> <li>\u200b\u641c\u7d22\u200b Issues: https://github.com/getaix/sqlalchemy-couchdb/issues</li> <li>\u200b\u63d0\u4ea4\u200b Bug \u200b\u62a5\u544a\u200b: \u200b\u4f7f\u7528\u200b Bug \u200b\u62a5\u544a\u200b\u6a21\u677f\u200b</li> <li>\u200b\u63d0\u95ee\u200b: \u200b\u4f7f\u7528\u200b \u200b\u95ee\u9898\u200b\u6a21\u677f\u200b</li> </ol> <p>\u200b\u63d0\u793a\u200b: \u200b\u5728\u200b\u63d0\u95ee\u200b\u65f6\u200b\uff0c\u200b\u8bf7\u200b\u63d0\u4f9b\u200b\uff1a - \u200b\u5b8c\u6574\u200b\u7684\u200b\u9519\u8bef\u200b\u5806\u6808\u200b\u4fe1\u606f\u200b - \u200b\u6700\u5c0f\u200b\u53ef\u200b\u590d\u73b0\u200b\u4ee3\u7801\u200b - \u200b\u73af\u5883\u200b\u4fe1\u606f\u200b\uff08Python\u3001CouchDB\u3001\u200b\u5305\u200b\u7248\u672c\u200b\uff09 - \u200b\u65e5\u5fd7\u200b\u8f93\u51fa\u200b</p>"},{"location":"getting-started/basic-usage/","title":"\u57fa\u7840\u200b\u7528\u6cd5","text":""},{"location":"getting-started/basic-usage/#_2","title":"\u7b2c\u4e00\u6b21\u200b\u4f7f\u7528","text":""},{"location":"getting-started/basic-usage/#1","title":"1. \u200b\u521b\u5efa\u200b\u5f15\u64ce","text":"<pre><code>from sqlalchemy import create_engine\n\n# \u200b\u540c\u6b65\u200b\u5f15\u64ce\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u200b\u5f02\u6b65\u200b\u5f15\u64ce\u200b\nfrom sqlalchemy.ext.asyncio import create_async_engine\nengine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n</code></pre>"},{"location":"getting-started/basic-usage/#2","title":"2. \u200b\u5b9a\u4e49\u200b\u8868\u200b\u7ed3\u6784","text":"<pre><code>from sqlalchemy import Table, Column, Integer, String, MetaData\n\nmetadata = MetaData()\n\n# \u200b\u6ce8\u610f\u200b\uff1a\u200b\u5728\u200b CouchDB \u200b\u4e2d\u200b\uff0c\"\u200b\u8868\u200b\"\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u901a\u8fc7\u200b `type` \u200b\u5b57\u200b\u6bb5\u200b\u533a\u5206\u200b\u7684\u200b\nusers = Table('users', metadata,\n    Column('_id', String, primary_key=True),  # CouchDB \u200b\u4e3b\u952e\u200b\n    Column('_rev', String),                    # \u200b\u7248\u672c\u53f7\u200b\uff08\u200b\u7528\u4e8e\u200b\u4e50\u89c2\u200b\u9501\u200b\uff09\n    Column('name', String),\n    Column('age', Integer),\n    Column('email', String),\n    Column('type', String)  # \u200b\u7528\u4e8e\u200b\u533a\u5206\u200b\u6587\u6863\u200b\u7c7b\u578b\u200b\n)\n\n# \u200b\u521b\u5efa\u200b\u8868\u200b\uff08\u200b\u5728\u200b CouchDB \u200b\u4e2d\u200b\u4f1a\u200b\u521b\u5efa\u200b\u89c6\u56fe\u200b\uff09\nmetadata.create_all(engine)\n</code></pre>"},{"location":"getting-started/basic-usage/#3","title":"3. \u200b\u63d2\u5165\u200b\u6570\u636e","text":"<pre><code>from sqlalchemy import text\n\n# \u200b\u65b9\u5f0f\u200b1: \u200b\u4f7f\u7528\u200b\u539f\u751f\u200b SQL\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, email, type)\n        VALUES (:id, :name, :age, :email, 'user')\n    \"\"\"), {\n        'id': 'user:123',\n        'name': 'Alice',\n        'age': 30,\n        'email': 'alice@example.com'\n    })\n    conn.commit()\n\n# \u200b\u65b9\u5f0f\u200b2: \u200b\u4f7f\u7528\u200b\u5b57\u5178\u200b\uff08\u200b\u66f4\u200b\u5e38\u7528\u200b\uff09\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, email, type)\n        VALUES (:_id, :name, :age, :email, 'user')\n        RETURNING *\n    \"\"\"), {\n        '_id': 'user:124',\n        'name': 'Bob',\n        'age': 25,\n        'email': 'bob@example.com'\n    })\n    row = result.fetchone()\n    print(f\"\u200b\u63d2\u5165\u200b\u7684\u200b\u6587\u6863\u200bID: {row._id}\")\n    conn.commit()\n</code></pre>"},{"location":"getting-started/basic-usage/#4","title":"4. \u200b\u67e5\u8be2\u200b\u6570\u636e","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    # \u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users WHERE type = 'user'\n    \"\"\"))\n\n    for row in result:\n        print(f\"ID: {row._id}, \u200b\u59d3\u540d\u200b: {row.name}, \u200b\u5e74\u9f84\u200b: {row.age}\")\n\n    # \u200b\u5e26\u200b\u6761\u4ef6\u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user' AND age &gt; :age\n        ORDER BY age DESC\n        LIMIT 10\n    \"\"\"), {'age': 20})\n\n    for row in result:\n        print(f\"{row.name}: {row.age} \u200b\u5c81\u200b\")\n\n    conn.commit()\n</code></pre>"},{"location":"getting-started/basic-usage/#5","title":"5. \u200b\u66f4\u65b0\u200b\u6570\u636e","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        UPDATE users\n        SET age = :age\n        WHERE _id = :id AND type = 'user'\n        RETURNING *\n    \"\"\"), {\n        'id': 'user:123',\n        'age': 31\n    })\n\n    updated_row = result.fetchone()\n    print(f\"\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u6587\u6863\u200b: {updated_row._id}, _rev: {updated_row._rev}\")\n    conn.commit()\n</code></pre>"},{"location":"getting-started/basic-usage/#6","title":"6. \u200b\u5220\u9664\u200b\u6570\u636e","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        DELETE FROM users\n        WHERE _id = :id AND type = 'user'\n    \"\"\"), {\n        'id': 'user:123'\n    })\n    conn.commit()\n</code></pre>"},{"location":"getting-started/basic-usage/#_3","title":"\u6587\u6863\u200b\u7ed3\u6784","text":""},{"location":"getting-started/basic-usage/#couchdb","title":"CouchDB \u200b\u6587\u6863\u200b\u683c\u5f0f","text":"<p>\u200b\u5728\u200b CouchDB \u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u6587\u6863\u200b\u90fd\u200b\u662f\u200b JSON \u200b\u5bf9\u8c61\u200b\uff1a</p> <pre><code>{\n  \"_id\": \"user:123\",\n  \"_rev\": \"1-abc123def456\",\n  \"type\": \"users\",\n  \"name\": \"Alice\",\n  \"age\": 30,\n  \"email\": \"alice@example.com\"\n}\n</code></pre> <p>\u200b\u5b57\u200b\u6bb5\u200b\u8bf4\u660e\u200b: - <code>_id</code>: \u200b\u6587\u6863\u200b\u552f\u4e00\u200b\u6807\u8bc6\u7b26\u200b - <code>_rev</code>: \u200b\u7248\u672c\u53f7\u200b\uff08\u200b\u7528\u4e8e\u200b\u4e50\u89c2\u200b\u9501\u200b\uff09 - <code>type</code>: \u200b\u6587\u6863\u200b\u7c7b\u578b\u200b\uff08\u200b\u7528\u4e8e\u200b\u6a21\u62df\u200b\"\u200b\u8868\u200b\"\uff09 - \u200b\u5176\u4ed6\u200b\u5b57\u200b\u6bb5\u200b: \u200b\u81ea\u200b\u5b9a\u4e49\u6570\u636e\u200b</p>"},{"location":"getting-started/basic-usage/#_4","title":"\u7c7b\u578b\u200b\u5b57\u200b\u6bb5\u200b\u7ea6\u5b9a","text":"\u8868\u540d\u200b type \u200b\u5b57\u200b\u6bb5\u503c\u200b \u200b\u793a\u4f8b\u200b _id <code>users</code> <code>users</code> <code>user:123</code> <code>orders</code> <code>orders</code> <code>order:456</code> <code>products</code> <code>products</code> <code>product:789</code>"},{"location":"getting-started/basic-usage/#_5","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":""},{"location":"getting-started/basic-usage/#1_1","title":"1. \u200b\u4f7f\u7528\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668","text":"<pre><code># \u2705 \u200b\u63a8\u8350\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"...\"))\n    conn.commit()\n\n# \u274c \u200b\u4e0d\u200b\u63a8\u8350\u200b\nconn = engine.connect()\nconn.execute(text(\"...\"))\nconn.commit()\nconn.close()\n</code></pre>"},{"location":"getting-started/basic-usage/#2_1","title":"2. \u200b\u53c2\u6570\u200b\u5316\u200b\u67e5\u8be2","text":"<pre><code># \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u5b89\u5168\u200b\uff0c\u200b\u9632\u6b62\u200b SQL \u200b\u6ce8\u5165\u200b\nconn.execute(text(\"SELECT * FROM users WHERE age &gt; :age\"), {'age': 20})\n\n# \u274c \u200b\u5371\u9669\u200b\uff1aSQL \u200b\u6ce8\u5165\u200b\u98ce\u9669\u200b\nconn.execute(text(f\"SELECT * FROM users WHERE age &gt; {age}\"))\n</code></pre>"},{"location":"getting-started/basic-usage/#3_1","title":"3. \u200b\u4f7f\u7528\u200b\u4e8b\u52a1","text":"<pre><code>with engine.begin() as conn:  # \u200b\u81ea\u52a8\u200b commit\n    conn.execute(text(\"INSERT INTO users ...\"))\n    conn.execute(text(\"INSERT INTO orders ...\"))\n    # \u200b\u81ea\u52a8\u200b commit\n\n# \u200b\u6216\u200b\u624b\u52a8\u200b\u63a7\u5236\u200b\nwith engine.connect() as conn:\n    try:\n        conn.execute(text(\"INSERT INTO users ...\"))\n        conn.execute(text(\"INSERT INTO orders ...\"))\n        conn.commit()\n    except Exception as e:\n        conn.rollback()\n        raise\n</code></pre>"},{"location":"getting-started/basic-usage/#4_1","title":"4. \u200b\u6279\u91cf\u200b\u64cd\u4f5c","text":"<pre><code># \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\nwith engine.connect() as conn:\n    users_data = [\n        {'_id': 'user:1', 'name': 'Alice', 'type': 'users'},\n        {'_id': 'user:2', 'name': 'Bob', 'type': 'users'},\n        {'_id': 'user:3', 'name': 'Charlie', 'type': 'users'},\n    ]\n\n    for user_data in users_data:\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, type)\n            VALUES (:_id, :name, :type)\n        \"\"\"), user_data)\n\n    conn.commit()\n</code></pre>"},{"location":"getting-started/basic-usage/#_6","title":"\u5e38\u89c1\u200b\u9519\u8bef","text":""},{"location":"getting-started/basic-usage/#1_2","title":"1. \u200b\u4e50\u89c2\u200b\u9501\u200b\u9519\u8bef","text":"<pre><code># \u200b\u5982\u679c\u200b\u6587\u6863\u200b\u5df2\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u4f1a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n# \u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1a\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u6587\u6863\u200b\ntry:\n    conn.execute(text(\"UPDATE users SET age=31 WHERE _id='user:123'\"))\n    conn.commit()\nexcept Exception as e:\n    # \u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u6587\u6863\u200b\n    result = conn.execute(text(\"SELECT * FROM users WHERE _id='user:123'\"))\n    latest_doc = result.fetchone()\n    # \u200b\u91cd\u65b0\u200b\u5c1d\u8bd5\u200b\u66f4\u65b0\u200b\n</code></pre>"},{"location":"getting-started/basic-usage/#2_2","title":"2. \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728","text":"<pre><code># \u200b\u68c0\u67e5\u200b\u6587\u6863\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\nresult = conn.execute(text(\"SELECT * FROM users WHERE _id = :id\"), {'id': 'user:999'})\nif result.rowcount == 0:\n    print(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\nelse:\n    row = result.fetchone()\n</code></pre>"},{"location":"getting-started/basic-usage/#_7","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u8fde\u63a5\u200b\u914d\u7f6e\u200b</li> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b</li> </ul>"},{"location":"getting-started/connection/","title":"\u8fde\u63a5\u200b\u914d\u7f6e","text":""},{"location":"getting-started/connection/#url","title":"\u8fde\u63a5\u200b URL \u200b\u683c\u5f0f","text":""},{"location":"getting-started/connection/#phase-1-couchdb","title":"Phase 1: \u200b\u7eaf\u200b CouchDB","text":"<pre><code># \u200b\u540c\u6b65\u200b\u8fde\u63a5\u200b\ncouchdb://username:password@host:port/database\n\n# \u200b\u5f02\u6b65\u200b\u8fde\u63a5\u200b\ncouchdb+async://username:password@host:port/database\n</code></pre>"},{"location":"getting-started/connection/#phase-2","title":"Phase 2: \u200b\u6df7\u5408\u200b\u6a21\u5f0f","text":"<pre><code>couchdb+hybrid://username:password@host:port/database?secondary_db=&lt;RDBMS_URL&gt;\n</code></pre>"},{"location":"getting-started/connection/#_2","title":"\u8fde\u63a5\u200b\u53c2\u6570\u200b\u8be6\u89e3","text":""},{"location":"getting-started/connection/#_3","title":"\u57fa\u672c\u53c2\u6570","text":"\u53c2\u6570\u200b \u200b\u8bf4\u660e\u200b \u200b\u793a\u4f8b\u200b <code>username</code> CouchDB \u200b\u7528\u6237\u540d\u200b <code>admin</code> <code>password</code> CouchDB \u200b\u5bc6\u7801\u200b <code>password123</code> <code>host</code> CouchDB \u200b\u4e3b\u673a\u200b <code>localhost</code> <code>port</code> CouchDB \u200b\u7aef\u53e3\u200b <code>5984</code> (\u200b\u9ed8\u8ba4\u200b) <code>database</code> \u200b\u6570\u636e\u5e93\u200b\u540d\u200b <code>mydb</code>"},{"location":"getting-started/connection/#url_1","title":"\u793a\u4f8b\u200b URL","text":"<pre><code>from sqlalchemy import create_engine\n\n# \u200b\u57fa\u7840\u200b\u8fde\u63a5\u200b\nengine = create_engine('couchdb://localhost:5984/mydb')\n\n# \u200b\u5e26\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u8fde\u63a5\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u200b\u8fdc\u7a0b\u200b\u8fde\u63a5\u200b\nengine = create_engine('couchdb://user:pass@example.com:5984/production')\n\n# \u200b\u5f02\u6b65\u200b\u8fde\u63a5\u200b\nfrom sqlalchemy.ext.asyncio import create_async_engine\nengine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n</code></pre>"},{"location":"getting-started/connection/#_4","title":"\u8fde\u63a5\u200b\u9009\u9879","text":""},{"location":"getting-started/connection/#1","title":"1. \u200b\u8ba4\u8bc1\u200b\u65b9\u5f0f","text":""},{"location":"getting-started/connection/#_5","title":"\u7528\u6237\u540d\u200b\u5bc6\u7801","text":"<pre><code>engine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n</code></pre>"},{"location":"getting-started/connection/#cookie","title":"Cookie \u200b\u8ba4\u8bc1","text":"<pre><code>engine = create_engine('couchdb://cookie:abc123@localhost:5984/mydb')\n</code></pre>"},{"location":"getting-started/connection/#_6","title":"\u65e0\u200b\u8ba4\u8bc1\u200b\uff08\u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\uff09","text":"<pre><code>engine = create_engine('couchdb://localhost:5984/mydb')\n</code></pre>"},{"location":"getting-started/connection/#2","title":"2. \u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e","text":"<pre><code>from sqlalchemy import create_engine\n\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=10,          # \u200b\u8fde\u63a5\u6c60\u200b\u5927\u5c0f\u200b\n    max_overflow=20,       # \u200b\u6700\u5927\u200b\u6ea2\u51fa\u200b\u8fde\u63a5\u200b\n    pool_recycle=3600,     # \u200b\u8fde\u63a5\u200b\u56de\u6536\u200b\u65f6\u95f4\u200b\uff08\u200b\u79d2\u200b\uff09\n    pool_timeout=30,       # \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n    pool_pre_ping=True,    # \u200b\u8fde\u63a5\u200b\u524d\u200b\u6d4b\u8bd5\u200b\n)\n</code></pre>"},{"location":"getting-started/connection/#3-http","title":"3. HTTP \u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e","text":"<pre><code>from sqlalchemy_couchdb.client import SyncCouchDBClient\n\nclient = SyncCouchDBClient(\n    base_url='http://localhost:5984',\n    username='admin',\n    password='password',\n    database='mydb',\n    timeout=30.0,           # \u200b\u8bf7\u6c42\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n    verify_ssl=True,        # \u200b\u662f\u5426\u200b\u9a8c\u8bc1\u200b SSL \u200b\u8bc1\u4e66\u200b\n    ca_cert_path=None,      # CA \u200b\u8bc1\u4e66\u200b\u8def\u5f84\u200b\n    client_cert_path=None,  # \u200b\u5ba2\u6237\u7aef\u200b\u8bc1\u4e66\u200b\u8def\u5f84\u200b\n    client_key_path=None,   # \u200b\u5ba2\u6237\u7aef\u200b\u5bc6\u94a5\u200b\u8def\u5f84\u200b\n)\n</code></pre>"},{"location":"getting-started/connection/#phase-2_1","title":"Phase 2: \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u8fde\u63a5","text":""},{"location":"getting-started/connection/#_7","title":"\u914d\u7f6e\u200b\u4e8c\u7ea7\u200b\u6570\u636e\u5e93","text":"<pre><code>from sqlalchemy import create_engine\n\n# CouchDB + PostgreSQL\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n)\n\n# CouchDB + MySQL\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=mysql+pymysql://user:pass@localhost:3306/mydb'\n)\n\n# CouchDB + SQLite\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=sqlite:///mydb.sqlite'\n)\n</code></pre>"},{"location":"getting-started/connection/#url_2","title":"URL \u200b\u67e5\u8be2\u200b\u53c2\u6570","text":"\u53c2\u6570\u200b \u200b\u8bf4\u660e\u200b \u200b\u793a\u4f8b\u200b <code>secondary_db</code> \u200b\u4e8c\u7ea7\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b URL <code>postgresql://...</code> <code>routing_strategy</code> \u200b\u8def\u7531\u200b\u7b56\u7565\u200b <code>simple</code>, <code>hybrid</code>, <code>all</code> <code>write_mode</code> \u200b\u5199\u200b\u64cd\u4f5c\u200b\u6a21\u5f0f\u200b <code>couchdb_only</code>, <code>dual_write</code>, <code>rdbms_only</code> <code>consistency_check</code> \u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b <code>true</code>, <code>false</code> <code>check_interval</code> \u200b\u68c0\u67e5\u200b\u95f4\u9694\u200b\uff08\u200b\u79d2\u200b\uff09 <code>60</code>"},{"location":"getting-started/connection/#_8","title":"\u5b8c\u6574\u200b\u793a\u4f8b","text":"<pre><code>engine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n    '&amp;routing_strategy=hybrid'\n    '&amp;write_mode=dual_write'\n    '&amp;consistency_check=true'\n    '&amp;check_interval=120'\n)\n</code></pre>"},{"location":"getting-started/connection/#_9","title":"\u73af\u5883\u53d8\u91cf\u200b\u914d\u7f6e","text":""},{"location":"getting-started/connection/#env","title":"\u4f7f\u7528\u200b .env \u200b\u6587\u4ef6","text":"<pre><code>import os\nfrom sqlalchemy import create_engine\n\n# \u200b\u4ece\u200b\u73af\u5883\u53d8\u91cf\u200b\u8bfb\u53d6\u200b\u914d\u7f6e\u200b\nCOUCHDB_HOST = os.getenv('COUCHDB_HOST', 'localhost')\nCOUCHDB_PORT = os.getenv('COUCHDB_PORT', '5984')\nCOUCHDB_USER = os.getenv('COUCHDB_USER', 'admin')\nCOUCHDB_PASSWORD = os.getenv('COUCHDB_PASSWORD', '')\nCOUCHDB_DATABASE = os.getenv('COUCHDB_DATABASE', 'mydb')\n\nengine = create_engine(\n    f'couchdb://{COUCHDB_USER}:{COUCHDB_PASSWORD}@{COUCHDB_HOST}:{COUCHDB_PORT}/{COUCHDB_DATABASE}'\n)\n</code></pre>"},{"location":"getting-started/connection/#_10","title":"\u73af\u5883\u53d8\u91cf\u200b\u6e05\u5355","text":"<pre><code># CouchDB \u200b\u914d\u7f6e\u200b\nexport COUCHDB_HOST=localhost\nexport COUCHDB_PORT=5984\nexport COUCHDB_USER=admin\nexport COUCHDB_PASSWORD=password\nexport COUCHDB_DATABASE=mydb\n\n# Phase 2 \u200b\u914d\u7f6e\u200b\nexport SECONDARY_DB_URL=postgresql://user:pass@localhost:5432/mydb\nexport ROUTING_STRATEGY=hybrid\nexport WRITE_MODE=dual_write\nexport CONSISTENCY_CHECK=true\nexport CHECK_INTERVAL=120\n</code></pre>"},{"location":"getting-started/connection/#ssltls","title":"SSL/TLS \u200b\u914d\u7f6e","text":""},{"location":"getting-started/connection/#https","title":"HTTPS \u200b\u8fde\u63a5","text":"<pre><code>engine = create_engine(\n    'couchdb://admin:password@secure-couchdb.com:6984/mydb',\n    connect_args={\n        'verify_ssl': True,\n        'ca_cert_path': '/path/to/ca-cert.pem',\n    }\n)\n</code></pre>"},{"location":"getting-started/connection/#_11","title":"\u5ba2\u6237\u7aef\u200b\u8bc1\u4e66","text":"<pre><code>engine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    connect_args={\n        'client_cert_path': '/path/to/client-cert.pem',\n        'client_key_path': '/path/to/client-key.pem',\n        'verify_ssl': True,\n    }\n)\n</code></pre>"},{"location":"getting-started/connection/#_12","title":"\u8fde\u63a5\u200b\u6d4b\u8bd5","text":""},{"location":"getting-started/connection/#_13","title":"\u6d4b\u8bd5\u200b\u8fde\u63a5","text":"<pre><code>from sqlalchemy import text\n\ndef test_connection(engine):\n    try:\n        with engine.connect() as conn:\n            # ping CouchDB\n            result = conn.execute(text(\"SELECT 1\"))\n            print(\"\u2705 \u200b\u8fde\u63a5\u200b\u6210\u529f\u200b\")\n            return True\n    except Exception as e:\n        print(f\"\u274c \u200b\u8fde\u63a5\u200b\u5931\u8d25\u200b: {e}\")\n        return False\n\n# \u200b\u4f7f\u7528\u200b\ntest_connection(engine)\n</code></pre>"},{"location":"getting-started/connection/#_14","title":"\u68c0\u67e5\u200b\u6570\u636e\u5e93\u200b\u72b6\u6001","text":"<pre><code>def check_database_status(engine):\n    try:\n        with engine.connect() as conn:\n            # \u200b\u83b7\u53d6\u200b\u6570\u636e\u5e93\u200b\u4fe1\u606f\u200b\n            result = conn.execute(text(\"SELECT db_name, doc_count FROM information_schema.tables WHERE table_type='BASE TABLE'\"))\n            # \u200b\u6ce8\u610f\u200b\uff1aCouchDB \u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\n            print(\"\u200b\u6570\u636e\u5e93\u200b\u72b6\u6001\u200b\u6b63\u5e38\u200b\")\n    except Exception as e:\n        print(f\"\u200b\u6570\u636e\u5e93\u200b\u72b6\u6001\u200b\u5f02\u5e38\u200b: {e}\")\n\ncheck_database_status(engine)\n</code></pre>"},{"location":"getting-started/connection/#_15","title":"\u8fde\u63a5\u6c60\u200b\u76d1\u63a7","text":""},{"location":"getting-started/connection/#_16","title":"\u76d1\u63a7\u200b\u8fde\u63a5\u6c60\u200b\u72b6\u6001","text":"<pre><code>from sqlalchemy.pool import StaticPool\n\ndef monitor_pool(engine):\n    pool = engine.pool\n    print(f\"\u200b\u6c60\u200b\u5927\u5c0f\u200b: {pool.size()}\")\n    print(f\"\u200b\u5df2\u200b\u68c0\u67e5\u200b out \u200b\u6570\u91cf\u200b: {pool.checkedout()}\")\n    print(f\"\u200b\u5df2\u200b\u8fd4\u56de\u200b\u6570\u91cf\u200b: {pool.returned()}\")\n\nmonitor_pool(engine)\n</code></pre>"},{"location":"getting-started/connection/#_17","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"getting-started/connection/#1_1","title":"1. \u200b\u8fde\u63a5\u200b\u8d85\u65f6","text":"<pre><code># \u200b\u589e\u52a0\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    connect_args={'timeout': 60.0}\n)\n</code></pre>"},{"location":"getting-started/connection/#2_1","title":"2. \u200b\u8fde\u63a5\u6c60\u200b\u8017\u5c3d","text":"<pre><code># \u200b\u589e\u52a0\u200b\u6c60\u200b\u5927\u5c0f\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=20,\n    max_overflow=30,\n)\n</code></pre>"},{"location":"getting-started/connection/#3-ssl","title":"3. SSL \u200b\u9a8c\u8bc1\u200b\u5931\u8d25","text":"<pre><code># \u200b\u7981\u7528\u200b SSL \u200b\u9a8c\u8bc1\u200b\uff08\u200b\u4ec5\u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\uff09\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    connect_args={'verify_ssl': False}\n)\n</code></pre>"},{"location":"getting-started/connection/#_18","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u6a21\u5f0f\u200b</li> </ul>"},{"location":"getting-started/installation/","title":"\u5b89\u88c5\u200b\u6307\u5357","text":""},{"location":"getting-started/installation/#_2","title":"\u7cfb\u7edf\u200b\u8981\u6c42","text":"<ul> <li>Python: 3.11 \u200b\u6216\u200b\u66f4\u200b\u9ad8\u200b\u7248\u672c\u200b</li> <li>SQLAlchemy: 2.0.0 \u200b\u6216\u200b\u66f4\u200b\u9ad8\u200b\u7248\u672c\u200b</li> <li>httpx: 0.27.0 \u200b\u6216\u200b\u66f4\u200b\u9ad8\u200b\u7248\u672c\u200b</li> </ul>"},{"location":"getting-started/installation/#_3","title":"\u5b89\u88c5\u200b\u65b9\u5f0f","text":""},{"location":"getting-started/installation/#_4","title":"\u57fa\u7840\u200b\u5b89\u88c5","text":"<pre><code>pip install sqlalchemy-couchdb\n</code></pre>"},{"location":"getting-started/installation/#_5","title":"\u5f00\u53d1\u200b\u5b89\u88c5","text":"<pre><code>git clone https://github.com/getaix/sqlalchemy-couchdb.git\ncd sqlalchemy-couchdb\n\n# \u200b\u521b\u5efa\u200b\u865a\u62df\u73af\u5883\u200b\npython -m venv .venv\nsource .venv/bin/activate  # Linux/Mac\n# .venv\\Scripts\\activate  # Windows\n\n# \u200b\u5b89\u88c5\u200b\u5f00\u53d1\u200b\u4f9d\u8d56\u200b\npip install -e \".[dev]\"\n\n# \u200b\u5b89\u88c5\u200b\u53ef\u200b\u9009\u200b\u4f9d\u8d56\u200b\uff08\u200b\u7528\u4e8e\u200b Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\uff09\npip install -e \".[postgres]\"     # PostgreSQL\npip install -e \".[mysql]\"        # MySQL\npip install -e \".[all]\"          # \u200b\u6240\u6709\u200b\u6570\u636e\u5e93\u200b\n</code></pre>"},{"location":"getting-started/installation/#_6","title":"\u9a8c\u8bc1\u200b\u5b89\u88c5","text":"<pre><code>import sqlalchemy_couchdb\n\nprint(f\"SQLAlchemy CouchDB \u200b\u7248\u672c\u200b: {sqlalchemy_couchdb.__version__}\")\n</code></pre>"},{"location":"getting-started/installation/#_7","title":"\u53ef\u200b\u9009\u200b\u4f9d\u8d56","text":""},{"location":"getting-started/installation/#phase-2","title":"Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f","text":"<pre><code># PostgreSQL \u200b\u652f\u6301\u200b\npip install sqlalchemy-couchdb[postgres]\n# \u200b\u6216\u200b\npip install \"sqlalchemy-couchdb[postgres]\"\n\n# MySQL \u200b\u652f\u6301\u200b\npip install sqlalchemy-couchdb[mysql]\n\n# \u200b\u6240\u6709\u200b\u6570\u636e\u5e93\u200b\u652f\u6301\u200b\npip install sqlalchemy-couchdb[all]\n</code></pre>"},{"location":"getting-started/installation/#couchdb","title":"\u8bbe\u7f6e\u200b CouchDB","text":""},{"location":"getting-started/installation/#docker","title":"\u4f7f\u7528\u200b Docker","text":"<pre><code>docker run -d -p 5984:5984 \\\n  -e COUCHDB_USER=admin \\\n  -e COUCHDB_PASSWORD=password \\\n  --name couchdb couchdb:3\n\n# \u200b\u521b\u5efa\u200b\u6570\u636e\u5e93\u200b\ncurl -X PUT http://admin:password@localhost:5984/testdb\n</code></pre>"},{"location":"getting-started/installation/#_8","title":"\u624b\u52a8\u200b\u5b89\u88c5","text":"<ol> <li>\u200b\u4e0b\u8f7d\u200b CouchDB: https://couchdb.apache.org/#download</li> <li>\u200b\u5b89\u88c5\u200b\u5e76\u200b\u542f\u52a8\u200b\u670d\u52a1\u200b</li> <li>\u200b\u901a\u8fc7\u200b\u7ba1\u7406\u200b\u754c\u9762\u200b\u521b\u5efa\u200b\u6570\u636e\u5e93\u200b</li> <li>\u200b\u521b\u5efa\u200b\u7ba1\u7406\u5458\u200b\u8d26\u6237\u200b</li> </ol>"},{"location":"getting-started/installation/#_9","title":"\u73af\u5883\u53d8\u91cf","text":"<pre><code># .env \u200b\u6587\u4ef6\u200b\nexport COUCHDB_HOST=localhost\nexport COUCHDB_PORT=5984\nexport COUCHDB_USER=admin\nexport COUCHDB_PASSWORD=password\nexport COUCHDB_DATABASE=mydb\n\n# Phase 2 \u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\nexport SECONDARY_DB_URL=postgresql://user:pass@localhost:5432/mydb\n</code></pre>"},{"location":"getting-started/installation/#_10","title":"\u6545\u969c\u200b\u6392\u9664","text":""},{"location":"getting-started/installation/#_11","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"getting-started/installation/#1-importerror-no-module-named-sqlalchemy_couchdb","title":"1. ImportError: No module named 'sqlalchemy_couchdb'","text":"<p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>pip install sqlalchemy-couchdb\n# \u200b\u6216\u8005\u200b\npip install -e .\n</code></pre></p>"},{"location":"getting-started/installation/#2-httpx","title":"2. httpx \u200b\u517c\u5bb9\u6027\u95ee\u9898","text":"<p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code>pip install --upgrade httpx\n</code></pre></p>"},{"location":"getting-started/installation/#3-python","title":"3. Python \u200b\u7248\u672c\u200b\u4e0d\u200b\u517c\u5bb9","text":"<p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u200b\u68c0\u67e5\u200b Python \u200b\u7248\u672c\u200b\npython --version  # \u200b\u5e94\u8be5\u200b\u662f\u200b 3.11+\n\n# \u200b\u5982\u679c\u200b\u7248\u672c\u200b\u8fc7\u4f4e\u200b\uff0c\u200b\u5347\u7ea7\u200b Python\n# \u200b\u6216\u200b\u4f7f\u7528\u200b pyenv \u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u7248\u672c\u200b\npyenv install 3.11.0\npyenv local 3.11.0\n</code></pre></p>"},{"location":"getting-started/installation/#4-couchdb","title":"4. CouchDB \u200b\u8fde\u63a5\u200b\u5931\u8d25","text":"<p>\u200b\u89e3\u51b3\u65b9\u6848\u200b: <pre><code># \u200b\u68c0\u67e5\u200b CouchDB \u200b\u670d\u52a1\u200b\u72b6\u6001\u200b\ncurl http://localhost:5984/\n\n# \u200b\u68c0\u67e5\u200b\u9632\u706b\u5899\u200b\u8bbe\u7f6e\u200b\nsudo ufw status  # Ubuntu/Debian\nsudo firewall-cmd --list-ports  # CentOS/RHEL\n\n# \u200b\u68c0\u67e5\u200b\u7aef\u53e3\u200b\u662f\u5426\u200b\u88ab\u200b\u5360\u7528\u200b\nnetstat -tulpn | grep 5984\n</code></pre></p>"},{"location":"getting-started/installation/#_12","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"getting-started/installation/#_13","title":"\u5b89\u88c5\u200b\u5efa\u8bae","text":"<ol> <li>\u200b\u4f7f\u7528\u200b\u865a\u62df\u73af\u5883\u200b: \u200b\u907f\u514d\u200b\u4f9d\u8d56\u200b\u51b2\u7a81\u200b</li> <li>\u200b\u542f\u7528\u200b\u7f13\u5b58\u200b: \u200b\u5b89\u88c5\u200b uv \u200b\u6216\u200b\u542f\u7528\u200b pip \u200b\u7f13\u5b58\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u4e8c\u8fdb\u5236\u200b\u8f6e\u5b50\u200b: \u200b\u907f\u514d\u200b\u4ece\u200b\u6e90\u7801\u200b\u7f16\u8bd1\u200b</li> </ol> <pre><code># \u200b\u4f7f\u7528\u200b uv \u200b\u5feb\u901f\u200b\u5b89\u88c5\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\nuv pip install sqlalchemy-couchdb\n\n# \u200b\u6216\u200b\u542f\u7528\u200b pip \u200b\u7f13\u5b58\u200b\npip install --cache-dir ~/.pip/cache sqlalchemy-couchdb\n</code></pre>"},{"location":"getting-started/installation/#_14","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u57fa\u7840\u200b\u7528\u6cd5\u200b</li> <li>\u200b\u8fde\u63a5\u200b\u914d\u7f6e\u200b</li> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> </ul>"},{"location":"guide/advanced-features/","title":"SQLAlchemy CouchDB - \u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u6587\u6863","text":"<p>\u200b\u7248\u672c\u200b: 0.1.0 (Phase 1 \u200b\u589e\u5f3a\u200b) \u200b\u65e5\u671f\u200b: 2025-11-03 \u200b\u72b6\u6001\u200b: \u2705 \u200b\u751f\u4ea7\u200b\u53ef\u7528\u200b</p>"},{"location":"guide/advanced-features/#_1","title":"\ud83d\udcda \u200b\u76ee\u5f55","text":"<ol> <li>\u200b\u9519\u8bef\u5904\u7406\u200b\u589e\u5f3a\u200b</li> <li>\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u9ad8\u7ea7\u200b\u67e5\u8be2\u200b\u652f\u6301\u200b</li> <li>\u200b\u7d22\u5f15\u200b\u7ba1\u7406\u200b</li> <li>\u200b\u89c6\u56fe\u200b\u7ba1\u7406\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u5efa\u8bae\u200b</li> </ol>"},{"location":"guide/advanced-features/#1","title":"1. \u200b\u9519\u8bef\u5904\u7406\u200b\u589e\u5f3a","text":""},{"location":"guide/advanced-features/#_2","title":"\u91cd\u8bd5\u200b\u673a\u5236","text":"<p>\u200b\u81ea\u52a8\u200b\u91cd\u8bd5\u200b\u7f51\u7edc\u200b\u9519\u8bef\u200b\u3001\u200b\u8d85\u65f6\u200b\u7b49\u200b\u4e34\u65f6\u6027\u200b\u6545\u969c\u200b\u3002</p>"},{"location":"guide/advanced-features/#_3","title":"\u57fa\u7840\u200b\u7528\u6cd5","text":"<pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy_couchdb.retry import RetryConfig\n\n# \u200b\u914d\u7f6e\u200b\u91cd\u8bd5\u200b\u7b56\u7565\u200b\nretry_config = RetryConfig(\n    max_retries=3,          # \u200b\u6700\u5927\u200b\u91cd\u8bd5\u200b3\u200b\u6b21\u200b\n    retry_delay=0.5,        # \u200b\u521d\u59cb\u200b\u5ef6\u8fdf\u200b0.5\u200b\u79d2\u200b\n    backoff_factor=2.0,     # \u200b\u6bcf\u6b21\u200b\u5ef6\u8fdf\u200b\u7ffb\u500d\u200b\n    retry_on_status_codes=(502, 503, 504)  # \u200b\u91cd\u8bd5\u200b\u8fd9\u4e9b\u200bHTTP\u200b\u72b6\u6001\u200b\u7801\u200b\n)\n\n# \u200b\u521b\u5efa\u200b\u5f15\u64ce\u200b\u65f6\u200b\u4f20\u5165\u200b\u91cd\u8bd5\u200b\u914d\u7f6e\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    connect_args={'retry_config': retry_config}\n)\n</code></pre>"},{"location":"guide/advanced-features/#_4","title":"\u88c5\u9970\u200b\u5668\u200b\u7528\u6cd5","text":"<pre><code>from sqlalchemy_couchdb.retry import with_retry, RetryConfig\n\n@with_retry(RetryConfig(max_retries=5))\ndef my_critical_operation():\n    # \u200b\u53ef\u80fd\u200b\u5931\u8d25\u200b\u7684\u200b\u64cd\u4f5c\u200b\n    return client.find({\"type\": \"users\"})\n</code></pre>"},{"location":"guide/advanced-features/#_5","title":"\u7279\u6027","text":"<ul> <li>\u2705 \u200b\u6307\u6570\u200b\u9000\u907f\u200b\u7b56\u7565\u200b\uff08\u200b\u907f\u514d\u200b\u670d\u52a1\u5668\u200b\u8fc7\u8f7d\u200b\uff09</li> <li>\u2705 \u200b\u53ef\u200b\u914d\u7f6e\u200b\u91cd\u8bd5\u200b\u6b21\u6570\u200b\u548c\u200b\u5ef6\u8fdf\u200b</li> <li>\u2705 \u200b\u81ea\u5b9a\u4e49\u200b\u91cd\u8bd5\u200b\u72b6\u6001\u200b\u7801\u200b</li> <li>\u2705 \u200b\u540c\u6b65\u200b\u548c\u200b\u5f02\u6b65\u200b\u652f\u6301\u200b</li> </ul>"},{"location":"guide/advanced-features/#2","title":"2. \u200b\u67e5\u8be2\u200b\u7f13\u5b58","text":""},{"location":"guide/advanced-features/#lru-ttl","title":"LRU \u200b\u7f13\u5b58\u200b + TTL","text":"<p>\u200b\u81ea\u52a8\u200b\u7f13\u5b58\u200b\u67e5\u8be2\u200b\u7ed3\u679c\u200b\uff0c\u200b\u51cf\u5c11\u200b\u6570\u636e\u5e93\u200b\u8bbf\u95ee\u200b\u3002</p>"},{"location":"guide/advanced-features/#_6","title":"\u542f\u7528\u200b\u7f13\u5b58","text":"<pre><code>from sqlalchemy_couchdb.client import SyncCouchDBClient\n\nclient = SyncCouchDBClient(\n    host=\"localhost\",\n    port=5984,\n    username=\"admin\",\n    password=\"password\",\n    database=\"mydb\",\n    enable_cache=True,     # \u200b\u542f\u7528\u200b\u7f13\u5b58\u200b\n    cache_size=100,        # \u200b\u7f13\u5b58\u200b100\u200b\u4e2a\u200b\u67e5\u8be2\u200b\n    cache_ttl=300.0,       # 5\u200b\u5206\u949f\u200b\u8fc7\u671f\u200b\n)\n</code></pre>"},{"location":"guide/advanced-features/#_7","title":"\u4f7f\u7528\u200b\u7f13\u5b58","text":"<pre><code># \u200b\u7b2c\u4e00\u6b21\u200b\u67e5\u8be2\u200b\uff08\u200b\u4ece\u200b\u6570\u636e\u5e93\u200b\uff09\nresults1 = client.find({\"age\": {\"$gt\": 25}}, use_cache=True)\n\n# \u200b\u7b2c\u4e8c\u6b21\u200b\u67e5\u8be2\u200b\uff08\u200b\u4ece\u200b\u7f13\u5b58\u200b\uff0c\u200b\u901f\u5ea6\u200b\u5feb\u200b\uff01\uff09\nresults2 = client.find({\"age\": {\"$gt\": 25}}, use_cache=True)\n\n# \u200b\u67e5\u770b\u200b\u7f13\u5b58\u200b\u7edf\u8ba1\u200b\nstats = client.cache.get_stats()\nprint(f\"\u200b\u7f13\u5b58\u200b\u547d\u4e2d\u7387\u200b: {stats['hit_rate']}\")\nprint(f\"\u200b\u7f13\u5b58\u200b\u5927\u5c0f\u200b: {stats['size']}/{stats['max_size']}\")\n</code></pre>"},{"location":"guide/advanced-features/#_8","title":"\u7f13\u5b58\u200b\u5931\u6548","text":"<pre><code># \u200b\u6e05\u7a7a\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\nclient.cache.clear()\n\n# \u200b\u4f7f\u200b\u7279\u5b9a\u200b\u8868\u200b\u7684\u200b\u7f13\u5b58\u200b\u5931\u6548\u200b\nclient.cache.invalidate(table=\"users\")\n</code></pre>"},{"location":"guide/advanced-features/#_9","title":"\u7279\u6027","text":"<ul> <li>\u2705 LRU\uff08\u200b\u6700\u8fd1\u200b\u6700\u5c11\u200b\u4f7f\u7528\u200b\uff09\u200b\u7b56\u7565\u200b</li> <li>\u2705 TTL\uff08\u200b\u751f\u5b58\u200b\u65f6\u95f4\u200b\uff09\u200b\u652f\u6301\u200b</li> <li>\u2705 \u200b\u81ea\u52a8\u200b\u7f13\u5b58\u200b\u5931\u6548\u200b\uff08INSERT/UPDATE/DELETE \u200b\u540e\u200b\uff09</li> <li>\u2705 \u200b\u7f13\u5b58\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b</li> </ul>"},{"location":"guide/advanced-features/#3","title":"3. \u200b\u9ad8\u7ea7\u200b\u67e5\u8be2\u200b\u652f\u6301","text":""},{"location":"guide/advanced-features/#_10","title":"\u805a\u5408\u200b\u51fd\u6570","text":"<p>\u200b\u5728\u200b\u5ba2\u6237\u7aef\u200b\u5b9e\u73b0\u200b\u805a\u5408\u200b\u529f\u80fd\u200b\uff08CouchDB \u200b\u539f\u751f\u200b\u4e0d\u200b\u652f\u6301\u200b\uff09\u3002</p>"},{"location":"guide/advanced-features/#count","title":"COUNT","text":"<pre><code>from sqlalchemy_couchdb.advanced import QueryProcessor\n\n# \u200b\u67e5\u8be2\u200b\u6570\u636e\u200b\nresults = client.find({\"type\": \"users\"})\n\n# \u200b\u8ba1\u6570\u200b\ntotal_count = QueryProcessor.count(results)\nprint(f\"\u200b\u603b\u200b\u7528\u6237\u6570\u200b: {total_count}\")\n\n# \u200b\u4e0d\u540c\u200b\u503c\u200b\u8ba1\u6570\u200b\ndept_count = QueryProcessor.count_distinct(results, \"department\")\nprint(f\"\u200b\u90e8\u95e8\u200b\u6570\u200b: {dept_count}\")\n</code></pre>"},{"location":"guide/advanced-features/#sum-avg-min-max","title":"SUM / AVG / MIN / MAX","text":"<pre><code># \u200b\u6c42\u548c\u200b\ntotal_salary = QueryProcessor.sum(results, \"salary\")\nprint(f\"\u200b\u5de5\u8d44\u200b\u603b\u548c\u200b: ${total_salary:,.2f}\")\n\n# \u200b\u5e73\u5747\u503c\u200b\navg_salary = QueryProcessor.avg(results, \"salary\")\nprint(f\"\u200b\u5e73\u5747\u5de5\u8d44\u200b: ${avg_salary:,.2f}\")\n\n# \u200b\u6700\u5c0f\u503c\u200b\u548c\u200b\u6700\u5927\u503c\u200b\nmin_age = QueryProcessor.min(results, \"age\")\nmax_age = QueryProcessor.max(results, \"age\")\nprint(f\"\u200b\u5e74\u9f84\u200b\u8303\u56f4\u200b: {min_age} - {max_age}\")\n</code></pre>"},{"location":"guide/advanced-features/#group-by","title":"GROUP BY","text":"<pre><code># \u200b\u6309\u200b\u90e8\u95e8\u200b\u5206\u7ec4\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5e73\u5747\u5de5\u8d44\u200b\ngrouped = QueryProcessor.group_by(\n    results,\n    group_fields=[\"department\"],\n    aggregate_func=\"avg\",\n    aggregate_field=\"salary\"\n)\n\nfor row in grouped:\n    print(f\"{row['department']}: ${row['avg_salary']:,.2f}\")\n</code></pre>"},{"location":"guide/advanced-features/#distinct","title":"DISTINCT","text":"<pre><code># \u200b\u53bb\u200b\u91cd\u200b\nunique_results = QueryProcessor.apply_distinct(results, [\"name\", \"email\"])\n</code></pre>"},{"location":"guide/advanced-features/#couchdb","title":"\u4f7f\u7528\u200b CouchDB \u200b\u89c6\u56fe\u200b\u5b9e\u73b0\u200b\u805a\u5408","text":"<p>\u200b\u5bf9\u4e8e\u200b\u5927\u200b\u6570\u636e\u200b\u96c6\u200b\uff0c\u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b\u66f4\u200b\u9ad8\u6548\u200b\uff1a</p> <pre><code>from sqlalchemy_couchdb.advanced import AggregateQueryBuilder\n\n# \u200b\u521b\u5efa\u200b\u7edf\u8ba1\u200b\u89c6\u56fe\u200b\nbuilder = AggregateQueryBuilder()\n\n# \u200b\u6309\u200b\u90e8\u95e8\u200b\u8ba1\u6570\u200b\ncount_view = builder.create_count_view(\n    design_doc=\"stats\",\n    view_name=\"count_by_department\",\n    group_field=\"department\"\n)\n\n# \u200b\u521b\u5efa\u200b\u89c6\u56fe\u200b\nclient.view_manager.create_view(\n    \"stats\",\n    \"count_by_department\",\n    count_view['map'],\n    count_view['reduce']\n)\n\n# \u200b\u67e5\u8be2\u200b\u89c6\u56fe\u200b\nresult = client.view_manager.query_view(\n    \"stats\",\n    \"count_by_department\",\n    group=True\n)\n</code></pre>"},{"location":"guide/advanced-features/#4","title":"4. \u200b\u7d22\u5f15\u200b\u7ba1\u7406","text":""},{"location":"guide/advanced-features/#indexmanager","title":"IndexManager","text":"<p>\u200b\u7ba1\u7406\u200b CouchDB \u200b\u7d22\u5f15\u200b\u7684\u200b\u5b8c\u6574\u200b\u5de5\u5177\u200b\u3002</p>"},{"location":"guide/advanced-features/#_11","title":"\u521b\u5efa\u200b\u7d22\u5f15","text":"<pre><code># \u200b\u83b7\u53d6\u200b\u7d22\u5f15\u200b\u7ba1\u7406\u5668\u200b\nindex_mgr = client.index_manager\n\n# \u200b\u521b\u5efa\u200b\u5355\u5b57\u200b\u6bb5\u200b\u7d22\u5f15\u200b\nindex_mgr.create_index(\n    fields=[\"age\"],\n    name=\"idx_age\"\n)\n\n# \u200b\u521b\u5efa\u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\nindex_mgr.create_index(\n    fields=[\"department\", \"salary\"],\n    name=\"idx_dept_salary\"\n)\n</code></pre>"},{"location":"guide/advanced-features/#_12","title":"\u5217\u51fa\u200b\u7d22\u5f15","text":"<pre><code>indexes = index_mgr.list_indexes()\n\nfor idx in indexes:\n    print(f\"\u200b\u7d22\u5f15\u200b\u540d\u200b: {idx['name']}\")\n    print(f\"\u200b\u5b57\u200b\u6bb5\u200b: {idx['def']['fields']}\")\n    print(f\"\u200b\u7c7b\u578b\u200b: {idx['type']}\")\n</code></pre>"},{"location":"guide/advanced-features/#_13","title":"\u67e5\u627e\u200b\u7d22\u5f15","text":"<pre><code># \u200b\u6839\u636e\u200b\u5b57\u200b\u6bb5\u200b\u67e5\u627e\u200b\u7d22\u5f15\u200b\nfound = index_mgr.find_index_by_fields([\"age\", \"name\"])\n\nif found:\n    print(f\"\u200b\u627e\u5230\u200b\u7d22\u5f15\u200b: {found['name']}\")\nelse:\n    print(\"\u200b\u672a\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b\u7d22\u5f15\u200b\")\n</code></pre>"},{"location":"guide/advanced-features/#_14","title":"\u5220\u9664\u200b\u7d22\u5f15","text":"<pre><code>index_mgr.delete_index(\n    ddoc=\"_design/xyz\",\n    name=\"idx_age\"\n)\n</code></pre>"},{"location":"guide/advanced-features/#5","title":"5. \u200b\u89c6\u56fe\u200b\u7ba1\u7406","text":""},{"location":"guide/advanced-features/#viewmanager","title":"ViewManager","text":"<p>\u200b\u7ba1\u7406\u200b CouchDB \u200b\u89c6\u56fe\u200b\u7684\u200b\u5b8c\u6574\u200b\u5de5\u5177\u200b\u3002</p>"},{"location":"guide/advanced-features/#_15","title":"\u521b\u5efa\u200b\u89c6\u56fe","text":"<pre><code>view_mgr = client.view_manager\n\n# Map \u200b\u51fd\u6570\u200b\nmap_func = \"\"\"\nfunction(doc) {\n    if (doc.type === 'users' &amp;&amp; doc.age) {\n        emit(doc.age, 1);\n    }\n}\n\"\"\"\n\n# \u200b\u521b\u5efa\u200b\u89c6\u56fe\u200b\nview_mgr.create_view(\n    design_doc=\"analytics\",\n    view_name=\"users_by_age\",\n    map_function=map_func,\n    reduce_function=\"_count\"  # \u200b\u5185\u7f6e\u200b reduce \u200b\u51fd\u6570\u200b\n)\n</code></pre>"},{"location":"guide/advanced-features/#_16","title":"\u67e5\u8be2\u200b\u89c6\u56fe","text":"<pre><code># \u200b\u67e5\u8be2\u200b\u89c6\u56fe\u200b\nresult = view_mgr.query_view(\n    design_doc=\"analytics\",\n    view_name=\"users_by_age\",\n    start_key=25,           # \u200b\u8d77\u59cb\u200b\u952e\u200b\n    end_key=35,             # \u200b\u7ed3\u675f\u200b\u952e\u200b\n    group=True,             # \u200b\u5206\u7ec4\u200b\n    reduce=True,            # \u200b\u6267\u884c\u200b reduce\n)\n\n# \u200b\u5904\u7406\u7ed3\u679c\u200b\nfor row in result['rows']:\n    print(f\"\u200b\u5e74\u9f84\u200b {row['key']}: {row['value']} \u200b\u4eba\u200b\")\n</code></pre>"},{"location":"guide/advanced-features/#_17","title":"\u9ad8\u7ea7\u200b\u67e5\u8be2\u200b\u9009\u9879","text":"<pre><code>result = view_mgr.query_view(\n    design_doc=\"analytics\",\n    view_name=\"users_by_age\",\n    key=30,                 # \u200b\u7cbe\u786e\u200b\u952e\u200b\u5339\u914d\u200b\n    limit=10,               # \u200b\u9650\u5236\u200b\u7ed3\u679c\u200b\u6570\u91cf\u200b\n    descending=True,        # \u200b\u964d\u5e8f\u200b\n    include_docs=True,      # \u200b\u5305\u542b\u200b\u5b8c\u6574\u200b\u6587\u6863\u200b\n)\n</code></pre>"},{"location":"guide/advanced-features/#_18","title":"\u5220\u9664\u200b\u89c6\u56fe","text":"<pre><code>view_mgr.delete_view(\n    design_doc=\"analytics\",\n    view_name=\"users_by_age\"\n)\n</code></pre>"},{"location":"guide/advanced-features/#6","title":"6. \u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u5efa\u8bae","text":""},{"location":"guide/advanced-features/#1_1","title":"1. \u200b\u4f7f\u7528\u200b\u67e5\u8be2\u200b\u7f13\u5b58","text":"<pre><code># \u200b\u5bf9\u4e8e\u200b\u9891\u7e41\u200b\u67e5\u8be2\u200b\u7684\u200b\u6570\u636e\u200b\nclient = SyncCouchDBClient(\n    ...,\n    enable_cache=True,\n    cache_size=200,      # \u200b\u6839\u636e\u200b\u67e5\u8be2\u200b\u7c7b\u578b\u200b\u8c03\u6574\u200b\n    cache_ttl=600.0,     # 10\u200b\u5206\u949f\u200b\n)\n</code></pre>"},{"location":"guide/advanced-features/#2_1","title":"2. \u200b\u6279\u91cf\u200b\u64cd\u4f5c","text":"<pre><code>from sqlalchemy import insert\n\n# \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\uff08\u200b\u4f7f\u7528\u200b _bulk_docs\uff09\nstmt = insert(users).values([\n    {\"name\": \"User1\", \"age\": 25},\n    {\"name\": \"User2\", \"age\": 30},\n    # ... \u200b\u66f4\u200b\u591a\u200b\u8bb0\u5f55\u200b\n])\n\nconn.execute(stmt)  # \u200b\u81ea\u52a8\u200b\u4f7f\u7528\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\n</code></pre>"},{"location":"guide/advanced-features/#3_1","title":"3. \u200b\u521b\u5efa\u200b\u5408\u9002\u200b\u7684\u200b\u7d22\u5f15","text":"<pre><code># \u200b\u4e3a\u200b\u5e38\u7528\u200b\u67e5\u8be2\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\nindex_mgr.create_index(\n    fields=[\"created_at\"],     # \u200b\u65f6\u95f4\u200b\u5b57\u200b\u6bb5\u200b\n    name=\"idx_created_at\"\n)\n\nindex_mgr.create_index(\n    fields=[\"status\", \"priority\"],  # \u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\n    name=\"idx_status_priority\"\n)\n</code></pre>"},{"location":"guide/advanced-features/#4_1","title":"4. \u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b\u8fdb\u884c\u200b\u590d\u6742\u200b\u805a\u5408","text":"<p>\u200b\u5bf9\u4e8e\u200b\u5927\u200b\u6570\u636e\u200b\u96c6\u200b\u7684\u200b\u805a\u5408\u200b\u67e5\u8be2\u200b\uff0c\u200b\u89c6\u56fe\u200b\u6bd4\u200b\u5ba2\u6237\u7aef\u200b\u805a\u5408\u200b\u5feb\u5f97\u591a\u200b\uff1a</p> <pre><code># \u200b\u4e0d\u200b\u63a8\u8350\u200b\uff1a\u200b\u5ba2\u6237\u7aef\u200b\u805a\u5408\u200b\uff08\u200b\u6162\u200b\uff09\nresults = client.find({\"type\": \"orders\"})  # \u200b\u53ef\u80fd\u200b\u6709\u200b\u6570\u767e\u4e07\u200b\u6761\u200b\ntotal = QueryProcessor.sum(results, \"amount\")\n\n# \u200b\u63a8\u8350\u200b\uff1a\u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b\uff08\u200b\u5feb\u200b\uff09\nview_mgr.create_view(\n    \"stats\",\n    \"total_sales\",\n    \"function(doc) { if (doc.type === 'orders') emit(null, doc.amount); }\",\n    \"_sum\"\n)\n\nresult = view_mgr.query_view(\"stats\", \"total_sales\")\ntotal = result['rows'][0]['value']\n</code></pre>"},{"location":"guide/advanced-features/#5_1","title":"5. \u200b\u5408\u7406\u200b\u8bbe\u7f6e\u200b\u8fde\u63a5\u6c60","text":"<pre><code>client = SyncCouchDBClient(...)\nclient_obj = client.connect()  # httpx.Client\n\n# \u200b\u8fde\u63a5\u6c60\u200b\u5df2\u200b\u81ea\u52a8\u200b\u914d\u7f6e\u200b\uff1a\n# - max_connections=100\n# - max_keepalive_connections=20\n# - connect_timeout=5s\n# - read_timeout=30s\n</code></pre>"},{"location":"guide/advanced-features/#_19","title":"\ud83d\udcca \u200b\u6027\u80fd\u200b\u5bf9\u6bd4","text":"\u64cd\u4f5c\u200b \u200b\u65e0\u200b\u4f18\u5316\u200b \u200b\u6709\u200b\u4f18\u5316\u200b \u200b\u63d0\u5347\u200b \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\uff08100\u200b\u6761\u200b\uff09 ~3\u200b\u79d2\u200b ~0.5\u200b\u79d2\u200b 6x \u200b\u91cd\u590d\u200b\u67e5\u8be2\u200b ~200ms ~5ms (\u200b\u7f13\u5b58\u200b) 40x \u200b\u805a\u5408\u200b\u67e5\u8be2\u200b\uff081\u200b\u4e07\u6761\u200b\uff09 ~2\u200b\u79d2\u200b ~100ms (\u200b\u89c6\u56fe\u200b) 20x \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b ~500ms ~100ms (\u200b\u7d22\u5f15\u200b) 5x"},{"location":"guide/advanced-features/#_20","title":"\ud83d\udd0d \u200b\u5b8c\u6574\u200b\u793a\u4f8b","text":"<p>\u200b\u53c2\u89c1\u200b <code>examples/advanced_features.py</code>\uff0c\u200b\u5305\u542b\u200b\u6240\u6709\u200b\u529f\u80fd\u200b\u7684\u200b\u5b8c\u6574\u200b\u6f14\u793a\u200b\uff1a</p> <pre><code>cd examples\npython advanced_features.py\n</code></pre>"},{"location":"guide/advanced-features/#_21","title":"\ud83d\udcdd \u200b\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b: \u200b\u7f13\u5b58\u200b\u4f1a\u200b\u5728\u200b INSERT/UPDATE/DELETE \u200b\u540e\u200b\u81ea\u52a8\u200b\u5931\u6548\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u5931\u6548\u200b</li> <li>\u200b\u805a\u5408\u200b\u6027\u80fd\u200b: \u200b\u5c0f\u200b\u6570\u636e\u200b\u96c6\u200b\uff08&lt;1000\u200b\u6761\u200b\uff09\u200b\u7528\u200b\u5ba2\u6237\u7aef\u200b\u805a\u5408\u200b\uff0c\u200b\u5927\u200b\u6570\u636e\u200b\u96c6\u7528\u200b\u89c6\u56fe\u200b</li> <li>\u200b\u7d22\u5f15\u200b\u5f00\u9500\u200b: \u200b\u7d22\u5f15\u200b\u4f1a\u200b\u589e\u52a0\u200b\u5199\u5165\u200b\u5f00\u9500\u200b\uff0c\u200b\u53ea\u200b\u4e3a\u200b\u5e38\u7528\u200b\u67e5\u8be2\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b</li> <li>\u200b\u91cd\u8bd5\u200b\u7b56\u7565\u200b: \u200b\u6839\u636e\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\u8c03\u6574\u200b\u91cd\u8bd5\u200b\u6b21\u6570\u200b\u548c\u200b\u5ef6\u8fdf\u200b</li> </ol> <p>\u200b\u76f8\u5173\u200b\u6587\u6863\u200b: - README.md - \u200b\u9879\u76ee\u200b\u6982\u89c8\u200b - \u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b\uff08\u200b\u89c1\u200b\u9996\u9875\u200b\uff09 - \u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b - TODO.md - \u200b\u5f85\u529e\u200b\u4e8b\u9879\u200b</p> <p>\u200b\u6700\u540e\u200b\u66f4\u65b0\u200b: 2025-11-03 \u200b\u6587\u6863\u200b\u7248\u672c\u200b: 1.0</p>"},{"location":"guide/async-operations/","title":"\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\u6307\u5357","text":""},{"location":"guide/async-operations/#_2","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u652f\u6301\u200b\u5b8c\u6574\u200b\u7684\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>couchdb+async://</code> URL \u200b\u6a21\u5f0f\u200b\u3002\u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u57fa\u4e8e\u200b SQLAlchemy 2.0+ \u200b\u7684\u200b asyncio \u200b\u652f\u6301\u200b\u548c\u200b greenlet \u200b\u673a\u5236\u200b\u3002</p>"},{"location":"guide/async-operations/#_3","title":"\u521b\u5efa\u200b\u5f02\u6b65\u200b\u5f15\u64ce","text":"<pre><code>from sqlalchemy.ext.asyncio import create_async_engine\n\n# \u200b\u57fa\u7840\u200b\u5f02\u6b65\u200b\u8fde\u63a5\u200b\nengine = create_async_engine('couchdb+async://localhost:5984/mydb')\n\n# \u200b\u5e26\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u5f02\u6b65\u200b\u8fde\u63a5\u200b\nengine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n# \u200b\u5e26\u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e\u200b\u7684\u200b\u5f02\u6b65\u200b\u8fde\u63a5\u200b\nengine = create_async_engine(\n    'couchdb+async://admin:password@localhost:5984/mydb',\n    pool_size=10,\n    max_overflow=20,\n)\n</code></pre>"},{"location":"guide/async-operations/#crud","title":"\u5f02\u6b65\u200b CRUD \u200b\u64cd\u4f5c","text":""},{"location":"guide/async-operations/#create-","title":"CREATE - \u200b\u5f02\u6b65\u200b\u63d2\u5165","text":""},{"location":"guide/async-operations/#_4","title":"\u5355\u6761\u200b\u63d2\u5165","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def insert_single_user():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, email, type)\n            VALUES (:id, :name, :age, :email, 'user')\n        \"\"\"), {\n            'id': 'user:async-123',\n            'name': 'Alice Async',\n            'age': 30,\n            'email': 'alice@example.com'\n        })\n\n        await conn.commit()\n        print(\"\u2705 \u200b\u5f02\u6b65\u200b\u63d2\u5165\u200b\u6210\u529f\u200b\")\n\n    await engine.dispose()\n\n# \u200b\u8fd0\u884c\u200b\nasyncio.run(insert_single_user())\n</code></pre>"},{"location":"guide/async-operations/#_5","title":"\u6279\u91cf\u200b\u63d2\u5165","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def batch_insert():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        users_data = [\n            {'id': 'user:async-1', 'name': 'Alice', 'age': 30, 'email': 'alice@example.com'},\n            {'id': 'user:async-2', 'name': 'Bob', 'age': 25, 'email': 'bob@example.com'},\n            {'id': 'user:async-3', 'name': 'Charlie', 'age': 35, 'email': 'charlie@example.com'},\n        ]\n\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, email, type)\n            VALUES (:id, :name, :age, :email, 'user')\n        \"\"\"), users_data)\n\n        await conn.commit()\n        print(f\"\u2705 \u200b\u5f02\u6b65\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b {len(users_data)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n\n    await engine.dispose()\n\nasyncio.run(batch_insert())\n</code></pre>"},{"location":"guide/async-operations/#read-","title":"READ - \u200b\u5f02\u6b65\u200b\u67e5\u8be2","text":""},{"location":"guide/async-operations/#_6","title":"\u7b80\u5355\u200b\u67e5\u8be2","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def query_users():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        result = await conn.execute(text(\"\"\"\n            SELECT * FROM users WHERE type = 'user'\n        \"\"\"))\n\n        # \u200b\u6ce8\u610f\u200b\uff1a\u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\uff08\u200b\u7ed3\u679c\u200b\u5df2\u200b\u5728\u200b execute \u200b\u65f6\u200b\u7f13\u5b58\u200b\uff09\n        for row in result:\n            print(f\"ID: {row._id}, \u200b\u59d3\u540d\u200b: {row.name}, \u200b\u5e74\u9f84\u200b: {row.age}\")\n\n    await engine.dispose()\n\nasyncio.run(query_users())\n</code></pre>"},{"location":"guide/async-operations/#_7","title":"\u6761\u4ef6\u200b\u67e5\u8be2","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def query_with_conditions():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        # \u200b\u5927\u4e8e\u200b\u67e5\u8be2\u200b\n        result = await conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user' AND age &gt; :age\n        \"\"\"), {'age': 25})\n\n        for row in result:\n            print(f\"{row.name}: {row.age} \u200b\u5c81\u200b\")\n\n        # IN \u200b\u67e5\u8be2\u200b\n        result = await conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user' AND _id IN (:id1, :id2)\n        \"\"\"), {\n            'id1': 'user:async-1',\n            'id2': 'user:async-2'\n        })\n\n        # LIKE \u200b\u67e5\u8be2\u200b\n        result = await conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user' AND name LIKE :pattern\n        \"\"\"), {'pattern': '%Alice%'})\n\n    await engine.dispose()\n\nasyncio.run(query_with_conditions())\n</code></pre>"},{"location":"guide/async-operations/#_8","title":"\u83b7\u53d6\u200b\u5355\u6761\u200b\u8bb0\u5f55","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def get_single_user():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        result = await conn.execute(text(\"\"\"\n            SELECT * FROM users\n            WHERE type = 'user' AND _id = :id\n        \"\"\"), {'id': 'user:async-123'})\n\n        if result.rowcount &gt; 0:\n            row = result.fetchone()\n            print(f\"\u200b\u627e\u5230\u200b\u7528\u6237\u200b: {row.name}\")\n        else:\n            print(\"\u200b\u7528\u6237\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n    await engine.dispose()\n\nasyncio.run(get_single_user())\n</code></pre>"},{"location":"guide/async-operations/#update-","title":"UPDATE - \u200b\u5f02\u6b65\u200b\u66f4\u65b0","text":""},{"location":"guide/async-operations/#_9","title":"\u66f4\u65b0\u200b\u5355\u6761\u200b\u8bb0\u5f55","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def update_user():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        result = await conn.execute(text(\"\"\"\n            UPDATE users\n            SET age = :age\n            WHERE _id = :id AND type = 'user'\n            RETURNING *\n        \"\"\"), {\n            'id': 'user:async-123',\n            'age': 31\n        })\n\n        if result.rowcount &gt; 0:\n            updated_row = result.fetchone()\n            print(f\"\u2705 \u200b\u66f4\u65b0\u200b\u6210\u529f\u200b, \u200b\u65b0\u200b\u7248\u672c\u200b: {updated_row._rev}\")\n        else:\n            print(\"\u274c \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n        await conn.commit()\n\n    await engine.dispose()\n\nasyncio.run(update_user())\n</code></pre>"},{"location":"guide/async-operations/#delete-","title":"DELETE - \u200b\u5f02\u6b65\u200b\u5220\u9664","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def delete_user():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        result = await conn.execute(text(\"\"\"\n            DELETE FROM users\n            WHERE _id = :id AND type = 'user'\n        \"\"\"), {'id': 'user:async-123'})\n\n        if result.rowcount &gt; 0:\n            print(\"\u2705 \u200b\u5220\u9664\u200b\u6210\u529f\u200b\")\n        else:\n            print(\"\u274c \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n        await conn.commit()\n\n    await engine.dispose()\n\nasyncio.run(delete_user())\n</code></pre>"},{"location":"guide/async-operations/#_10","title":"\u5e76\u53d1\u200b\u64cd\u4f5c","text":""},{"location":"guide/async-operations/#_11","title":"\u5e76\u53d1\u200b\u67e5\u8be2","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def concurrent_queries():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        # \u200b\u5e76\u53d1\u200b\u6267\u884c\u200b\u591a\u4e2a\u200b\u67e5\u8be2\u200b\n        tasks = [\n            conn.execute(text(\"SELECT * FROM users WHERE type = 'user' AND age &gt; :age\"), {'age': 20}),\n            conn.execute(text(\"SELECT * FROM users WHERE type = 'user' AND age &lt; :age\"), {'age': 30}),\n            conn.execute(text(\"SELECT COUNT(*) as count FROM users WHERE type = 'user'\")),\n        ]\n\n        results = await asyncio.gather(*tasks)\n\n        for i, result in enumerate(results):\n            print(f\"\u200b\u67e5\u8be2\u200b {i+1} \u200b\u7ed3\u679c\u200b\u6570\u200b: {result.rowcount}\")\n\n    await engine.dispose()\n\nasyncio.run(concurrent_queries())\n</code></pre>"},{"location":"guide/async-operations/#_12","title":"\u5e76\u53d1\u200b\u63d2\u5165","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\nimport uuid\n\nasync def concurrent_inserts():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        # \u200b\u751f\u6210\u200b\u591a\u4e2a\u200b\u7528\u6237\u200b\u6570\u636e\u200b\n        users_data = [\n            {\n                'id': f'user:concurrent-{uuid.uuid4()}',\n                'name': f'User{i}',\n                'age': 20 + i,\n                'email': f'user{i}@example.com'\n            }\n            for i in range(10)\n        ]\n\n        # \u200b\u5e76\u53d1\u200b\u63d2\u5165\u200b\n        tasks = []\n        for user_data in users_data:\n            task = conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, email, type)\n                VALUES (:id, :name, :age, :email, 'user')\n            \"\"\"), user_data)\n            tasks.append(task)\n\n        await asyncio.gather(*tasks)\n        await conn.commit()\n        print(f\"\u2705 \u200b\u5e76\u53d1\u200b\u63d2\u5165\u200b {len(users_data)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n\n    await engine.dispose()\n\nasyncio.run(concurrent_inserts())\n</code></pre>"},{"location":"guide/async-operations/#_13","title":"\u5f02\u6b65\u200b\u4e8b\u52a1\u7ba1\u7406","text":""},{"location":"guide/async-operations/#_14","title":"\u81ea\u52a8\u200b\u63d0\u4ea4","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def auto_commit():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    # \u200b\u4f7f\u7528\u200b begin() \u200b\u81ea\u52a8\u200b\u63d0\u4ea4\u200b\n    async with engine.begin() as conn:\n        await conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, type)\n            VALUES (:id, :name, :age, 'user')\n        \"\"\"), {\n            'id': 'user:auto-123',\n            'name': 'Auto User',\n            'age': 28\n        })\n        # \u200b\u81ea\u52a8\u200b commit\n\n    await engine.dispose()\n\nasyncio.run(auto_commit())\n</code></pre>"},{"location":"guide/async-operations/#_15","title":"\u624b\u52a8\u200b\u4e8b\u52a1","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def manual_transaction():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        try:\n            await conn.execute(text(\"\"\"\n                INSERT INTO users (_id, name, age, type)\n                VALUES (:id1, :name1, :age1, 'user')\n            \"\"\"), {'id1': 'user:tx-1', 'name1': 'Alice', 'age1': 30})\n\n            await conn.execute(text(\"\"\"\n                INSERT INTO orders (_id, user_id, amount, type)\n                VALUES (:id2, :user_id, :amount, 'order')\n            \"\"\"), {'id2': 'order:tx-1', 'user_id': 'user:tx-1', 'amount': 99.99})\n\n            # \u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\n            await conn.commit()\n            print(\"\u2705 \u200b\u5f02\u6b65\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u6210\u529f\u200b\")\n\n        except Exception as e:\n            # \u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\n            await conn.rollback()\n            print(f\"\u274c \u200b\u5f02\u6b65\u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b: {e}\")\n\n    await engine.dispose()\n\nasyncio.run(manual_transaction())\n</code></pre>"},{"location":"guide/async-operations/#_16","title":"\u5f02\u6b65\u200b\u4e0a\u4e0b\u6587\u200b\u7ba1\u7406\u5668","text":""},{"location":"guide/async-operations/#_17","title":"\u63a8\u8350\u200b\u6a21\u5f0f","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\nasync def recommended_pattern():\n    \"\"\"\u200b\u63a8\u8350\u200b\u7684\u200b\u5f02\u6b65\u200b\u4f7f\u7528\u200b\u6a21\u5f0f\u200b\"\"\"\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    try:\n        async with engine.connect() as conn:\n            # \u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\n            await conn.execute(text(\"...\"))\n            await conn.commit()\n    finally:\n        # \u200b\u786e\u4fdd\u200b\u8d44\u6e90\u200b\u91ca\u653e\u200b\n        await engine.dispose()\n\nasyncio.run(recommended_pattern())\n</code></pre>"},{"location":"guide/async-operations/#async-with","title":"\u4f7f\u7528\u200b async with (\u200b\u63a8\u8350\u200b)","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def use_async_with():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    async with engine.connect() as conn:\n        # \u200b\u5728\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u4e2d\u200b\u64cd\u4f5c\u200b\n        await conn.execute(text(\"INSERT INTO ...\"))\n        await conn.commit()\n        print(\"\u2705 \u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\")\n\n    # \u200b\u5f15\u64ce\u200b\u81ea\u52a8\u200b.dispose()\n\nasyncio.run(use_async_with())\n</code></pre>"},{"location":"guide/async-operations/#_18","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"guide/async-operations/#_19","title":"\u5f02\u5e38\u200b\u6355\u83b7","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\nfrom sqlalchemy_couchdb.exceptions import CouchDBError\n\nasync def handle_errors():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    try:\n        async with engine.connect() as conn:\n            await conn.execute(text(\"INSERT INTO ...\"))\n            await conn.commit()\n    except CouchDBError as e:\n        print(f\"CouchDB \u200b\u5f02\u6b65\u200b\u9519\u8bef\u200b: {e}\")\n    except Exception as e:\n        print(f\"\u200b\u901a\u7528\u200b\u5f02\u6b65\u200b\u9519\u8bef\u200b: {e}\")\n    finally:\n        await engine.dispose()\n\nasyncio.run(handle_errors())\n</code></pre>"},{"location":"guide/async-operations/#_20","title":"\u5f02\u6b65\u200b\u91cd\u8bd5\u200b\u673a\u5236","text":"<pre><code>import asyncio\nfrom sqlalchemy.ext.asyncio import create_async_engine\nfrom sqlalchemy import text\n\nasync def async_retry_update(user_id, new_age, max_retries=3):\n    \"\"\"\u200b\u5f02\u6b65\u200b\u91cd\u8bd5\u200b\u66f4\u65b0\u200b\"\"\"\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    for attempt in range(max_retries):\n        try:\n            async with engine.connect() as conn:\n                result = await conn.execute(text(\"\"\"\n                    UPDATE users\n                    SET age = :age\n                    WHERE _id = :id AND type = 'user'\n                    RETURNING *\n                \"\"\"), {\n                    'id': user_id,\n                    'age': new_age\n                })\n\n                if result.rowcount &gt; 0:\n                    await conn.commit()\n                    return result.fetchone()\n                else:\n                    raise Exception(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n        except Exception as e:\n            if attempt == max_retries - 1:\n                raise\n            print(f\"\u200b\u5c1d\u8bd5\u200b {attempt + 1} \u200b\u5931\u8d25\u200b: {e}\uff0c\u200b\u91cd\u8bd5\u200b\u4e2d\u200b...\")\n            await asyncio.sleep(0.1)\n    finally:\n        await engine.dispose()\n\n# \u200b\u4f7f\u7528\u200b\nasyncio.run(async_retry_update('user:async-123', 35))\n</code></pre>"},{"location":"guide/async-operations/#_21","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"guide/async-operations/#1","title":"1. \u200b\u4f7f\u7528\u200b\u8fde\u63a5\u6c60","text":"<pre><code>engine = create_async_engine(\n    'couchdb+async://admin:password@localhost:5984/mydb',\n    pool_size=20,          # \u200b\u589e\u52a0\u200b\u5f02\u6b65\u200b\u6c60\u200b\u5927\u5c0f\u200b\n    max_overflow=30,\n    pool_recycle=1800,     # \u200b\u8f83\u200b\u77ed\u200b\u56de\u6536\u200b\u65f6\u95f4\u200b\n)\n</code></pre>"},{"location":"guide/async-operations/#2","title":"2. \u200b\u5408\u7406\u200b\u4f7f\u7528\u200b\u5e76\u53d1","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u5408\u7406\u200b\u5e76\u53d1\u200b\ntasks = [query_task(i) for i in range(10)]\nresults = await asyncio.gather(*tasks)\n\n# \u274c \u200b\u574f\u200b\uff1a\u200b\u8fc7\u591a\u200b\u5e76\u53d1\u200b\ntasks = [query_task(i) for i in range(1000)]  # \u200b\u53ef\u80fd\u200b\u8017\u5c3d\u200b\u8d44\u6e90\u200b\n</code></pre>"},{"location":"guide/async-operations/#3-n1","title":"3. \u200b\u907f\u514d\u200b N+1 \u200b\u67e5\u8be2","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u9884\u200b\u67e5\u8be2\u200b\nall_users = await conn.execute(text(\"SELECT _id FROM users WHERE type = 'user'\"))\nuser_ids = [row._id for row in all_users]\n\n# \u274c \u200b\u574f\u200b\uff1aN+1 \u200b\u67e5\u8be2\u200b\nfor user_id in user_ids:\n    result = await conn.execute(text(\"SELECT * FROM users WHERE _id = :id\"), {'id': user_id})\n</code></pre>"},{"location":"guide/async-operations/#_22","title":"\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"guide/async-operations/#greenlet","title":"Greenlet \u200b\u673a\u5236","text":"<p>\u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u4f7f\u7528\u200b greenlet \u200b\u673a\u5236\u200b\uff1a</p> <pre><code># \u2705 \u200b\u6b63\u786e\u200b\uff1a\u200b\u7ed3\u679c\u200b\u5df2\u200b\u7f13\u5b58\u200b\uff0c\u200b\u53ef\u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\nresult = await conn.execute(text(\"SELECT * FROM users\"))\nfor row in result:  # \u200b\u540c\u6b65\u200b\u8fed\u4ee3\u200b\n    print(row.name)\n\n# \u274c \u200b\u9519\u8bef\u200b\uff1a\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b async for\n# result = await conn.execute(text(\"SELECT * FROM users\"))\n# async for row in result:  # \u200b\u9519\u8bef\u200b\uff01\n</code></pre>"},{"location":"guide/async-operations/#_23","title":"\u8fde\u63a5\u200b\u91ca\u653e","text":"<pre><code>async def cleanup_example():\n    engine = create_async_engine('couchdb+async://admin:password@localhost:5984/mydb')\n\n    try:\n        async with engine.connect() as conn:\n            # \u200b\u64cd\u4f5c\u200b\n            pass\n    finally:\n        # \u200b\u786e\u4fdd\u200b\u91ca\u653e\u200b\u8d44\u6e90\u200b\n        await engine.dispose()\n\nasyncio.run(cleanup_example())\n</code></pre>"},{"location":"guide/async-operations/#_24","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b</li> <li>\u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u6a21\u5f0f\u200b</li> </ul>"},{"location":"guide/hybrid-mode/","title":"\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u6a21\u5f0f\u200b (Phase 2)","text":""},{"location":"guide/hybrid-mode/#_1","title":"\u6982\u8ff0","text":"<p>\u200b\u6df7\u5408\u200b\u6570\u636e\u5e93\u200b\u6a21\u5f0f\u200b\u662f\u200b SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b Phase 2 \u200b\u7684\u200b\u6838\u5fc3\u200b\u7279\u6027\u200b\uff0c\u200b\u7ed3\u5408\u200b CouchDB \u200b\u7684\u200b\u9ad8\u6027\u80fd\u200b\u548c\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u5f3a\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"guide/hybrid-mode/#_2","title":"\u6838\u5fc3\u601d\u60f3","text":""},{"location":"guide/hybrid-mode/#_3","title":"\u667a\u80fd\u200b\u67e5\u8be2\u200b\u8def\u7531","text":"<ul> <li>\u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB\uff08\u200b\u9ad8\u6027\u80fd\u200b\uff09</li> <li>\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\uff08\u200b\u529f\u80fd\u4e30\u5bcc\u200b\uff09</li> <li>\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b \u2192 \u200b\u53cc\u5199\u200b\uff08\u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b\uff09</li> </ul>"},{"location":"guide/hybrid-mode/#_4","title":"\u6570\u636e\u200b\u540c\u6b65","text":"<ul> <li>\u200b\u4e3b\u200b\u6570\u636e\u5e93\u200b: CouchDB\uff08\u200b\u6587\u6863\u200b\u5b58\u50a8\u200b\uff09</li> <li>\u200b\u8f85\u52a9\u200b\u6570\u636e\u5e93\u200b: \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\uff08\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\uff09</li> <li>\u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b: <code>_id</code> \u2192 <code>id</code>, <code>_rev</code> \u2192 <code>rev</code>, <code>type</code> \u2192 \u200b\u9690\u5f0f\u200b</li> </ul>"},{"location":"guide/hybrid-mode/#_5","title":"\u914d\u7f6e","text":""},{"location":"guide/hybrid-mode/#url","title":"URL \u200b\u683c\u5f0f","text":"<pre><code>couchdb+hybrid://username:password@host:port/database?secondary_db=&lt;RDBMS_URL&gt;\n</code></pre>"},{"location":"guide/hybrid-mode/#_6","title":"\u793a\u4f8b\u200b\u914d\u7f6e","text":"<pre><code>from sqlalchemy import create_engine\n\n# CouchDB + PostgreSQL\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n)\n\n# CouchDB + MySQL\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=mysql+pymysql://user:pass@localhost:3306/mydb'\n)\n\n# CouchDB + SQLite\nengine = create_engine(\n    'couchdb+hybrid://admin:password@localhost:5984/mydb'\n    '?secondary_db=sqlite:///mydb.sqlite'\n)\n</code></pre>"},{"location":"guide/hybrid-mode/#url_1","title":"URL \u200b\u53c2\u6570","text":"\u53c2\u6570\u200b \u200b\u8bf4\u660e\u200b \u200b\u793a\u4f8b\u200b <code>secondary_db</code> \u200b\u8f85\u52a9\u200b\u6570\u636e\u5e93\u200b URL <code>postgresql://...</code> <code>routing_strategy</code> \u200b\u8def\u7531\u200b\u7b56\u7565\u200b <code>simple</code>, <code>hybrid</code>, <code>all</code> <code>write_mode</code> \u200b\u5199\u200b\u64cd\u4f5c\u200b\u6a21\u5f0f\u200b <code>couchdb_only</code>, <code>dual_write</code>, <code>rdbms_only</code> <code>consistency_check</code> \u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b <code>true</code>, <code>false</code> <code>check_interval</code> \u200b\u68c0\u67e5\u200b\u95f4\u9694\u200b\uff08\u200b\u79d2\u200b\uff09 <code>60</code>"},{"location":"guide/hybrid-mode/#_7","title":"\u67e5\u8be2\u200b\u8def\u7531","text":""},{"location":"guide/hybrid-mode/#couchdb","title":"\u7b80\u5355\u200b\u67e5\u8be2\u200b \u2192 CouchDB","text":"<pre><code>with engine.connect() as conn:\n    # \u200b\u8def\u7531\u200b\u5230\u200b CouchDB\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user' AND age &gt; 25\n        ORDER BY age DESC\n        LIMIT 10\n    \"\"\"))\n</code></pre> <p>\u200b\u7279\u5f81\u200b: - \u200b\u5355\u8868\u200b\u67e5\u8be2\u200b - \u200b\u65e0\u200b JOIN - \u200b\u65e0\u200b GROUP BY - \u200b\u65e0\u5b50\u200b\u67e5\u8be2\u200b - \u200b\u7b80\u5355\u200b WHERE \u200b\u6761\u4ef6\u200b</p> <p>\u200b\u4f18\u70b9\u200b: - \u200b\u9ad8\u6027\u80fd\u200b\uff08&lt; 50ms\uff09 - \u200b\u53ef\u6269\u5c55\u6027\u200b\u597d\u200b - \u200b\u9002\u5408\u200b\u5927\u91cf\u200b\u6570\u636e\u200b</p>"},{"location":"guide/hybrid-mode/#_8","title":"\u590d\u6742\u200b\u67e5\u8be2\u200b \u2192 \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93","text":"<pre><code>with engine.connect() as conn:\n    # \u200b\u8def\u7531\u200b\u5230\u200b PostgreSQL\n    result = conn.execute(text(\"\"\"\n        SELECT u.name, COUNT(o.id) as order_count\n        FROM users u\n        JOIN orders o ON u.id = o.user_id\n        WHERE u.age &gt; 25\n        GROUP BY u.name\n        HAVING COUNT(o.id) &gt; 5\n        ORDER BY order_count DESC\n    \"\"\"))\n</code></pre> <p>\u200b\u7279\u5f81\u200b: - \u200b\u591a\u8868\u200b JOIN - GROUP BY + HAVING - \u200b\u5b50\u200b\u67e5\u8be2\u200b - \u200b\u590d\u6742\u200b\u805a\u5408\u200b - \u200b\u7a97\u53e3\u200b\u51fd\u6570\u200b</p> <p>\u200b\u4f18\u70b9\u200b: - \u200b\u529f\u80fd\u5f3a\u5927\u200b - \u200b\u6210\u719f\u200b\u4f18\u5316\u200b - \u200b\u517c\u5bb9\u6027\u200b\u597d\u200b</p>"},{"location":"guide/hybrid-mode/#_9","title":"\u8def\u7531\u200b\u51b3\u7b56","text":"<pre><code>graph TD\n    A[SQL \u200b\u67e5\u8be2\u200b] --&gt; B{\u200b\u5206\u6790\u200b\u67e5\u8be2\u200b\u590d\u6742\u5ea6\u200b}\n    B --&gt; C{\u200b\u5355\u8868\u200b?}&lt;br&gt;\u200b\u7b80\u5355\u200b WHERE?&lt;br&gt;\u200b\u65e0\u200b JOIN?\n    C --&gt;|\u200b\u662f\u200b| D[CouchDB]\n    C --&gt;|\u200b\u5426\u200b| E{RDBMS \u200b\u517c\u5bb9\u200b?}\n    E --&gt;|\u200b\u662f\u200b| F[\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b]\n    E --&gt;|\u200b\u5426\u200b| G[\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b]</code></pre>"},{"location":"guide/hybrid-mode/#_10","title":"\u5b57\u200b\u6bb5\u200b\u6620\u5c04","text":""},{"location":"guide/hybrid-mode/#couchdb_1","title":"CouchDB \u2192 \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93","text":"CouchDB \u200b\u5b57\u200b\u6bb5\u200b \u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b \u200b\u8bf4\u660e\u200b <code>_id</code> <code>id</code> (VARCHAR PRIMARY KEY) \u200b\u4e3b\u952e\u200b <code>_rev</code> <code>rev</code> (VARCHAR) \u200b\u7248\u672c\u53f7\u200b <code>type</code> (\u200b\u4e0d\u200b\u5b58\u50a8\u200b) \u200b\u901a\u8fc7\u200b\u8868\u540d\u200b\u9690\u5f0f\u200b\u8868\u8fbe\u200b \u200b\u5176\u4ed6\u200b\u5b57\u200b\u6bb5\u200b \u200b\u76f4\u63a5\u200b\u6620\u5c04\u200b \u200b\u4fdd\u6301\u200b\u540d\u79f0\u200b\u548c\u200b\u7c7b\u578b"},{"location":"guide/hybrid-mode/#_11","title":"\u793a\u4f8b\u200b\u6620\u5c04","text":"<p>CouchDB \u200b\u6587\u6863\u200b: <pre><code>{\n  \"_id\": \"user:123\",\n  \"_rev\": \"1-abc123\",\n  \"type\": \"users\",\n  \"name\": \"Alice\",\n  \"age\": 30,\n  \"email\": \"alice@example.com\"\n}\n</code></pre></p> <p>PostgreSQL \u200b\u8868\u200b: <pre><code>CREATE TABLE users (\n    id VARCHAR PRIMARY KEY,\n    rev VARCHAR,\n    name VARCHAR,\n    age INTEGER,\n    email VARCHAR\n);\n</code></pre></p> <p>\u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b: <pre><code># \u200b\u8f93\u5165\u200b\u6587\u6863\u200b\ncouchdb_doc = {\n    \"_id\": \"user:123\",\n    \"_rev\": \"1-abc123\",\n    \"type\": \"users\",\n    \"name\": \"Alice\",\n    \"age\": 30,\n    \"email\": \"alice@example.com\"\n}\n\n# \u200b\u6620\u5c04\u200b\u5230\u200b RDBMS\nrdbms_row = {\n    \"id\": \"user:123\",\n    \"rev\": \"1-abc123\",\n    \"name\": \"Alice\",\n    \"age\": 30,\n    \"email\": \"alice@example.com\"\n}\n\n# \u200b\u6ce8\u610f\u200b\uff1atype \u200b\u5b57\u6bb5\u200b\u4e0d\u200b\u5b58\u50a8\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8868\u540d\u200b\u9690\u5f0f\u200b\u8868\u8fbe\u200b\n</code></pre></p>"},{"location":"guide/hybrid-mode/#_12","title":"\u5199\u5165\u200b\u64cd\u4f5c","text":""},{"location":"guide/hybrid-mode/#_13","title":"\u53cc\u5199\u200b\u6a21\u5f0f\u200b (\u200b\u63a8\u8350\u200b)","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    # \u200b\u540c\u65f6\u200b\u5199\u5165\u200b CouchDB \u200b\u548c\u200b PostgreSQL\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, email, type)\n        VALUES (:id, :name, :age, :email, 'user')\n    \"\"\"), {\n        'id': 'user:hybrid-1',\n        'name': 'Hybrid User',\n        'age': 28,\n        'email': 'hybrid@example.com'\n    })\n    conn.commit()\n\n    print(\"\u2705 \u200b\u53cc\u5199\u200b\u6210\u529f\u200b\")\n</code></pre> <p>\u200b\u6d41\u7a0b\u200b: 1. \u200b\u5199\u5165\u200b CouchDB 2. \u200b\u5199\u5165\u200b PostgreSQL 3. \u200b\u9a8c\u8bc1\u200b\u5199\u5165\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09 4. \u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b</p> <p>\u200b\u4f18\u70b9\u200b: - \u200b\u6570\u636e\u5b8c\u6574\u6027\u200b - \u200b\u67e5\u8be2\u200b\u7075\u6d3b\u6027\u200b - \u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b</p> <p>\u200b\u6ce8\u610f\u200b: - \u200b\u53ef\u80fd\u200b\u77ed\u6682\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff08\u200b\u540e\u53f0\u200b\u81ea\u52a8\u200b\u4fee\u590d\u200b\uff09 - \u200b\u5199\u5165\u200b\u5ef6\u8fdf\u200b\u589e\u52a0\u200b 30-50ms</p>"},{"location":"guide/hybrid-mode/#couchdb_2","title":"\u4ec5\u200b CouchDB \u200b\u6a21\u5f0f","text":"<pre><code># \u200b\u4f7f\u7528\u200b QueryRouter \u200b\u63a7\u5236\u200b\u8def\u7531\u200b\nfrom sqlalchemy_couchdb.hybrid import QueryRouter\n\nrouter = QueryRouter(engine)\nrouter.set_write_mode('couchdb_only')\n\n# \u200b\u6240\u6709\u200b\u5199\u5165\u200b\u4ec5\u5230\u200b CouchDB\nwith engine.connect() as conn:\n    conn.execute(text(\"INSERT INTO users ...\"))\n</code></pre>"},{"location":"guide/hybrid-mode/#rdbms","title":"\u4ec5\u200b RDBMS \u200b\u6a21\u5f0f","text":"<pre><code>router.set_write_mode('rdbms_only')\n\n# \u200b\u6240\u6709\u200b\u5199\u5165\u200b\u4ec5\u5230\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"INSERT INTO users ...\"))\n</code></pre>"},{"location":"guide/hybrid-mode/#_14","title":"\u4e00\u81f4\u6027\u200b\u7ba1\u7406","text":""},{"location":"guide/hybrid-mode/#_15","title":"\u6700\u7ec8\u200b\u4e00\u81f4\u6027","text":"<p>\u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\u4f7f\u7528\u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b\u6a21\u578b\u200b\uff1a</p> <ol> <li>\u200b\u5199\u5165\u200b\u9636\u6bb5\u200b: \u200b\u7acb\u5373\u200b\u5199\u5165\u200b CouchDB\uff08\u200b\u4e3b\u200b\u6570\u636e\u5e93\u200b\uff09</li> <li>\u200b\u5f02\u6b65\u200b\u540c\u6b65\u200b: \u200b\u540e\u53f0\u200b\u8fdb\u7a0b\u200b\u5199\u5165\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b</li> <li>\u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b: \u200b\u5b9a\u671f\u68c0\u67e5\u200b\u6570\u636e\u200b\u5dee\u5f02\u200b</li> <li>\u200b\u81ea\u52a8\u200b\u4fee\u590d\u200b: \u200b\u81ea\u52a8\u200b\u540c\u6b65\u200b\u5dee\u5f02\u200b\u6570\u636e\u200b</li> </ol>"},{"location":"guide/hybrid-mode/#_16","title":"\u4e00\u81f4\u6027\u200b\u68c0\u67e5","text":"<pre><code>from sqlalchemy_couchdb.hybrid import ConsistencyChecker\n\nchecker = ConsistencyChecker(engine)\n\n# \u200b\u624b\u52a8\u200b\u89e6\u53d1\u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b\nresult = checker.check_consistency('users')\nprint(f\"\u200b\u68c0\u67e5\u200b\u7ed3\u679c\u200b: {result}\")\n\n# \u200b\u4fee\u590d\u200b\u5dee\u5f02\u200b\nchecker.repair_consistency('users')\n</code></pre>"},{"location":"guide/hybrid-mode/#_17","title":"\u76d1\u63a7","text":"<pre><code>from sqlalchemy_couchdb.hybrid import Monitor\n\nmonitor = Monitor(engine)\n\n# \u200b\u83b7\u53d6\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\nstats = monitor.get_stats()\nprint(f\"\u200b\u4e00\u81f4\u6027\u200b\u7edf\u8ba1\u200b: {stats}\")\n\n# \u200b\u76d1\u63a7\u200b\u72b6\u6001\u200b\nstatus = monitor.get_status()\nprint(f\"\u200b\u76d1\u63a7\u200b\u72b6\u6001\u200b: {status}\")\n</code></pre>"},{"location":"guide/hybrid-mode/#_18","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"guide/hybrid-mode/#1","title":"1. \u200b\u7d22\u5f15\u200b\u7b56\u7565","text":"<pre><code># CouchDB \u200b\u7d22\u5f15\u200b\uff08\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\uff09\n# ORDER BY \u200b\u5b57\u200b\u6bb5\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\n\n# PostgreSQL \u200b\u7d22\u5f15\u200b\uff08\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\uff09\nfrom sqlalchemy import text\n\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        CREATE INDEX idx_users_age ON users(age);\n        CREATE INDEX idx_orders_user_id ON orders(user_id);\n    \"\"\"))\n</code></pre>"},{"location":"guide/hybrid-mode/#2","title":"2. \u200b\u5206\u533a\u200b\u7b56\u7565","text":"<pre><code># PostgreSQL \u200b\u8868\u200b\u5206\u533a\u200b\nfrom sqlalchemy import text\n\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        CREATE TABLE users_2025 PARTITION OF users\n        FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');\n    \"\"\"))\n</code></pre>"},{"location":"guide/hybrid-mode/#3","title":"3. \u200b\u7f13\u5b58","text":"<pre><code>from sqlalchemy_couchdb.cache import QueryCache\n\ncache = QueryCache(engine, ttl=300)  # 5\u200b\u5206\u949f\u200b\u7f13\u5b58\u200b\n\n# \u200b\u542f\u7528\u200b\u67e5\u8be2\u200b\u7f13\u5b58\u200b\nwith engine.connect() as conn:\n    result = cache.get(\"users_over_25\")\n    if result is None:\n        result = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n        cache.set(\"users_over_25\", result)\n</code></pre>"},{"location":"guide/hybrid-mode/#_19","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":""},{"location":"guide/hybrid-mode/#1_1","title":"1. \u200b\u6570\u636e\u200b\u5efa\u6a21","text":"<pre><code># \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u6241\u5e73\u5316\u200b\u6587\u6863\u200b\nuser = {\n    \"_id\": \"user:123\",\n    \"type\": \"users\",\n    \"name\": \"Alice\",\n    \"age\": 30,\n    \"email\": \"alice@example.com\"\n}\n\n# \u274c \u200b\u907f\u514d\u200b\uff1a\u200b\u8fc7\u5ea6\u200b\u5d4c\u5957\u200b\nuser = {\n    \"_id\": \"user:123\",\n    \"type\": \"users\",\n    \"profile\": {\n        \"personal\": {\n            \"name\": \"Alice\",\n            \"age\": 30\n        },\n        \"contact\": {\n            \"email\": \"alice@example.com\"\n        }\n    }\n}\n</code></pre>"},{"location":"guide/hybrid-mode/#2_1","title":"2. \u200b\u67e5\u8be2\u200b\u7b56\u7565","text":"<pre><code># \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u7b80\u5355\u200b\u67e5\u8be2\u200b\u7528\u200b CouchDB\nusers = conn.execute(text(\"\"\"\n    SELECT * FROM users WHERE age &gt; 25\n\"\"\")).fetchall()\n\n# \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u7528\u200b PostgreSQL\nstats = conn.execute(text(\"\"\"\n    SELECT age_group, COUNT(*) as count\n    FROM (\n        SELECT CASE\n            WHEN age &lt; 20 THEN 'teen'\n            WHEN age &lt; 40 THEN 'adult'\n            ELSE 'senior'\n        END as age_group\n        FROM users\n    ) age_groups\n    GROUP BY age_group\n\"\"\")).fetchall()\n</code></pre>"},{"location":"guide/hybrid-mode/#3_1","title":"3. \u200b\u4e8b\u52a1\u7ba1\u7406","text":"<pre><code># \u200b\u6ce8\u610f\u200b\uff1a\u200b\u53cc\u5199\u200b\u4f7f\u7528\u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b\nwith engine.connect() as conn:\n    try:\n        conn.execute(text(\"INSERT INTO users ...\"))\n        conn.commit()\n        print(\"\u2705 \u200b\u5199\u5165\u200b\u6210\u529f\u200b\")\n    except Exception as e:\n        conn.rollback()\n        print(f\"\u274c \u200b\u5199\u5165\u200b\u5931\u8d25\u200b: {e}\")\n        # \u200b\u8bb0\u5f55\u200b\u5931\u8d25\u200b\uff0c\u200b\u7b49\u5f85\u200b\u91cd\u8bd5\u200b\n</code></pre>"},{"location":"guide/hybrid-mode/#4","title":"4. \u200b\u9519\u8bef\u5904\u7406","text":"<pre><code>from sqlalchemy_couchdb.exceptions import ConsistencyError\n\ntry:\n    result = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\nexcept ConsistencyError as e:\n    # \u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\n    print(f\"\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b: {e}\")\n    # \u200b\u89e6\u53d1\u200b\u4e00\u81f4\u6027\u200b\u68c0\u67e5\u200b\n    checker.check_consistency('users')\n</code></pre>"},{"location":"guide/hybrid-mode/#_20","title":"\u9650\u5236\u200b\u8bf4\u660e","text":""},{"location":"guide/hybrid-mode/#phase-2_1","title":"Phase 2 \u200b\u5f53\u524d\u200b\u9650\u5236","text":"<ol> <li>\u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b: \u200b\u5199\u5165\u200b\u540e\u200b\u53ef\u80fd\u200b\u77ed\u6682\u200b\u4e0d\u200b\u4e00\u81f4\u200b</li> <li>\u200b\u7d22\u5f15\u200b\u4f9d\u8d56\u200b: \u200b\u590d\u6742\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b PostgreSQL \u200b\u7d22\u5f15\u200b</li> <li>\u200b\u53cc\u5199\u200b\u5f00\u9500\u200b: \u200b\u5199\u5165\u200b\u5ef6\u8fdf\u200b\u589e\u52a0\u200b</li> <li>\u200b\u6a21\u5f0f\u200b\u7ba1\u7406\u200b: \u200b\u9700\u8981\u200b\u5728\u200b PostgreSQL \u200b\u4e2d\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u8868\u200b</li> <li>\u200b\u6570\u636e\u200b\u51b2\u7a81\u200b: \u200b\u9700\u8981\u200b\u89e3\u51b3\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u95ee\u9898\u200b</li> </ol>"},{"location":"guide/hybrid-mode/#_21","title":"\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b\u7279\u6027","text":"<ul> <li>\u200b\u8de8\u200b\u6570\u636e\u5e93\u200b\u4e8b\u52a1\u200b</li> <li>\u200b\u5b9e\u65f6\u200b\u4e00\u81f4\u6027\u200b\u4fdd\u8bc1\u200b</li> <li>\u200b\u81ea\u52a8\u200b\u6a21\u5f0f\u200b\u8fc1\u79fb\u200b</li> <li>\u200b\u667a\u80fd\u200b\u5206\u7247\u200b</li> </ul>"},{"location":"guide/hybrid-mode/#_22","title":"\u76d1\u63a7\u200b\u548c\u200b\u7ba1\u7406","text":""},{"location":"guide/hybrid-mode/#1_2","title":"1. \u200b\u8fde\u63a5\u6c60\u200b\u76d1\u63a7","text":"<pre><code>def monitor_connections(engine):\n    \"\"\"\u200b\u76d1\u63a7\u200b\u8fde\u63a5\u6c60\u200b\"\"\"\n    couchdb_pool = engine.pool  # CouchDB \u200b\u8fde\u63a5\u6c60\u200b\n    rdbms_pool = engine.get_pool('rdbms')  # RDBMS \u200b\u8fde\u63a5\u6c60\u200b\n\n    print(f\"CouchDB \u200b\u6c60\u200b\u5927\u5c0f\u200b: {couchdb_pool.size()}\")\n    print(f\"CouchDB \u200b\u5df2\u200b\u501f\u51fa\u200b: {couchdb_pool.checkedout()}\")\n    print(f\"RDBMS \u200b\u6c60\u200b\u5927\u5c0f\u200b: {rdbms_pool.size()}\")\n    print(f\"RDBMS \u200b\u5df2\u200b\u501f\u51fa\u200b: {rdbms_pool.checkedout()}\")\n\nmonitor_connections(engine)\n</code></pre>"},{"location":"guide/hybrid-mode/#2_2","title":"2. \u200b\u6027\u80fd\u6307\u6807","text":"<pre><code>from sqlalchemy_couchdb.hybrid import PerformanceMonitor\n\nmonitor = PerformanceMonitor(engine)\n\n# \u200b\u83b7\u53d6\u200b\u67e5\u8be2\u200b\u5ef6\u8fdf\u200b\nlatency = monitor.get_query_latency()\nprint(f\"\u200b\u67e5\u8be2\u200b\u5ef6\u8fdf\u200b: {latency}\")\n\n# \u200b\u83b7\u53d6\u200b\u5199\u5165\u200b\u541e\u5410\u91cf\u200b\nthroughput = monitor.get_write_throughput()\nprint(f\"\u200b\u5199\u5165\u200b\u541e\u5410\u91cf\u200b: {throughput}\")\n</code></pre>"},{"location":"guide/hybrid-mode/#3_2","title":"3. \u200b\u5065\u5eb7\u68c0\u67e5","text":"<pre><code>def health_check(engine):\n    \"\"\"\u200b\u5065\u5eb7\u68c0\u67e5\u200b\"\"\"\n    try:\n        # \u200b\u68c0\u67e5\u200b CouchDB\n        with engine.connect() as conn:\n            conn.execute(text(\"SELECT 1\"))\n        print(\"\u2705 CouchDB \u200b\u6b63\u5e38\u200b\")\n    except Exception as e:\n        print(f\"\u274c CouchDB \u200b\u5f02\u5e38\u200b: {e}\")\n\n    try:\n        # \u200b\u68c0\u67e5\u200b RDBMS\n        rdbms_engine = engine.get_rdbms_engine()\n        with rdbms_engine.connect() as conn:\n            conn.execute(text(\"SELECT 1\"))\n        print(\"\u2705 RDBMS \u200b\u6b63\u5e38\u200b\")\n    except Exception as e:\n        print(f\"\u274c RDBMS \u200b\u5f02\u5e38\u200b: {e}\")\n\nhealth_check(engine)\n</code></pre>"},{"location":"guide/hybrid-mode/#_23","title":"\u6545\u969c\u200b\u6062\u590d","text":""},{"location":"guide/hybrid-mode/#_24","title":"\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u6062\u590d","text":"<pre><code>from sqlalchemy_couchdb.hybrid import DataRecovery\n\nrecovery = DataRecovery(engine)\n\n# \u200b\u4fee\u590d\u200b\u7279\u5b9a\u200b\u7528\u6237\u200b\nrecovery.repair_user('user:123')\n\n# \u200b\u4fee\u590d\u200b\u6240\u6709\u200b\u7528\u6237\u200b\nrecovery.repair_table('users')\n\n# \u200b\u5b8c\u6574\u200b\u4fee\u590d\u200b\nrecovery.full_repair()\n</code></pre>"},{"location":"guide/hybrid-mode/#_25","title":"\u53cc\u5199\u200b\u6545\u969c\u200b\u6062\u590d","text":"<pre><code>from sqlalchemy_couchdb.hybrid import WriteFailureHandler\n\nhandler = WriteFailureHandler(engine)\n\n# \u200b\u5904\u7406\u200b\u5199\u5165\u200b\u5931\u8d25\u200b\ndef handle_write_failure(operation, data, error):\n    \"\"\"\u200b\u5904\u7406\u200b\u5199\u5165\u200b\u5931\u8d25\u200b\"\"\"\n    # \u200b\u8bb0\u5f55\u200b\u5931\u8d25\u200b\n    logger.error(f\"\u200b\u5199\u5165\u200b\u5931\u8d25\u200b: {operation}, {data}, {error}\")\n\n    # \u200b\u91cd\u65b0\u200b\u5c1d\u8bd5\u200b\n    handler.retry_write(operation, data)\n\n    # \u200b\u6216\u200b\u8bb0\u5f55\u200b\u5230\u200b\u961f\u5217\u200b\uff0c\u200b\u7b49\u5f85\u200b\u540e\u7eed\u200b\u5904\u7406\u200b\n    handler.queue_write(operation, data)\n\nhandler.on_failure(handle_write_failure)\n</code></pre>"},{"location":"guide/hybrid-mode/#_26","title":"\u8fc1\u79fb\u200b\u6307\u5357","text":""},{"location":"guide/hybrid-mode/#phase-1-phase-2","title":"\u4ece\u200b Phase 1 \u200b\u8fc1\u79fb\u200b\u5230\u200b Phase 2","text":"<ol> <li> <p>\u200b\u5b89\u88c5\u200b\u53ef\u200b\u9009\u200b\u4f9d\u8d56\u200b: <pre><code>pip install sqlalchemy-couchdb[all]\n</code></pre></p> </li> <li> <p>\u200b\u66f4\u65b0\u200b\u8fde\u63a5\u200b URL: <pre><code># Phase 1\nengine = create_engine('couchdb://localhost:5984/mydb')\n\n# Phase 2\nengine = create_engine(\n    'couchdb+hybrid://localhost:5984/mydb'\n    '?secondary_db=postgresql://user:pass@localhost:5432/mydb'\n)\n</code></pre></p> </li> <li> <p>\u200b\u5728\u200b PostgreSQL \u200b\u4e2d\u200b\u521b\u5efa\u200b\u8868\u200b: <pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        CREATE TABLE users (\n            id VARCHAR PRIMARY KEY,\n            rev VARCHAR,\n            name VARCHAR,\n            age INTEGER,\n            email VARCHAR\n        );\n    \"\"\"))\n</code></pre></p> </li> <li> <p>\u200b\u542f\u7528\u200b\u76d1\u63a7\u200b: <pre><code>from sqlalchemy_couchdb.hybrid import Monitor\n\nmonitor = Monitor(engine)\nmonitor.start()\n</code></pre></p> </li> </ol>"},{"location":"guide/hybrid-mode/#_27","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b</li> <li>API \u200b\u53c2\u8003\u200b</li> <li>\u200b\u5e38\u89c1\u95ee\u9898\u200b</li> </ul>"},{"location":"guide/sql-to-mango/","title":"SQL \u200b\u8f6c\u200b Mango Query \u200b\u6307\u5357","text":""},{"location":"guide/sql-to-mango/#_1","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u7684\u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b\u662f\u200b\u5c06\u200b\u6807\u51c6\u200b SQL \u200b\u8bed\u53e5\u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b CouchDB Mango Query\u3002\u200b\u672c\u200b\u6587\u6863\u200b\u8be6\u7ec6\u200b\u8bf4\u660e\u200b\u8f6c\u6362\u200b\u539f\u7406\u200b\u548c\u200b\u5e38\u89c1\u200b\u6a21\u5f0f\u200b\u3002</p>"},{"location":"guide/sql-to-mango/#_2","title":"\u8f6c\u6362\u200b\u539f\u7406","text":""},{"location":"guide/sql-to-mango/#_3","title":"\u7f16\u8bd1\u5668\u200b\u67b6\u6784","text":"<pre><code>graph TD\n    A[SQLAlchemy SQL] --&gt; B[CouchDBCompiler]\n    B --&gt; C[Mango Query JSON]\n    C --&gt; D[CouchDB HTTP API]\n    D --&gt; E[CouchDB \u200b\u6570\u636e\u5e93\u200b]</code></pre> <p>\u200b\u7f16\u8bd1\u5668\u200b\u7ec4\u4ef6\u200b: - <code>CouchDBCompiler</code>: \u200b\u4e3b\u200b\u7f16\u8bd1\u5668\u200b\uff0c\u200b\u7ee7\u627f\u200b\u81ea\u200b SQLCompiler - <code>CouchDBTypeCompiler</code>: \u200b\u7c7b\u578b\u200b\u8f6c\u6362\u5668\u200b - <code>CouchDBDDLCompiler</code>: DDL \u200b\u8bed\u53e5\u200b\u7f16\u8bd1\u5668\u200b</p>"},{"location":"guide/sql-to-mango/#select","title":"SELECT \u200b\u8bed\u53e5\u200b\u8f6c\u6362","text":""},{"location":"guide/sql-to-mango/#select_1","title":"\u7b80\u5355\u200b SELECT","text":"<p>SQL: <pre><code>SELECT * FROM users WHERE type = 'user'\n</code></pre></p> <p>Mango Query: <pre><code>{\n  \"selector\": {\n    \"type\": {\"$eq\": \"user\"}\n  },\n  \"fields\": [\"_id\", \"_rev\", \"type\", \"name\", \"age\", \"email\"],\n  \"limit\": 25\n}\n</code></pre></p> <p>\u200b\u5b9e\u73b0\u200b: <pre><code># compiler.py:visit_select()\ndef visit_select(self, select, **kwargs):\n    # \u200b\u6784\u5efa\u200b selector\n    selector = self._compile_where(select.whereclause)\n    # \u200b\u6784\u5efa\u200b fields\n    fields = self._compile_fields(select)\n    # \u200b\u6784\u5efa\u200b limit/skip\n    limit = select.limit and self._compile_limit_offset(select)\n    # \u200b\u7ec4\u88c5\u200b Mango Query\n    return {\n        \"selector\": selector,\n        \"fields\": fields,\n        \"limit\": limit,\n        \"skip\": skip\n    }\n</code></pre></p>"},{"location":"guide/sql-to-mango/#select_2","title":"\u5e26\u200b\u6761\u4ef6\u200b\u7684\u200b SELECT","text":"<p>SQL: <pre><code>SELECT * FROM users\nWHERE type = 'user'\n  AND age &gt; 25\n  AND name IN ('Alice', 'Bob')\nORDER BY age DESC, name ASC\nLIMIT 10\nOFFSET 20\n</code></pre></p> <p>Mango Query: <pre><code>{\n  \"selector\": {\n    \"type\": {\"$eq\": \"user\"},\n    \"age\": {\"$gt\": 25},\n    \"name\": {\"$in\": [\"Alice\", \"Bob\"]}\n  },\n  \"fields\": [\"_id\", \"_rev\", \"type\", \"name\", \"age\", \"email\"],\n  \"sort\": [\n    {\"age\": \"desc\"},\n    {\"name\": \"asc\"}\n  ],\n  \"limit\": 10,\n  \"skip\": 20\n}\n</code></pre></p> <p>\u200b\u8f6c\u6362\u89c4\u5219\u200b:</p> SQL \u200b\u64cd\u4f5c\u7b26\u200b Mango \u200b\u64cd\u4f5c\u7b26\u200b \u200b\u793a\u4f8b\u200b <code>=</code> <code>$eq</code> <code>age = 25</code> <code>!=</code> <code>$ne</code> <code>age != 25</code> <code>&gt;</code> <code>$gt</code> <code>age &gt; 25</code> <code>&gt;=</code> <code>$gte</code> <code>age &gt;= 25</code> <code>&lt;</code> <code>$lt</code> <code>age &lt; 30</code> <code>&lt;=</code> <code>$lte</code> <code>age &lt;= 30</code> <code>IN</code> <code>$in</code> <code>name IN ('A', 'B')</code> <code>NOT IN</code> <code>$nin</code> <code>name NOT IN ('A', 'B')</code> <code>LIKE</code> <code>$regex</code> <code>name LIKE '%Alice%'</code> <code>AND</code> (\u200b\u9ed8\u8ba4\u200b) <code>age &gt; 25 AND active = true</code> <code>OR</code> <code>$or</code> <code>age &gt; 30 OR name = 'Bob'</code>"},{"location":"guide/sql-to-mango/#where","title":"\u590d\u6742\u200b WHERE \u200b\u6761\u4ef6","text":"<p>SQL: <pre><code>SELECT * FROM users\nWHERE (age &gt; 25 AND active = true)\n   OR (name = 'Alice' AND status = 'vip')\n</code></pre></p> <p>Mango Query: <pre><code>{\n  \"selector\": {\n    \"$or\": [\n      {\n        \"age\": {\"$gt\": 25},\n        \"active\": {\"$eq\": true}\n      },\n      {\n        \"name\": {\"$eq\": \"Alice\"},\n        \"status\": {\"$eq\": \"vip\"}\n      }\n    ]\n  },\n  \"fields\": [\"_id\", \"_rev\", \"type\", \"name\", \"age\", \"active\", \"status\"]\n}\n</code></pre></p> <p>\u200b\u5b9e\u73b0\u200b: <pre><code># compiler.py:_compile_where()\ndef _compile_where(self, whereclause):\n    if whereclause is None:\n        return {}\n\n    if isinstance(whereclause, expression.And):\n        # \u200b\u5904\u7406\u200b AND\n        left = self._compile_where(whereclause.left)\n        right = self._compile_where(whereclause.right)\n        return {**left, **right}  # \u200b\u5408\u5e76\u200b\n\n    elif isinstance(whereclause, expression.Or):\n        # \u200b\u5904\u7406\u200b OR\n        left = self._compile_where(whereclause.left)\n        right = self._compile_where(whereclause.right)\n        return {\"$or\": [left, right]}\n\n    # \u200b\u5904\u7406\u200b\u6bd4\u8f83\u200b\u64cd\u4f5c\u7b26\u200b\n    return self._compile_condition(whereclause)\n</code></pre></p>"},{"location":"guide/sql-to-mango/#insert","title":"INSERT \u200b\u8bed\u53e5\u200b\u8f6c\u6362","text":""},{"location":"guide/sql-to-mango/#_4","title":"\u5355\u6761\u200b\u63d2\u5165","text":"<p>SQL: <pre><code>INSERT INTO users (_id, name, age, email, type)\nVALUES ('user:123', 'Alice', 30, 'alice@example.com', 'user')\n</code></pre></p> <p>Mango Query: <pre><code>POST /mydb\nContent-Type: application/json\n\n{\n  \"_id\": \"user:123\",\n  \"name\": \"Alice\",\n  \"age\": 30,\n  \"email\": \"alice@example.com\",\n  \"type\": \"user\"\n}\n</code></pre></p> <p>\u200b\u5b9e\u73b0\u200b: <pre><code># compiler.py:visit_insert()\ndef visit_insert(self, insert, **kwargs):\n    # \u200b\u63d0\u53d6\u200b\u5b57\u6bb5\u200b\u548c\u200b\u503c\u200b\n    fields, values = self._extract_fields_and_values(insert)\n    # \u200b\u6784\u5efa\u200b\u6587\u6863\u200b\n    doc = dict(zip(fields, values))\n    # \u200b\u8c03\u7528\u200b bulk_docs API\n    return {\"method\": \"POST\", \"docs\": [doc]}\n</code></pre></p>"},{"location":"guide/sql-to-mango/#_5","title":"\u6279\u91cf\u200b\u63d2\u5165","text":"<p>SQL: <pre><code>INSERT INTO users (_id, name, age, type)\nVALUES\n  ('user:1', 'Alice', 30, 'user'),\n  ('user:2', 'Bob', 25, 'user'),\n  ('user:3', 'Charlie', 35, 'user')\n</code></pre></p> <p>Mango Query: <pre><code>POST /mydb/_bulk_docs\nContent-Type: application/json\n\n{\n  \"docs\": [\n    {\"_id\": \"user:1\", \"name\": \"Alice\", \"age\": 30, \"type\": \"user\"},\n    {\"_id\": \"user:2\", \"name\": \"Bob\", \"age\": 25, \"type\": \"user\"},\n    {\"_id\": \"user:3\", \"name\": \"Charlie\", \"age\": 35, \"type\": \"user\"}\n  ]\n}\n</code></pre></p> <p>\u200b\u5b9e\u73b0\u200b: <pre><code># \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u4f1a\u200b\u8c03\u7528\u200b _bulk_docs \u200b\u7aef\u70b9\u200b\n{\n  \"method\": \"POST\",\n  \"endpoint\": \"/_bulk_docs\",\n  \"docs\": [doc1, doc2, doc3]\n}\n</code></pre></p>"},{"location":"guide/sql-to-mango/#update","title":"UPDATE \u200b\u8bed\u53e5\u200b\u8f6c\u6362","text":""},{"location":"guide/sql-to-mango/#_6","title":"\u7b80\u5355\u200b\u66f4\u65b0","text":"<p>SQL: <pre><code>UPDATE users\nSET age = 31\nWHERE _id = 'user:123' AND type = 'user'\n</code></pre></p> <p>Mango Query: <pre><code>POST /mydb/_bulk_docs\nContent-Type: application/json\n\n{\n  \"docs\": [\n    {\n      \"_id\": \"user:123\",\n      \"_rev\": \"1-abc123\",\n      \"$set\": {\"age\": 31}\n    }\n  ]\n}\n</code></pre></p> <p>\u200b\u4e50\u89c2\u200b\u9501\u200b\u673a\u5236\u200b:</p> <pre><code># compiler.py:visit_update()\ndef visit_update(self, update, **kwargs):\n    # \u200b\u6b65\u9aa4\u200b1: \u200b\u6839\u636e\u200b WHERE \u200b\u6761\u4ef6\u200b\u67e5\u627e\u200b\u6587\u6863\u200b\n    selector = self._compile_where(update.whereclause)\n\n    # \u200b\u6b65\u9aa4\u200b2: \u200b\u83b7\u53d6\u200b\u6587\u6863\u200b\u7684\u200b _rev\n    docs = self.client.find(selector, fields=[\"_id\", \"_rev\"])\n\n    # \u200b\u6b65\u9aa4\u200b3: \u200b\u6784\u5efa\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\n    updated_docs = []\n    for doc in docs:\n        doc[\"$set\"] = self._compile_set_clause(update)\n        updated_docs.append(doc)\n\n    # \u200b\u6b65\u9aa4\u200b4: \u200b\u4f7f\u7528\u200b bulk_docs \u200b\u66f4\u65b0\u200b\n    return {\n        \"method\": \"POST\",\n        \"endpoint\": \"/_bulk_docs\",\n        \"docs\": updated_docs\n    }\n</code></pre> <p>\u200b\u5173\u952e\u70b9\u200b: 1. \u200b\u5fc5\u987b\u200b\u5305\u542b\u200b <code>_rev</code>: CouchDB \u200b\u4e50\u89c2\u200b\u9501\u200b\u673a\u5236\u200b 2. \u200b\u4f7f\u7528\u200b <code>$set</code> \u200b\u64cd\u4f5c\u200b: \u200b\u907f\u514d\u200b\u8986\u76d6\u200b\u6574\u4e2a\u200b\u6587\u6863\u200b 3. \u200b\u5148\u200b\u67e5\u8be2\u200b\u518d\u200b\u66f4\u65b0\u200b: \u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b <code>_rev</code></p>"},{"location":"guide/sql-to-mango/#_7","title":"\u591a\u5b57\u6bb5\u200b\u66f4\u65b0","text":"<p>SQL: <pre><code>UPDATE users\nSET age = 31, name = 'Alice Updated', is_active = true\nWHERE _id = 'user:123' AND type = 'user'\n</code></pre></p> <p>Mango Query: <pre><code>{\n  \"docs\": [\n    {\n      \"_id\": \"user:123\",\n      \"_rev\": \"1-abc123\",\n      \"$set\": {\n        \"age\": 31,\n        \"name\": \"Alice Updated\",\n        \"is_active\": true\n      }\n    }\n  ]\n}\n</code></pre></p>"},{"location":"guide/sql-to-mango/#delete","title":"DELETE \u200b\u8bed\u53e5\u200b\u8f6c\u6362","text":""},{"location":"guide/sql-to-mango/#_8","title":"\u5220\u9664\u200b\u6587\u6863","text":"<p>SQL: <pre><code>DELETE FROM users\nWHERE _id = 'user:123' AND type = 'user'\n</code></pre></p> <p>Mango Query: <pre><code>POST /mydb/_bulk_docs\nContent-Type: application/json\n\n{\n  \"docs\": [\n    {\n      \"_id\": \"user:123\",\n      \"_rev\": \"1-abc123\",\n      \"_deleted\": true\n    }\n  ]\n}\n</code></pre></p> <p>\u200b\u5b9e\u73b0\u200b: <pre><code># compiler.py:visit_delete()\ndef visit_delete(self, delete, **kwargs):\n    # \u200b\u6b65\u9aa4\u200b1: \u200b\u67e5\u627e\u200b\u8981\u200b\u5220\u9664\u200b\u7684\u200b\u6587\u6863\u200b\n    selector = self._compile_where(delete.whereclause)\n    docs = self.client.find(selector, fields=[\"_id\", \"_rev\"])\n\n    # \u200b\u6b65\u9aa4\u200b2: \u200b\u6807\u8bb0\u200b\u4e3a\u200b\u5220\u9664\u200b\n    for doc in docs:\n        doc[\"_deleted\"] = True\n\n    # \u200b\u6b65\u9aa4\u200b3: \u200b\u4f7f\u7528\u200b bulk_docs\n    return {\n        \"method\": \"POST\",\n        \"endpoint\": \"/_bulk_docs\",\n        \"docs\": docs\n    }\n</code></pre></p>"},{"location":"guide/sql-to-mango/#order-by","title":"ORDER BY \u200b\u548c\u200b\u7d22\u5f15","text":""},{"location":"guide/sql-to-mango/#_9","title":"\u81ea\u52a8\u200b\u7d22\u5f15\u200b\u521b\u5efa","text":"<p>SQL: <pre><code>SELECT * FROM users\nWHERE type = 'user'\nORDER BY age DESC, name ASC\n</code></pre></p> <p>\u200b\u8fc7\u7a0b\u200b: 1. \u200b\u7f16\u8bd1\u200b SQL \u2192 Mango Query 2. \u200b\u68c0\u6d4b\u200b\u6392\u5e8f\u200b\u5b57\u200b\u6bb5\u200b \u2192 <code>[\"age\", \"name\"]</code> 3. \u200b\u68c0\u67e5\u200b\u7d22\u5f15\u200b \u2192 \u200b\u4f7f\u7528\u200b <code>ensure_index()</code> 4. \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b \u2192 \u200b\u5982\u679c\u200b\u7d22\u5f15\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5148\u200b\u521b\u5efa\u200b</p> <p>\u200b\u5b9e\u73b0\u200b: <pre><code># compiler.py:_compile_order_by()\ndef _compile_order_by(self, order_by):\n    sort = []\n    for item in order_by:\n        field = item.element.name\n        direction = \"desc\" if item.desc else \"asc\"\n        sort.append({field: direction})\n\n        # \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\n        self.client.ensure_index(field)\n\n    return sort\n</code></pre></p> <p>\u200b\u7d22\u5f15\u200b\u8bbe\u8ba1\u200b: <pre><code># \u200b\u590d\u5408\u200b\u7d22\u5f15\u200b\n{\n  \"index\": {\n    \"fields\": [\n      {\"age\": \"desc\"},\n      {\"name\": \"asc\"}\n    ],\n    \"name\": \"age-name-index\"\n  }\n}\n</code></pre></p>"},{"location":"guide/sql-to-mango/#limit-offset","title":"LIMIT \u200b\u548c\u200b OFFSET","text":""},{"location":"guide/sql-to-mango/#_10","title":"\u5206\u9875\u200b\u67e5\u8be2","text":"<p>SQL: <pre><code>SELECT * FROM users\nWHERE type = 'user'\nORDER BY _id\nLIMIT 10\nOFFSET 20\n</code></pre></p> <p>Mango Query: <pre><code>{\n  \"selector\": {\"type\": {\"$eq\": \"user\"}},\n  \"fields\": [\"_id\", \"_rev\", \"type\", \"name\", \"age\"],\n  \"sort\": [{\"_id\": \"asc\"}],\n  \"limit\": 10,\n  \"skip\": 20\n}\n</code></pre></p> <p>\u200b\u6ce8\u610f\u200b: CouchDB \u200b\u7684\u200b <code>skip</code> \u200b\u4f1a\u200b\u8df3\u200b\u8fc7\u200b\u524d\u9762\u200b\u7684\u200b\u6587\u6863\u200b\uff0c\u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b\u3002\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b <code>startkey</code> \u200b\u548c\u200b <code>limit</code> \u200b\u5b9e\u73b0\u200b\u9ad8\u6548\u200b\u5206\u9875\u200b\u3002</p>"},{"location":"guide/sql-to-mango/#_11","title":"\u53c2\u6570\u200b\u7ed1\u5b9a","text":""},{"location":"guide/sql-to-mango/#bindparameter","title":"BindParameter \u200b\u5904\u7406","text":"<p>SQLAlchemy 2.0 \u200b\u4f7f\u7528\u200b <code>BindParameter</code> \u200b\u8fdb\u884c\u200b\u53c2\u6570\u200b\u7ed1\u5b9a\u200b\uff1a</p> <p>SQL: <pre><code>conn.execute(\n    text(\"SELECT * FROM users WHERE age &gt; :age\"),\n    {\"age\": 25}\n)\n</code></pre></p> <p>\u200b\u7ed1\u5b9a\u200b\u503c\u200b\u63d0\u53d6\u200b: <pre><code># compiler.py:_extract_value()\ndef _extract_value(self, value):\n    if isinstance(value, BindParameter):\n        return value.value  # \u200b\u63d0\u53d6\u200b\u5b9e\u9645\u200b\u503c\u200b\n    return value\n</code></pre></p>"},{"location":"guide/sql-to-mango/#_12","title":"\u5e8f\u5217\u5316\u200b\u8fc7\u7a0b","text":"<pre><code># compiler.py:_serialize_for_json()\ndef _serialize_for_json(self, value):\n    if isinstance(value, datetime):\n        return value.isoformat()  # \u200b\u8f6c\u6362\u200b\u4e3a\u200b ISO 8601\n    elif isinstance(value, date):\n        return value.isoformat()\n    elif isinstance(value, Decimal):\n        return str(value)  # \u200b\u9ad8\u7cbe\u5ea6\u200b\u6570\u503c\u200b\n    elif isinstance(value, (dict, list)):\n        return value  # JSON \u200b\u539f\u751f\u200b\u652f\u6301\u200b\n    return value\n</code></pre>"},{"location":"guide/sql-to-mango/#_13","title":"\u8c03\u8bd5\u200b\u8f6c\u6362\u200b\u8fc7\u7a0b","text":""},{"location":"guide/sql-to-mango/#_14","title":"\u542f\u7528\u200b\u8c03\u8bd5\u200b\u65e5\u5fd7","text":"<pre><code>import logging\nlogging.basicConfig(level=logging.DEBUG)\n\n# \u200b\u8bbe\u7f6e\u200b\u7f16\u8bd1\u5668\u200b\u65e5\u5fd7\u200b\nlogging.getLogger('sqlalchemy_couchdb.compiler').setLevel(logging.DEBUG)\n</code></pre>"},{"location":"guide/sql-to-mango/#_15","title":"\u624b\u52a8\u200b\u7f16\u8bd1\u200b\u6d4b\u8bd5","text":"<pre><code>from sqlalchemy import text\nfrom sqlalchemy_couchdb.compiler import CouchDBCompiler\n\n# \u200b\u624b\u52a8\u200b\u7f16\u8bd1\u200b SQL\ncompiler = CouchDBCompiler(None, None)\nsql = text(\"SELECT * FROM users WHERE age &gt; 25\")\nmango_query = compiler.process(sql)\n\nprint(\"Mango Query:\", mango_query)\n</code></pre>"},{"location":"guide/sql-to-mango/#_16","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"guide/sql-to-mango/#1","title":"1. \u200b\u7d22\u5f15\u200b\u4f18\u5316","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5\u200b\u6392\u5e8f\u200b\nSELECT * FROM users ORDER BY age  # age \u200b\u5b57\u6bb5\u200b\u6709\u200b\u7d22\u5f15\u200b\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u65e0\u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5\u200b\u6392\u5e8f\u200b\nSELECT * FROM users ORDER BY name  # name \u200b\u5b57\u6bb5\u200b\u65e0\u200b\u7d22\u5f15\u200b\n</code></pre>"},{"location":"guide/sql-to-mango/#2","title":"2. \u200b\u9650\u5236\u200b\u8fd4\u56de\u200b\u5b57\u200b\u6bb5","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u53ea\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\nSELECT _id, name FROM users\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b\nSELECT * FROM users\n</code></pre>"},{"location":"guide/sql-to-mango/#3-where","title":"3. \u200b\u5408\u7406\u200b\u4f7f\u7528\u200b WHERE","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u7cbe\u786e\u200b\u7b5b\u9009\u200b\nSELECT * FROM users WHERE type = 'user' AND age &gt; 25\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u5bbd\u6cdb\u200b\u7b5b\u9009\u200b\nSELECT * FROM users\n</code></pre>"},{"location":"guide/sql-to-mango/#_17","title":"\u9650\u5236\u200b\u8bf4\u660e","text":""},{"location":"guide/sql-to-mango/#sql","title":"\u4e0d\u200b\u652f\u6301\u200b\u7684\u200b SQL \u200b\u7279\u6027","text":"SQL \u200b\u7279\u6027\u200b \u200b\u539f\u56e0\u200b \u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b <code>JOIN</code> \u200b\u6587\u6863\u200b\u6570\u636e\u5e93\u200b\u65e0\u200b\u5173\u8054\u200b\u67e5\u8be2\u200b \u200b\u4f7f\u7528\u200b\u5d4c\u5165\u5f0f\u200b\u6587\u6863\u200b\u6216\u200b\u591a\u6b21\u200b\u67e5\u8be2\u200b <code>GROUP BY</code> \u200b\u65e0\u200b\u539f\u751f\u200b\u805a\u5408\u200b \u200b\u4f7f\u7528\u200b MapReduce \u200b\u89c6\u56fe\u200b <code>UNION</code> \u200b\u4e0d\u200b\u652f\u6301\u200b \u200b\u591a\u6b21\u200b\u67e5\u8be2\u200b\u5408\u5e76\u200b\u7ed3\u679c\u200b <code>\u200b\u5b50\u200b\u67e5\u8be2\u200b</code> \u200b\u5d4c\u5957\u200b\u67e5\u8be2\u200b\u590d\u6742\u200b \u200b\u9884\u200b\u67e5\u8be2\u200b\u6216\u200b\u5e94\u7528\u5c42\u200b\u5904\u7406\u200b <code>HAVING</code> \u200b\u9700\u8981\u200b\u805a\u5408\u200b \u200b\u4f7f\u7528\u200b\u89c6\u56fe\u200b\u6216\u200b\u5e94\u7528\u5c42\u200b\u8fc7\u6ee4"},{"location":"guide/sql-to-mango/#_18","title":"\u8f6c\u6362\u200b\u9650\u5236","text":"<ol> <li>\u200b\u6700\u5927\u200b\u67e5\u8be2\u200b\u6df1\u5ea6\u200b: Mango Query \u200b\u5d4c\u5957\u200b\u4e0d\u80fd\u200b\u8d85\u8fc7\u200b 5 \u200b\u5c42\u200b</li> <li>\u200b\u7d22\u5f15\u200b\u4f9d\u8d56\u200b: \u200b\u590d\u6742\u200b\u6392\u5e8f\u200b\u9700\u8981\u200b\u9884\u5148\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b</li> <li>\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b: LIKE \u200b\u67e5\u8be2\u200b\u4f7f\u7528\u200b <code>$regex</code>\uff0c\u200b\u6027\u80fd\u200b\u8f83\u200b\u4f4e\u200b</li> </ol>"},{"location":"guide/sql-to-mango/#_19","title":"\u8c03\u8bd5\u200b\u5de5\u5177","text":""},{"location":"guide/sql-to-mango/#mango-query","title":"\u67e5\u770b\u200b\u751f\u6210\u200b\u7684\u200b Mango Query","text":"<pre><code>from sqlalchemy_couchdb.compiler import CouchDBCompiler\n\n# \u200b\u542f\u7528\u200b\u8be6\u7ec6\u200b\u65e5\u5fd7\u200b\nimport logging\nlogging.basicConfig(level=logging.DEBUG)\n\n# \u200b\u6267\u884c\u200b\u67e5\u8be2\u200b\u65f6\u4f1a\u200b\u8f93\u51fa\u200b\u7f16\u8bd1\u200b\u8fc7\u7a0b\u200b\nresult = conn.execute(text(\"SELECT * FROM users WHERE age &gt; 25\"))\n</code></pre>"},{"location":"guide/sql-to-mango/#mango-query_1","title":"\u624b\u52a8\u200b\u6d4b\u8bd5\u200b Mango Query","text":"<pre><code>import httpx\n\n# \u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b Mango Query\nwith httpx.Client() as client:\n    response = client.post(\n        'http://localhost:5984/mydb/_find',\n        json={\n            \"selector\": {\"type\": {\"$eq\": \"user\"}},\n            \"limit\": 10\n        }\n    )\n    print(response.json())\n</code></pre>"},{"location":"guide/sql-to-mango/#_20","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b</li> </ul>"},{"location":"guide/sync-operations/","title":"\u540c\u6b65\u64cd\u4f5c\u200b\u6307\u5357","text":""},{"location":"guide/sync-operations/#_2","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u652f\u6301\u200b\u5b8c\u6574\u200b\u7684\u200b\u540c\u6b65\u64cd\u4f5c\u200b\uff0c\u200b\u4f7f\u7528\u200b\u6807\u51c6\u200b\u7684\u200b SQLAlchemy 2.0 API\u3002\u200b\u6240\u6709\u200b\u540c\u6b65\u64cd\u4f5c\u200b\u90fd\u200b\u57fa\u4e8e\u200b <code>couchdb://</code> URL \u200b\u6a21\u5f0f\u200b\u3002</p>"},{"location":"guide/sync-operations/#_3","title":"\u521b\u5efa\u200b\u540c\u6b65\u200b\u5f15\u64ce","text":"<pre><code>from sqlalchemy import create_engine\n\n# \u200b\u57fa\u7840\u200b\u8fde\u63a5\u200b\nengine = create_engine('couchdb://localhost:5984/mydb')\n\n# \u200b\u5e26\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u8fde\u63a5\u200b\nengine = create_engine('couchdb://admin:password@localhost:5984/mydb')\n\n# \u200b\u5e26\u200b\u8fde\u63a5\u6c60\u200b\u914d\u7f6e\u200b\u7684\u200b\u8fde\u63a5\u200b\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=10,\n    max_overflow=20,\n)\n</code></pre>"},{"location":"guide/sync-operations/#crud","title":"CRUD \u200b\u64cd\u4f5c","text":""},{"location":"guide/sync-operations/#create-","title":"CREATE - \u200b\u63d2\u5165\u200b\u6570\u636e","text":""},{"location":"guide/sync-operations/#_4","title":"\u5355\u6761\u200b\u63d2\u5165","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    # \u200b\u63d2\u5165\u200b\u6587\u6863\u200b\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, email, type)\n        VALUES (:id, :name, :age, :email, 'user')\n    \"\"\"), {\n        'id': 'user:123',\n        'name': 'Alice',\n        'age': 30,\n        'email': 'alice@example.com'\n    })\n    conn.commit()\n\n    print(\"\u2705 \u200b\u63d2\u5165\u200b\u6210\u529f\u200b\")\n</code></pre>"},{"location":"guide/sync-operations/#_5","title":"\u6279\u91cf\u200b\u63d2\u5165","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    users_data = [\n        {'id': 'user:1', 'name': 'Alice', 'age': 30, 'email': 'alice@example.com'},\n        {'id': 'user:2', 'name': 'Bob', 'age': 25, 'email': 'bob@example.com'},\n        {'id': 'user:3', 'name': 'Charlie', 'age': 35, 'email': 'charlie@example.com'},\n    ]\n\n    for user_data in users_data:\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, email, type)\n            VALUES (:id, :name, :age, :email, 'user')\n        \"\"\"), user_data)\n\n    conn.commit()\n    print(f\"\u2705 \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b {len(users_data)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n</code></pre>"},{"location":"guide/sync-operations/#_6","title":"\u6279\u91cf\u200b\u63d2\u5165\u200b (\u200b\u9ad8\u6548\u200b\u65b9\u5f0f\u200b)","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    users_data = [\n        {'id': 'user:1', 'name': 'Alice', 'age': 30, 'email': 'alice@example.com'},\n        {'id': 'user:2', 'name': 'Bob', 'age': 25, 'email': 'bob@example.com'},\n        {'id': 'user:3', 'name': 'Charlie', 'age': 35, 'email': 'charlie@example.com'},\n    ]\n\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, email, type)\n        VALUES (:id, :name, :age, :email, 'user')\n    \"\"\"), users_data)\n\n    conn.commit()\n    print(\"\u2705 \u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\u6210\u529f\u200b\")\n</code></pre>"},{"location":"guide/sync-operations/#read-","title":"READ - \u200b\u67e5\u8be2\u200b\u6570\u636e","text":""},{"location":"guide/sync-operations/#_7","title":"\u7b80\u5355\u200b\u67e5\u8be2","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users WHERE type = 'user'\n    \"\"\"))\n\n    for row in result:\n        print(f\"ID: {row._id}, \u200b\u59d3\u540d\u200b: {row.name}, \u200b\u5e74\u9f84\u200b: {row.age}\")\n</code></pre>"},{"location":"guide/sync-operations/#_8","title":"\u6761\u4ef6\u200b\u67e5\u8be2","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    # \u200b\u5927\u4e8e\u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user' AND age &gt; :age\n    \"\"\"), {'age': 25})\n\n    for row in result:\n        print(f\"{row.name}: {row.age} \u200b\u5c81\u200b\")\n\n    # IN \u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user' AND _id IN (:id1, :id2, :id3)\n    \"\"\"), {\n        'id1': 'user:1',\n        'id2': 'user:2',\n        'id3': 'user:3'\n    })\n\n    # LIKE \u200b\u67e5\u8be2\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user' AND name LIKE :pattern\n    \"\"\"), {'pattern': '%Alice%'})\n</code></pre>"},{"location":"guide/sync-operations/#_9","title":"\u6392\u5e8f\u200b\u548c\u200b\u5206\u9875","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    # \u200b\u6392\u5e8f\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user'\n        ORDER BY age DESC, name ASC\n    \"\"\"))\n\n    for row in result:\n        print(f\"{row.name}: {row.age} \u200b\u5c81\u200b\")\n\n    # \u200b\u5206\u9875\u200b\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user'\n        ORDER BY _id\n        LIMIT 10 OFFSET 20\n    \"\"\"))\n\n    for row in result:\n        print(f\"{row.name}\")\n</code></pre>"},{"location":"guide/sync-operations/#_10","title":"\u83b7\u53d6\u200b\u5355\u6761\u200b\u8bb0\u5f55","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        SELECT * FROM users\n        WHERE type = 'user' AND _id = :id\n    \"\"\"), {'id': 'user:123'})\n\n    if result.rowcount &gt; 0:\n        row = result.fetchone()\n        print(f\"\u200b\u627e\u5230\u200b\u7528\u6237\u200b: {row.name}\")\n    else:\n        print(\"\u200b\u7528\u6237\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n</code></pre>"},{"location":"guide/sync-operations/#update-","title":"UPDATE - \u200b\u66f4\u65b0\u200b\u6570\u636e","text":""},{"location":"guide/sync-operations/#_11","title":"\u66f4\u65b0\u200b\u5355\u6761\u200b\u8bb0\u5f55","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        UPDATE users\n        SET age = :age\n        WHERE _id = :id AND type = 'user'\n        RETURNING *\n    \"\"\"), {\n        'id': 'user:123',\n        'age': 31\n    })\n\n    if result.rowcount &gt; 0:\n        updated_row = result.fetchone()\n        print(f\"\u2705 \u200b\u66f4\u65b0\u200b\u6210\u529f\u200b, \u200b\u65b0\u200b\u7248\u672c\u200b: {updated_row._rev}\")\n    else:\n        print(\"\u274c \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n    conn.commit()\n</code></pre>"},{"location":"guide/sync-operations/#_12","title":"\u66f4\u65b0\u200b\u591a\u6761\u200b\u8bb0\u5f55","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        UPDATE users\n        SET age = age + 1\n        WHERE type = 'user' AND age &lt; :max_age\n        RETURNING *\n    \"\"\"), {'max_age': 30})\n\n    updated_count = result.rowcount\n    print(f\"\u2705 \u200b\u66f4\u65b0\u200b\u4e86\u200b {updated_count} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n\n    conn.commit()\n</code></pre>"},{"location":"guide/sync-operations/#delete-","title":"DELETE - \u200b\u5220\u9664\u200b\u6570\u636e","text":""},{"location":"guide/sync-operations/#_13","title":"\u5220\u9664\u200b\u5355\u6761\u200b\u8bb0\u5f55","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        DELETE FROM users\n        WHERE _id = :id AND type = 'user'\n    \"\"\"), {'id': 'user:123'})\n\n    if result.rowcount &gt; 0:\n        print(\"\u2705 \u200b\u5220\u9664\u200b\u6210\u529f\u200b\")\n    else:\n        print(\"\u274c \u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n    conn.commit()\n</code></pre>"},{"location":"guide/sync-operations/#_14","title":"\u6279\u91cf\u200b\u5220\u9664","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    result = conn.execute(text(\"\"\"\n        DELETE FROM users\n        WHERE type = 'user' AND age &lt; :min_age\n    \"\"\"), {'min_age': 18})\n\n    deleted_count = result.rowcount\n    print(f\"\u2705 \u200b\u5220\u9664\u200b\u4e86\u200b {deleted_count} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n\n    conn.commit()\n</code></pre>"},{"location":"guide/sync-operations/#_15","title":"\u4e8b\u52a1\u7ba1\u7406","text":""},{"location":"guide/sync-operations/#_16","title":"\u81ea\u52a8\u200b\u63d0\u4ea4","text":"<pre><code>from sqlalchemy import text\n\n# \u200b\u4f7f\u7528\u200b begin() \u200b\u81ea\u52a8\u200b\u63d0\u4ea4\u200b\nwith engine.begin() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, type)\n        VALUES (:id, :name, :age, 'user')\n    \"\"\"), {'id': 'user:456', 'name': 'David', 'age': 28})\n\n    # \u200b\u81ea\u52a8\u200b commit\n</code></pre>"},{"location":"guide/sync-operations/#_17","title":"\u624b\u52a8\u200b\u4e8b\u52a1","text":"<pre><code>from sqlalchemy import text\n\nwith engine.connect() as conn:\n    try:\n        # \u200b\u5f00\u59cb\u200b\u4e8b\u52a1\u200b\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, type)\n            VALUES (:id1, :name1, :age1, 'user')\n        \"\"\"), {'id1': 'user:1', 'name1': 'Alice', 'age1': 30})\n\n        conn.execute(text(\"\"\"\n            INSERT INTO orders (_id, user_id, amount, type)\n            VALUES (:id2, :user_id, :amount, 'order')\n        \"\"\"), {'id2': 'order:1', 'user_id': 'user:1', 'amount': 99.99})\n\n        # \u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\n        conn.commit()\n        print(\"\u2705 \u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u6210\u529f\u200b\")\n    except Exception as e:\n        # \u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\n        conn.rollback()\n        print(f\"\u274c \u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b: {e}\")\n</code></pre>"},{"location":"guide/sync-operations/#_18","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"guide/sync-operations/#db-api","title":"DB-API \u200b\u5f02\u5e38","text":"<pre><code>from sqlalchemy import text\nfrom sqlalchemy_couchdb.exceptions import CouchDBError\n\ntry:\n    with engine.connect() as conn:\n        conn.execute(text(\"\"\"\n            INSERT INTO users (_id, name, age, type)\n            VALUES (:id, :name, :age, 'user')\n        \"\"\"), {\n            'id': 'user:123',  # \u200b\u5047\u8bbe\u200b\u5df2\u200b\u5b58\u5728\u200b\n            'name': 'Alice',\n            'age': 30\n        })\n        conn.commit()\nexcept CouchDBError as e:\n    print(f\"CouchDB \u200b\u9519\u8bef\u200b: {e}\")\nexcept Exception as e:\n    print(f\"\u200b\u901a\u7528\u200b\u9519\u8bef\u200b: {e}\")\n</code></pre>"},{"location":"guide/sync-operations/#_19","title":"\u4e50\u89c2\u200b\u9501\u200b\u9519\u8bef\u5904\u7406","text":"<pre><code>from sqlalchemy import text\n\ndef update_with_retry(conn, user_id, new_age, max_retries=3):\n    \"\"\"\u200b\u5e26\u200b\u91cd\u8bd5\u200b\u7684\u200b\u4e50\u89c2\u200b\u9501\u200b\u66f4\u65b0\u200b\"\"\"\n    for attempt in range(max_retries):\n        try:\n            result = conn.execute(text(\"\"\"\n                UPDATE users\n                SET age = :age\n                WHERE _id = :id AND type = 'user'\n                RETURNING *\n            \"\"\"), {\n                'id': user_id,\n                'age': new_age\n            })\n\n            if result.rowcount &gt; 0:\n                return result.fetchone()\n            else:\n                raise Exception(\"\u200b\u6587\u6863\u200b\u4e0d\u200b\u5b58\u5728\u200b\")\n\n        except Exception as e:\n            if attempt == max_retries - 1:\n                raise\n            print(f\"\u200b\u5c1d\u8bd5\u200b {attempt + 1} \u200b\u5931\u8d25\u200b: {e}\uff0c\u200b\u91cd\u8bd5\u200b\u4e2d\u200b...\")\n            # \u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u6587\u6863\u200b\n            time.sleep(0.1)\n\n# \u200b\u4f7f\u7528\u200b\nwith engine.connect() as conn:\n    updated_row = update_with_retry(conn, 'user:123', 35)\n    conn.commit()\n</code></pre>"},{"location":"guide/sync-operations/#_20","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"guide/sync-operations/#1","title":"1. \u200b\u4f7f\u7528\u200b\u6279\u91cf\u200b\u64cd\u4f5c","text":"<pre><code># \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u6279\u91cf\u200b\u63d2\u5165\u200b\nusers_data = [...]\nconn.execute(text(\"INSERT INTO ...\"), users_data)\n\n# \u274c \u200b\u6162\u200b\uff1a\u200b\u5faa\u73af\u200b\u63d2\u5165\u200b\nfor data in users_data:\n    conn.execute(text(\"INSERT INTO ...\"), data)\n</code></pre>"},{"location":"guide/sync-operations/#2","title":"2. \u200b\u4f7f\u7528\u200b\u7d22\u5f15","text":"<pre><code># \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\uff08\u200b\u901a\u8fc7\u200b ORDER BY\uff09\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user' AND age &gt; 25\n    ORDER BY age DESC  -- \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b age \u200b\u7d22\u5f15\u200b\n\"\"\"))\n</code></pre>"},{"location":"guide/sync-operations/#3","title":"3. \u200b\u9650\u5236\u200b\u8fd4\u56de\u200b\u5b57\u200b\u6bb5","text":"<pre><code># \u2705 \u200b\u53ea\u200b\u67e5\u8be2\u200b\u9700\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT _id, name, age FROM users\n    WHERE type = 'user'\n\"\"\"))\n\n# \u274c \u200b\u67e5\u8be2\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n\"\"\"))\n</code></pre>"},{"location":"guide/sync-operations/#_21","title":"\u8fde\u63a5\u200b\u7ba1\u7406","text":""},{"location":"guide/sync-operations/#_22","title":"\u8fde\u63a5\u6c60","text":"<pre><code>from sqlalchemy import create_engine\n\nengine = create_engine(\n    'couchdb://admin:password@localhost:5984/mydb',\n    pool_size=10,          # \u200b\u6c60\u200b\u5927\u5c0f\u200b\n    max_overflow=20,       # \u200b\u6700\u5927\u200b\u6ea2\u51fa\u200b\n    pool_recycle=3600,     # \u200b\u8fde\u63a5\u200b\u56de\u6536\u200b\u65f6\u95f4\u200b\n    pool_pre_ping=True,    # \u200b\u9884\u200b\u68c0\u67e5\u200b\u8fde\u63a5\u200b\n)\n\n# \u200b\u76d1\u63a7\u200b\u8fde\u63a5\u6c60\u200b\ndef check_pool(engine):\n    pool = engine.pool\n    print(f\"\u200b\u6c60\u200b\u5927\u5c0f\u200b: {pool.size()}\")\n    print(\"\u200b\u5df2\u200b\u501f\u51fa\u200b:\", pool.checkedout())\n    print(\"\u200b\u5df2\u200b\u8fd4\u56de\u200b:\", pool.returned())\n\ncheck_pool(engine)\n</code></pre>"},{"location":"guide/sync-operations/#_23","title":"\u8fde\u63a5\u200b\u6d4b\u8bd5","text":"<pre><code>def ping_database(engine):\n    \"\"\"\u200b\u6d4b\u8bd5\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\"\"\"\n    try:\n        with engine.connect() as conn:\n            result = conn.execute(text(\"SELECT 1\"))\n            print(\"\u2705 \u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\u6b63\u5e38\u200b\")\n            return True\n    except Exception as e:\n        print(f\"\u274c \u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\u5931\u8d25\u200b: {e}\")\n        return False\n\nping_database(engine)\n</code></pre>"},{"location":"guide/sync-operations/#_24","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b</li> <li>SQL \u200b\u8f6c\u200b Mango Query</li> </ul>"},{"location":"guide/type-mapping/","title":"\u7c7b\u578b\u200b\u6620\u5c04\u200b\u6307\u5357","text":""},{"location":"guide/type-mapping/#_2","title":"\u6982\u8ff0","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u63d0\u4f9b\u200b\u5b8c\u6574\u200b\u7684\u200b Python \u2194 JSON \u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b\u7cfb\u7edf\u200b\u3002\u200b\u6240\u6709\u200b SQLAlchemy \u200b\u7c7b\u578b\u200b\u90fd\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b CouchDB JSON \u200b\u7c7b\u578b\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b Python \u200b\u548c\u200b JSON \u200b\u4e4b\u95f4\u200b\u8fdb\u884c\u200b\u53cc\u5411\u200b\u8f6c\u6362\u200b\u3002</p>"},{"location":"guide/type-mapping/#_3","title":"\u7c7b\u578b\u200b\u6620\u5c04\u200b\u8868","text":"SQLAlchemy \u200b\u7c7b\u578b\u200b CouchDB JSON \u200b\u7c7b\u578b\u200b Python \u200b\u7c7b\u578b\u200b \u200b\u793a\u4f8b\u200b <code>CouchDBString</code> <code>string</code> <code>str</code> <code>\"Alice\"</code> <code>CouchDBInteger</code> <code>number</code> <code>int</code> <code>30</code> <code>CouchDBFloat</code> <code>number</code> <code>float</code> <code>99.99</code> <code>CouchDBBoolean</code> <code>boolean</code> <code>bool</code> <code>true</code> <code>CouchDBDateTime</code> <code>string</code> (ISO 8601) <code>datetime</code> <code>\"2025-01-02T15:30:00\"</code> <code>CouchDBDate</code> <code>string</code> (ISO 8601) <code>date</code> <code>\"2025-01-02\"</code> <code>CouchDBJSON</code> <code>object/array</code> <code>dict</code>/<code>list</code> <code>{\"key\": \"value\"}</code> <code>CouchDBNumeric</code> <code>number/string</code> <code>Decimal</code> <code>\"123.456789\"</code>"},{"location":"guide/type-mapping/#_4","title":"\u5185\u7f6e\u200b\u7c7b\u578b\u200b\u8be6\u89e3","text":""},{"location":"guide/type-mapping/#1-couchdbstring","title":"1. CouchDBString","text":"<pre><code>from sqlalchemy import Column, String\nfrom sqlalchemy_couchdb.types import CouchDBString\n\n# \u200b\u5728\u200b\u8868\u200b\u5b9a\u4e49\u200b\u4e2d\u200b\u4f7f\u7528\u200b\nusers = Table('users', metadata,\n    Column('name', CouchDBString),  # \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b string\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# \"Alice\" \u2192 \"Alice\"\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# \"Alice\" \u2192 \"Alice\"\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u6240\u6709\u200b\u503c\u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5b57\u7b26\u4e32\u200b - \u200b\u81ea\u52a8\u200b\u5904\u7406\u200b None \u200b\u503c\u200b - \u200b\u652f\u6301\u200b Unicode</p>"},{"location":"guide/type-mapping/#2-couchdbinteger","title":"2. CouchDBInteger","text":"<pre><code>from sqlalchemy import Column, Integer\nfrom sqlalchemy_couchdb.types import CouchDBInteger\n\nusers = Table('users', metadata,\n    Column('age', CouchDBInteger),  # \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b number\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# 30 \u2192 30\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# 30 \u2192 30\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6574\u6570\u200b - \u200b\u652f\u6301\u200b None \u200b\u503c\u200b - \u200b\u4f1a\u200b\u622a\u65ad\u200b\u5c0f\u6570\u200b\u90e8\u5206\u200b\uff08\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b Float\uff09</p>"},{"location":"guide/type-mapping/#3-couchdbfloat","title":"3. CouchDBFloat","text":"<pre><code>from sqlalchemy import Column, Float\nfrom sqlalchemy_couchdb.types import CouchDBFloat\n\nusers = Table('users', metadata,\n    Column('price', CouchDBFloat),  # \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b number\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# 99.99 \u2192 99.99\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# 99.99 \u2192 99.99\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6d6e\u70b9\u6570\u200b - \u200b\u652f\u6301\u200b None \u200b\u503c\u200b - \u200b\u6ce8\u610f\u200b\u6d6e\u70b9\u6570\u200b\u7cbe\u5ea6\u200b\u95ee\u9898\u200b</p>"},{"location":"guide/type-mapping/#4-couchdbboolean","title":"4. CouchDBBoolean","text":"<pre><code>from sqlalchemy import Column, Boolean\nfrom sqlalchemy_couchdb.types import CouchDBBoolean\n\nusers = Table('users', metadata,\n    Column('is_active', CouchDBBoolean),  # \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b boolean\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# True \u2192 true\n# False \u2192 false\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# true \u2192 True\n# false \u2192 False\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5e03\u5c14\u503c\u200b - \u200b\u652f\u6301\u200b None \u200b\u503c\u200b - \u200b\u4efb\u4f55\u200b\u975e\u96f6\u503c\u200b\u8f6c\u4e3a\u200b True</p>"},{"location":"guide/type-mapping/#5-couchdbdatetime","title":"5. CouchDBDateTime","text":"<pre><code>from sqlalchemy import Column, DateTime\nfrom sqlalchemy_couchdb.types import CouchDBDateTime\nfrom datetime import datetime\n\nusers = Table('users', metadata,\n    Column('created_at', CouchDBDateTime),  # ISO 8601 \u200b\u5b57\u7b26\u4e32\u200b\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# datetime(2025, 1, 2, 15, 30, 0) \u2192 \"2025-01-02T15:30:00\"\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# \"2025-01-02T15:30:00\" \u2192 datetime(2025, 1, 2, 15, 30, 0)\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u4f7f\u7528\u200b ISO 8601 \u200b\u683c\u5f0f\u200b - \u200b\u652f\u6301\u200b\u65f6\u200b\u533a\u200b\uff08\u200b\u5982\u679c\u200b\u63d0\u4f9b\u200b\uff09 - \u200b\u81ea\u52a8\u200b\u5904\u7406\u200b None \u200b\u503c\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u793a\u4f8b\u200b:</p> <pre><code>from datetime import datetime\n\n# \u200b\u63d2\u5165\u200b\u5e26\u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\u7684\u200b\u6587\u6863\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, created_at, type)\n        VALUES (:id, :name, :created_at, 'user')\n    \"\"\"), {\n        'id': 'user:dt-1',\n        'name': 'Alice',\n        'created_at': datetime(2025, 1, 2, 15, 30, 0)\n    })\n    conn.commit()\n\n# \u200b\u67e5\u8be2\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\u56de\u200b datetime\nresult = conn.execute(text(\"SELECT * FROM users WHERE _id = 'user:dt-1'\"))\nrow = result.fetchone()\nprint(type(row.created_at))  # &lt;class 'datetime.datetime'&gt;\n</code></pre>"},{"location":"guide/type-mapping/#6-couchdbdate","title":"6. CouchDBDate","text":"<pre><code>from sqlalchemy import Column, Date\nfrom sqlalchemy_couchdb.types import CouchDBDate\nfrom datetime import date\n\nusers = Table('users', metadata,\n    Column('birth_date', CouchDBDate),  # ISO 8601 \u200b\u65e5\u671f\u200b\u5b57\u7b26\u4e32\u200b\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# date(2025, 1, 2) \u2192 \"2025-01-02\"\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# \"2025-01-02\" \u2192 date(2025, 1, 2)\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - \u200b\u4f7f\u7528\u200b YYYY-MM-DD \u200b\u683c\u5f0f\u200b - \u200b\u81ea\u52a8\u200b\u5904\u7406\u200b None \u200b\u503c\u200b - \u200b\u4e0d\u4f1a\u200b\u5b58\u50a8\u200b\u65f6\u95f4\u200b\u90e8\u5206\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u793a\u4f8b\u200b:</p> <pre><code>from datetime import date\n\n# \u200b\u63d2\u5165\u200b\u5e26\u200b\u65e5\u671f\u200b\u7684\u200b\u6587\u6863\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, birth_date, type)\n        VALUES (:id, :name, :birth_date, 'user')\n    \"\"\"), {\n        'id': 'user:date-1',\n        'name': 'Bob',\n        'birth_date': date(1990, 5, 15)\n    })\n    conn.commit()\n\n# \u200b\u67e5\u8be2\u200b\nresult = conn.execute(text(\"SELECT * FROM users WHERE _id = 'user:date-1'\"))\nrow = result.fetchone()\nprint(type(row.birth_date))  # &lt;class 'datetime.date'&gt;\n</code></pre>"},{"location":"guide/type-mapping/#7-couchdbjson","title":"7. CouchDBJSON","text":"<pre><code>from sqlalchemy import Column, JSON\nfrom sqlalchemy_couchdb.types import CouchDBJSON\n\nusers = Table('users', metadata,\n    Column('metadata', CouchDBJSON),  # \u200b\u539f\u751f\u200b JSON \u200b\u5bf9\u8c61\u200b\n)\n\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# {\"key\": \"value\", \"list\": [1, 2, 3]} \u2192 {\"key\": \"value\", \"list\": [1, 2, 3]}\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# {\"key\": \"value\"} \u2192 {\"key\": \"value\"}\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - CouchDB \u200b\u539f\u751f\u200b\u652f\u6301\u200b\uff0c\u200b\u65e0\u9700\u200b\u8f6c\u6362\u200b - \u200b\u652f\u6301\u200b\u5d4c\u5957\u200b\u5bf9\u8c61\u200b\u548c\u200b\u6570\u7ec4\u200b - \u200b\u7075\u6d3b\u200b\u5b58\u50a8\u200b\u534a\u200b\u7ed3\u6784\u5316\u200b\u6570\u636e\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u793a\u4f8b\u200b:</p> <pre><code># \u200b\u63d2\u5165\u200b\u590d\u6742\u200b JSON \u200b\u6570\u636e\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, metadata, type)\n        VALUES (:id, :name, :metadata, 'user')\n    \"\"\"), {\n        'id': 'user:json-1',\n        'name': 'Charlie',\n        'metadata': {\n            'preferences': {\n                'theme': 'dark',\n                'notifications': True\n            },\n            'tags': ['vip', 'beta'],\n            'score': 95.5\n        }\n    })\n    conn.commit()\n\n# \u200b\u67e5\u8be2\u200b JSON \u200b\u6570\u636e\u200b\nresult = conn.execute(text(\"SELECT metadata FROM users WHERE _id = 'user:json-1'\"))\nrow = result.fetchone()\nprint(row.metadata['preferences']['theme'])  # \"dark\"\n</code></pre>"},{"location":"guide/type-mapping/#8-couchdbnumeric","title":"8. CouchDBNumeric\uff08\u200b\u9ad8\u7cbe\u5ea6\u200b\u6570\u503c\u200b\uff09","text":"<pre><code>from sqlalchemy import Column, Numeric\nfrom sqlalchemy_couchdb.types import CouchDBNumeric\nfrom decimal import Decimal\n\nusers = Table('transactions', metadata,\n    Column('amount', CouchDBNumeric(precision=10, scale=2, as_string=True)),\n)\n\n# as_string=True\uff08\u200b\u9ed8\u8ba4\u200b\uff09\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# Decimal(\"123.45\") \u2192 \"123.45\"\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# \"123.45\" \u2192 Decimal(\"123.45\")\n\n# as_string=False\n# Python \u2192 JSON \u200b\u8f6c\u6362\u200b\n# Decimal(\"123.45\") \u2192 123.45\n\n# JSON \u2192 Python \u200b\u8f6c\u6362\u200b\n# 123.45 \u2192 123.45\uff08\u200b\u53ef\u80fd\u200b\u635f\u5931\u200b\u7cbe\u5ea6\u200b\uff09\n</code></pre> <p>\u200b\u7279\u70b9\u200b: - <code>as_string=True</code>: \u200b\u4fdd\u6301\u200b\u7cbe\u5ea6\u200b\uff0c\u200b\u5b58\u50a8\u200b\u4e3a\u200b\u5b57\u7b26\u4e32\u200b - <code>as_string=False</code>: \u200b\u5b58\u50a8\u200b\u4e3a\u200b\u6570\u5b57\u200b\uff0c\u200b\u53ef\u80fd\u200b\u635f\u5931\u200b\u7cbe\u5ea6\u200b - \u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b <code>as_string=True</code> \u200b\u5904\u7406\u200b\u8d27\u5e01\u200b\u7b49\u200b\u654f\u611f\u6570\u636e\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u793a\u4f8b\u200b:</p> <pre><code>from decimal import Decimal\n\n# \u200b\u4f7f\u7528\u200b\u9ad8\u7cbe\u5ea6\u200b\u6570\u503c\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO transactions (_id, amount, type)\n        VALUES (:id, :amount, 'transaction')\n    \"\"\"), {\n        'id': 'tx:1',\n        'amount': Decimal('123.456789')  # \u200b\u4fdd\u6301\u200b\u5b8c\u6574\u200b\u7cbe\u5ea6\u200b\n    })\n    conn.commit()\n\n# \u200b\u67e5\u8be2\u200b\nresult = conn.execute(text(\"SELECT amount FROM transactions WHERE _id = 'tx:1'\"))\nrow = result.fetchone()\nprint(row.amount)  # Decimal('123.456789')\nprint(f\"\u200b\u7c7b\u578b\u200b: {type(row.amount)}\")  # &lt;class 'decimal.Decimal'&gt;\n</code></pre>"},{"location":"guide/type-mapping/#sqlalchemy","title":"\u4f7f\u7528\u200b\u6807\u51c6\u200b SQLAlchemy \u200b\u7c7b\u578b","text":"<p>SQLAlchemy CouchDB \u200b\u65b9\u8a00\u200b\u81ea\u52a8\u200b\u5c06\u200b\u6807\u51c6\u200b\u7c7b\u578b\u200b\u6620\u5c04\u200b\u5230\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b\uff1a</p> <pre><code>from sqlalchemy import Table, Column, String, Integer, Float, Boolean, DateTime, Date, JSON\n\nusers = Table('users', metadata,\n    Column('_id', String),           # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBString\n    Column('name', String),\n    Column('age', Integer),          # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBInteger\n    Column('price', Float),          # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBFloat\n    Column('is_active', Boolean),    # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBBoolean\n    Column('created_at', DateTime),  # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBDateTime\n    Column('birth_date', Date),      # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBDate\n    Column('metadata', JSON),        # \u200b\u81ea\u52a8\u200b\u6620\u5c04\u200b\u5230\u200b CouchDBJSON\n    Column('type', String)\n)\n</code></pre>"},{"location":"guide/type-mapping/#_5","title":"\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b","text":"<p>\u200b\u60a8\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\uff1a</p> <pre><code>from sqlalchemy import types\nfrom sqlalchemy_couchdb.types import CouchDBString\n\nclass CouchDBEmail(CouchDBString):\n    \"\"\"\u200b\u90ae\u4ef6\u200b\u7c7b\u578b\u200b - \u200b\u57fa\u4e8e\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u4f46\u200b\u6dfb\u52a0\u200b\u9a8c\u8bc1\u200b\"\"\"\n\n    def bind_processor(self, dialect):\n        def process(value):\n            if value is None:\n                return None\n            # \u200b\u6dfb\u52a0\u200b\u7b80\u5355\u200b\u7684\u200b\u90ae\u7bb1\u200b\u683c\u5f0f\u200b\u68c0\u67e5\u200b\n            if '@' not in str(value):\n                raise ValueError(f\"\u200b\u65e0\u6548\u200b\u7684\u200b\u90ae\u7bb1\u200b\u683c\u5f0f\u200b: {value}\")\n            return str(value)\n\n        return process\n\n# \u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7c7b\u578b\u200b\nusers = Table('users', metadata,\n    Column('email', CouchDBEmail),\n)\n</code></pre>"},{"location":"guide/type-mapping/#_6","title":"\u7c7b\u578b\u200b\u63a8\u65ad","text":"<p>SQLAlchemy \u200b\u4f1a\u200b\u6839\u636e\u200b Python \u200b\u503c\u200b\u7684\u200b\u7c7b\u578b\u200b\u81ea\u52a8\u200b\u63a8\u65ad\u200b\uff1a</p> <pre><code>from sqlalchemy import text\n\n# SQLAlchemy \u200b\u4f1a\u200b\u6839\u636e\u200b\u503c\u200b\u7c7b\u578b\u200b\u81ea\u52a8\u200b\u8f6c\u6362\u200b\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, name, age, is_active, created_at, type)\n        VALUES (:id, :name, :age, :is_active, :created_at, 'user')\n    \"\"\"), {\n        'id': 'user:auto-1',\n        'name': 'Alice',           # str \u2192 string\n        'age': 30,                 # int \u2192 number\n        'is_active': True,         # bool \u2192 boolean\n        'created_at': datetime.now(),  # datetime \u2192 ISO 8601 string\n    })\n    conn.commit()\n</code></pre>"},{"location":"guide/type-mapping/#_7","title":"\u65e5\u671f\u200b\u65f6\u95f4\u200b\u683c\u5f0f\u5316","text":""},{"location":"guide/type-mapping/#iso-8601","title":"ISO 8601 \u200b\u683c\u5f0f","text":"<p>CouchDB \u200b\u4f7f\u7528\u200b ISO 8601 \u200b\u683c\u5f0f\u200b\u5b58\u50a8\u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\uff1a</p> <pre><code># \u200b\u6807\u51c6\u200b\u683c\u5f0f\u200b\n\"2025-01-02T15:30:00\"\n\"2025-01-02T15:30:00Z\"  # UTC \u200b\u65f6\u200b\u533a\u200b\n\"2025-01-02T15:30:00+08:00\"  # \u200b\u6307\u5b9a\u200b\u65f6\u200b\u533a\u200b\n</code></pre>"},{"location":"guide/type-mapping/#_8","title":"\u65f6\u200b\u533a\u200b\u5904\u7406","text":"<pre><code>from datetime import datetime, timezone\nimport pytz\n\n# UTC \u200b\u65f6\u95f4\u200b\nutc_time = datetime.now(timezone.utc)\n\n# \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6307\u5b9a\u200b\u65f6\u200b\u533a\u200b\ntokyo_tz = pytz.timezone('Asia/Tokyo')\ntokyo_time = utc_time.astimezone(tokyo_tz)\n\n# \u200b\u5b58\u50a8\u200b\u5230\u200b CouchDB\nwith engine.connect() as conn:\n    conn.execute(text(\"\"\"\n        INSERT INTO users (_id, created_at, type)\n        VALUES (:id, :created_at, 'user')\n    \"\"\"), {\n        'id': 'user:tz-1',\n        'created_at': utc_time\n    })\n    conn.commit()\n</code></pre>"},{"location":"guide/type-mapping/#_9","title":"\u6027\u80fd\u200b\u4f18\u5316","text":""},{"location":"guide/type-mapping/#1","title":"1. \u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u7c7b\u578b","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u4f7f\u7528\u200b\u9002\u5f53\u200b\u7cbe\u5ea6\u200b\nColumn('price', CouchDBNumeric(precision=10, scale=2))\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u7cbe\u5ea6\u200b\nColumn('price', CouchDBNumeric(precision=38, scale=20))\n</code></pre>"},{"location":"guide/type-mapping/#2-json","title":"2. \u200b\u907f\u514d\u200b\u8fc7\u5ea6\u200b\u5d4c\u5957\u200b JSON","text":"<pre><code># \u2705 \u200b\u597d\u200b\uff1a\u200b\u9002\u5ea6\u200b\u5d4c\u5957\u200b\nmetadata = {'tag': 'vip', 'score': 95}\n\n# \u274c \u200b\u5dee\u200b\uff1a\u200b\u8fc7\u5ea6\u200b\u5d4c\u5957\u200b\uff08\u200b\u5f71\u54cd\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\uff09\nmetadata = {\n    'level1': {\n        'level2': {\n            'level3': {...}\n        }\n    }\n}\n</code></pre>"},{"location":"guide/type-mapping/#3","title":"3. \u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\u5b57\u200b\u6bb5","text":"<pre><code># \u200b\u4e3a\u200b\u5e38\u7528\u200b\u67e5\u8be2\u200b\u5b57\u200b\u6bb5\u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\uff08\u200b\u901a\u8fc7\u200b ORDER BY \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\uff09\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE type = 'user'\n    ORDER BY age  -- \u200b\u81ea\u52a8\u200b\u4e3a\u200b age \u200b\u521b\u5efa\u200b\u7d22\u5f15\u200b\n    LIMIT 100\n\"\"\"))\n</code></pre>"},{"location":"guide/type-mapping/#_10","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"guide/type-mapping/#1_1","title":"1. \u200b\u65e5\u671f\u200b\u65f6\u95f4\u200b\u683c\u5f0f\u200b\u4e0d\u200b\u5339\u914d","text":"<p>\u200b\u95ee\u9898\u200b: <pre><code># \u200b\u63d2\u5165\u200b\u9519\u8bef\u200b\u683c\u5f0f\u200b\u7684\u200b\u65e5\u671f\u200b\nconn.execute(text(\"...\"), {'date': '2025/01/02'})  # \u200b\u9519\u8bef\u200b\n</code></pre></p> <p>\u200b\u89e3\u51b3\u200b: <pre><code># \u200b\u4f7f\u7528\u200b datetime \u200b\u5bf9\u8c61\u200b\nfrom datetime import datetime\nconn.execute(text(\"...\"), {'date': datetime(2025, 1, 2)})\n\n# \u200b\u6216\u200b\u4f7f\u7528\u200b ISO 8601 \u200b\u5b57\u7b26\u4e32\u200b\nconn.execute(text(\"...\"), {'date': '2025-01-02T00:00:00'})\n</code></pre></p>"},{"location":"guide/type-mapping/#2","title":"2. \u200b\u6570\u503c\u200b\u7cbe\u5ea6\u200b\u635f\u5931","text":"<p>\u200b\u95ee\u9898\u200b: <pre><code># \u200b\u4f7f\u7528\u200b Float \u200b\u5b58\u50a8\u200b\u8d27\u5e01\u200b\nColumn('amount', Float)  # \u200b\u53ef\u80fd\u200b\u635f\u5931\u200b\u7cbe\u5ea6\u200b\n</code></pre></p> <p>\u200b\u89e3\u51b3\u200b: <pre><code># \u200b\u4f7f\u7528\u200b Numeric \u200b\u7c7b\u578b\u200b\nfrom sqlalchemy import Numeric\nfrom sqlalchemy_couchdb.types import CouchDBNumeric\n\nColumn('amount', CouchDBNumeric(precision=10, scale=2, as_string=True))\n</code></pre></p>"},{"location":"guide/type-mapping/#3-json","title":"3. JSON \u200b\u5b57\u200b\u6bb5\u200b\u67e5\u8be2","text":"<pre><code># CouchDB \u200b\u5bf9\u200b\u5d4c\u5957\u200b JSON \u200b\u67e5\u8be2\u200b\u6709\u200b\u9650\u5236\u200b\n# \u274c \u200b\u4e0d\u200b\u63a8\u8350\u200b\uff1a\u200b\u5d4c\u5957\u200b\u67e5\u8be2\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE metadata-&gt;'preferences'-&gt;&gt;'theme' = 'dark'\n\"\"\"))\n\n# \u2705 \u200b\u63a8\u8350\u200b\uff1a\u200b\u4f7f\u7528\u200b\u7b80\u5355\u200b\u5b57\u6bb5\u200b\u6216\u200b\u89c6\u56fe\u200b\nresult = conn.execute(text(\"\"\"\n    SELECT * FROM users\n    WHERE theme = 'dark'\n\"\"\"))\n</code></pre>"},{"location":"guide/type-mapping/#_11","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>SQL \u200b\u8f6c\u200b Mango Query</li> <li>\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b</li> </ul>"}]}